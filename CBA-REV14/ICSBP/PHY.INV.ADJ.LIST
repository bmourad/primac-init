*********************************************************************
* REVISION    - [08.1]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - ICS
* SOURCE      - ICSBP
* PROGRAM     - PHY.INV.ADJ.LIST
* DATE        - 04/03/90
* BY          - W.R. MCKENZIE , C.B.A
* DESCRIPTION - This report is used for physical inventory adjust
* list
*T25740 edvard 07/23/2001 * Added CATG.TRK.LVL    
*T26190 ajibaly 03/13/2002 Convert to rev12, use INV_AUDIT_HIST records
*                          instead of INV.ADJ.HIST records.
*T26493 cmykleb 03/22/2002 * Change report to use rpt # from proc.
*********************************************************************
*
*-----   INSERT EQUATES FROM CPYLIB
*
*COPY>ICS.CPYLIB>INV.WHSE
*COPY>ICS.CPYLIB>INV.WHSE.LOC
*COPY>ICS.CPYLIB>WAREHOUSE
*COPY>ICS.CPYLIB>CATEGORY
*COPY>ICS.CPYLIB>INV_AUDIT_HIST ;*T26190
*COPY>CPYLIB>SYSCOM
*COPY>ICS.CPYLIB>INVENTORY
*COPY>CPYLIB>CHAR
*
*-----   INITIALIZATION
*
   PAGE.NO           = 0
*
*-----   SET UP THE ERRMSG ROUTINE FOR SYSCOM
*
   SYS.TYPE = 1
   CALL SYSCOM(MAT SYSCOM.REC)
*
*-----   OPEN THE FILES
*
   OPEN "","INV.WHSE" TO INV.WHSE ELSE
      ERRMSG = "INV.WHSE FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","CATEGORY" TO CATEGORY ELSE
      ERRMSG = "CATEGORY FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","WAREHOUSE" TO WAREHOUSE ELSE
      ERRMSG = "WAREHOUSE FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","INV.WHSE.LOC" TO INV.WHSE.LOC ELSE
      ERRMSG = "INV.WHSE.LOC FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","INVENTORY" TO INVENTORY ELSE
      ERRMSG = "INVENTORY FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","INV_AUDIT_HIST" TO INV_AUDIT_HIST ELSE
      ERRMSG = "INV_AUDIT_HIST FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","CONTROL" TO CONTROL ELSE
      ERRMSG = "CONTROL FILE IS MISSING"
      GOTO 93000
   END
*
*-----   READ COMPANY NAME
*
   PROCREAD ID ELSE
      ERRMSG = " CANNOT PERFORM PROCREAD"
      GOTO 93000
   END
   CONO = ID<1>
   DIV       = ID<5>
*T26493 v
*  CONO.NAME = ID<2>
*  REPORT.NAME = "PHYSICAL INVENTORY ADJUSTMENT JOURNAL"
*  REPORT.NUMBER = "XXXX"
   REPORT.NUMBER = ID<2>
   REPORT.NAME = ""
   CONO.NAME = ""
*T26493 ^
   REPORT.DATE = DATE()
   HD1 = " ; HD2 = "
   HD3 = "DIVISION : ":DIV
   CALL GET.PROG.HEAD(CONO,CONO.NAME,REPORT.NAME,REPORT.NUMBER,REPORT.DATE,HD1,HD2)
*
*-----    PRINTER ON
*
   PRINTER ON
   FIRST = 1
   OMLINE = ""
   OPLINE = ""
   OWHSE = ""
   OLOC = ""
   OPROD = ""
   LINE.CNT = 99
*
*-----MAIN PROCESS
*
100 *
   READNEXT ID ELSE GOTO 999999
   MATREAD INAH.REC FROM INV_AUDIT_HIST,ID ELSE GOTO 100
   MATREAD INV.REC FROM INVENTORY, CONO:INAH.PROD ELSE
      MAT INV.REC = "???????????"
   END
   MATREAD CATG.REC FROM CATEGORY,CONO:INV.LINE ELSE
      MAT CATG.REC = "??????????????"
   END
   IF CATG.TRK.LVL="S" THEN
      MULTI.RSK = 1
   END ELSE
      MULTI.RSK = 0
   END
   BEGIN CASE
      CASE CATG.TYPE="L"
         U.M="LBS"
      CASE CATG.TYPE="S"
         U.M="SHT"
      CASE CATG.TYPE="RL"
         U.M="PC "
      CASE CATG.TYPE="PC"
         U.M="FT "
      CASE 1
         U.M = "QTY"
   END CASE
   WHSE.KEY=CONO:INAH.PROD:'!':INAH.WHSE
   MATREAD IWH.REC FROM INV.WHSE , WHSE.KEY ELSE
      MAT IWH.REC = "?????????????????"
   END
   IWH.KEY = CONO:INAH.PROD:"!":INAH.WHSE:"!":INAH.LOC
   MATREAD IWLO.REC FROM INV.WHSE.LOC, IWH.KEY ELSE
      MAT IWLO.REC = ""
   END
   BEGIN CASE
      CASE INV.UNIT<1,2>='SHT' AND INV.UNIT<1,3>='LBS'
         ICR.CNV="MD0";ICR.SCAL=0;ICR.TYPE=3
         ICR.DV1=INV.M.WT;ICR.MT1=1;ICR.DV2=1
      CASE INV.UNIT<1,2>='PC' AND INV.UNIT<1,3>='MSI'
         ICR.CNV="MD0";ICR.SCAL=0;ICR.TYPE=3
         ICR.DV1=INV.PAP.WIDTH/100;ICR.MT1=10;ICR.DV2=1
      CASE INV.UNIT<1,2>='FT' AND INV.UNIT<1,3>='MSI'
         ICR.CNV="MD0";ICR.SCAL=0;ICR.TYPE=3
         ICR.DV1=INV.PAP.WIDTH/100;ICR.MT1=100;ICR.DV2=12
      CASE 1
         ICR.CNV="MD2";ICR.SCAL=2;ICR.TYPE=4
         ICR.DV1=10;ICR.MT1=1;ICR.DV2=1
   END CASE
   BEGIN CASE
      CASE FIRST
         FIRST = 0
         GOSUB 1000
      CASE INV.M.LINE # OMLINE
         GOSUB 10000
         GOSUB 1000
      CASE INV.LINE # OPLINE
         GOSUB 10000
         GOSUB 1000
      CASE INAH.WHSE # OWHSE
         GOSUB 10000
         GOSUB 1000
      CASE INAH.LOC # OLOC
         GOSUB 10000
         GOSUB 1000
      CASE INAH.PROD # OPROD AND MULTI.RSK
         GOSUB 10000
         GOSUB 1000
      CASE 1
         GOSUB 1000
   END CASE
   OMLINE = INV.M.LINE
   OPLINE = INV.LINE
   OWHSE = INAH.WHSE
   OLOC = INAH.LOC
   OPROD = INAH.PROD
150 *
   GOTO 100
*
*----- PRINT LINE
*
1000 *
   IF LINE.CNT > 24 THEN
      LINE.CNT = 0
      GOSUB 10000
   END
   IF INAH.CUR.QTY < 0 THEN ROND="-.5" ELSE ROND=".5"
   TEMP.PREV.QTY = OCONV(INT(((INAH.CUR.QTY/ICR.DV1)*ICR.MT1)/ICR.DV2+ROND) , ICR.CNV)
   IF INAH.NEW.QTY < 0 THEN ROND="-.5" ELSE ROND=".5"
   TEMP.CURR.QTY = OCONV(INT(((INAH.NEW.QTY/ICR.DV1)*ICR.MT1)/ICR.DV2+ROND) , ICR.CNV)
   TEMP.DIFF.QTY = INAH.NEW.QTY - INAH.CUR.QTY
   IF TEMP.DIFF.QTY < 0 THEN ROND="-.5" ELSE ROND=".5"
   TEMP.DIFF.QTY = OCONV(INT(((TEMP.DIFF.QTY/ICR.DV1)*ICR.MT1)/ICR.DV2+ROND) , ICR.CNV)
*T26190 v
*  DLINE = INAH.PROD"L#15 "
*  DLINE = DLINE:INV.DESC"L#30 "
   DLINE = INAH.PROD"L#22 "
   IF INAH.SERIAL[1,1] = "R" OR INAH.SERIAL = "0" THEN
      DLINE = DLINE:INAH.RECP.NO"L#17 "
   END ELSE
      DLINE = DLINE:INAH.SERIAL"L#17 "
   END
*T26190 ^
   DLINE = DLINE:INV.COLOR"L#8 "
   DLINE = DLINE:OCONV(INV.BAS.WT,"MD2")"R#8 "
   DLINE = DLINE:OCONV(INV.M.WT,"MD0Z")"R#6 "
*T26190 v
*  DLINE = DLINE:IAH.R.S.ID"L#11 "
*T26190 ^
   DLINE = DLINE:TEMP.PREV.QTY"R#11 "
   DLINE = DLINE:TEMP.CURR.QTY"R#11 "
   DLINE = DLINE:TEMP.DIFF.QTY"R#11 "
   DLINE = DLINE:OCONV(INAH.CUR.DIAM,"MD2")"R#5 "
   DLINE = DLINE:OCONV(INAH.NEW.DIAM,"MD2")"R#5 "
   PRINT DLINE
*T26190 v
*  PRINT
   DLINE = INV.DESC
   PRINT DLINE
*T26190 ^
   LINE.CNT = LINE.CNT + 1
   RETURN
*
*----HEADINGS
*
10000 *
   PAGE.NO = PAGE.NO + 1
   WHSE.KEY = CONO:INAH.WHSE
   MATREAD WHSE.REC FROM WAREHOUSE, WHSE.KEY ELSE MAT WHSE.REC = ""
   HD0 = HD1:PAGE.NO"R#4"
   HD4 = "MLINE : ":INV.M.LINE"L#7":"   ":"PLINE : ":INV.LINE"L#6"
   HD4 = HD4:"  WAREHOUSE : ":INAH.WHSE"L#4":" ":WHS.DESC"L#30"
   HD4 = HD4:"   LOCATION : ":INAH.LOC"L#4"
   HD6 = "PRODUCT #/DESCRIPTION  SERIAL/RECEIPT #   COLOR"
   HD6 = HD6:"    BAS WT   M/WHT"
   HD6 = HD6:"  CUR /  ":U.M"L#3":"  REV /  ":U.M"L#3":"  DIF /  ":U.M"L#3":" C/DIA R/DIA"
   HD7 = "---------------------  ----------------  --------"
   HD7 = HD7:" -------- ------"
   HD7 = HD7:"  ----------  ----------  ---------- ----- -----"
   PRINT CHAR(12)
   PRINT HD0
   PRINT HD2
   PRINT HD3
   PRINT
   PRINT
   PRINT HD4
   PRINT
   PRINT HD6
   PRINT HD7
   RETURN
*
*-----   CALLS FOR SYSCOM
*
91000 *
   ERR.TYPE = 1
   CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
92000 *
   ERR.TYPE = 2
   CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
93000 *
   ERR.TYPE = 3
   CALL SYSCOM(MAT SYSCOM.REC)
999999 *
   PRINTER OFF
END
