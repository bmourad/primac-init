SUBROUTINE RS.REC.ED.LIST
*********************************************************************
* REVISION    - [10.3]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - ICSBP
* PROGRAM     - STOCK.REC.EDIT.LIST
* BY          - EDVARD PITKA
* DATE        - 07/30/01
* DESCRIPTION
* Thist program prints serial stock receipt edit listing.
*T26090 ajibaly 03/22/2002 * CONVERT TO R12 REPORT.SCRN
*T26497 adelgado 04/04/2002 * Add validation rule for Inter-Divisional
*                             Whse.
*T26090 cmykleb 04/11/2002 * If report was (V)iewed do not update records
*                            as printed.
*T26556 cmykleb 04/22/2002 * PO TOTAL is not printing the correct amt.
*T26678 lhelms 06/18/2002 * SUBTOTAL ON PROD WITHIN A RECEIPT
*C40364 cmykleb 07/18/2002 * Remove the over all total and po total.
*T27306 lross 06/10/2003 * Resolve mods from 26556.
*T27940 lross 02/05/2004 * Error in calc Variance.
*T27801 lross 04/07/2004 * Additional error checks.
*T27904 cmykleb 04/14/2004 * Additional error checks for rs receipts.
*T28090 lross 04/28/2004 * Add warning msg for total qty to post = 0.
*T27904 cmykleb 06/09/2004 * If location error message is longer than 30
*                            characters it needs to truncate and print
*                            the rest on the next line.
*T28300 lross 11/15/2004 * New conversions for PUG.
*T27928 lross 12/22/2004 * Make it a subroutine.
*********************************************************************
*
*------------------------ COPY STATEMENTS ---------------------------
*
*COPY>PMC.CPYLIB>COMPANY
*COPY>PMC.CPYLIB>PO
*COPY>ICS.CPYLIB>DAILY_STOCK
*COPY>ICS.CPYLIB>INVENTORY
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*COPY>ICS.CPYLIB>PO.RSKI.XREF
*COPY>ICS.CPYLIB>PO.MAN.XREF
*COPY>ICS.CPYLIB>INV_SERIAL
*COPY>ICS.CPYLIB>SAVE.STOCK.REC
*COPY>ICS.CPYLIB>INV.WHSE
*COPY>CPYLIB>SYSCOM
*COPY>ICS.CPYLIB>CATEGORY
*COPY>ICS.CPYLIB>WAREHOUSE
*COPY>ICS.CPYLIB>INV.CNV
   EQU INV.UOM.CST TO INV.UNIT<1,3>
*
*---------------------------- READ PROC -----------------------------
*
   PROCREAD X ELSE
      ERRMSG="THIS REPORT MUST RUN FROM A PROC"
      GOTO 93000
   END
   CONO=X<1>
*T26090> CNAME=X<2>
   CNAME = ''; *<T26090
   RPT.TYPE=X<9>
   PRINT.FLAG = X<10> ; * T26090
*
*------------------- SETUP FOR SYSTEM ERRMSGS ----------------------
*
   SYS.TYPE=1
   CALL SYSCOM(MAT SYSCOM.REC)
*
*------------------------- OPEN FILES -------------------------------
*
   OPEN "","INVENTORY" TO INVENTORY ELSE
      ERRMSG="INVENTORY FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","INV_SERIAL" TO INV_SERIAL ELSE
      ERRMSG ="INV_SERIAL FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","PO.RSKI.XREF" TO PO.RSKI.XREF ELSE
      ERRMSG ="PO.RSKI.XREF FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","PO.MAN.XREF" TO PO.MAN.XREF ELSE
      ERRMSG ="PO.MAN.XREF FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","CONTROL" TO CONTROL ELSE
      ERRMSG ="CONTROL FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","INV.WHSE" TO INV.WHSE ELSE
      ERRMSG="INV.WHSE FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","DAILY_STOCK" TO DAILY_STOCK ELSE
      ERRMSG="DAIL_STOCK FILE IS MISSING"
      GOTO 93000
   END
   OPEN "","CATEGORY" TO CATEGORY ELSE
      ERRMSG="CATEGORY FILE IS MISSING";GOTO 93000
   END
   OPEN "","COMPANY" TO COMPANY ELSE
      ERRMSG="COMPANY FILE IS MISSING";GOTO 93000
   END
   OPEN "","WAREHOUSE" TO WAREHOUSE ELSE
      ERRMSG="WAREHOUSE FILE IS MISSING";GOTO 93000 
   END
*
*------------------------ INITIALIZATION --------------------------
*
   MATREAD COMP.REC FROM COMPANY, CONO ELSE
      MAT COMP.REC=""
   END
   END.DATE=""
   PAGE.NO=0
   LINE.CNT=0
   SP1=" "
   SP2="  "
   SP4="    "
   SP5="     "
   SP9=SPACE(9)
   SP12=SPACE(12)
   SP16=SPACE(16)
   SP26=SPACE(26)
   SP67=SPACE(67)
   SP39=SPACE(39)
   SP84=SPACE(84)
   TLV1="Manifest #: "
   TLV2=" Manifest total: "
   TLV3="          Total: "
   TLV4="Prior Posting Total="
   TLV5="Variance    "
   TLV6="PO TOTAL    "
   TLV7="GRAND TOTAL "
   OLD.PO.NO=""
   DATE.TOTAL=0
   RECP.TOTAL=0
   STATUS=''
   PO.TOTAL=0
   GRAND.TOTAL=0
   PRIOR.POST.TOTAL=0
*<1> = TOTAL
*<2> = LINE NUMBER
   VARIANCE=0
   PRINT.LINE=0
   PRINT.PO.TOTAL=0
   PRINT.GRAND.TOTAL=0
   MAT DSR.REC=""
   MAT RSMAN.REC=""
   PRINTER ON
*
*------------------------ GET HEADING -------------------------------
*
   IF RPT.TYPE="EDIT" THEN
      REPORT.NAME="DAILY.STOCK.RECEIPTS.EDIT.LISTING"
   END ELSE
      REPORT.NAME="STOCK.RECEIPTS.REJECT.LISTING"
   END
   RNUM = X<2>
   REPORT.NAME = '' ;*T26090
   HD1=""
   HD2=""
   CALL GET.PROG.HEAD(CONO,CNAME,REPORT.NAME,RNUM,END.DATE,HD1,HD2)
*
*------------------ READ AND PROCESS ALL RECORDS --------------------
*
10 *
   RECP.TOTAL=0
   VARIANCE=0
   PRINT.LINE=0
   DONE=0 ; LPTR=0 ; OLD.SEQ=""
   FIRST.TIME=1 ; * C36923
   LOOP
      READNEXT DSR.ID ELSE
         DONE=1
         IF FIRST.TIME THEN
            IF RPT.TYPE='REJECT' THEN
               GOSUB PRINT.HEADING
               PRINT 'NO ITEMS PRESENT'
               GOTO 99999
            END
         END
      END
   UNTIL (DONE) DO
      FIRST.TIME=0
      PO.TOTAL=0
      RECP.TOTAL=0
      PRIOR.POST.TOTAL=0
      MATREAD DSR.REC FROM DAILY_STOCK,DSR.ID THEN
         GOSUB PRINT.HEADING
         MATREAD RSMAN.REC FROM PO.MAN.XREF,DSR.ID THEN 
*T27306 v Move to be within PP Loop.
*           GOSUB CALC.PRIOR.POST.TOTAL
            MAN.NO=DSR.SHPMNT.NO
            MAN.TOT=DSR.SHPMNT.TOT
*T26090 v
*           DSR.EDIT.DATE=DATE()
            IF PRINT.FLAG # "V" THEN DSR.EDIT.DATE=DATE()
*T26090 ^
            PROD.CNT=DCOUNT(DSR.PROD,VM)
            FOR PP=1 TO PROD.CNT
               S.CNT = DCOUNT(DSR.SERIAL<1,PP>,SVM)
*T27306 v
               GOSUB CALC.PRIOR.POST.TOTAL
               DSR.STATUS<1,PP>=""
               DSR.LOC.STATUS<1,PP>=""
               PROD=DSR.PROD<1,PP>
               WHSE=DSR.WHSE<1,PP>
*T27306        CONO=DSR.ID[1,3]
               INV.ID = CONO:PROD
               MATREAD INV.REC FROM INVENTORY,INV.ID ELSE MAT INV.REC = ''
               ;*T27009 v
*              RECV.QTY = SUM(DSR.QTY<1,PP>)
               RECV.QTY=0
               SCNT=DCOUNT(DSR.SERIAL<1,PP>,SVM)    
               POST.CNT = SCNT ;*T27306
               UM=DSR.UOM<1,PP>
               UN.PRICE=DSR.UN.PRICE<1,PP>
               FOR SS=1 TO SCNT                      
                  IF DSR.POST.DATE<1,PP,SS>='' THEN 
                     RECV.QTY+=DSR.QTY<1,PP,SS>     
                     POST.CNT -= 1 ;*T27306
                  END                                
               NEXT SS                               
               ;*T27009 ^
               IF RECV.QTY > 0 THEN
                  IWH.ID = INV.ID:"!":WHSE
                  MATREAD INV.REC FROM INVENTORY,INV.ID THEN
*COPY>ICSBP>INV.UM.CNV
                     CATG.ID = CONO:INV.LINE
                     MATREAD CATG.REC FROM CATEGORY,CATG.ID THEN
                * T26497 v
                        IF CO.INTR.WHSE # '' AND WHSE = CO.INTR.WHSE THEN
                           DSR.STATUS<1,PP> = 'CANNOT USE AN INTER-DIVISIONAL WHSE ':WHSE
                        END ELSE
                * T26497 ^
                           MATREAD IWH.REC FROM INV.WHSE,IWH.ID THEN
                              GOSUB CHECK.SERIAL
                           END ELSE
                              DSR.STATUS<1,PP>="INV.WHSE ":IWH.ID:" IS MISSING." 
                           END
                        END           ;* T26497
                     END ELSE
                        DSR.STATUS<1,PP>="CATEGORY ":INV.LINE:" IS MISSING."
                     END
                  END ELSE
                     DSR.STATUS<1,PP>="INVENTORY ":PROD:" IS MISSING."
                  END
               END ELSE
*T27306 v
                  IF POST.CNT < 1 AND SCNT > 0 THEN
*T28090 v
*                    DSR.STATUS<1,PP>="Qty. must be greater than 0."  
                     DSR.STATUS<1,PP>="Warning: Qty to post = 0, result will be deletion of serials from system."
*T28090 ^
                  END
*T27306 ^
               END
               GOSUB PRINT.DETAIL.LINE
            NEXT PP
         END ELSE
            GOSUB PRINT.HEADING
            PRINT "Manifest record ":DSR.ID:" is missing."
         END
      END
      MATWRITE DSR.REC ON DAILY_STOCK,DSR.ID
      GOSUB PRINT.RECP.TOTAL
*C40364  GOSUB PRINT.PO.TOTAL
*  GOSUB PRINT.GRAND.TOTAL
   REPEAT
   GOTO 99999
*
*
**************************************************************************
**** S U B R O U T I N E S ***********************************************
**************************************************************************
*
**************
CHECK.SERIAL: 
**************
*
   S.CNT = DCOUNT(DSR.SERIAL<1,PP>,SVM)
   FOR SS=1 TO S.CNT
      IF DSR.QTY<1,PP,SS> # '' THEN
         ISTK.ID = CONO:DSR.SERIAL<1,PP,SS>
         MATREAD ISTK.REC FROM INV_SERIAL,ISTK.ID THEN
            IF ISTK.POST.DATE='' THEN
               IF DSR.QTY<1,PP,SS>=0 THEN
                  DSR.LOC.STATUS<1,PP,SS>='Serial will be deleted'
               END ELSE
*T27801 v
                  IF ISTK.MANIFEST.NO # DSR.SHPMNT.NO THEN
                     DSR.LOC.STATUS<1,PP,SS>:= 'Serial belongs to PO ':ISTK.PO.NO:' manifest ':ISTK.MANIFEST.NO
                  END
*T27801 ^
                  IF ISTK.PO.NO # "" THEN
                     IF ISTK.PO.NO # DSR.PO THEN
                        DSR.LOC.STATUS<1,PP,SS>:="Serial belongs to PO ":ISTK.PO.NO
                     END ELSE
                        IF ISTK.PO.LINE # DSR.PO.LINE<1,PP> THEN
                           DSR.LOC.STATUS<1,PP,SS>="Serial belongs to PO line. ":ISTK.PO.LINE
                        END ELSE
                           IF INV.PAP.TYPE='ROLL' OR INV.PAP.TYPE='LROLL' OR INV.PAP.TYPE='PCOAT' THEN
                              IF INV.FACTOR+0>0 AND INV.PAP.WIDTH+0>0 AND INV.CORE.DIA+0>0 THEN
                                 IF DSR.DIAM<1,PP,SS>+0=0 THEN
                                    DSR.LOC.STATUS<1,PP,SS>:='Diameter is zero'             
                                 END
                              END
                           END                                                      
                        END
                     END
                  END
               END
*T27904 v
*           END
            END ELSE
               DSR.LOC.STATUS<1,PP,SS>:='Serial has already been received'
            END
*T27904 ^
         END ELSE
            MAT ISTK.REC=""
         END
*T26090 v
*        IF RPT.TYPE="EDIT" THEN ISTK.EDIT.DATE=DATE()
         IF RPT.TYPE="EDIT" AND PRINT.FLAG # "V" THEN ISTK.EDIT.DATE=DATE()
*T26090 ^
         MATWRITE ISTK.REC ON INV_SERIAL, ISTK.ID
      END
   NEXT SS
   RETURN
*
******************
PRINT.DETAIL.LINE: 
******************
*
   PROD.RECP.TOTAL = 0
*T28090 v
   HOLD.STATUS=''
   IF LEN(DSR.STATUS<1,PP>) > 30 THEN
*    HOLD.STATUS=FIELD(DSR.STATUS<1,PP>,",",2); DSR.STATUS<1,PP>=FIELD(DSR.STATUS<1,PP>,",",1):","
      CALL DESC.REFORMAT.2(DSR.STATUS<1,PP>,'30',HOLD.STATUS)
   END
   IF HOLD.STATUS = '' THEN
      P.LINE = PROD"L#15":SP1:INV.FULL.DESC"L#45":SP39:DSR.STATUS<1,PP>"L#30"
      PRINT P.LINE
   END ELSE
      P.LINE = PROD"L#15":SP1:INV.FULL.DESC"L#45":SP39:HOLD.STATUS<1,1>"L#30"
      PRINT P.LINE
      FOR H = 2 TO DCOUNT(HOLD.STATUS,VM)
         PRINT SPACE(100):HOLD.STATUS<1,H>"L#30"
         LINE.CNT += 1
      NEXT H
   END
*  PRINT P.LINE
   LINE.CNT +=1
*T28090 ^
*T27306 v Enclose detail print with condition.
   IF RECV.QTY > 0 OR DSR.STATUS<1,PP> # '' OR DSR.LOC.STATUS<1,PP> # '' THEN
      FOR SS = 1 TO S.CNT
         IF LINE.CNT > 55 THEN 
            GOSUB PRINT.HEADING
         END
         QTY = DSR.QTY<1,PP,SS>
         IF QTY #'' THEN
            LOC = DSR.LOC<1,PP,SS>
            SERIAL = DSR.SERIAL<1,PP,SS>
            MILL.ID = DSR.MILL.ID<1,PP,SS>
*T27306 v
            MATREAD ISTK.REC FROM INV_SERIAL,CONO:SERIAL ELSE MAT ISTK.REC = ''
            ;* convert from costing uom to buying uom.
*T28300     IF UM = 'LBS' OR UM = 'MSI' THEN
            IF UM # 'SHT' AND UM # 'FT' AND UM # 'PC' THEN
               PQTY = OCONV(ISTK.LBS.ENTERED,'MD2')
            END ELSE
               PQTY = ISTK.LBS.ENTERED
            END
            IQTY = ISTK.LBS.ENTERED
            PROD.RECP.TOTAL +=IQTY ;* 26678
*T28300     IF UM # 'LBS' AND UM # 'MSI' THEN IQTY *= 100
            IF UM = 'SHT' OR UM = 'FT' OR UM = 'PC' THEN IQTY *= 100
*T27306     QTY=INT(QTY+.5)
*           RECP.TOTAL +=QTY
            RECP.TOTAL +=IQTY
*           PROD.RECP.TOTAL +=QTY ;* 26678
*T27306 v   QTY=QTY"R#11"
            QTY=PQTY"R#11"
            STATUS=DSR.LOC.STATUS<1,PP,SS>
*T27904 v
            HOLD.STATUS = ''
            IF LEN(STATUS) > 30 THEN
               CALL DESC.REFORMAT.2(STATUS,'30',HOLD.STATUS)
            END
*T27904 ^
            D.LINE=SP16:WHSE"L#4":SP1:LOC"L#4":SP1:SERIAL"L#15"
            D.LINE:=SP1:MILL.ID"L#15":SP1:OCONV(DSR.DATE,"D2/")"L#8"
            D.LINE:=SP1:DSR.PERIOD"L#6":SP1:OCONV(UN.PRICE,"MD4")"R#9"
            D.LINE:=SP1:QTY:SP1:UM"L#3"
*T27904 v
*           D.LINE:=SP1:STATUS"L#30"
            IF HOLD.STATUS = '' THEN
               D.LINE:=SP1:STATUS"L#30"
            END ELSE
               D.LINE:=SP1:HOLD.STATUS<1,1>"L#30"
            END
*T27904 ^
            PRINT D.LINE
            LINE.CNT +=1
*T27904 v
            IF HOLD.STATUS # '' THEN
               HCNT = DCOUNT(HOLD.STATUS<1>,VM)
               FOR H = 2 TO HCNT
                  PRINT SPACE(100):HOLD.STATUS<1,2>'L#30'
                  LINE.CNT +=1
               NEXT H
            END
*T27904 ^
         END
      NEXT SS
  * T 26678
      IF LINE.CNT + 2 > 55 THEN 
         GOSUB PRINT.HEADING
      END
      T.LINE=SP84: "==========="
      PRINT T.LINE
*T27306 v
*T28300 IF UM = 'LBS' OR UM = 'MSI' THEN
      IF UM # 'SHT' AND UM # 'FT' AND UM # 'PC' THEN
         PROD.RECP.TOTAL = OCONV(PROD.RECP.TOTAL,'MD2')
      END
*T27306 ^
      T.LINE=SP67: TLV3:PROD.RECP.TOTAL"R#11"
      PRINT T.LINE
      LINE.CNT +=2
   END
*IF PRIOR.POST.TOTAL<1,PP> # 0 THEN
   IF PRIOR.POST.TOTAL # 0 THEN
*T28300 IF UM = 'LBS' OR UM = 'MSI' THEN
      IF UM # 'SHT' AND UM # 'FT' AND UM # 'PC' THEN
*   PRIOR.POST.TOTAL<1,PP> = OCONV(PRIOR.POST.TOTAL<1,PP>,'MD2')
         PRIOR.POST.TOTAL = OCONV(PRIOR.POST.TOTAL,'MD2')
      END
* T.LINE=SPACE(38):TLV4:SP1:PRIOR.POST.TOTAL<1,PP> "R#11"
      T.LINE=SPACE(38):TLV4:SP1:PRIOR.POST.TOTAL "R#11"
      PRINT T.LINE
      LINE.CNT += 1
   END
   PRIOR.POST.TOTAL=0
*T27306 ^
   RETURN
*
*********************
CALC.PRIOR.POST.TOTAL: 
*********************
*
*T27306 v
*CNT = DCOUNT(RSMAN.RS.NO,VM)
   CNT=S.CNT
   FOR CC=1 TO CNT
* MATREAD ISTK.REC FROM INV_SERIAL,CONO:RSMAN.RS.NO<1,CC> THEN
      MATREAD ISTK.REC FROM INV_SERIAL,CONO:DSR.SERIAL<1,PP,CC> THEN
*T27306 v
*   LOCATE RSMAN.LINE.NO<1,CC> IN PRIOR.POST.TOTAL<2> SETTING POS ELSE PRIOR.POST.TOTAL<1,POS>=0
*   LOCATE PP IN PRIOR.POST.TOTAL<2> SETTING POS ELSE PRIOR.POST.TOTAL<1,POS>=0; PRIOR.POST.TOTAL<2,POS> = PP
*T27306 ^
*T27306 v PRIOR.POST.TOTAL<1,POS> +=ISTK.ORG.QTY
*   PRIOR.POST.TOTAL<1,POS> += ISTK.LBS.ENTERED
         IF ISTK.POST.DATE # "" THEN
            PRIOR.POST.TOTAL += ISTK.LBS.ENTERED
         END
      END
   NEXT CC
   RETURN
*
*******************
CHECK.WGT.VARIANCE: 
*******************
*
*IF RSMAN.MAN.TOT.WGT+0 # 0 THEN
   IF MAN.TOT+0 # 0 THEN
* VARIANCE=ABS(RSMAN.MAN.TOT.WGT - RECP.TOTAL)
*T27940 v
*T28300 IF UM # 'LBS' AND UM # 'MSI' THEN
      IF UM = 'SHT' OR UM = 'FT' OR UM = 'PC' THEN
         VARIANCE = ABS(MAN.TOT/100 - RECP.TOTAL/100)
      END ELSE
         VARIANCE=ABS(MAN.TOT - RECP.TOTAL)
      END
*T27940 ^
* IF VARIANCE # 0 THEN
      IF VARIANCE # 0 AND RECP.TOTAL+0 # 0 THEN
         SEQ.CNT = DCOUNT(RSMAN.RS.NO,VM)
         FOR A=1 TO SEQ.CNT
            MATREADU ISTK.REC FROM INV_SERIAL, CONO: RSMAN.RS.NO<1,A> THEN
               IF ISTK.STATUS="" AND ISTK.POST.DATE="" AND ISTK.ENTRY.DATE # "" AND ISTK.LBS.ENTERED # 0 THEN ISTK.STATUS="Shipment var."
               MATWRITE ISTK.REC ON INV_SERIAL, CONO: RSMAN.RS.NO<1,A>
            END ELSE
               RELEASE INV_SERIAL, CONO: RSMAN.RS.NO<1,A>
            END
         NEXT A
      END
   END
   RETURN
*
*****************
PRINT.RECP.TOTAL: 
*****************
*
*C40364 v
*  T.LINE=SP84: "==========="
*  PRINT T.LINE
*  T.LINE=TLV1:MAN.NO "L#20":' ':TLV2: OCONV(MAN.TOT,"MD2") "R#12"
*  T.LINE=T.LINE:TLV3:RECP.TOTAL"R#11"
   T.LINE = TLV1:MAN.NO"L#20":SPACE(1)
*C40364 ^
*T27306 v Move up to product total line.
*IF PRIOR.POST.TOTAL<1,PP> # 0 THEN
*  T.LINE=T.LINE:SP4:TLV4:OCONV(PRIOR.POST.TOTAL<1,PP>/10,"MD2") "R#11"
*END
   PRINT T.LINE
   LINE.CNT += 1
*T27306 v
   GOSUB CHECK.WGT.VARIANCE
*IF VARIANCE # 0 THEN
   IF VARIANCE # 0 AND RECP.TOTAL+0 # 0 THEN
*T28300  IF UM = 'LBS' OR UM = 'MSI' THEN
      IF UM # 'SHT' AND UM # 'FT' AND UM # 'PC' THEN
         VARIANCE = OCONV(VARIANCE,'MD2')
      END
* T.LINE=SP67:TLV5:OCONV(VARIANCE/10,"MD2")"R#11"
      T.LINE=SP67:TLV5:VARIANCE"R#11"
*T27306 ^
      T.LINE=T.LINE:SP5:"*********** VARIANCE ***********"
      PRINT T.LINE
      LINE.CNT += 1
   END
   IF RSMAN.MAN.TOT.WGT + 0=0 THEN
*T26556 v
*     PO.TOTAL=PO.TOTAL + (RECP.TOTAL/10) + (PRIOR.POST.TOTAL<1,PP>/10)
      PO.TOTAL = PO.TOTAL + RECP.TOTAL + SUM(PRIOR.POST.TOTAL<1>)
*T26556 ^
   END ELSE
      PO.TOTAL=PO.TOTAL + RSMAN.MAN.TOT.WGT
   END
   RETURN
*
***************
PRINT.PO.TOTAL: 
***************
*
   PRINT
   T.LINE=''
   T.LINE=SP39:TLV6:OCONV(PO.TOTAL,"MD2") "R#11"
* T.LINE=SP39:TLV6:PO.TOTAL "R#11"
   PRINT T.LINE
   PRINT
   GRAND.TOTAL=GRAND.TOTAL + PO.TOTAL
   RETURN
*
******************
PRINT.GRAND.TOTAL: 
******************
*
   T.LINE=''
   T.LINE=SP39:TLV7:OCONV(GRAND.TOTAL,"MD2") "R#11"
   PRINT T.LINE
   RETURN
*
*--------------------- PRINT HEADINGS ------------------------------
*
*************
PRINT.HEADING: 
**************
*
   PRINT CHAR(12)
   PAGE.NO=PAGE.NO + 1
   H.LINE=""
   H.LINE=HD1:PAGE.NO
   PRINT H.LINE
   H.LINE=""
   H.LINE=HD2
   PRINT H.LINE
   H.LINE=""
   PRINT
   SHD3="PO Number : "
   SHD4="Vendor Number : " 
   TLV1="Manifest #: "
   TLV2=" Manifest total: "
   IF CO.LOT.TRACK="Y" THEN
      SHD7="Product / Desc  Whse Loc   Serial Number  Mill Roll/Lot # Rec Date Period UnitPrice   Quantity  UOM            Status    "
   END ELSE
      SHD7="Product / Desc  Whse Loc   Serial Number   Mill Roll ID   Rec Date Period UnitPrice   Quantity  UOM            Status    "
   END
   UL=  "--------------- ---- ---- --------------- --------------- -------- ------ --------- ----------- --- ------------------------------"
   SH.LINE=""
   SH.LINE=SHD3:DSR.PO
   SH.LINE=SH.LINE:"     ":SHD4:DSR.VEND      ;*T24023
   PRINT SH.LINE
   PRINT
   SH.LINE=""
   SH.LINE=SHD7
   PRINT SH.LINE
   SH.LINE=""
   SH.LINE=UL
   PRINT SH.LINE
   LINE.CNT=8
   RETURN
*
*
*---------------------- CALLS FOR SYSCOM ----------------------------
*
91000 ERR.TYPE=1;CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
92000 ERR.TYPE=2;CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
93000 ERR.TYPE=3;CALL SYSCOM(MAT SYSCOM.REC)
*
99990 *
   PROCWRITE "END"
*
*----------------------- END OF JOB ---------------------------------
*
99999 *
   PRINTER CLOSE
   PRINTER OFF
   RETURN
END
