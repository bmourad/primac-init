*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - ICSBP
* PROGRAM     - INV.YTD.RPT
* DATE        - 02/25/86
* BY          - JIHAD YAMOUT , C.B.A
* DESCRIPTION - This report list inventory year to date analysis.
*T21638 doug 02/26/1997 * Add quantity conversion for FNGD
*T26190 cmykleb 03/11/2002 * Change report to use new rev12 changes and
*                            files.
*T26493 cmykleb 03/22/2002 * Change report to use rpt # from proc.
*********************************************************************
***   INSERT EQUATE FROM CPYLIB
*COPY>CPYLIB>SYSCOM
*COPY>ICS.CPYLIB>INVENTORY
*COPY>ICS.CPYLIB>INV.CNV
*COPY>ICS.CPYLIB>INV_AUDIT_BAL
*COPY>ICS.CPYLIB>INV_AUDIT_HIST
*COPY>ICS.CPYLIB>INV.WHSE
*COPY>CPYLIB>CHAR
*T26190 v
   DEFFUN CALC.PTD(CONO,PROD.NUM,CURR.WHSE,CUR.PERIOD)
   DEFFUN CALC.YTD(CONO,PROD.NUM,CURR.WHSE,CUR.PERIOD)
   DEFFUN CALC.STK.QTY(COST.QTY,MAT INV.CNV.REC,ROND,LN)
*T26190 ^
***   INITIALIZATION
   LINE.COUNT=99 ; PAGE.NO=0 
   PREV.WHSE="" ; PREV.M.P.LINE="" ; PREV.BAS.WT=""
   PTOTALS="" ; BTOTALS="" ; MTOTALS="" ; WTOTALS="" ; GTOTALS=""
   SP1=SPACE(1)
***   SET UP THE ERRMSG ROUTINE FOR SYSCOM
   SYS.TYPE=1
   CALL SYSCOM(MAT SYSCOM.REC)
***   OPEN THE FILE
   OPEN '','INV_AUDIT_HIST' TO INV_AUDIT_HIST ELSE
      ERRMSG='INV_AUDIT_HIST FILE IS MISSING'
      GOTO 93000
   END
   OPEN '','INV_AUDIT_BAL' TO INV_AUDIT_BAL ELSE
      ERRMSG='INV_AUDIT_BAL FILE IS MISSING'
      GOTO 93000
   END
   OPEN '','INVENTORY' TO INVENTORY ELSE
      ERRMSG='INVENTORY FILE IS MISSING'
      GOTO 93000
   END
   OPEN '','INV.WHSE' TO INV.WHSE ELSE
      ERRMSG='INV.WHSE FILE IS MISSING'
      GOTO 93000
   END
***   READ COMPANY NAME 
   PROCREAD ID ELSE
      ERRMSG=' CANNOT PERFORM PROCREAD'
      GOTO 93000
   END
   CONO=ID<1>
   PERIOD=ID<9> ; * T26190
   YEAR=PERIOD[1,4]
   PER=PERIOD[5,2]
*T26493 v
*  CONO.NAME=ID<2>
*  REPORT.NAME="INVENTORY.YEAR.TO.DATE.ANALYSIS.REPORT"
*  REPORT.NUMBER="XXXX"
   REPORT.NUMBER=ID<2>
   REPORT.NAME=""
   CONO.NAME=""
*T26493 ^
   REPORT.DATE=DATE()
   HD1="" ; HD2=""
   CALL GET.PROG.HEAD(CONO,CONO.NAME,REPORT.NAME,REPORT.NUMBER,REPORT.DATE,HD1,HD2)
   PRINTER ON
   *** READ AND PROCESS THE FIRST RECORD ***
100*
   READNEXT KEY ELSE GOTO 999999
   GOSUB 200
   MATREAD IWH.REC FROM INV.WHSE,KEY ELSE GOTO 100
   MATREAD INV.REC FROM INVENTORY,PROD.KEY ELSE MAT INV.REC=''
   *** GET THE PRODUCT # ***
   PREV.WHSE=WHSE
   PREV.M.P.LINE=INV.M.LINE:" / ":INV.LINE
   PREV.BAS.WT=INV.BAS.WT
   *** GET THE HEADING LINES ***
   HH.LINE=" PRODUCT NUMBER                                BEGINNING   RECEIPTS   TRANSFER IN TRANSFER OT ADJUSTMENTS SALE/USAGE    ON-HAND "
   HH1.LINE="FULL DESCRIPTION                               QTY / AMT   QTY / AMT   QTY / AMT   QTY / AMT   QTY / AMT   QTY / AMT   QTY / AMT"
   HH2.LINE="--------------------------------------------- ----------- ----------- ----------- ----------- ----------- ----------- -----------"
   DH1.LINE="                                              ----------- ----------- ----------- ----------- ----------- ----------- -----------"
   DH2.LINE="                                              =========== =========== =========== =========== =========== =========== ==========="
   GOSUB 1000 ; * PROCESS THE FILE
   DATA=0
   LOOP
      READNEXT KEY ELSE DATA=1
   WHILE DATA=0 DO
      GOSUB 200
      MATREAD IWH.REC FROM INV.WHSE,KEY ELSE GOTO 111
      MATREAD INV.REC FROM INVENTORY,PROD.KEY ELSE MAT INV.REC=''
      GOSUB 1000 ; * PROCESS A RECORD
111*
   REPEAT
   *** PRINT THE TOTALS FOR THE LAST PRODUCT ***
   GOSUB 25000 ; GOSUB 26000 ; GOSUB 27000
   *** PRINT THEN GRAND TOTALS ***
   IF LINE.COUNT+3 > 54 THEN GOSUB 80000
   PRINT
   PRINT
   T.LINE=SPACE(3):"GRAND TOTAL":SPACE(32)
   T.LINE=T.LINE :OCONV(GTOTALS<2>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(GTOTALS<4>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(GTOTALS<6>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(GTOTALS<8>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(GTOTALS<10>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(GTOTALS<12>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(GTOTALS<14>, "MD2") "R#11":SP1
   PRINT T.LINE
***    END OF JOB
   GOTO 999999
200 * GET THE PROD AND WHSE
   PROD.KEY=FIELD(KEY,"!",1)
   PROD=PROD.KEY[4,99]
   WHSE=FIELD(KEY,"!",2)
   RETURN
1000 * PROCESS THE RECORD
   BEGIN CASE
      CASE PREV.WHSE # WHSE
         GOSUB 25000
         GOSUB 26000
         GOSUB 27000
         LINE.COUNT=99
      CASE PREV.M.P.LINE # INV.M.LINE:" / ":INV.LINE
         GOSUB 25000
         GOSUB 26000
         LINE.COUNT=99
      CASE PREV.BAS.WT # INV.BAS.WT
         GOSUB 25000
   END CASE
*COPY>ICSBP>INV.UM.CNV
   YTD=CALC.YTD(CONO,PROD,WHSE,PERIOD)
   MAT ITB.REC=''
   MATPARSE ITB.REC FROM YTD,@AM
   IF LINE.COUNT+2 > 54 THEN GOSUB 80000
   LINE.COUNT=LINE.COUNT+2
   PTOTALS<1>=CALC.STK.QTY(ITB.BEG,MAT INV.CNV.REC,'','')
   PTOTALS<2>=ITB.BEG.AMT
   PTOTALS<3>=CALC.STK.QTY(ITB.RECV,MAT INV.CNV.REC,'','')
   PTOTALS<4>=ITB.RECV.AMT
   PTOTALS<5>=CALC.STK.QTY(ITB.TRAN.IN,MAT INV.CNV.REC,'','')
   PTOTALS<6>=ITB.TRAN.IN.AMT
   PTOTALS<7>=CALC.STK.QTY(ITB.TRAN.OUT,MAT INV.CNV.REC,'','')
   PTOTALS<8>=ITB.TRAN.OUT.AMT
   PTOTALS<9>=CALC.STK.QTY(ITB.SHRNK,MAT INV.CNV.REC,'','')
   PTOTALS<10>=ITB.SHRNK.AMT
   PTOTALS<11>=CALC.STK.QTY(ITB.SALE,MAT INV.CNV.REC,'','')
   PTOTALS<12>=ITB.SALE.AMT
   F.LINE=SP1:PROD "L#44":SP1
   S.LINE=INV.FULL.DESC "L#45":SP1
   F.LINE=F.LINE : OCONV(PTOTALS<1>,ICR.CNV) "R#11":SP1
   S.LINE=S.LINE : OCONV(PTOTALS<2>, "MD2") "R#11":SP1
   F.LINE=F.LINE : OCONV(PTOTALS<3>,ICR.CNV) "R#11":SP1
   S.LINE=S.LINE : OCONV(PTOTALS<4>, "MD2") "R#11":SP1
   F.LINE=F.LINE : OCONV(PTOTALS<5>,ICR.CNV) "R#11":SP1
   S.LINE=S.LINE : OCONV(PTOTALS<6>, "MD2") "R#11":SP1
   F.LINE=F.LINE : OCONV(PTOTALS<7>,ICR.CNV) "R#11":SP1
   S.LINE=S.LINE : OCONV(PTOTALS<8>, "MD2") "R#11":SP1
   F.LINE=F.LINE : OCONV(PTOTALS<9>,ICR.CNV) "R#11":SP1
   S.LINE=S.LINE : OCONV(PTOTALS<10>, "MD2") "R#11":SP1
   F.LINE=F.LINE : OCONV(PTOTALS<11>,ICR.CNV) "R#11":SP1
   S.LINE=S.LINE : OCONV(PTOTALS<12>, "MD2") "R#11":SP1
   ON.HAND=PTOTALS<1>+PTOTALS<3>+PTOTALS<5>+PTOTALS<7>+PTOTALS<9>+PTOTALS<11>
   ON.HAND.COST=PTOTALS<2>+PTOTALS<4>+PTOTALS<6>+PTOTALS<8>+PTOTALS<10>+PTOTALS<12>
   F.LINE=F.LINE : OCONV(ON.HAND, ICR.CNV) "R#11"
   S.LINE=S.LINE : OCONV(ON.HAND.COST, "MD2") "R#11"
   *** BASIS WEIGHT TOTALS ***
   BTOTALS<1>=BTOTALS<1>+PTOTALS<1>
   BTOTALS<2>=BTOTALS<2>+PTOTALS<2>
   BTOTALS<3>=BTOTALS<3>+PTOTALS<3>
   BTOTALS<4>=BTOTALS<4>+PTOTALS<4>
   BTOTALS<5>=BTOTALS<5>+PTOTALS<5>
   BTOTALS<6>=BTOTALS<6>+PTOTALS<6>
   BTOTALS<7>=BTOTALS<7>+PTOTALS<7>
   BTOTALS<8>=BTOTALS<8>+PTOTALS<8>
   BTOTALS<9>=BTOTALS<9>+PTOTALS<9>
   BTOTALS<10>=BTOTALS<10>+PTOTALS<10>
   BTOTALS<11>=BTOTALS<11>+PTOTALS<11>
   BTOTALS<12>=BTOTALS<12>+PTOTALS<12>
   BTOTALS<13>=BTOTALS<13>+ON.HAND
   BTOTALS<14>=BTOTALS<14>+ON.HAND.COST
   PTOTALS=""
   *** END OF BASIS WEIGHT TOTALS ***
   PRINT F.LINE
   PRINT S.LINE
   IF LINE.COUNT+1 > 54 THEN
      GOSUB 80000
   END ELSE
      PRINT
      LINE.COUNT=LINE.COUNT+1
   END
   RETURN
25000 * PRINT TOTALS FOR BASIS WEIGHT
   IF LINE.COUNT+3 > 54 THEN GOSUB 80000 
   LINE.COUNT=LINE.COUNT+2
   PRINT DH1.LINE
   T.LINE=SPACE(46)
   T.LINE=T.LINE:OCONV(BTOTALS<1>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE:OCONV(BTOTALS<3>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE:OCONV(BTOTALS<5>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE:OCONV(BTOTALS<7>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE:OCONV(BTOTALS<9>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE:OCONV(BTOTALS<11>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE:OCONV(BTOTALS<13>,ICR.CNV) "R#11":SP1
   PRINT T.LINE
   T.LINE=SPACE(3):"TOTAL FOR BASIS WEIGHT  ":OCONV(PREV.BAS.WT, "MD2") "L#8":SPACE(11)
   T.LINE=T.LINE :OCONV(BTOTALS<2>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(BTOTALS<4>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(BTOTALS<6>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(BTOTALS<8>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(BTOTALS<10>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(BTOTALS<12>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(BTOTALS<14>, "MD2") "R#11":SP1
   PRINT T.LINE
   PRINT
   LINE.COUNT=LINE.COUNT+1
   FOR AMP=1 TO 14
      MTOTALS<AMP>=MTOTALS<AMP>+BTOTALS<AMP>
   NEXT AMP
   PREV.BAS.WT=INV.BAS.WT ; BTOTALS=""
   RETURN
*** PRINT TOTAL FOR M.LINE / P.LINE
26000*
   IF LINE.COUNT+2 > 54 THEN GOSUB 80000
   LINE.COUNT=LINE.COUNT+2
   PRINT DH2.LINE
   T.LINE=SPACE(46)
   T.LINE=T.LINE :OCONV(MTOTALS<1>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<3>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<5>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<7>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<9>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<11>,ICR.CNV) "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<13>,ICR.CNV) "R#11":SP1
   PRINT T.LINE
   T.LINE=SPACE(3):"TOTAL FOR MLINE / PLINE  ":PREV.M.P.LINE "L#17":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<2>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<4>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<6>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<8>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<10>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<12>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(MTOTALS<14>, "MD2") "R#11":SP1
   PRINT T.LINE
   PRINT
   LINE.COUNT=LINE.COUNT+1
   PREV.M.P.LINE=INV.M.LINE:" / ":INV.LINE
   FOR AW=1 TO 14
      WTOTALS<AW>=WTOTALS<AW>+MTOTALS<AW>
   NEXT AW
   MTOTALS=""
   RETURN
*** PRINT TOTAL FOR WHSE
27000*
   IF LINE.COUNT+3 > 54 THEN GOSUB 80000
   LINE.COUNT=LINE.COUNT+3
   PRINT
   PRINT
   T.LINE=''
   T.LINE=T.LINE :SPACE(3):"TOTAL FOR WAREHOUSE  ":PREV.WHSE "L#4":SPACE(18)
   T.LINE=T.LINE :OCONV(WTOTALS<2>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(WTOTALS<4>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(WTOTALS<6>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(WTOTALS<8>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(WTOTALS<10>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(WTOTALS<12>, "MD2") "R#11":SP1
   T.LINE=T.LINE :OCONV(WTOTALS<14>, "MD2") "R#11":SP1
   PRINT T.LINE
   PRINT
   LINE.COUNT=LINE.COUNT+1
   PREV.WHSE=WHSE
   FOR AG=1 TO 14
      GTOTALS<AG>=GTOTALS<AG>+WTOTALS<AG>
   NEXT AG
   WTOTALS=""
   RETURN
***  ROUTINE TO PRINT HEADINGS
80000*
   PRINT CHAR(12)
   PAGE.NO=PAGE.NO+1
   PRINT HD1:PAGE.NO
   PRINT HD2
   PRINT SPACE(69):"YEAR : ":YEAR
   PRINT "WAREHOUSE : ":PREV.WHSE
   PRINT "MLINE / PLINE : ":PREV.M.P.LINE
   PRINT
   PRINT HH.LINE
   PRINT HH1.LINE
   PRINT HH2.LINE
   LINE.COUNT=9
   RETURN
***   CALLS FOR SYSCOM
91000*
   ERR.TYPE=1
   CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
92000*
   ERR.TYPE=2
   CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
93000*
   ERR.TYPE=3
   CALL SYSCOM(MAT SYSCOM.REC)
999999*
   PRINTER OFF
END
