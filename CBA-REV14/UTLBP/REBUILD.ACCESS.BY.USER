*COPY>CPYLIB>COM1
*********************************************************************
* REVISION     - [11.0]
* Copyright 1998 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM       - PRIMAC
* SOURCE       - PMCBP
* PROGRAM      - REBUILD.ACCESS.BY.USER
* BY           - ALEJANDRO DELGAD
* DATE         - 09/17/2002
* DESCRIPTION  - This program will rebuild the ACCESS_BY_USER file.
*
*T26853 adelgado 09/17/2002 * Original Code.
*********************************************************************
*
*COPY>PMC.CPYLIB>COMPANY
*COPY>PMC.CPYLIB>SECURITY
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
  *
  OPEN "","COMPANY" TO COMPANY ELSE
    PRINT "CANNOT OPEN COMPANY FILE" ; STOP
  END
  OPEN "","SECURITY" TO SECURITY ELSE
    PRINT "CANNOT OPEN SECURITY FILE" ; STOP
  END
  OPEN "","CONTROL" TO CONTROL ELSE
    PRINT "CANNOT OPEN CONTROL FILE" ; STOP
  END
  OPEN "","EASY.MENUS" TO EASY.MENUS ELSE
    PRINT "CANNOT OPEN EASY.MENUS FILE" ; STOP
  END
  OPEN "","ACCESS_BY_USER" TO ACCESS_BY_USER ELSE
    PRINT "CANNOT OPEN ACCESS_BY_USER FILE" ; STOP
  END
*
*        MAIN LOOP
*
  CMD = 'SSELECT SECURITY BY CONO'
  PERFORM CMD
  ALL.DONE = 0
  LOOP
    READNEXT ID ELSE ALL.DONE = 1
  UNTIL (ALL.DONE) DO
    TMP = 0 ; TMP2 = 0
    TMP = INDEX(ID,'*',1)
    TMP2 = INDEX(ID,'!',1)
*   IF TMP # 0 OR TMP2 # 0 THEN CONTINUE
    MATREAD SEC.REC FROM SECURITY, ID THEN
      CONO = ID[1,3] ; USER.ID = ID[4,99]
      IF SEC.MENU.LEVEL GE 0 AND SEC.MENU.LEVEL LT 5 THEN
        CALL BUILD.ACCESS.BY.USER(CONO, USER.ID, MAT SEC.REC, EASY.MENUS, ACCESS_BY_USER)
      END
    END
  REPEAT
END
