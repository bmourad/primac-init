*****************************************************************
*
* REVISION    - [08.0]
*
* PROGRAM.ID     - PROG.XREF.LIST
*
* BY             - JIHAD YAMOUT , COMPUTER BUSINESS ASSOCIATES
*
* DATE           - 04/01/83
*
* DESCRIPTION
*              THIS PROGRAM WILL LIST ALL PROGRAMS AND SUBROUTINES AND
*              ALL FILES THAT THEY USED AND CURRENT STATUS.
*
*ENDDOC
**********************************************************************
*
*COPY>CPYLIB>PROG.FILE.XREF
*COPY>CPYLIB>CHAR
*
***** INITIALIZATION
*
      PROMPT = ''
      FLG = 0
      PAGE.NO = 0
      LINE.NO = 0
      MAT PFX.REC = ''
*
***** OPEN FILES
*
      OPEN '','PROG.FILE.XREF' TO PROG.FILE.XREF ELSE
         STOP 'PROG.FILE.XREF FILE IS MISSING'
      END
*
***** INPUT RECORD NAME
*
      PRINT @(-1):
      SELECT PROG.FILE.XREF
      PRINT "INPUT PROGRAM NAME: ":
      INPUT NAME.PROGRAM
      IF NAME.PROGRAM = "" OR NAME.PROGRAM = "END" THEN GOTO 9999
*
***** MAIN PROCESSING
*
      DATA = 0
      PRINTER ON
      LOOP
         READNEXT PROG.NAME ELSE DATA = 1
      WHILE DATA = 0 DO
         IF NAME.PROGRAM # "ALL" AND NAME.PROGRAM # PROG.NAME THEN GOTO 999
         MATREAD PFX.REC FROM PROG.FILE.XREF, PROG.NAME ELSE
            MAT PFX.REC = ''
            GOTO 999
         END
         GOSUB 1000
         GOSUB 2000
         GOSUB 3000
         GOSUB 4000
         GOSUB 5000
         GOSUB 6000
         GOSUB 7000
         IF PFX.PROG.CALLED # '' THEN
            GOSUB 8000
         END
         IF PFX.CALLED.BY.PROG # '' THEN
            GOSUB 9000
         END
999*
*        PAGE.NO = 0
         LINE.NO = 0
      REPEAT
      GOTO 9999
*
**** PRINT HEADING
*
1000*
      PRINT CHAR(12)
      PAGE.NO = PAGE.NO + 1
      DE.LINE = SPACE(132)
      DE.LINE = DE.LINE[1,30] : 'XXXXXXXXXXXXX' "L#13" : DE.LINE[44,999]
      DE.LINE = DE.LINE[1,69] : 'PAGE ':PAGE.NO "R#3" : DE.LINE[79,999]
      DE.LINE = SPACE(132)
      DE.LINE = DE.LINE[1,26] : 'SYSTEMS DOCUMENTATION' "L#21" : DE.LINE[48,999]
      PRINT DE.LINE
      PRINT SPACE(29):"PROGRAM LISTING"
      PRINT
      LINE.NO = LINE.NO + 4
      RETURN
*
**** PRINT PROGRAM NAME OR SUBROUTINE NAME
*
2000*
      DE.LINE = SPACE(132)
      IF PFX.SUBR.FLAG = '' THEN
         DE.LINE = DE.LINE[1,3] : 'PROGRAM :' "L#11" : DE.LINE[15,999]
         DE.LINE = DE.LINE[1,14] : PROG.NAME "L#30" : DE.LINE[45,999]
         PRINT  DE.LINE
      END ELSE
         DE.LINE = DE.LINE[1,3] : 'SUBROUTINE:' "L#11" : DE.LINE[15,999]
         DE.LINE = DE.LINE[1,14] : PROG.NAME "L#30" : DE.LINE[45,999]
         PRINT  DE.LINE
      END
      PRINT
      LINE.NO = LINE.NO + 1
      RETURN
*
**** PRINT FILE NAME
*
3000*
      DE.LINE = SPACE(132)
      DE.LINE = DE.LINE[1,3] : 'FILE :' "L#11" : DE.LINE[15,999]
      DE.LINE = DE.LINE[1,14] : PFX.SOURCE.FILE "L#30" : DE.LINE[45,999]
      PRINT  DE.LINE
      PRINT
      LINE.NO = LINE.NO + 2
      RETURN
*
**** PRINT AUTHOR NAME AND DATE
*
4000*
      DE.LINE = SPACE(132)
      DE.LINE = DE.LINE[1,3] : 'AUTHOR :' "L#11" : DE.LINE[15,999]
      DE.LINE = DE.LINE[1,14] : PFX.WRITTEN.BY:'-':OCONV(PFX.DATE.WRITTEN,"D2/") "L#50" : DE.LINE[65,999]
      PRINT  DE.LINE
      PRINT
      LINE.NO = LINE.NO + 2
      RETURN
*
**** PRINT NARRATIVE
*
5000*
      DE.LINE = SPACE(132)
      DE.LINE = DE.LINE[1,3] : 'NARRATIVE :' "L#11" : DE.LINE[15,999]
      DESC.COUNT = COUNT(PFX.DESC, VM) + (PFX.DESC # '')
      FOR PP = 1 TO DESC.COUNT
         IF LINE.NO > 40 THEN
            LINE.NO = 0
            GOSUB 1000
         END
         DE.LINE = DE.LINE[1,14] : PFX.DESC<1,PP> "L#80" : DE.LINE[95,999]
         PRINT  DE.LINE
         LINE.NO = LINE.NO + 1
         DE.LINE = SPACE(132)
      NEXT PP
      PRINT
      LINE.NO = LINE.NO + 1
      RETURN
*
**** PRINT SUB.HEADING
*
6000*
      IF LINE.NO > 40 THEN
         LINE.NO = 0
         GOSUB 1000
      END
      DE.LINE = SPACE(132)
      DE.LINE = '   FILE ADDRESSED:       RD     WR     D       OPEN' "L#80" : DE.LINE[81,999]
      PRINT  DE.LINE
      PRINT
      LINE.NO = LINE.NO + 1
      RETURN
*
***** PRINT FILE NAME AND FILE ACTVITIS
*
7000*
      DE.LINE = SPACE(132)
      COUNT.ALL = COUNT(PFX.FILE.NAME, VM) + (PFX.FILE.NAME # '')
      FOR I = 1 TO COUNT.ALL
         IF LINE.NO > 40 THEN
            LINE.NO = 0
            GOSUB 1000
            GOSUB 6000
         END
         DE.LINE = SPACE(132)
         DE.LINE = DE.LINE[1,3] : PFX.FILE.NAME<1,I> "L#20" : DE.LINE[24,999]
         DE.LINE = DE.LINE[1,25] : PFX.READ.FLAG<1,I> "L#2" : DE.LINE[28,999]
         DE.LINE = DE.LINE[1,32] : PFX.WRITE.FLAG<1,I> "L#2" : DE.LINE[35,999]
         DE.LINE = DE.LINE[1,39] : PFX.DELETE.FLAG<1,I> "L#2" : DE.LINE[42,999]
         DE.LINE = DE.LINE[1,47] : PFX.OPEN.FLAG<1,I> "L#2" : DE.LINE[50,999]
         PRINT  DE.LINE
         LINE.NO = LINE.NO + 1
      NEXT I
      PRINT
      LINE.NO = LINE.NO + 1
      RETURN
*
***** PRINT SUBROUTINES CALLED
*
8000*
      IF LINE.NO > 40 THEN
         LINE.NO = 0
         GOSUB 1000
      END
      DE.LINE = SPACE(132)
      DE.LINE = DE.LINE[1,3] : 'SUBROUTINES CALLED:' "L#19" : DE.LINE[23,999]
      PRINT  DE.LINE
      LINE.NO = LINE.NO + 1
      COUNT.SUB = COUNT(PFX.PROG.CALLED, VM) + (PFX.PROG.CALLED # '')
      FOR SS = 1 TO COUNT.SUB
         IF LINE.NO > 40 THEN
            LINE.NO = 0
            GOSUB 1000
         END
         DE.LINE = SPACE(132)
         DE.LINE = DE.LINE[1,3] : PFX.PROG.CALLED<1,SS> "L#30" : DE.LINE[34,999]
         PRINT  DE.LINE
         LINE.NO = LINE.NO + 1
      NEXT SS
      PRINT
      LINE.NO = LINE.NO + 1
      RETURN
*
**** PRINT CALLED BY
*
9000*
      IF LINE.NO > 40 THEN
         LINE.NO = 0
         GOSUB 1000
      END
      DE.LINE = SPACE(132)
      DE.LINE = DE.LINE[1,3] : 'CALLED BY:' "L#10" : DE.LINE[14,999]
      PRINT  DE.LINE
      LINE.NO = LINE.NO + 1
      COUNT.BY = COUNT(PFX.CALLED.BY.PROG, VM) + (PFX.CALLED.BY.PROG # '')
      FOR BB = 1 TO COUNT.BY
         IF LINE.NO > 40 THEN
            LINE.NO = 0
            GOSUB 1000
         END
         DE.LINE = SPACE(132)
         DE.LINE = DE.LINE[1,3] : PFX.CALLED.BY.PROG<1,BB> "L#30" : DE.LINE[34,999]
         PRINT  DE.LINE
         LINE.NO = LINE.NO + 1
      NEXT BB
      RETURN
*
***** END PROGRAM
*
9999*
      PRINTER OFF
      PRINTER CLOSE
   END
