* CHECK FOR DATA FROM CALLING PROGRAM IN FILE NAME SUPPLIED BY PROC
*T26685 lhelms 07/03/2002 * REV12 DIVISION SECURITY INPUTS DON'TNOT
*                           WORK
*T23278 markt 03/19/1999 * CHECK ONLY FOR DATA IN THE SELECTED
*                          DIVISION
*T28688 lross 10/13/2005 * If error found clear attr 3-5 in FISCAL
*                          record.
* DAN GRUENENFELDER, VERCOM SOFTWARE
* 08/08/91
* T 26685
*T28688 v
OPEN "CONTROL" TO CONTROL ELSE
  CRT @(0,22):"Cannot OPEN CONTROL File!"
  STOP
END
*T28688 ^
PROCREAD X ELSE
  PRINT @(0,22):"MUST BE RUN FROM PROC"
  STOP
END
* INPUT IBUF
IBUF = X<11>
***** T23278 v
* INPUT IBUF2
IBUF2 = X<12>
* INPUT IBUF3
IBUF3 = X<13>
***** T23278 ^
*3 PROCREAD X ELSE
*3     PRINT @(0,22):"MUST BE RUN FROM PROC"
*3     STOP
* END
CONO = X<1>
*T28688 v
IBUF4 = X<14>
IBUF5 = X<15>
FISNAME = X<IBUF4>
POS = X<IBUF5>
*T28688 ^
FILENAME = X<IBUF>
***** T23278 v
DIV.CODE = X<IBUF2>
IF DIV.CODE = 'ALL' THEN DIV.CODE = '00'
ATTNUM = IBUF3
***** T23278 ^
OPEN FILENAME TO TESTFILE ELSE RETURN
SELECT TESTFILE
10 *
READNEXT ID ELSE
  X<IBUF>=''
  GOTO 99
END
IF ID[1,3] # CONO THEN GOTO 10
READ TESTRECORD FROM TESTFILE, ID ELSE GOTO 10
IF DIV.CODE # '00' THEN
  IF TESTRECORD<ATTNUM> # DIV.CODE THEN GOTO 10
END
* DONE WITH PROGRAM
* FOUND DATA IN CURRENT CONO, %4 IS NOW 'END'
X<IBUF> = 'END'
*T28688 v
IF FISNAME # "" THEN
  READU FISREC FROM CONTROL,CONO:FISNAME THEN
     FISREC<3,POS>=''
     FISREC<4,POS>=''
     FISREC<5,POS>=''
     FISREC<7,POS>=''
     WRITE FISREC ON CONTROL,CONO:FISNAME
  END ELSE RELEASE CONTROL,CONO:FISNAME
*T28688 ^
END
99 *
PROCWRITE X
END
