*COPY>CPYLIB>COM1
*COPY>CPYLIB>COM.DICT.VAL
*************************************************************
* REVISION    - [08.0]  
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM     - PRIMAC
* SOURCE      - CBABP
* PROGRAM     - ALL.DICT.BAT
* DATE        _ 10/90
* DESCRIPTION
*************************************************************
*COPY>PMC.CPYLIB>COMPANY
*COPY>PMC.CPYLIB>CORP.CONO
*COPY>CPYLIB>DICT.VALUES
*COPY>CPYLIB>DICT.HLD.FILE
*COPY>CPYLIB>CHAR
FF = CHAR(12)
*
*--- TO RUN A TEST ONLY (COMPARE THE DIF OF WHAT THIS ROUTINE CREATES
*--- TO DICT ITEMA EXISTING ON FILE, SET 'JUST.TESTING' TO TRUE.  THE
*--- DATA ELEMENT 'MAX.ERRORS' IS USED TO LIMIT THE AMOUNT OF ERRORS 
*--- THAT WILL BE PRINTED.
*
	JUST.TESTING = 1
	MAX.ERRORS = 20
	ERROR.CNT = 0
*
MAT SFR = ''
MAT POS = ''
MAT SF1 = ''
MAT SF2 = ''
MAT SF3 = ''
MAT DICT.REC = ''
*
*---- INITIAL
*
ERRMSG = ''
DASHES = STR('-',80)
PROMPT ""
OPEN.FLAG = 0
*
*---- OPEN FILES
*
OPEN '','COMPANY' TO COMPANY ELSE
ERRMSG = 'COMPANY FILE IS MISSING'
GOSUB 91000
GOTO 999999
END
OPEN '','CONTROL' TO CONTROL ELSE
ERRMSG = 'CONTROL FILE IS MISSING'
GOSUB 91000
GOTO 999999
END
OPEN '','VOC' TO MD ELSE
ERRMSG = 'MD FILE IS MISSING'
GOSUB 91000
GOTO 999999
END
OPEN '','DICT.HLD.FLE' TO HOLD.FILE ELSE
ERRMSG = 'DICT.HLD.FLE FILE IS MISSING'
GOSUB 91000
GOTO 999999
END
*
*--- CHECK COMPANY PARAMETER ---
*
	READ CCONO FROM CONTROL, "CORP.CONO" ELSE
		CCONO = '001'
	END
	MATREAD COMP.REC FROM COMPANY, CCONO ELSE
		ERRMSG = 'COMPANY ':CCONO:' IS NOT ON FILE'
		GOSUB 91000
		GOTO 999999
	END
	MATREAD CCO.REC FROM CONTROL, "CORPORATE" ELSE
		FOR X = 1 TO CCO.MAX
			CCO.REC(X) = 'N'
		NEXT X
	END
	FOR X = 1 TO CCO.MAX
		IF CCO.REC(X) = 'Y' THEN
			CCO.REC(X) = CCONO
		END ELSE
			CCO.REC(X) = ''
		END
	NEXT X
READV CURR.ACCT FROM CONTROL, 'MENUS.CONTROL', 1 ELSE
READV CURR.ACCT FROM CONTROL, '001MENUS.CONTROL', 1 ELSE
ERRMSG = 'CANNOT READ MENUS.CONTROL'
GOSUB 91000
GOTO 999999
END
END
ACCT.LEN = LEN(CURR.ACCT)
*
*---- PRINT SCREEN
*
SCRN = CS
SCRN = SCRN : @(0,0):'VERCOM'
SCRN = SCRN : @(28,0):'DICTIONARIES ADJUSTMENT'
SCRN = SCRN : @(0,1):DASHES
SCRN = SCRN : @(25,3):CO.NAME
SCRN = SCRN : @(25,5):'CURRENT ACCOUNT : ' : CURR.ACCT
SCRN = SCRN : @(25,11):'NOW PROCESSING'
SCRN = SCRN : @(25,13):'FILE :'
SCRN = SCRN : @(25,15):'DICT :'
SCRN = SCRN : @(0,22):DASHES
PRINT SCRN :
PREV.FILE = ''
*
*---- CHECK COMPANY PARAMETER
*
CONO.LEN = 3
ST.CONO = CONO.LEN + 1
DIV.LEN = 2
DEP.LEN = 2
CTR.LEN = 3
CCTR.LEN = CONO.LEN + DIV.LEN + DEP.LEN + CTR.LEN
ST.CCTR = CCTR.LEN + 1
GL.LEN = 0
STRUC.CNT = COUNT(CO.ACCT.STRUC,'-')
SF.CNT = STRUC.CNT + 1
FOR I = 1 TO SF.CNT
SFR(I) = FIELD(CO.ACCT.STRUC,'-',I)
IF NUM(SFR(I)) THEN
IF SFR(I) > 0 THEN
SFR(I) = SFR(I) + 0
POS(I) = GL.LEN + 1
GL.LEN = GL.LEN + SFR(I)
END ELSE
ERRMSG = 'SUFFIX #':I:' IS < 1'
GOSUB 91000
GOTO 999999
END
END ELSE
ERRMSG = 'SUFFIX # ':I:' IS NOT NUMERIC'
GOSUB 91000
GOTO 999999
END
NEXT I
IF GL.LEN <> LEN(CO.ACCT.PIC) THEN
ERRMSG = 'GL.LEN <> LEN(CO.ACCT.PIC)'
GOSUB 91000
GOTO 999999
END
IF SF.CNT > 1 THEN
SUFFIX.POS = POS(2)
SUFFIX.LEN = GL.LEN - SFR(1)
END ELSE
SUFFIX.LEN = 0
SUFFIX.POS = GL.LEN + 1
END
STRUC.LEN = STRUC.CNT + GL.LEN
TOT.LEN = CCTR.LEN + GL.LEN
EN.GL.LEN1 = ST.CONO + GL.LEN
EN.GL.LEN2 = ST.CCTR + GL.LEN
*
*---- PROCESS ALL DICT
*
	SELECT HOLD.FILE
*
DATA = 1
LOOP
READNEXT ID ELSE DATA = 0
WHILE DATA DO
MAT DICT.REC = ''
MATREAD HOLD.REC FROM HOLD.FILE, ID ELSE GOTO 9999
*HELP TEMP
*IF HOLD.TYPE # '56' THEN GOTO 9999
	IF HOLD.TYPE < '50' THEN GOTO 9999
*HELP END 
IF NOT(NUM(HOLD.TYPE)) THEN
ERRMSG = HOLD.TYPE:' IS NOT A VALID TYPE'
GOSUB 91000
GOTO 9999
END
FILE.NAME = FIELD(ID,'!',1)
IF FILE.NAME # PREV.FILE THEN
OPEN.FLAG = 1
PREV.FILE = FILE.NAME
READ ITEM FROM MD, FILE.NAME ELSE
ERRMSG = 'FILE ':FILE.NAME:' IS MISSING'
GOSUB 91000
OPEN.FLAG = 0
GOTO 199
END
OPEN 'DICT',FILE.NAME TO D.F.NAME ELSE
ERRMSG = FILE.NAME:' FILE IS MISSING'
GOSUB 91000
OPEN.FLAG = 0
GOTO 199
END
PRINT @(32,13):FILE.NAME:CL:
199 *
END
IF OPEN.FLAG = 0 THEN GOTO 9999
DICT.NAME = FIELD(ID,'!',2)
IF DICT.NAME = 'DL/ID' THEN GOTO 9999
PRINT @(32,15):DICT.NAME:CL:
NEW.DICT.ID = DICT.NAME
*
	CALL ALL.DICT.CR(FILE.NAME, HEAD, WIDTH, CONV, CORR, NEW.DICT.ID)
	IF JUST.TESTING THEN
		PRINTER ON
		DIM REC(20)
		FND = 1
		MATREAD REC FROM D.F.NAME, NEW.DICT.ID ELSE
			FND = 0
		END
		IF FND THEN
			DICT.SAME = 1
			FOR X = 1 TO 10 WHILE DICT.SAME
				IF REC(X) # DICT.REC(X) AND X # 4 THEN
					DICT.SAME = 0
					BAD.X = X
				END
			NEXT X
			IF DICT.SAME THEN
				PRINT "FILE: '":FILE.NAME:"', ID: '":NEW.DICT.ID:"', TYPE: '":HOLD.TYPE:"', OK"
			END ELSE
				ERROR.CNT = ERROR.CNT + 1
				IF MAX.ERRORS > ERROR.CNT THEN
					PRINT "**********************************************************"
					PRINT "FILE: '":FILE.NAME:"', ID: '":NEW.DICT.ID:"', TYPE: '":HOLD.TYPE:"', IS NOT THE SAME"
					PRINT "ORIGINAL DICT;"
					FOR Y = 1 TO 10
						PRINT Y:" ":REC(Y)
					NEXT Y
					PRINT "NEW DICT;"
					FOR Z = 1 TO 10
						PRINT Z:" ":DICT.REC(Z)
						IF Z = BAD.X THEN
							PRINT "^^^^^^^^^^^^^^^^^^^^"
						END
					NEXT Z
				END
			END
		END ELSE
			PRINT "FILE: '":FILE.NAME:"', ID: '":NEW.DICT.ID:"', TYPE: '":HOLD.TYPE:"', NOT ON FILE"
		END 
		PRINTER OFF
	END ELSE
		MATWRITE DICT.REC ON D.F.NAME, NEW.DICT.ID
	END
*
9999 *
REPEAT
GOTO 999999
91000 *
PRINT @(0,23):ERRMSG:CL:
INPUT REPLY,1:
PRINT @(0,23):CL:
RETURN
999999 *
	IF JUST.TESTING THEN
		PRINTER ON
		PRINT "*************************"
		PRINT ERROR.CNT:" TOTAL ERRORS"
		PRINT "*************************"
		PRINTER OFF
	END
PRINT @(-1):
END
