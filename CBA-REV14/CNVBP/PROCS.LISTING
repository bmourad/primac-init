*COPY>PMC.CPYLIB>PMC_PROCESS
  OPEN '','PMC_PROCESS' TO PMC_PROCESS ELSE PRINT 'UNABLE TO OPEN PMC_PROCESS' ; STOP
  OPEN '','PRIMAC.MENUS' TO PRIMAC.MENUS ELSE PRINT 'UNABLE TO OPEN PRIMAC.MENUS' ; STOP
  OPEN '','A.DUMP' TO A.DUMP ELSE PRINT 'UNABLE TO OPEN A.DUMP' ; STOP
  CMD = 'SSELECT PMC_PROCESS WITH F1 = "P" BY F2 BY F3'
  PERFORM CMD
  *
  LOOP.DONE = 0 ; OLD.FILE.NM = ''
  LOOP
    READNEXT ID ELSE LOOP.DONE = 1
  UNTIL (LOOP.DONE) DO
    MATREAD PPS.REC FROM PMC_PROCESS, ID THEN
      IF OLD.FILE.NM # PPS.DIR THEN
        OPEN '', PPS.DIR TO FILE.NM ELSE
          TEST.REC<1> = PPS.DIR
          TEST.REC<2> = PPS.PROCESS
          TEST.REC<3> = PPS.MENU
          TEST.REC<4> = 98
          WRITE TEST.REC ON A.DUMP, ID
          CONTINUE
        END
        OLD.FILE.NM = PPS.DIR
      END
      TMP.REC = '' ; TEST.REC = ''
      READ MENU.REC FROM PRIMAC.MENUS, PPS.MENU THEN
        ZCNT = DCOUNT(MENU.REC,@AM) ; FOUND.IN.MENU = 0
        FOR ZZ = 1 TO ZCNT
          IF MENU.REC<ZZ,1> = PPS.VOC THEN
            FOUND.IN.MENU = 1 ; ZZ = ZCNT
          END
        NEXT ZZ
        IF FOUND.IN.MENU = 1 THEN
          IF PPS.MENU[1,5] = 'M.CBA' THEN
            TEST.REC<4> = 90
          END ELSE
            READ TMP.REC FROM FILE.NM, PPS.PROCESS THEN
              GOSUB VALIDATE.PROC
            END ELSE
              TEST.REC<4> = 99
            END
          END
        END ELSE
          TEST.REC<4> = 96
        END
      END ELSE
        TEST.REC<4> = 97
      END
      TEST.REC<1> = PPS.DIR
      TEST.REC<2> = PPS.PROCESS
      TEST.REC<3> = PPS.MENU
      WRITE TEST.REC ON A.DUMP, ID
    END
  REPEAT
  STOP
*
VALIDATE.PROC: 
*
  XCNT = DCOUNT(TMP.REC, @AM)
  RSCRN.FLAG = 0 ; PCONO.FLAG = 0 
  IP.FLAG = 0 ; T.FLAG = 0
  FOR XX = 1 TO XCNT
    BEGIN CASE
      CASE INDEX(TMP.REC<XX>,'REPORT.SCRN',1) AND TMP.REC<XX>[1,1] = 'H'
        IF TMP.REC<XX+1>[1,1] = 'P' THEN
          RSCRN.FLAG = 1
        END
      CASE INDEX(TMP.REC<XX>,'GET.PROC.CONO',1) AND TMP.REC<XX>[1,1] = 'H'
        PCONO.FLAG = 1
      CASE (TMP.REC<XX>[1,2] = 'IP' OR TMP.REC<XX>[1,2] = 'T ') AND IP.FLAG = 0
        IF TMP.REC<XX>[1,3] = 'T C' THEN CONTINUE
        BEGIN CASE
          CASE PCONO.FLAG = 1 AND RSCRN.FLAG = 1
            IP.FLAG = 1
          CASE PCONO.FLAG = 1 AND RSCRN.FLAG = 0
            IP.FLAG = 2
          CASE PCONO.FLAG = 0 AND RSCRN.FLAG = 0
            IP.FLAG = 3
          CASE 1
            IP.FLAG = 1
        END CASE
    END CASE
  NEXT XX
  BEGIN CASE
    CASE IP.FLAG # 0
      BEGIN CASE
        CASE PCONO.FLAG = 1 AND RSCRN.FLAG = 1 AND IP.FLAG = 1
          TEST.REC<4> = 5
        CASE PCONO.FLAG = 1 AND RSCRN.FLAG = 1 AND IP.FLAG = 2
          TEST.REC<4> = 6
        CASE PCONO.FLAG = 1 AND RSCRN.FLAG = 1 AND IP.FLAG = 3
          TEST.REC<4> = 7
        CASE PCONO.FLAG = 1
          IF IP.FLAG = 3 THEN
            TEST.REC<4> = 8
          END ELSE
            TEST.REC<4> = 9
          END
        CASE 1
          TEST.REC<4> = 10
      END CASE
    CASE PCONO.FLAG = 1 AND RSCRN.FLAG = 1
      TEST.REC<4> = 1
    CASE PCONO.FLAG = 1
      TEST.REC<4> = 3
    CASE RSCRN.FLAG = 1
      TEST.REC<4> = 2
    CASE 1
      TEST.REC<4> = 4
  END CASE
  *
  RETURN
END
