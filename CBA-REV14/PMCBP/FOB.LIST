*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - LMFPBP
* PROGRAM     - FOB.LIST
* BY          - JULIANNE RIVERA, VERCOM SOFTWARE, INC.
* DATE        - 11/26/91
* DESCRIPTION -
*T26493 cmykleb 03/22/2002 * Change report to use rpt # from proc.
*********************************************************************
*COPY>PMC.CPYLIB>COMPANY
*COPY>PMC.CPYLIB>FOB
*COPY>CPYLIB>SYSCOM
*COPY>CPYLIB>CHAR
*
**** SET UP FOR SYSCOM
   SYS.TYPE = 1; CALL SYSCOM(MAT SYSCOM.REC)
   PROCREAD BUFFER ELSE
      ERRMSG = "THIS PROGRAM MUST RUN FROM A PROC"
      GOTO 93000
   END
   CONO = BUFFER<1>
   CONO.NAME = ""
*T26493 v
*  REPORT.NAME = "FOB LISTING"
*  REPORT.NUM = "XXXX"
   REPORT.NAME = ""
   REPORT.NUM = BUFFER<2>
*T26493 ^
   REPORT.DATE = ""
   HD1 = " ; HD2 = "
   CALL GET.PROG.HEAD(CONO,CONO.NAME,REPORT.NAME,REPORT.NUM,REPORT.DATE,HD1,HD2)
*
*---- OPEN FILES
*
   OPEN '','FOB' TO FOB ELSE ERRMSG = "FOB FILE IS MISSING"; GOTO 93000
   OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = "COMPANY IS MISSING" ; GOTO 93000
*
*---- INITIALIZE
*
   UNKNOWN = STR("?",45)
   PAGE.NO = 0
   LINE.CNT = 99
   FIRST.REC = 1
   SP1 = SPACE(1)
   SP2 = SPACE(2)
   SP3 = SPACE(3)
   PREV.WEIGHT = ""
*
*---- HEADINGS
*
   SHD1 = "FOB"
   SHD2 = "CODE    DESCRIPTION    SRCHG  DISC"
   SHD3 = "----  ---------------  ----- -----"
*
*---- MAIN PROCESSING
*
100*
   DATA = 1
   READNEXT FOB.ID THEN
      MATREAD FOB.REC FROM FOB, FOB.ID THEN
         GOSUB 10000
         PREV.WEIGHT = FOB.WEIGHT
      END ELSE
         GOTO 99999
      END
   END
   LOOP
      READNEXT FOB.ID ELSE DATA = 0
   WHILE DATA DO
      MATREAD FOB.REC FROM FOB, FOB.ID THEN
         GOSUB 10000
         PREV.WEIGHT = FOB.WEIGHT
      END
   REPEAT
   GOTO 99999
*
*---- PRINT DETAIL LINE
*
10000*
   LCNT = DCOUNT(FOB.WEIGHT,VM)
   IF LCNT > 14 THEN LCNT = 14
   IF FIRST.REC THEN
      PRINTER ON
      FIRST.REC = 0
   END
   BEGIN CASE
      CASE LINE.CNT > 50
         GOSUB 20000
      CASE FOB.WEIGHT = PREV.WEIGHT
      CASE LINE.CNT > 45
         GOSUB 20000
      CASE 1
         GOSUB 20100
   END CASE
   LINE = FOB.ID[4,3]"L#3":SP3:FOB.DESC"L#15"
   LINE = LINE:SP2:OCONV(FOB.SURCHARGE,"MD2")"R#5"
   LINE = LINE:SP1:OCONV(FOB.DISCOUNT,"MD2")"R#5"
   FOR X = 1 TO LCNT
      LINE = LINE:SP1:OCONV(FOB.RATE<1,X>,"MD2")"R#6"
   NEXT X
   PRINT LINE
   LINE.CNT = LINE.CNT + 1
   RETURN
*
*---- PRINT HEADINGS
*
20000*
   PRINT CHAR(12)
   PAGE.NO = PAGE.NO + 1
   PRINT HD1:PAGE.NO
   PRINT HD2
   LINE.CNT = 2
20100*
   PRINT
   PRINT SHD1
   SH2 = SHD2
   SH3 = SHD3
   FOR X = 1 TO LCNT
      BEGIN CASE
         CASE FOB.WEIGHT<1,X> = ""
            SH2 = SH2:SP1:"""R#6"
         CASE LEN(FOB.WEIGHT<1,X>) <= 5
            SH2 = SH2:SP1:OCONV(FOB.WEIGHT<1,X>,"MD0,")"R#6"
         CASE 1
            SH2 = SH2:SP1:FOB.WEIGHT<1,X>"R#6"
      END CASE
      SH3 = SH3:SP1:"------"
   NEXT X
   PRINT SH2
   PRINT SH3
   LINE.CNT = LINE.CNT + 4
   RETURN
*
93000ERR.TYPE = 3 ; CALL SYSCOM(MAT SYSCOM.REC)
99999PRINTER OFF
END
