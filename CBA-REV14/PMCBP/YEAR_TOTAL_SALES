 SUBROUTINE TOTAL_YEAR_SALES (TOTAL, CURR.YR, CONO, CUSTNO)
*THIS SUBROUTINE WILL CALCULATE THE TOTAL SALES FOR THE YEAR AND
* RETURN IT BACK
*
*COPY>PMC.CPYLIB>CUSTOMER
OPEN 'CONTROL' TO CONTROL ELSE STOP
OPEN 'CUSTOMER' TO CUSTOMER ELSE STOP
*READ SDREC FROM CONTROL, CONO:"SALESDATES" ELSE STOP
*CURR.YR=SDREC<2,1>
*CURR.YR = OCONV(CURR.YR,'D4/')[7,4]
TOTAL=0
MATREAD CUST.REC FROM CUSTOMER,CONO:CUSTNO ELSE MAT CUST.REC=''
FOR P = 1 TO DCOUNT(CUST.SALES.PER,@VM)
  IF CUST.SALES.PER<1,P>[1,4] = CURR.YR THEN TOTAL += CUST.SALES<1,P>
NEXT P
RETURN
