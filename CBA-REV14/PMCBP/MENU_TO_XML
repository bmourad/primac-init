   PROGRAM MENU_TO_XML
*COPY>CPYLIB>COM1
**********************************************
* REVISION    - [12.0]
* Copyright 1995 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - PMCBP
* PROGRAM     - MENU_TO_XML
* BY          - ABDULLAH JIBALY; CBA
* DATE        - 06/13/2002
* DESCRIPTION - THIS PROGRAM CONVERTS ePRIMAC.MENUS RECORDS TO
*               ePRIMAC_MENUS_XML RECORDS
*
*ENDDOC
**********************************************
*
*---CPYLIBS
*
*COPY>CPYLIB>SYSCOM
*
*---ERROR MESSAGES
*
   SYS.TYPE=1
   CALL SYSCOM(MAT SYSCOM.REC)
*
*---OPEN FILES
*
   OPEN '', 'PRIMAC.MENUS' TO PRIMAC.MENUS ELSE
      ERRMSG = 'PRIMAC.MENUS FILE IS MISSING'
      GOSUB 91000; RETURN
   END
   OPEN '', 'ePRIMAC.MENUS' TO EPRIMAC.MENUS ELSE
      ERRMSG = 'ePRIMAC.MENUS FILE IS MISSING'
      GOSUB 91000; RETURN
   END
   OPEN '', 'ePRIMAC_MENUS_XML' TO EPRIMAC_MENUS_XML ELSE
      ERRMSG = 'ePRIMAC_MENUS_XML FILE IS MISSING'
      GOSUB 91000; RETURN
   END
   OPEN '', 'PMC_PROCESS_XREF' TO PMC_PROCESS_XREF ELSE
      ERRMSG = 'PMC_PROCESS_XREF FILE IS MISSING'
      GOSUB 91000; RETURN
   END
*
*---INITIALIZATION SECTION
*
   DEFFUN XML_FORMAT_CDATA(STR)
   DEFFUN MENU_TO_XML_FUN(MAT PASS.FILES, EMENU.REC, SELF, LVL, CUTOFF)
   DIM PASS.FILES(3)
   PASS.FILES(1) = PRIMAC.MENUS
   PASS.FILES(2) = EPRIMAC.MENUS
   PASS.FILES(3) = PMC_PROCESS_XREF
   GOSUB MAIN
   RETURN
*
MAIN: 
   REC.ID = "M.MASTER"
   READ REC FROM EPRIMAC.MENUS, REC.ID ELSE
      ERRMSG = "CANNOT FIND ": REC.ID :" RECORD IN MENU FILE!"
      GOSUB 91000; RETURN
   END
   ;*
   ;* Start numbering the first level at -2, the second at -1, etc
   ;*
   START.LVL = -2
   ;*
   ;* Save the first three level to an XML file individually.
   ;* The remaining levels are combined with the 4th level XML file
   ;*
   CUTOFF = START.LVL + 3
   XVAL = MENU_TO_XML_FUN(MAT PASS.FILES, REC, REC.ID, START.LVL, CUTOFF)
*
   RETURN
*
*---STANDARD SUBROUTINES
*
91000 ERR.TYPE=1;CALL SYSCOM(MAT SYSCOM.REC);RETURN
99999 RETURN
END
