*COPY>CPYLIB>COM1
*******************************************************************
* REVISION    - [07.0]
* SOURCE        - GLSBP
* PROGRAM       - FINANCIAL.RPT.LIST
* BY            - RHONDA PERRIN, C.B.A.
* DATE          - 12/12/84
* DESCRIPTION   -
* This program creates a General Ledger Financial Report Listing.
* T26493 cmykleb 05/22/2002 * Change pgm to get the rpt # from the proc
*                             and use GET.PROG.HEAD for the heading.
*T27264 thompson 02/04/2003 * Fix page numbering problem 
*T27807 lross 11/26/2003 * Add Report # to heading.
*ENDDOC
*****************************************************************
*
*---- FILE EQUATES
*
*COPY>CPYLIB>SYSCOM
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*COPY>PMC.CPYLIB>COMPANY
*COPY>PMC.CPYLIB>COA
*COPY>GLS.CPYLIB>GLS.REPORT
*COPY>GLS.CPYLIB>ACCT.TYPE
*COPY>GLS.CPYLIB>ACCT.CATG
*
*---- SYSTEM ERROR MESSAGES
*
   SYS.TYPE = 1
   CALL SYSCOM(MAT SYSCOM.REC)
* T26493 v
*
*---- READ FROM PROC
*
   PROCREAD BUFFER ELSE
      ERRMSG = "MUST RUN FROM A PROC"
      GOTO 93000
   END
*T26493 ^
*
*---- OPEN FILES
*
   OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = 'COMPANY FILE MISSING';GOTO 93000
   OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE MISSING';GOTO 93000
   OPEN '','COA' TO COA ELSE ERRMSG = 'COA FILE MISSING';GOTO 93000
   OPEN '','GLS.REPORT' TO GLS.REPORT ELSE ERRMSG = 'GLS.REPORT FILE MISSING';GOTO 93000
   OPEN '','ACCT.TYPE' TO ACCT.TYPE ELSE ERRMSG = 'ACCT.TYPE FILE MISSING';GOTO 93000
   OPEN '','ACCT.CATG' TO ACCT.CATG ELSE ERRMSG = 'ACCT.CATG FILE MISSING';GOTO 93000
*
*---- GET COMPANY NUMBER
*
   CONO = ''
   CALL GET.CONO(CONO,MAT COMP.REC)
   IF CONO = 'END' THEN GOTO 99999
*T26493 v
   CONO.NAME = ""
   RPT.NAME = ""
   RPT.NO = BUFFER<2>
   HD1 = ""
   HD2 = ""
   CALL GET.PROG.HEAD(CONO,CONO.NAME,RPT.NAME,RPT.NO,"",HD1,HD2)
*T26493 ^
*
*---- INITIALIZATION
*
   PG.NO = 0
   LINE.CNT = 0
   ERRMSG = ''
   D10 = STR("-",10)
   D14 = STR("-",14)
   D21 = STR("-",21)
   D45 = STR("-",45)
   UNKNOWN = STR("?",21)
   SP1 = ' '
   ACCT.NO=''
   SIGN=''
   DESC=""
   CODE=""
   STRUC = CO.ACCT.MASK:STR("#",14 - LEN(CO.ACCT.MASK))
   PRINTER ON
*
*---- MAIN PROCESSING
*
10*  
   READNEXT GLS.KEY ELSE GOTO 12
   MATREAD GLRP.REC FROM GLS.REPORT,GLS.KEY ELSE GOTO 10
   R.NO=GLS.KEY[4,3]
   ST.CNT = GLRP.BEG.LINE + 1
   LN.CNT = ST.CNT
   LOOP WHILE GLRP.REC(LN.CNT) # '' DO
      LN.CNT = LN.CNT + 1
   REPEAT
   IF LN.CNT < 1 THEN GOTO 10
   LN.CNT = LN.CNT - 1
   SAVE.RPT.NO = ''
   LN.NO=1
   GOSUB 20
   FOR L = ST.CNT TO LN.CNT
      GOSUB 30
*       SAVE.RPT.NO = R.NO
      LN.NO = LN.NO + 1
   NEXT L
   GOTO 10
12*
   PRINTER OFF
   GOTO 99999
*
*---- PRINT HEADING
*
20*
   PRINT CHAR(12)
   LINE.CNT = 0
   PG.NO = PG.NO + 1
*T26493 v
*  H.LINE = '';HLINE1 = '';HLINE2 = '';HLINE3 = ''
*  HLINE1 = "DATE : ":OCONV(DATE(),"D2/"):SPACE(26)
*  REMAIN = 50 - LEN(CO.NAME)
*  HALF = INT(REMAIN / 2)
*  SP = SPACE(HALF)
*  HLINE2 = SP:CO.NAME:SP
*  HLINE3 = SPACE(23):"PAGE : ":PG.NO
*  H.LINE = HLINE1:HLINE2:HLINE3
*  PRINT H.LINE
*  H.LINE = ''
*  H.LINE = H.LINE:'REPORT : ':R.NO "L#3"
*  H.LINE = H.LINE:SPACE(40):"FINANCIAL REPORT LINE LISTING"
*  PRINT H.LINE
*  PRINT
*  PRINT SPACE(129):'-'
*  H.LINE = ''
*T27264   HD1 = HD1:PG.NO
   PRINT HD1:PG.NO "R%3"; *T27264
   PRINT HD2
*C42799 v T27807
*  PRINT
   PRINT 'REPORT NO. ':R.NO
   PRINT SPACE(129):'-'
*T26493 ^
   H.LINE = "LN# T LN# S U R DV DP CTR FIXED AMNT":SPACE(15):"LINE  DESCRIPTION":SPACE(15):"LN# CODE TYPE/CATG/ACCT      DESCRIPTION      + T"
   PRINT H.LINE
   H.LINE = ''
   H.LINE = "--- - --- - - - -- -- --- ":D10:SP1:D45:' --- ---- ':D14:SP1:D21:' - -'
   PRINT H.LINE
   PRINT
   LINE.CNT = LINE.CNT + 7
   RETURN
*
*---- PRINT REPORT LINE(S)
*
30*
   IF LINE.CNT > 55 THEN GOSUB 20
   S.CNT = COUNT(GLRP.REC(L)<1,11>,SVM) + (GLRP.REC(L)<1,11> # '')
   IF S.CNT < 1 THEN
      S.NO = '';ACCT.NO = '';SIGN = '';LINE.TYPE = ''
      CODE = '';DESC = '';ACCT.NUM = ACCT.NO "L#14"
   END ELSE
      S.NO = 1
      SIGN = GLRP.REC(L)<1,12,1>
      LINE.TYPE = GLRP.REC(L)<1,13,1>
      BEGIN CASE
         CASE GLRP.REC(L)<1,14,1> = ""
            CODE = "ACCT"
            ACCT.NO = GLRP.REC(L)<1,11,1>
            ACCT.NUM = ACCT.NO STRUC
            MATREAD COA.REC FROM COA, CONO:ACCT.NO ELSE
               MAT COA.REC = ""; COA.DESC = "NOT ON FILE"
            END
            DESC = COA.DESC
         CASE GLRP.REC(L)<1,14,1> = 1
            CODE = "SUB"
            ACCT.NO = GLRP.REC(L)<1,11,1>[1,3]
            MATREAD AC.REC FROM ACCT.CATG, ACCT.NO ELSE
               MAT AC.REC = ""; AC.DESC = "NOT ON FILE"
            END
            DESC = AC.DESC
            ACCT.NO = ACCT.NO :SP1: GLRP.REC(L)<1,11,1>[4,3]
            ACCT.NUM = ACCT.NO "L#14"
         CASE GLRP.REC(L)<1,14,1> = 2
            CODE = "CATG"
            ACCT.NO = GLRP.REC(L)<1,11,1>
            MATREAD AC.REC FROM ACCT.CATG, ACCT.NO ELSE
               MAT AC.REC = ""; AC.DESC = "NOT ON FILE"
            END
            DESC = AC.DESC
            ACCT.NUM = ACCT.NO "L#14"
         CASE GLRP.REC(L)<1,14,1> = 3
            CODE = "TYPE"
            ACCT.NO = GLRP.REC(L)<1,11,1>
            MATREAD AT.REC FROM ACCT.TYPE, ACCT.NO ELSE
               MAT AT.REC = ""; AT.DESC = "NOT ON FILE"
            END
            DESC = AT.DESC
            ACCT.NUM = ACCT.NO "L#14"
         CASE 1
            ACCT.NO = GLRP.REC(L)<1,11,1>; DESC = ''
            ACCT.NUM = ACCT.NO "L#14"; CODE = GLRP.REC(L)<1,14,1>
      END CASE
   END
*    IF SAVE.RPT.NO = R.NO THEN
*       RPT.NO = ''
*    END ELSE
*       RPT.NO = R.NO
*    END
   P.LINE = ''
   P.LINE = LN.NO "R#3" :SP1: GLRP.REC(L)<1,1> "L#1" :SP1
   P.LINE = P.LINE : GLRP.REC(L)<1,2> "R#3" :SP1: GLRP.REC(L)<1,3> "L#1" :SP1
   P.LINE = P.LINE : GLRP.REC(L)<1,4> "L#1" :SP1: GLRP.REC(L)<1,5> "L#1" :SP1
   P.LINE = P.LINE: GLRP.REC(L)<1,6> "L#2" :SP1: GLRP.REC(L)<1,7> "L#2":SP1
   P.LINE = P.LINE: GLRP.REC(L)<1,8> "L#3" :SP1
   P.LINE = P.LINE : OCONV(GLRP.REC(L)<1,9>, "MD2") "R#10" :SP1
   P.LINE = P.LINE : GLRP.REC(L)<1,10> "L#45" :SP1: S.NO "R#3" :SP1: CODE "L#4" :SP1
   P.LINE = P.LINE : ACCT.NUM :SP1: DESC "L#21" :SP1: SIGN "L#1" :SP1: LINE.TYPE "L#1"
   PRINT P.LINE
   LINE.CNT = LINE.CNT + 1
   IF S.CNT > 1 THEN
      FOR S = 2 TO S.CNT
         SIGN = GLRP.REC(L)<1,12,S>
         LINE.TYPE = GLRP.REC(L)<1,13,S>
         S.NO = S.NO + 1
         BEGIN CASE
            CASE GLRP.REC(L)<1,14,S> = ""
               CODE = "ACCT"
               ACCT.NO = GLRP.REC(L)<1,11,S>
               ACCT.NUM = ACCT.NO STRUC
               MATREAD COA.REC FROM COA, CONO:ACCT.NO ELSE
                  MAT COA.REC = ""; COA.DESC = "NOT ON FILE"
               END
               DESC = COA.DESC
            CASE GLRP.REC(L)<1,14,S> = 1
               CODE = "SUB"
               ACCT.NO = GLRP.REC(L)<1,11,S>[1,3]
               MATREAD AC.REC FROM ACCT.CATG, ACCT.NO ELSE
                  MAT AC.REC = ""; AC.DESC = "NOT ON FILE"
               END
               DESC = AC.DESC
               ACCT.NO = ACCT.NO :SP1: GLRP.REC(L)<1,11,S>[4,3]
               ACCT.NUM = ACCT.NO "L#14"
            CASE GLRP.REC(L)<1,14,S> = 2
               CODE = "CATG"
               ACCT.NO = GLRP.REC(L)<1,11,S>
               MATREAD AC.REC FROM ACCT.CATG, ACCT.NO ELSE
                  MAT AC.REC = ""; AC.DESC = "NOT ON FILE"
               END
               DESC = AC.DESC
               ACCT.NUM = ACCT.NO "L#14"
            CASE GLRP.REC(L)<1,14,S> = 3
               CODE = "TYPE"
               ACCT.NO = GLRP.REC(L)<1,11,S>
               MATREAD AT.REC FROM ACCT.TYPE, ACCT.NO ELSE
                  MAT AT.REC = ""; AT.DESC = "NOT ON FILE"
               END
               DESC = AT.DESC
               ACCT.NUM = ACCT.NO "L#14"
            CASE 1
               ACCT.NO = GLRP.REC(L)<1,11,S>; DESC = ''
               ACCT.NUM = ACCT.NO "L#14"; CODE = GLRP.REC(L)<1,14,1>
         END CASE
         P.LINE = ''
         P.LINE = SPACE(83): S.NO "R#3" :SP1: CODE "L#4" :SP1
         P.LINE = P.LINE : ACCT.NUM :SP1: DESC "L#21" :SP1: SIGN "L#1" :SP1: LINE.TYPE "L#1"
         PRINT P.LINE
         LINE.CNT = LINE.CNT + 1
         IF LINE.CNT > 55 THEN GOSUB 20
      NEXT S
   END
   RETURN
*
*---- CALLS FOR SYSCOM
*
93000*
   PRINTER OFF
   ERR.TYPE = 1
   CALL SYSCOM(MAT SYSCOM.REC)
99999*
END
