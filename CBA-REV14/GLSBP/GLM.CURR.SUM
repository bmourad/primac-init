*********************************************************************
* REVISION - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM   - PRIMAC
* SOURCE   - GLSBP
* PROGRAM  - GLM.CURR.SUM
* BY       - WALID YAMOUT ,C.B.A
* DATE     - 09/19/85
*********************************************************************
*COPY>PMC.CPYLIB>COMPANY
*COPY>GLS.CPYLIB>GLM
*COPY>GLS.CPYLIB>COA.BAL
*COPY>CPYLIB>CHAR
*
   PROCREAD INBUFF ELSE
      ERRMSG = "MUST RUN FROM PROC"; GOSUB 91000; GOTO 99999
   END
   READNEXT GLM.ID ELSE GOTO 99999
   CONO = INBUFF<1>
   IF CONO <> GLM.ID[1,3] THEN
      ERRMSG = 'CANNOT SELECT TWO DIFFERENT COMPANIES, ' : CONO : ' & ' : GLM.ID[1,3]
      GOSUB 91000; GOTO 88888
   END
   OPEN "","COMPANY" TO COMPANY ELSE
      ERRMSG = "COMPANY FILE IS MISSING"; GOSUB 91000; GOTO 88888
   END
   MATREAD COMP.REC FROM COMPANY,CONO ELSE
      ERRMSG = 'CANNOT LOCATE COMPANY, ' : CONO
      GOSUB 91000; GOTO 88888
   END
   MONTH = INBUFF<3>[5,2]
   OPEN "","GLR" TO GLR ELSE
      ERRMSG = "GLR FILE IS MISSING"; GOSUB 91000; GOTO 88888
   END
   OPEN "","CO.COA.BAL" TO CO.COA.BAL ELSE
      ERRMSG = "CO.COA.BAL FILE IS MISSING"; GOSUB 91000; GOTO 88888
   END
   OPEN "","DV.COA.BAL" TO DV.COA.BAL ELSE
      ERRMSG = "DV.COA.BAL FILE IS MISSING"; GOSUB 91000; GOTO 88888
   END
   OPEN "","DP.COA.BAL" TO DP.COA.BAL ELSE
      ERRMSG = "DP.COA.BAL FILE IS MISSING"; GOSUB 91000; GOTO 88888
   END
   OPEN "","CC.COA.BAL" TO CC.COA.BAL ELSE
      ERRMSG = "CC.COA.BAL FILE IS MISSING"; GOSUB 91000; GOTO 88888
   END
*
   DATA = 1
   ACCT.LEN = LEN(CO.ACCT.PIC)
   DIV = GLM.ID[4,2]
   DEPT = GLM.ID[6,2]
   CCTR = GLM.ID[8,3]
   ACCT = GLM.ID[11,ACCT.LEN]
   OACCT = ACCT
   ODIV = DIV
   ODEPT = DEPT
   OCCTR = CCTR
   ACCT.DB = 0
   ACCT.CR = 0
   ACCT.D.DB = 0
   ACCT.D.CR = 0
   DIV.DB = 0
   DIV.CR = 0
   DIV.D.DB = 0
   DIV.D.CR = 0
   DEPT.DB = 0
   DEPT.CR = 0
   DEPT.D.DB = 0
   DEPT.D.CR = 0
   CCTR.DB = 0
   CCTR.CR = 0
   CCTR.D.DB = 0
   CCTR.D.CR = 0
   LOOP
      BEGIN CASE
         CASE ACCT <> OACCT
            CCTR.ID = CONO : ODIV : ODEPT : OCCTR : OACCT
            OCCTR = CCTR
            MATREAD CB.REC FROM CC.COA.BAL, CCTR.ID ELSE
               MAT CB.REC = ''
            END
            CB.DEBITS = CCTR.DB; CB.CREDITS = CCTR.CR
            CB.D.DEBITS = CCTR.D.DB; CB.D.CREDITS = CCTR.D.CR
            MATWRITE CB.REC ON CC.COA.BAL, CCTR.ID
            CCTR.DB = 0; CCTR.CR = 0
            CCTR.D.DB = 0; CCTR.D.CR = 0
            DEPT.ID = CONO : ODIV : ODEPT : OACCT
            ODEPT = DEPT
            MATREAD CB.REC FROM DP.COA.BAL, DEPT.ID ELSE
               MAT CB.REC = ''
            END
            CB.DEBITS = DEPT.DB; CB.CREDITS = DEPT.CR
            CB.D.DEBITS = DEPT.D.DB; CB.D.CREDITS = DEPT.D.CR
            MATWRITE CB.REC ON DP.COA.BAL, DEPT.ID
            DEPT.DB = 0; DEPT.CR = 0
            DEPT.D.DB = 0; DEPT.D.CR = 0
            DIV.ID = CONO : ODIV : OACCT
            ODIV = DIV
            MATREAD CB.REC FROM DV.COA.BAL, DIV.ID ELSE
               MAT CB.REC = ''
            END
            CB.DEBITS = DIV.DB; CB.CREDITS = DIV.CR
            CB.D.DEBITS = DIV.D.DB; CB.D.CREDITS = DIV.D.CR
            MATWRITE CB.REC ON DV.COA.BAL, DIV.ID
            DIV.DB = 0; DIV.CR = 0
            DIV.D.DB = 0; DIV.D.CR = 0
            ACCT.ID = CONO : OACCT
            OACCT = ACCT
            MATREAD CB.REC FROM CO.COA.BAL, ACCT.ID ELSE
               MAT CB.REC = ''
            END
            CB.DEBITS = ACCT.DB; CB.CREDITS = ACCT.CR
            CB.D.DEBITS = ACCT.D.DB; CB.D.CREDITS = ACCT.D.CR
            MATWRITE CB.REC ON CO.COA.BAL, ACCT.ID
            ACCT.DB = 0; ACCT.CR = 0
            ACCT.D.DB = 0; ACCT.D.CR = 0
         CASE DIV <> ODIV
            CCTR.ID = CONO : ODIV : ODEPT : OCCTR : OACCT
            OCCTR = CCTR
            MATREAD CB.REC FROM CC.COA.BAL, CCTR.ID ELSE
               MAT CB.REC = ''
            END
            CB.DEBITS = CCTR.DB; CB.CREDITS = CCTR.CR
            CB.D.DEBITS = CCTR.D.DB; CB.D.CREDITS = CCTR.D.CR
            MATWRITE CB.REC ON CC.COA.BAL, CCTR.ID
            CCTR.DB = 0; CCTR.CR = 0
            CCTR.D.DB = 0; CCTR.D.CR = 0
            DEPT.ID = CONO : ODIV : ODEPT : OACCT
            ODEPT = DEPT
            MATREAD CB.REC FROM DP.COA.BAL, DEPT.ID ELSE
               MAT CB.REC = ''
            END
            CB.DEBITS = DEPT.DB; CB.CREDITS = DEPT.CR
            CB.D.DEBITS = DEPT.D.DB; CB.D.CREDITS = DEPT.D.CR
            MATWRITE CB.REC ON DP.COA.BAL, DEPT.ID
            DEPT.DB = 0; DEPT.CR = 0
            DEPT.D.DB = 0; DEPT.D.CR = 0
            DIV.ID = CONO : ODIV : OACCT
            ODIV = DIV
            MATREAD CB.REC FROM DV.COA.BAL, DIV.ID ELSE
               MAT CB.REC = ''
            END
            CB.DEBITS = DIV.DB; CB.CREDITS = DIV.CR
            CB.D.DEBITS = DIV.D.DB; CB.D.CREDITS = DIV.D.CR
            MATWRITE CB.REC ON DV.COA.BAL, DIV.ID
            DIV.DB = 0; DIV.CR = 0
            DIV.D.DB = 0; DIV.D.CR = 0
         CASE DEPT <> ODEPT
            CCTR.ID = CONO : ODIV : ODEPT : OCCTR : OACCT
            OCCTR = CCTR
            MATREAD CB.REC FROM CC.COA.BAL, CCTR.ID ELSE
               MAT CB.REC = ''
            END
            CB.DEBITS = CCTR.DB; CB.CREDITS = CCTR.CR
            CB.D.DEBITS = CCTR.D.DB; CB.D.CREDITS = CCTR.D.CR
            MATWRITE CB.REC ON CC.COA.BAL, CCTR.ID
            CCTR.DB = 0; CCTR.CR = 0
            CCTR.D.DB = 0; CCTR.D.CR = 0
            DEPT.ID = CONO : ODIV : ODEPT : OACCT
            ODEPT = DEPT
            MATREAD CB.REC FROM DP.COA.BAL, DEPT.ID ELSE
               MAT CB.REC = ''
            END
            CB.DEBITS = DEPT.DB; CB.CREDITS = DEPT.CR
            CB.D.DEBITS = DEPT.D.DB; CB.D.CREDITS = DEPT.D.CR
            MATWRITE CB.REC ON DP.COA.BAL, DEPT.ID
            DEPT.DB = 0; DEPT.CR = 0
            DEPT.D.DB = 0; DEPT.D.CR = 0
         CASE CCTR <> OCCTR
            CCTR.ID = CONO : ODIV : ODEPT : OCCTR : OACCT
            OCCTR = CCTR
            MATREAD CB.REC FROM CC.COA.BAL, CCTR.ID ELSE
               MAT CB.REC = ''
            END
            CB.DEBITS = CCTR.DB; CB.CREDITS = CCTR.CR
            CB.D.DEBITS = CCTR.D.DB; CB.D.CREDITS = CCTR.D.CR
            MATWRITE CB.REC ON CC.COA.BAL, CCTR.ID
            CCTR.DB = 0; CCTR.CR = 0
            CCTR.D.DB = 0; CCTR.D.CR = 0
      END CASE
      MATREAD GLM.REC FROM GLR, GLM.ID ELSE
         MAT GLM.REC = ''
      END
      BEGIN CASE
         CASE GLM.AMT > 0
            ACCT.DB = ACCT.DB + GLM.AMT
            DIV.DB = DIV.DB + GLM.AMT
            DEPT.DB = DEPT.DB + GLM.AMT
            CCTR.DB = CCTR.DB + GLM.AMT
            IF GLM.P.DATE = "" THEN
               ACCT.D.DB = ACCT.D.DB + GLM.AMT
               DIV.D.DB = DIV.D.DB + GLM.AMT
               DEPT.D.DB = DEPT.D.DB + GLM.AMT
               CCTR.D.DB = CCTR.D.DB + GLM.AMT
            END
         CASE GLM.AMT < 0
            ACCT.CR = ACCT.CR - GLM.AMT
            DIV.CR = DIV.CR - GLM.AMT
            DEPT.CR = DEPT.CR - GLM.AMT
            CCTR.CR = CCTR.CR - GLM.AMT
            IF GLM.P.DATE = "" THEN
               ACCT.D.CR = ACCT.D.CR - GLM.AMT
               DIV.D.CR = DIV.D.CR - GLM.AMT
               DEPT.D.CR = DEPT.D.CR - GLM.AMT
               CCTR.D.CR = CCTR.D.CR - GLM.AMT
            END
      END CASE
   WHILE DATA DO
      READNEXT GLM.ID ELSE
         DATA = 0
         GLM.ID = 'XXXXXXXXXXXXXXXXXXXX'
      END
      DIV = GLM.ID[4,2]
      DEPT = GLM.ID[6,2]
      CCTR = GLM.ID[8,3]
      ACCT = GLM.ID[11,ACCT.LEN]
   REPEAT  
   GOTO 99999
**** ERROR ROUTINE
91000 PRINT @(0,23): ERRMSG : CL :
   INPUT ERRMSG,1 :
   PRINT @(0,23): CL :
   RETURN
88888 INBUFF<3> = "END"
   PROCWRITE INBUFF
99999 END
