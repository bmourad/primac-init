*COPY>CPYLIB>COM1
**************************************************************
* REVISION      - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* PROGRAM       - COA.AUDIT.TRAIL.RPT
* SYSTEM        - GLSBP
* BY            - RHONDA PERRIN, COMPUTER BUSINESS ASSOCIATES
* DATE          - 07/18/86
* DESCRIPTION   -
* This program produces an Audit Trail report for COA.
*
* TASK 18573 LLH 4/95 - ACCOUNTING PERIODS 1-52
*T26090 wyamout 03/24/2002 * Add PMC_REPORTS logic and call to
*                            GET.PROG.HEAD
*ENDDOC
**************************************************************
*
*---- FILE EQUATES
*
*COPY>CPYLIB>SYSCOM
*COPY>CPYLIB>CHAR
*COPY>CPYLIB>FILE.VARS
*COPY>PMC.CPYLIB>COMPANY
*COPY>GLS.CPYLIB>COA.AUDIT.TRAIL
*
*---- SETUP FOR SYSTEM ERROR MESSAGES
*
   SYS.TYPE = 1
   CALL SYSCOM(MAT SYSCOM.REC)
*
*---- PROCREAD
*
   PROCREAD ID ELSE ERRMSG = "MUST BE RUN FROM PROC";GOSUB 91000;GOTO 99999
   CONO = ID<1>
   REPORT_ID = ID<2>
   BEG.DATE = ID<3>
   END.DATE = ID<4>
   OPTION = ID<5>
*
*---- DIMENSION TABLE
*
   DIM PB(15)
*
*---- OPEN FILES
*
   OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = 'COMPANY FILE MISSING';GOTO 93000
   OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE MISSING';GOTO 93000
   OPEN '','COA.AUDIT.TRAIL' TO COA.AUDIT.TRAIL ELSE ERRMSG = 'COA.AUDIT.TRAIL FILE MISSING';GOTO 93000
*
*---- READ COMPANY RECORD
*
*T26090 v
*  CALL GET.CONO(CONO,MAT COMP.REC)
   MATREAD COMP.REC FROM COMPANY, CONO ELSE
      ERRMSG = "Invalid Company ID (": CONO :")"
      GOSUB 91000
      CONO = "END"
   END
   IF CONO = "END" THEN GOTO 99999
*T26090 ^
*
   READ PER.DATES FROM CONTROL,CONO:"OPENDATES" ELSE
      ERRMSG = "CONTROL RECORD OPENDATES IS MISSING";GOSUB 91000;GOTO 99999
   END
   READ PERIOD.REC FROM CONTROL,CONO:"ACCT.PERIODS" ELSE
      PERIOD.REC = ""
      PERIOD.REC<1> = 12
   END
   YEAR.END = PERIOD.REC<1> + 1
*
*---- INITIALIZATION
*
   PG.NO = 0
   NODATA = 1
   SP = " "
   SP2 = "  "
   SP3 = "   "
   SP5 = SP2:SP3
   SP6 = SP3:SP3
   SP12= SP6:SP6
   DSH = STR('-',13)
   D8 = DSH[1,8]
   D2 = '--'
*T26090 v
*  T.DATE = OCONV(DATE(),"D2/")
   T.DATE = ""
*T26090 ^
   B.DATE = OCONV(BEG.DATE,"D2/")
   E.DATE = OCONV(END.DATE,"D2/")
*T26090 v
*  K = SPACE(INT((50 - LEN(CO.NAME)) / 2))
*  C.NAME = K:CO.NAME:K
*  C.NAME = C.NAME "L#50"
*  HD1 = "DATE : ":T.DATE:SPACE(27):C.NAME:SPACE(29):"PAGE : "
*  HD2 = "TIME : ":OCONV(TIME(),"MTS")
*  IF OPTION = "R" THEN
*     HD2 = HD2:SPACE(24):"C H A R T   O F   A C C O U N T S   A U D I T   T R A I L":SPACE(25):"RPT# : XXXX"
*  END ELSE
*     HD2 = HD2:SPACE(16):"C H A R T   O F   A C C O U N T S   A U D I T   T R A I L (CLEAR)":SPACE(25):"RPT# : XXXX"
*  END
   HD1 = ""
   HD2 = ""
   REPORT_NAME = ''
   CALL GET.PROG.HEAD(CONO,CO.NAME,REPORT_NAME,REPORT_ID,T.DATE,HD1,HD2)
*T26090 ^
   HD3 = SPACE(54):"FROM ":B.DATE:" TO ":E.DATE
   HD4 = "ACCOUNT  : "
   HD5 = "DATE     : "
   HD6 = "OPERATOR : "
   HD7 = SPACE(36):"B E F O R E":SPACE(55):"A F T E R"
   HD8 = SPACE(36):"-----------":SPACE(55):"---------"
   HD9 = "DESCRIPTION     : "
   HD10= "LONG DESCRIPTION: "
   HD11= "ACCOUNT TYPE    : "
   HD12= "CATEGORY        : "
   HD13= "SUB CATEGORY    : "
   HD14= "   CURR / LONG  : "
   HD15= "   FIX/VARIABLE : "
   HD16= "   PRO/SELL/ADMN: "
   HD17= "(DEBIT / CREDIT): "
   HD18= "ACCOUNT LEVEL   : "
   HD19= "     OPEN     PR    THIS YEAR          LAST YEAR           BUDGET":SPACE(17):"THIS YEAR          LAST YEAR          BUDGET"
   HD20= "   BAL DATE   NO   OPEN BALANCE       OPEN BALANCE      OPEN BALANCE":SPACE(13):"OPEN BALANCE       OPEN BALANCE      OPEN BALANCE"
   HD21= SP3:D8:SP3:D2:SP2:DSH:SP6:DSH:SP5:DSH:SP12:DSH:SP6:DSH:SP5:DSH
   STRUC = CO.ACCT.MASK:STR("#",15 - LEN(CO.ACCT.MASK))
   PRINTER ON
*
*---- MAIN PROCESSING
*
   READNEXT CAT.KEY ELSE GOTO 99999
   GOSUB 1000
   DATA = 1
   LOOP
      READNEXT CAT.KEY ELSE DATA = 0
   WHILE DATA DO
      GOSUB 1000
   REPEAT
   PRINTER OFF
   GOTO 99999
1000 MATREAD CAT.REC FROM COA.AUDIT.TRAIL,CAT.KEY ELSE GOTO 1999
   PRINT CHAR(12):
   PG.NO = PG.NO + 1
   PRINT HD1:PG.NO
   PRINT HD2
   PRINT HD3
   PRINT
   PRINT HD4:CAT.ACCOUNT STRUC
   PRINT HD5:OCONV(CAT.DATE,"D2/")
   PRINT HD6:CAT.OPER
   PRINT
   PRINT
   PRINT HD7
   PRINT HD8
   PRINT 
   PRINT HD9:CAT.B.DESC "L#30":SPACE(32):CAT.A.DESC
   PRINT HD10:CAT.B.L.DESC "L#50":SP12:CAT.A.L.DESC
   PRINT HD11:CAT.B.TYPE "L#1":SPACE(61):CAT.A.TYPE
   PRINT HD12:CAT.B.CATG "L#3":SPACE(59):CAT.A.CATG
   PRINT HD13:CAT.B.SUB.CATG "L#3":SPACE(59):CAT.A.SUB.CATG
   PRINT HD14:CAT.B.CURR "L#1":SPACE(61):CAT.A.CURR
   PRINT HD15:CAT.B.FIX "L#1":SPACE(61) :CAT.A.FIX
   PRINT HD16:CAT.B.PROD "L#1":SPACE(61):CAT.A.PROD
   PRINT HD17:CAT.B.NORM "L#2":SPACE(60):CAT.A.NORM
   PRINT HD18:CAT.B.LEVEL"L#2":SPACE(60):CAT.A.LEVEL
   IF CAT.CHANGE < 2 THEN GOTO 1999
   MAT PB = ""
   FOR N = 1 TO PERIOD.REC<1>
      XX = LEN(N)
      IF XX = 1 THEN
         NUM = "0":N
      END ELSE
         NUM = N
      END
      PB(N) = SP3:OCONV(PER.DATES<N>,"D2/") "R#8":SP3:NUM "L#2":SP2
   NEXT N
   PB(YEAR.END) = SPACE(14):"YE  "
   FOR N = 1 TO YEAR.END
      PB(N) = PB(N):OCONV(CAT.REC(N + 50) ,"MD2,") "R#13":SP6
      PB(N) = PB(N):OCONV(CAT.REC(N + 103) ,"MD2,") "R#13":SP5
      PB(N) = PB(N):OCONV(CAT.REC(N + 156) ,"MD2,") "R#13":SP12
      PB(N) = PB(N):OCONV(CAT.REC(N + 209) ,"MD2,") "R#13":SP6
      PB(N) = PB(N):OCONV(CAT.REC(N + 262),"MD2,") "R#13":SP5
      PB(N) = PB(N):OCONV(CAT.REC(N + 315),"MD2,") "R#13"
   NEXT N
   PRINT
   PRINT
   PRINT
   PRINT HD19
   PRINT HD20
   PRINT HD21
   FOR N = 1 TO PERIOD.REC<12>
      PRINT PB(N)
   NEXT N
1999 RETURN
*
*---- CALLS FOR SYSCOM
*
91000 ERR.TYPE = 1
   CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
93000 ERR.TYPE = 3
   CALL SYSCOM(MAT SYSCOM.REC)
99999 END
