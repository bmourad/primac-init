*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - EPSBP
* PROGRAM     - SUI.RPT
* BY          - WALID YAMOUT
* DATE        - 05/25/84
* DESCRIPTION - Prints the State Unemployment Insurance Report
* TASK 20670 JR ADD TAXABLE WAGES COLUMN
*********************************************************************
*COPY>PMC.CPYLIB>COMPANY
*COPY>PMC.CPYLIB>EMPLOYEE
*COPY>PRS.CPYLIB>QTD-YTD
*COPY>PRS.CPYLIB>MISCDED
*COPY>PRS.CPYLIB>TAX2 
*COPY>CPYLIB>CHAR
      PROCREAD INBUFF ELSE PRINT "CAN'T READ INPUT BUFFER":;INPUT GO$;STOP
      CONO=INBUFF<1>;QTR=INBUFF<3>;YEAR=INBUFF<4>;BACKUP=INBUFF<6>
      IF BACKUP="Y" THEN
         OPEN "S.COMPANY" TO COMPANY ELSE PRINT "CAN'T OPEN S.COMPANY":;INPUT GO$;STOP
         OPEN "S.EMPLOYEE" TO EMPLOYEE ELSE PRINT "CAN'T OPEN S.EMPLOYEE":;INPUT GO$;STOP
         OPEN "S.QTD-YTD" TO QTD.YTD ELSE PRINT "CAN'T OPEN S.QTD-YTD":;INPUT GO$;STOP
      END ELSE
         OPEN "COMPANY" TO COMPANY ELSE PRINT "CAN'T OPEN COMPANY":;INPUT GO$;STOP
         OPEN "EMPLOYEE" TO EMPLOYEE ELSE PRINT "CAN'T OPEN EMPLOYEE":;INPUT GO$;STOP
         OPEN "QTD-YTD" TO QTD.YTD ELSE PRINT "CAN'T OPEN QTD-YTD":;INPUT GO$;STOP
      END
      OPEN "MISCDED" TO MISCDED ELSE PRINT "CAN'T OPEN MISCDED":;INPUT GO$;STOP
      OPEN "TAX2" TO TAX2 ELSE PRINT "CAN'T OPEN TAX2":;INPUT GO$;STOP
      MATREAD COMP.REC FROM COMPANY, CONO ELSE PRINT "CAN'T READ COMPANY":;INPUT GO$;STOP
      RPT.QTR=""
      IF QTR=1 THEN RPT.QTR="1ST QUARTER "
      IF QTR=2 THEN RPT.QTR="2ND QUARTER "
      IF QTR=3 THEN RPT.QTR="3RD QUARTER "
      IF QTR=4 THEN RPT.QTR="4TH QUARTER "
      RPT.QTR=RPT.QTR:YEAR
      SP20 = SPACE(20)
      SP10 = SPACE(10)
      SP2 = SPACE(2)
      SP3 = SPACE(3)
      SP5 = SPACE(5)
      SP4 = SPACE(4)
*
*---- HEADING
*
      HEAD1 = "DATE - " : OCONV(DATE(), "D2/") "R#8" :SP20
      HEAD1 = HEAD1 : "STATE UNEMPLOYMENT TAX (SUTA) REPORT FOR THE " :RPT.QTR "L#16"
      HEAD1 = HEAD1 : SP20 : "PAGE - "
      HEAD2 = CO.NAME 
      HEAD3 = CO.ADDRESS 
      HEAD4 = CO.CITY : SP10 : CO.STATE "L#2" : SP3 : CO.ZIP 
      HEAD5 = "FEDERAL TAX ID - " : CO.FED.TAX.ID "L#11" :SP4: "COUNTY CODE - " : CO.COUNTY.CODE 
      HEAD6 = "STATE TAX ID   - " : CO.STATE.TAX.ID "L#11" :SP4: "AREA CODE   - " : CO.AREA.CODE 
      HEAD7 = "EXEMPT LEVEL   = " : OCONV(CO.MAX.SUI.TAX, "MD2,$") 
      HEAD7A = SPACE(53):"ADJUSTED"
* T20670
*     HEAD8 = "SOCIAL SECURITY" :SP3: "EMPLOYEE NAME" :SP20: "GROSS WAGES " :SP3: "EXEMPT WAGES"
*     HEAD9 = "---------------" :SP3: "------------------------------" :SP3: "------------" :SP3: "------------"
      HEAD8 = "SOCIAL SECURITY" :SP3: "EMPLOYEE NAME" :SP20: "GROSS WAGES " :SP3: "EXEMPT WAGES":SP2:"TAXABLE WAGES"
      HEAD9 = "---------------" :SP3: "------------------------------" :SP3: "------------" :SP3: "------------":SP2:"-------------"
* T20670
      PRINTER ON
      LINE.COUNT = 99
      PAGE.NO = 0
      TOT.GROSS = 0
      TOT.EXEMPT = 0
      PAG.GROSS = 0
      PAG.EXEMPT = 0
      STATE.GROSS = 0
      STATE.EXEMPT = 0
      SAVE.ST.CODE = "*!?@"
      FIRST = 1
100*
      READNEXT ID ELSE GOTO 200
      MAT EMP.REC = "";MAT QTD.REC = ""
      MATREAD EMP.REC FROM EMPLOYEE,ID ELSE GOTO 100
      ALT.GROSS=0;ALT.NTSICK=0;QTD.NTD.SUTA=0;YTD.NTD.SUTA=0
      IF FIRST THEN GOSUB 5000
      IF EMP.ST.CODE # HOLD.ST.CODE THEN GOSUB 5000
      IF EMP.ALT.NO # "" THEN
         MATREAD QTD.REC FROM QTD.YTD,ID[1,3]:EMP.ALT.NO ELSE MAT QTD.REC=""
         FOR X=1 TO QTR
            ALT.GROSS=ALT.GROSS+QTD.GROSS<1,X>
            ALT.NTSICK=ALT.NTSICK+QTD.SK.NO.FI<1,X>
         NEXT X
*        GOSUB 5000;ALT.GROSS=ALT.GROSS-NON.TAX.DED
         GOSUB 4000
      END
      MATREAD QTD.REC FROM QTD.YTD,ID ELSE GOTO 100
      IF QTD.GROSS<1,QTR> + 0 = 0 THEN GOTO 100
      GROSS.YTD=0;NTSICK.YTD=0
      FOR Y=1 TO QTR
         GROSS.YTD=GROSS.YTD+QTD.GROSS<1,Y>
         NTSICK.YTD=NTSICK.YTD+QTD.SK.NO.FI<1,Y>
      NEXT Y
*     GOSUB 5000;GROSS.YTD=GROSS.YTD-NON.TAX.DED
      GOSUB 4000
*
      BEGIN CASE
      CASE TTR.EMPR.MAX.SUI # "" AND TTR.EMPR.MAX.SUI # " "
         SUI.MAXIMUM = TTR.EMPR.MAX.SUI * 100
      CASE CO.MAX.SUI.TAX # ""
         SUI.MAXIMUM = CO.MAX.SUI.TAX
      CASE 1
         SUI.MAXIMUM = 0
      END CASE
      PAID=QTD.GROSS<1,QTR>-QTD.SK.NO.FI<1,QTR>-QTD.NTD.SUTA
      THIS.SUI=GROSS.YTD-NTSICK.YTD-YTD.NTD.SUTA;THAT.SUI=ALT.GROSS-ALT.NTSICK
      PRE.SUI=THIS.SUI-PAID
      BEGIN CASE
      CASE (THIS.SUI+THAT.SUI) > SUI.MAXIMUM 
         THIS.SUI=(SUI.MAXIMUM-THAT.SUI)-PRE.SUI
      CASE THIS.SUI > SUI.MAXIMUM
         THIS.SUI=SUI.MAXIMUM-PRE.SUI
      CASE THAT.SUI > SUI.MAXIMUM
         THIS.SUI=0
      CASE 1
         THIS.SUI=PAID
      END CASE
      IF THIS.SUI<0 THEN THIS.SUI=0
      SUI=THIS.SUI
      EXEMPT=0
      IF PAID > SUI THEN EXEMPT=PAID-SUI
*
      NAME = EMP.LAST.NAME : " " : EMP.FRST.NAME
      IF LINE.COUNT > 53 THEN
         IF PAGE.NO > 0 THEN
* T20670
*           PRINT SPACE(51) : "------------" :SP3: "------------"
*           PRINT SPACE(37):"PAGE TOTALS - ":OCONV(PAG.GROSS,"MD2,")"R#12   ":OCONV(PAG.EXEMPT,"MD2,")"R#12"
            PRINT SPACE(51) : "------------" :SP3: "------------":SP3:"------------"
            PRINT SPACE(37):"PAGE TOTALS - ":OCONV(PAG.GROSS,"MD2,")"R#12   ":OCONV(PAG.EXEMPT,"MD2,")"R#12":SP3:OCONV((PAG.GROSS-PAG.EXEMPT),"MD2,")"R#12"
* T20670
         END
         GOSUB 8500
      END
*
      LINE.GROSS = QTD.GROSS<1,QTR>-QTD.SK.NO.FI<1,QTR>-QTD.NTD.SUTA
* T20670
*     PRINT "  ":EMP.SOC.SEC"L#11" :SP5: NAME"L#30   " :OCONV(LINE.GROSS,"MD2Z,")"R#12   ":OCONV(EXEMPT,"MD2Z,")"R#12"
      PRINT "  ":EMP.SOC.SEC"L#11" :SP5: NAME"L#30   " :OCONV(LINE.GROSS,"MD2Z,")"R#12   ":OCONV(EXEMPT,"MD2Z,")"R#12":SP3:OCONV((LINE.GROSS-EXEMPT),"MD2Z,")"R#12"
* T20670
      PRINT
      TOT.GROSS = TOT.GROSS + LINE.GROSS
      TOT.EXEMPT = TOT.EXEMPT + EXEMPT
      PAG.GROSS = PAG.GROSS + LINE.GROSS
      PAG.EXEMPT = PAG.EXEMPT + EXEMPT
      STATE.GROSS = STATE.GROSS + LINE.GROSS
      STATE.EXEMPT = STATE.EXEMPT + EXEMPT
      LINE.COUNT = LINE.COUNT + 2
      GOTO 100
200*
      IF PAGE.NO < 1 THEN GOSUB 8500
* T20670
*     PRINT SPACE(51) : "------------" :SP3: "------------"
*     PRINT SPACE(37) : "     TOTALS - ":OCONV(STATE.GROSS,"MD2,")"R#12   ":OCONV(STATE.EXEMPT,"MD2,")"R#12"
      PRINT SPACE(51) : "------------" :SP3: "------------":SP3:"------------"
      PRINT SPACE(37) : "     TOTALS - ":OCONV(STATE.GROSS,"MD2,")"R#12   ":OCONV(STATE.EXEMPT,"MD2,")"R#12":SP3:OCONV((STATE.GROSS-STATE.EXEMPT),"MD2Z,")"R#12"
* T20670
      PRINT
* T20670
*      PRINT SPACE(29): "      TAXABLE WAGES = " : OCONV((STATE.GROSS - STATE.EXEMPT), "MD2,")
*      PRINT
* T20670
      IF LINE.COUNT + 4 > 53 THEN GOSUB 8500
*     PRINT SPACE(51) : "------------" :SP3: "------------"
      PRINT CHAR(12):
      FINAL.HEAD = SPACE(39):"GRAND TOTAL FOR STATE UNEMPLOYMENT TAX (SUTA)"
      PRINT FINAL.HEAD
      PRINT; PRINT; PRINT
* T20670
*      PRINT SPACE(36) : "GRAND TOTAL - ":OCONV(TOT.GROSS, "MD2,") "R#12" :SP3:OCONV(TOT.EXEMPT, "MD2,") "R#12"
      PRINT SPACE(36) : "GRAND TOTAL - ":OCONV(TOT.GROSS, "MD2,") "R#12" :SP3:OCONV(TOT.EXEMPT, "MD2,") "R#12":SP3:OCONV(TOT.GROSS-TOT.EXEMPT,"MD2,")"R#12"
      PRINT
*      PRINT SPACE(29): "TOTAL TAXABLE WAGES = " : OCONV((TOT.GROSS - TOT.EXEMPT), "MD2,")
* T20670      
      PRINTER OFF
      GOTO 999999
*
*----- GET NONTAX DEDUCTS
*
4000 *
      NTD.CNT=DCOUNT(QTD.DED,VM)
      FOR REF=1 TO NTD.CNT
         MATREAD MDED.REC FROM MISCDED,CONO:QTD.DED<1,REF> ELSE MAT MDED.REC=""
         IF MDED.TAXABLE="B" THEN
            IF MDED.NTXSUTA = "Y" THEN
               FOR X = 1 TO QTR
                  YTD.NTD.SUTA = YTD.NTD.SUTA + QTD.AMNT<1,REF,X>
                  IF X = QTR THEN
                      QTD.NTD.SUTA = QTD.NTD.SUTA + QTD.AMNT<1,REF,X>
                  END
               NEXT X
            END
         END
      NEXT REF
      RETURN
*
*---- NON TAXABLE DEDUCTIONS
5000*
*     NON.TAX.DED=0
*     NTD.CNT=DCOUNT(QTD.DED,VM)
*     FOR REF=1 TO NTD.CNT
*        MATREAD MDED.REC FROM MISCDED,CONO:QTD.DED<1,REF> ELSE MAT MDED.REC=""
*        IF MDED.TAXABLE="B" THEN
*           FOR X=1 TO QTR
*              NON.TAX.DED=NON.TAX.DED+QTD.AMNT<1,REF,X>
*              IF X=QTR THEN QTD.NTD=QTD.NTD+QTD.AMNT<1,REF,X>
*           NEXT X
*        END
*     NEXT REF
      IF NOT(FIRST) THEN
         IF PAGE.NO < 1 THEN GOSUB 8500
* T20670
*         PRINT SPACE(51) : "------------" :SP3: "------------"
*         PRINT SPACE(36) : "      TOTALS - ":OCONV(STATE.GROSS,"MD2,")"R#12   ":OCONV(STATE.EXEMPT,"MD2,")"R#12"
         PRINT SPACE(51) : "------------" :SP3: "------------":SP3:"------------"
         PRINT SPACE(36) : "      TOTALS - ":OCONV(STATE.GROSS,"MD2,")"R#12   ":OCONV(STATE.EXEMPT,"MD2,")"R#12":SP3:OCONV(STATE.GROSS-STATE.EXEMPT,"MD2,")"R#12"
         PRINT
*         PRINT SPACE(29): "      TAXABLE WAGES = " : OCONV((STATE.GROSS - STATE.EXEMPT), "MD2,")
* T20670
      END
      FIRST = 0
      STATE.GROSS = 0
      STATE.EXEMPT = 0
      HOLD.ST.CODE = EMP.ST.CODE
      MATREAD TAX.TAB.REC FROM TAX2, CONO:EMP.ST.CODE ELSE MAT TAX.TAB.REC = ""
      GOSUB 8500
      RETURN
*
*---- HEADING ROUTINE
8500*
      PAGE.NO = PAGE.NO + 1
*
      IF EMP.ST.CODE = "" OR EMP.ST.CODE = " " THEN
         HEAD1A = ""
      END ELSE
         HEAD1A = SPACE(58):"FOR STATE CODE - ":EMP.ST.CODE
      END
*
      BEGIN CASE
      CASE TTR.EMPR.MAX.SUI # "" AND TTR.EMPR.MAX.SUI # " "
         PRT.MAXIMUM = TTR.EMPR.MAX.SUI * 100
      CASE CO.MAX.SUI.TAX # ""
         PRT.MAXIMUM = CO.MAX.SUI.TAX
      CASE 1
         PRT.MAXIMUM = 0
      END CASE
      BEGIN CASE
*
      CASE TTR.STATE.TAX.ID # "" AND TTR.STATE.TAX.ID # " "
         PRT.TAX.ID = TTR.STATE.TAX.ID
      CASE CO.STATE.TAX.ID # ""
         PRT.TAX.ID = CO.STATE.TAX.ID
      CASE 1
         PRT.TAX.ID = ""
      END CASE
*
      HEAD6 = "STATE TAX ID   - " : PRT.TAX.ID "L#11" :SP4: "AREA CODE   - " : CO.AREA.CODE 
      HEAD7 = "EXEMPT LEVEL   = " : OCONV(PRT.MAXIMUM, "MD2,$") 
      HEAD7AA = "STATE TABLE ID - ":EMP.ST.CODE; * T20670
*
*     HEADING HEAD1 : PAGE.NO "R#3" : "]]" : HEAD2 : HEAD3 : HEAD4 : HEAD5 : HEAD6 : HEAD7 : HEAD8 : HEAD9
      PRINT CHAR(12):
      PRINT HEAD1 : PAGE.NO "R#3"
      PRINT
      PRINT HEAD2
      PRINT HEAD3
      PRINT HEAD4
      PRINT
      PRINT HEAD5
      PRINT HEAD6
      PRINT HEAD7
      PRINT HEAD7AA; * T20670
      PRINT HEAD7A
*     PRINT
      PRINT HEAD8
      PRINT HEAD9
* T20670
*      LINE.COUNT = 13
      LINE.COUNT = 14
* T20670      
      PAG.GROSS = 0
      PAG.EXEMPT = 0
      RETURN
999999*
   END
