*COPY>ICS.CPYLIB>CATEGORY
*COPY>ICS.CPYLIB>CATEGORY.REV11
OPEN '','CATEGORY' TO CATEGORY ELSE STOP 201
OPEN '','CATEGORY.OLD' TO CATEGORY.OLD ELSE STOP 201
OPEN '','CONTROL' TO CONTROL ELSE STOP 'CONTROL'
CMD = 'SELECT CATEGORY.OLD'
UDTEXECUTE CMD CAPTURING MSG
PRINT @(-1)
PRINT @(1,5):'Converting CATEGORY':@(-4)
DONE = 0
LOOP
  READNEXT CATG.ID ELSE DONE=1
  PRINT @(45,5):CATG.ID:@(-4)
UNTIL (DONE) DO 
  MATREAD R11.CATG.REC FROM CATEGORY.OLD,CATG.ID THEN
    MAT CATG.REC=MAT R11.CATG.REC
    IF CATG.MAJ.LINE='FNGD' THEN
      CATG.TRK.LVL='R'
      CATG.BARCODE='N'
      CATG.COST.TYPE='AC'
      MATWRITE CATG.REC ON CATEGORY,CATG.ID
    END ELSE
      IF R11.CATG.R.S.ID = "Y" THEN
        CATG.TRK.LVL ="G"
        CATG.BARCODE="N"
      END ELSE
        CATG.TRK.LVL="S"
        CATG.BARCODE="Y"
      END
      MATWRITE CATG.REC ON CATEGORY,CATG.ID
    END
  END
REPEAT
;*
;* convert RL.SK.CONTROL
;*
CMD='SELECT COMPANY'
UDTEXECUTE CMD CAPTURING MSG
DONE=0
LOOP
  READNEXT ID ELSE DONE=1
UNTIL DONE DO
  NEWREC=''
  READ REC FROM CONTROL,ID:"RL.SK.CONTROL" THEN
    NEWREC<1>=REC<5>
    WRITE NEWREC ON CONTROL,ID:"RL.SK.CONTROL"
  END
REPEAT
;*
;* build indicies
;*
UDTEXECUTE 'BUILD.INDEX WAREHOUSE ALL'
UDTEXECUTE 'BUILD.INDEX INV.WHSE ALL'
UDTEXECUTE 'BUILD.INDEX INV_AUDIT_HIST ALL'
UDTEXECUTE 'BUILD.INDEX INV_RECP_WHSE ALL'
UDTEXECUTE 'BUILD.INDEX BOL ALL'
