*
*
**********************************************
* REVISION    - [XX.X]
* Copyright 1995 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - R12CNVBP
* PROGRAM     - CONV.OUTSIDE.PO
* BY          - CHRIS MYKLEBUST - PRIMAC SYSTEMS
* DATE        - 05/06/2002
* DESCRIPTION -
*
*T28779 lross 02/09/2006 * Retain identity of multiple same Prod/Whse
*                          lines.
*                          This pgm was copied from CONV.OUTSIDE.PO.
*ENDDOC
**********************************************
*   CPYLIBS
*COPY>PMC.CPYLIB>PO
*COPY>CPYLIB>CHAR
*
*   FILE OPENS
   OPEN "PO" TO PO ELSE
      ERRMSG="Unable to open po"
      GOSUB 91000
      STOP
   END
*
*   INITIALIZATION SECTION
*
*   BODY OF PROGRAM SECTION
*
*DEBUG
   VERB = "COUNT PO"
   UDTEXECUTE VERB CAPTURING JUNK
 
   NUMITEMS = FIELD(JUNK<3>," ",1)
   NUMFRAMES = INT(NUMITEMS / 5)
   VERB = "CREATE.FILE HOLD_PO ":NUMFRAMES
   UDTEXECUTE VERB
   OPEN "HOLD_PO" TO HOLD_PO ELSE
      ERRMSG = "UNABLE TO OPEN HOLD_PO"
      GOSUB 91000
      STOP
   END
*CLEARFILE HOLD_PO
   CTR=0
   SELECT PO
   DONE = 0
   LOOP
      READNEXT ID ELSE DONE = 1
   UNTIL DONE DO
      MATREADU PO.REC FROM PO,ID THEN
         READ REC FROM HOLD_PO,ID THEN
      *  ALREADY PROCESSED
         END ELSE
            MATWRITE PO.REC ON HOLD_PO,ID
            GOSUB PROCESS.PO
         END
      END
      CTR += 1
      IF REM(CTR,100) = 0 THEN PRINT CTR
   REPEAT
   STOP
*
*
PROCESS.PO: 
*
   IF PO.LAST.SEQ = "" THEN
      PO.LAST.SEQ=0
      NUM.LINES = DCOUNT(PO.PROD.NUM,@VM)
      FOR II = 1 TO NUM.LINES
         PO.LAST.SEQ += 1
         PO.PROD.SEQ<1,II>=PO.LAST.SEQ
      NEXT II
      MATWRITE PO.REC ON PO,ID
   END
*
*
   RETURN
*
*   STANDARD SUBROUTINES
*
91000 PRINT @(0,23):ERRMSG:CL:
   INPUT XX:
   PRINT @(0,23):CL:
   RETURN
99999 RETURN
END
