  SUBROUTINE JRS.LB.COST.SUM
*COPY>JCS.CPYLIB>COM.JRS
*************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - JCSBP
* PROGRAM     - JRS.LB.COST.SUM
* BY          - W.R. MCKENZIE, COMPUTER BUSINESS ASSOCIATES
* DATE        - 05/27/88
* DESCRIPTION -
* This program produces a Job Hours/Costing Posted report.
*T26556 ajibaly 05/09/2002 * USE RPT NO AND GET.PROG.HEAD
*T27266 adelgado 03/09/2003 * Expand the amount fields to handle
*                             millions.
*T28964 wvaughan 08/07/2006 * Extend JOB.QTY field to display 8 numbers.
*************************************************************
*
*---- FILE EQUATES
*
*COPY>JCS.CPYLIB>JOB
*COPY>CPYLIB>CHAR
*COPY>CPYLIB>FILE.VARS
*COPY>JCS.CPYLIB>JOB.RPT.SET
*COPY>JCS.CPYLIB>JOB.RPT.SUM
*COPY>JCS.CPYLIB>OPERATION
*COPY>PMC.CPYLIB>COST.CNTR
*COPY>PMC.CPYLIB>DEPARTMENT
*
*---- DIMENSION RECORDS
*
  DIM DEPT.TTL.REC(20)
  DIM GRD.TOT(20)
*
*---- INITIALIZATION
*
  PG.NO=0
  LINE.CNT=75
  ERRMSG=''
*T26556 v
*     RPT.NO = "XXXX"
  RPT.NAME = ""
  RPT.DATE = DATE()
  HD1 = ''; HD2 = ''
  CALL GET.PROG.HEAD(CONO,C.CO.NAME,RPT.NAME,RPT.NO,RPT.DATE,HD1,HD2)
  PRINTER ON
*T26556 ^
  UNKNOWN=STR("?",30)
  MAT DEPT.TTL.REC=''
  MAT GRD.TOT=''
* T27266 v
* H3.LINE='DEPT  CCTR  OPER  DESCRIPTION':SPACE(27):'ENTRY     REG   O/T    TOTAL     REG   O/T   D/T   TOTAL     VAR($)    SPOIL'
* H1.LINE=SPACE(56):'LAST    ---- EST. COSTS ----   ------ ACTUAL COSTS -----'
  C.D.PRT=0
* H2.LINE='----  ----  ----  -------------------------------     --------  ------ -----  ------   ------ ----- ----- ------     ------   ------'
* DT.LINE=SPACE(64):'------ -----  ------   ------ ----- ----- ------     ------   ------'
  H3.LINE = 'DEPT CCTR OPER DESCRIPTION':SPACE(24)
  H3.LINE := 'ENTRY':SPACE(5):'REG':SPACE(5):'O/T':SPACE(4):'TOTAL'
  H3.LINE := SPACE(5):'REG':SPACE(5):'O/T':SPACE(4):'D/T'
  H3.LINE := SPACE(4):'TOTAL':SPACE(3):'VAR($)':SPACE(3):'SPOIL'
  H1.LINE = SPACE(50):'LAST':SPACE(3)
  H1.LINE := '------ EST. COSTS ------':SPACE(1)
  H1.LINE := '-------- ACTUAL COSTS ---------'
  H2.LINE = STR('-',4):SPACE(1):STR('-',4):SPACE(1):STR('-',4):SPACE(1)
  H2.LINE := STR('-',30):SPACE(3):STR('-',8):SPACE(1):STR('-',8)
  H2.LINE := SPACE(1):STR('-',6):SPACE(1):STR('-',8):SPACE(1)
  H2.LINE := STR('-',8):SPACE(1):STR('-',6):SPACE(1):STR('-',6)
  H2.LINE := SPACE(1):STR('-',8):SPACE(1):STR('-',9):' -------'
  DT.LINE = SPACE(57):STR('-',8)
  DT.LINE := SPACE(1):STR('-',6):SPACE(1):STR('-',8):SPACE(1)
  DT.LINE := STR('-',8):SPACE(1):STR('-',6):SPACE(1):STR('-',6)
  DT.LINE := SPACE(1):STR('-',8):SPACE(1):STR('-',9):' -------'
* T27266 ^
  D.PRT=0
  GRAND.C=0
*
*---- MAIN PROCESSING
*
  IF JRSD.CONS="Y" THEN
    CONSOL="CONSOLIDATED"
  END ELSE
    CONSOL="            "
  END
  JOB.CNT = DCOUNT(JRS.IDS,AM)
  PTR=0
  FOR I = 1 TO JOB.CNT WHILE PTR=0
    IF FIELD(JRS.IDS<I>,'&',5) # 'L' THEN GOTO 7
    DEPT.NO = FIELD(JRS.IDS<I>,"&",2)
    IF DP.SEL # 'ALL' THEN
      IF DP.SEL # DEPT.NO THEN GOTO 7
    END
    MATREAD JRS.REC FROM JOB.RPT.SET,CONO:JOBNO:"&":JRS.IDS<I> ELSE GOTO 7
    PTR=I
7 NEXT I
  IF PTR=0 THEN GOTO 99999
  CCTR.NO = FIELD(JRS.IDS<PTR>,"&",3)
  OPER.NO = FIELD(JRS.IDS<PTR>,"&",4)
  DEPT.NO = FIELD(JRS.IDS<PTR>,"&",2)
  OLD.DEPT = DEPT.NO
  MATREAD DEPT.REC FROM DEPARTMENT,CONO:OLD.DEPT ELSE DEPT.DESC=UNKNOWN
  MATREAD OPER.REC FROM OPERATION, CONO:OPER.NO ELSE OPER.DESC = UNKNOWN
  GOSUB 20
  P.LINE=DEPT.DESC:'  ':DEPT.NO
  PRINT P.LINE
  PRINT STR('-',LEN(P.LINE))
  LINE.CNT=LINE.CNT + 2
  GOSUB 1000
  PTR=PTR+1
  FOR I = PTR TO JOB.CNT
    MATREAD JRS.REC FROM JOB.RPT.SET,CONO:JOBNO:"&":JRS.IDS<I> ELSE GOTO 17
    IF FIELD(JRS.IDS<I>,'&',5) # 'L' THEN GOTO 17
    CCTR.NO = FIELD(JRS.IDS<I>,"&",3)
    OPER.NO = FIELD(JRS.IDS<I>,"&",4)
    DEPT.NO = FIELD(JRS.IDS<I>,"&",2)
    IF DP.SEL # 'ALL' THEN
      IF DP.SEL # DEPT.NO THEN
        GOTO 17
*           END ELSE
*              JOB.CNT = 0
      END
    END
    IF DEPT.NO # OLD.DEPT THEN
      GOSUB 2000
      MATREAD DEPT.REC FROM DEPARTMENT,CONO:DEPT.NO ELSE DEPT.DESC=UNKNOWN
      P.LINE=DEPT.DESC:'  ':DEPT.NO
      PRINT P.LINE
      PRINT STR('-',LEN(P.LINE))
      LINE.CNT=LINE.CNT + 2
      OLD.DEPT = DEPT.NO
    END
    MATREAD OPER.REC FROM OPERATION, CONO:OPER.NO ELSE OPER.DESC=UNKNOWN
    GOSUB 1000
17 *
  NEXT I
  GOSUB 2000
  G.DATE=GRD.TOT(1)
  G.LINE=''
  FOR J=2 TO 9
    IF GRD.TOT(J) <= 0 THEN GRD.TOT(J) = INT((GRD.TOT(J)/100) - .5) ELSE GRD.TOT(J) = INT((GRD.TOT(J)/100) + .5)
  NEXT J
  FOR J=11 TO 18
    IF GRD.TOT(J) <= 0 THEN GRD.TOT(J) = INT((GRD.TOT(J)/100) - .5) ELSE GRD.TOT(J) = INT((GRD.TOT(J)/100) + .5)
  NEXT J
  G.VAR=GRD.TOT(8) - GRD.TOT(4)
  G.C.VAR=GRD.TOT(17) - GRD.TOT(13)
  FOR J = 1 TO 18
    IF GRD.TOT(J) = 0 THEN GRD.TOT(J)=''
  NEXT J
  PRINT DT.LINE
* T27266 v
* G.LINE=G.LINE:'*** GRAND TOTALS ***':SPACE(34):OCONV(G.DATE,'D2/') "R#8":'  ':GRD.TOT(2) "R#6":' ':GRD.TOT(3) "R#5":'  ':GRD.TOT(4) "R#6":'   ':GRD.TOT(5) "R#6":' ':GRD.TOT(6) "R#5":' ':GRD.TOT(7) "R#5":' ':GRD.TOT(8) "R#6":'     ':G.VAR "R#6":'   ':GRD.TOT(9) "R#6"
  G.LINE := '*** GRAND TOTALS ***':SPACE(28):OCONV(G.DATE,'D2/') "R#8"
  G.LINE := ' ':GRD.TOT(2)"R#8":' ':GRD.TOT(3)"R#6":' ':GRD.TOT(4)"R#8"
  G.LINE := ' ':GRD.TOT(5)"R#8":' ':GRD.TOT(6)"R#6":' ':GRD.TOT(7)"R#6"
  G.LINE := ' ':GRD.TOT(8)"R#8":' ':G.VAR"R#9":' ':GRD.TOT(9)"R#7"
* T27266 ^
  PRINT G.LINE
  IF GRAND.C THEN
* T27266 v
*   G.LINE=SPACE(50):'CO  ':OCONV(GRD.TOT(10),'D2/') "R#8":'  ':GRD.TOT(11) "R#6":' ':GRD.TOT(12) "R#5":'  ':GRD.TOT(13) "R#6":'   ':GRD.TOT(14) "R#6":' ':GRD.TOT(15) "R#5":' ':GRD.TOT(16) "R#5":' ':GRD.TOT(17) "R#6":'     ':G.C.VAR "R#6":'   ':GRD.TOT(18) "R#6"
    G.LINE = SPACE(45):'CO ':OCONV(GRD.TOT(10),'D2/') "R#8":' '
    G.LINE := GRD.TOT(11)"R#8":' ':GRD.TOT(12)"R#6":' ':GRD.TOT(13)"R#8"
    G.LINE := ' ':GRD.TOT(14)"R#8":' ':GRD.TOT(15)"R#6":' ':GRD.TOT(16)"R#6"
    G.LINE := ' ':GRD.TOT(17)"R#8":' ':G.C.VAR"R#9":' ':GRD.TOT(18)"R#7"
* T27266 ^
    PRINT G.LINE
  END
  GOTO 99999
*
*---- PRINT THE HEADINGS
*
20 *
  PRINT CHAR(12)
  LINE.CNT=0
  PG.NO=PG.NO + 1
  H.LINE=''; HLINE1=''; HLINE2=''; HLINE3=''
  HLINE1="#":JOBNO "L#8":SPACE(1):CONSOL:"  REPORT NO: ":RPT.NO "L#4":SPACE(3)
  N=SPACE((50 - LEN(C.CO.NAME)) / 2)
  HLINE2=N:C.CO.NAME:N
  HLINE3=SPACE(8):OCONV(DATE(),"D2/")"R#8":SPACE(12):"PAGE: ":PG.NO
  H.LINE=HLINE1:HLINE2:HLINE3
*T26556 v
*     PRINT H.LINE
*     H.LINE=JOB.CUST "L#8":SPACE(31):'L A B O R   D O L L A R S   P O S T E D   R E P O R T'
*     PRINT H.LINE
  PRINT HD1:PG.NO
  PRINT HD2
  PRINT "Job Number: ":JOBNO "L#8":SPACE(1):CONSOL
  PRINT JOB.CUST "L#8"
*T26556 ^
  H.LINE=''
  H.LINE=H.LINE:C.CUST.NAME
  PRINT H.LINE
  H.LINE=''
  *T29864   H.LINE=H.LINE:JOB.QTY<1,1> "L#7":SPACE(45):'FOR ITEMS THROUGH: ':OCONV(JRSD.DATE,"D2-")
  H.LINE=H.LINE:JOB.QTY<1,1> "L#8":SPACE(45):'FOR ITEMS THROUGH: ':OCONV(JRSD.DATE,"D2-");*T28964
  PRINT H.LINE
  H.LINE=''
  H.LINE=H.LINE:JOB.DESC<1,1> "L#30":SPACE(22):'DATE LAST ENTRY  : ':OCONV(JRSD.LB.DATE,"D2-")
  PRINT H.LINE
  H.LINE=''
  H.LINE=H.LINE:'SR: ':C.SALS.NAME "L#27":'SALES CODE: ':JOB.SLSMN
  PRINT H.LINE
  H.LINE=''
  PRINT H1.LINE
  H.LINE=''
  PRINT H3.LINE
  PRINT H2.LINE
*T26556 v
*     LINE.CNT=LINE.CNT + 9
  LINE.CNT=LINE.CNT + 11
*T26556 ^
  RETURN
*
*-----PRINT LINE
*
1000 *
  E.HRS=JRS.R.QTY<1,1> + JRS.R.QTY<1,2>
  IF CS.FLG = "S" THEN
    JRS.R.COST=JRS.R.SALE
    JRS.C.COST=JRS.C.SALE
    JRS.E.R.COST=JRS.E.R.SALE
    JRS.E.C.COST=JRS.E.C.SALE
  END
  DEPT.TTL.REC(2)=DEPT.TTL.REC(2)+JRS.E.R.COST<1,1>
  DEPT.TTL.REC(3)=DEPT.TTL.REC(3)+JRS.E.R.COST<1,2>
  DEPT.TTL.REC(5)=DEPT.TTL.REC(5)+ JRS.R.COST<1,1>
  DEPT.TTL.REC(6)=DEPT.TTL.REC(6)+JRS.R.COST<1,2>
  DEPT.TTL.REC(7)=DEPT.TTL.REC(7)+JRS.R.COST<1,3>
  DEPT.TTL.REC(9)=DEPT.TTL.REC(9) + JRS.S.COST<1,1>
  DEPT.TTL.REC(11)=DEPT.TTL.REC(11) + JRS.E.C.COST<1,1>
  DEPT.TTL.REC(12)=DEPT.TTL.REC(12) + JRS.E.C.COST<1,2>
  DEPT.TTL.REC(18)=DEPT.TTL.REC(18) + JRS.E.S.COST
  DEPT.TTL.REC(14)=DEPT.TTL.REC(14) + JRS.C.COST<1,1>
  DEPT.TTL.REC(15)=DEPT.TTL.REC(15) + JRS.C.COST<1,2>
  DEPT.TTL.REC(16)=DEPT.TTL.REC(16) + JRS.C.COST<1,3>
  E.R.TTL = JRS.E.R.COST<1,1> + JRS.E.R.COST<1,2>
  DEPT.TTL.REC(4)=DEPT.TTL.REC(4)+E.R.TTL
  IF E.R.TTL <= 0  THEN E.R.TTL=INT((E.R.TTL / 100) - .5) ELSE E.R.TTL=INT((E.R.TTL / 100) + .5)
  IF JRS.E.R.COST<1,1> <= 0  THEN JRS.E.R.COST<1,1>=INT((JRS.E.R.COST<1,1> / 100) - .5) ELSE JRS.E.R.COST<1,1>=INT((JRS.E.R.COST<1,1> / 100) + .5)
  IF JRS.E.R.COST<1,1>=0 THEN JRS.E.R.COST<1,1>=''
  IF JRS.E.R.COST<1,2> <= 0 THEN JRS.E.R.COST<1,2>=INT((JRS.E.R.COST<1,2> / 100) - .5) ELSE JRS.E.R.COST<1,2>=INT((JRS.E.R.COST<1,2> / 100) + .5)
  IF JRS.E.R.COST<1,2>=0 THEN JRS.E.R.COST<1,2>=''
  IF E.R.TTL=0 THEN E.R.TTL=''
  R.TTL = JRS.R.COST<1,1>+JRS.R.COST<1,2>+JRS.R.COST<1,3>
  DEPT.TTL.REC(8)=DEPT.TTL.REC(8) + R.TTL
  IF R.TTL <= 0 THEN
    R.TTL=INT((R.TTL / 100) - .5)
  END ELSE
    R.TTL=INT((R.TTL / 100) + .5)
  END
  IF R.TTL=0 THEN R.TTL=''
  IF JRS.R.COST<1,1> <= 0 THEN
    JRS.R.COST<1,1>=INT((JRS.R.COST<1,1> / 100) - .5)
  END ELSE
    JRS.R.COST<1,1>=INT((JRS.R.COST<1,1> / 100) + .5)
  END
  IF JRS.R.COST<1,1>=0 THEN JRS.R.COST<1,1>=''
  IF JRS.R.COST<1,2> <= 0 THEN
    JRS.R.COST<1,2>=INT((JRS.R.COST<1,2> / 100) - .5)
  END ELSE
    JRS.R.COST<1,2>=INT((JRS.R.COST<1,2> / 100) + .5)
  END
  IF JRS.R.COST<1,2>=0 THEN JRS.R.COST<1,2>=''
  IF JRS.R.COST<1,3> <= 0 THEN JRS.R.COST<1,3>=INT((JRS.R.COST<1,3> / 100) - .5) ELSE JRS.R.COST<1,3>=INT((JRS.R.COST<1,3> / 100) + .5)
  IF JRS.R.COST<1,3>=0 THEN JRS.R.COST<1,3>=''
  JRS.S.COST<1,1>=INT((JRS.S.COST<1,1> / 100) + .5)
  IF JRS.S.COST<1,1>=0 THEN JRS.S.COST<1,1>=''
  E.C.TTL= JRS.E.C.COST<1,1>+JRS.E.C.COST<1,2>
  DEPT.TTL.REC(13)=DEPT.TTL.REC(13) + E.C.TTL
  IF E.C.TTL <= 0 THEN E.C.TTL=INT((E.C.TTL / 100) - .5) ELSE E.C.TTL=INT((E.C.TTL / 100) + .5)
  IF E.C.TTL=0 THEN E.C.TTL=''
  IF JRS.E.C.COST<1,1> <= 0 THEN JRS.E.C.COST<1,1>=INT((JRS.E.C.COST<1,1> / 100) - .5) ELSE JRS.E.C.COST<1,1>=INT((JRS.E.C.COST<1,1> / 100) + .5)
  IF JRS.E.C.COST<1,1>=0 THEN JRS.E.C.COST<1,1>=''
  IF JRS.E.C.COST<1,2> <= 0 THEN JRS.E.C.COST<1,2>=INT((JRS.E.C.COST<1,2> / 100) - .5) ELSE JRS.E.C.COST<1,2>=INT((JRS.E.C.COST<1,2> / 100) + .5)
  IF JRS.E.C.COST<1,2>=0 THEN JRS.E.C.COST<1,2>=''
  C.A.TTL=JRS.C.COST<1,1>+JRS.C.COST<1,2>+JRS.C.COST<1,3>
  DEPT.TTL.REC(17)=DEPT.TTL.REC(17) + C.A.TTL
  IF C.A.TTL <= 0 THEN C.A.TTL=INT((C.A.TTL / 100) - .5) ELSE C.A.TTL=INT((C.A.TTL / 100) + .5)
  IF C.A.TTL=0 THEN C.A.TTL=''
  IF JRS.C.COST<1,1> <= 0 THEN JRS.C.COST<1,1>=INT((JRS.C.COST<1,1> / 100) - .5) ELSE JRS.C.COST<1,1>=INT((JRS.C.COST<1,1> / 100) + .5)
  IF JRS.C.COST<1,1>=0 THEN JRS.C.COST<1,1>=''
  IF JRS.C.COST<1,2> <= 0 THEN JRS.C.COST<1,2>=INT((JRS.C.COST<1,2> / 100) - .5) ELSE JRS.C.COST<1,2>=INT((JRS.C.COST<1,2> / 100) + .5)
  IF JRS.C.COST<1,2>=0 THEN JRS.C.COST<1,2>=''
  IF JRS.C.COST<1,3> <= 0 THEN JRS.C.COST<1,3>=INT((JRS.C.COST<1,3> / 100) - .5) ELSE JRS.C.COST<1,3>=INT((JRS.C.COST<1,3> / 100) + .5)
  IF JRS.C.COST<1,3>=0 THEN JRS.C.COST<1,3>=''
  R.VAR=R.TTL - E.R.TTL
  IF R.VAR=0 THEN R.VAR=''
  C.VAR=C.A.TTL - E.C.TTL
  IF C.VAR=0 THEN C.VAR=''
  IF LINE.CNT >= 50 THEN GOSUB 20
* T27266 v
* P.LINE=SPACE(6):CCTR.NO "L#4":'  ':OPER.NO "L#4":'  ':OPER.DESC "L#31"
  P.LINE=SPACE(5):CCTR.NO "L#4":' ':OPER.NO "L#4":' ':OPER.DESC "L#30"
* T27266 ^
  IF JRS.R.COST # "" OR JRS.E.R.COST # '' THEN
    D.PRT=1
* T27266 v
*   PLINE1='     ':OCONV(JRS.DATE,'D2/')"R#8":'  ':JRS.E.R.COST<1,1> "R#6":' ':JRS.E.R.COST<1,1> "R#5":'  ':E.R.TTL "R#6":'   ':JRS.R.COST<1,1> "R#6":' ':JRS.R.COST<1,2> "R#5":' ':JRS.R.COST<1,3> "R#5":' ':R.TTL "R#6":'     ':OCONV(R.VAR,"MD0-")"R#7":'  ':JRS.S.COST<1,1> "R#6"
    PLINE1 = '   ':OCONV(JRS.DATE,'D2/')"R#8":' ':JRS.E.R.COST<1,1> "R#8"
    PLINE1 := ' ':JRS.E.R.COST<1,1> "R#6":' ':E.R.TTL "R#8":' '
    PLINE1 := JRS.R.COST<1,1> "R#8":' ':JRS.R.COST<1,2> "R#6":' '
    PLINE1 := JRS.R.COST<1,3> "R#6":' ':R.TTL "R#8":' '
    PLINE1 := OCONV(R.VAR,"MD0-")"R#9":' ':JRS.S.COST<1,1>"R#7"
* T27266 ^
    PRINT P.LINE:PLINE1
    LINE.CNT=LINE.CNT + 1
* T27266 v
*   P.LINE=SPACE(49)
    P.LINE=SPACE(45)
* T27266 ^
  END
  IF C.A.TTL # '' OR E.C.TTL # '' THEN
    C.D.PRT=1
    GRAND.C=1
* T27266 v
*   PLINE2=' CO  ':OCONV(JRS.C.DATE,'D2/') "R#8":'  ':JRS.E.C.COST<1,1> "R#6":' ':JRS.E.C.COST<1,2> "R#5":'  ':E.C.TTL "R#6":'   ':JRS.C.COST<1,1> "R#6":' ':JRS.C.COST<1,2> "R#5":' ':JRS.C.COST<1,3> "R#5":' ':C.A.TTL "R#6":'  CO ':OCONV(C.VAR,"MD0-")"R#7":'  ':JRS.S.COST<1,1> "R#6"
    PLINE2 = 'CO ':OCONV(JRS.C.DATE,'D2/') "R#8":' ':JRS.E.C.COST<1,1> "R#8"
    PLINE2 := ' ':JRS.E.C.COST<1,2> "R#6":' ':E.C.TTL "R#8":' '
    PLINE2 := JRS.C.COST<1,1>"R#8":' ':JRS.C.COST<1,2> "R#6":' '
    PLINE2 := JRS.C.COST<1,3>"R#6":' ':C.A.TTL "R#8":' '
    PLINE2 := OCONV(C.VAR,"MD0-")"R#9":' ':JRS.S.COST<1,1> "R#7"
* T27266 ^
    PRINT P.LINE:PLINE2
    LINE.CNT=LINE.CNT + 1
  END
  IF LINE.CNT >= 50 THEN GOSUB 20
  IF JRS.DATE > DEPT.TTL.REC(1) THEN DEPT.TTL.REC(1) = JRS.DATE
  IF JRS.C.DATE > DEPT.TTL.REC(10) THEN DEPT.TTL.REC(10)=JRS.C.DATE
  RETURN
*
*-----PRINT DEPARTMENT TOTALS
*
2000 *
  IF DEPT.TTL.REC(1) > GRD.TOT(1) THEN GRD.TOT(1)=DEPT.TTL.REC(1)
  IF DEPT.TTL.REC(10) > GRD.TOT(10) THEN GRD.TOT(10)=DEPT.TTL.REC(10)
  FOR J=2 TO 9
    GRD.TOT(J)=GRD.TOT(J) + DEPT.TTL.REC(J)
  NEXT J
  FOR J=11 TO 18
    GRD.TOT(J)=GRD.TOT(J) + DEPT.TTL.REC(J)
  NEXT J
  FOR J=2 TO 9
    IF DEPT.TTL.REC(J) <= 0 THEN DEPT.TTL.REC(J) = INT((DEPT.TTL.REC(J)/100) - .5) ELSE DEPT.TTL.REC(J) = INT((DEPT.TTL.REC(J)/100) + .5)
  NEXT J
  FOR J=11 TO 18
    IF DEPT.TTL.REC(J) <= 0 THEN DEPT.TTL.REC(J) = INT((DEPT.TTL.REC(J)/100) - .5) ELSE DEPT.TTL.REC(J) = INT((DEPT.TTL.REC(J)/100) + .5)
  NEXT J
  DEPT.VAR=DEPT.TTL.REC(8) - DEPT.TTL.REC(4)
  DEPT.C.VAR=DEPT.TTL.REC(17) - DEPT.TTL.REC(13)
  FOR J = 1 TO 18
    IF DEPT.TTL.REC(J) = 0 THEN DEPT.TTL.REC(J)=''
  NEXT J
  D.LINE=''
  IF D.PRT=0 AND C.D.PRT=0 THEN GOTO 2005
  PRINT DT.LINE
* T27266 v
* D.LINE='** ':DEPT.DESC:' DEPARTMENT TOTAL';D.LINE=D.LINE "L#40"
  D.LINE='** ':DEPT.DESC:' DEPARTMENT TOTAL';D.LINE=D.LINE "L#45"
* T27266 ^
  IF D.PRT THEN
*   DLINE1=SPACE(14):OCONV(DEPT.TTL.REC(1),'D2/') "R#8":'  ':DEPT.TTL.REC(2) "R#6":' ':DEPT.TTL.REC(3) "R#5":'  ':DEPT.TTL.REC(4) "R#6":'   ':DEPT.TTL.REC(5) "R#6":' ':DEPT.TTL.REC(6) "R#5":' ':DEPT.TTL.REC(7) "R#5":' ':DEPT.TTL.REC(8) "R#6":'     ':OCONV(DEPT.VAR,"MD0-")"R#7":'  ':DEPT.TTL.REC(9) "R#6"
    DLINE1 = SPACE(3)
    DLINE1 := OCONV(DEPT.TTL.REC(1),'D2/')"R#8":' ':DEPT.TTL.REC(2)"R#8"
    DLINE1 := ' ':DEPT.TTL.REC(3)"R#6":' ':DEPT.TTL.REC(4)"R#8":' '
    DLINE1 := DEPT.TTL.REC(5)"R#8":' ':DEPT.TTL.REC(6)"R#6":' '
    DLINE1 := DEPT.TTL.REC(7)"R#6":' ':DEPT.TTL.REC(8)"R#8":' '
    DLINE1 := OCONV(DEPT.VAR,"MD0-")"R#9":' ':DEPT.TTL.REC(9) "R#7"
* T27266 ^
    D.LINE=D.LINE:DLINE1
    PRINT D.LINE
    IF C.D.PRT =0 THEN
      PRINT;LINE.CNT=LINE.CNT + 2
    END ELSE
      D.LINE=''
* T27266 v
*     DLINE2=SPACE(50):'CO  ':OCONV(DEPT.TTL.REC(10),'D2/') "R#8":'  ':DEPT.TTL.REC(11) "R#6":' ':DEPT.TTL.REC(12) "R#5":'  ':DEPT.TTL.REC(13) "R#6":'   ':DEPT.TTL.REC(14) "R#6":' ':DEPT.TTL.REC(15) "R#5":' ':DEPT.TTL.REC(16) "R#5":' ':DEPT.TTL.REC(17) "R#6":'     ':OCONV(DEPT.C.VAR,"MD0-")"R#7":'  ':DEPT.TTL.REC(18) "R#6"
      DLINE2 = SPACE(45):'CO '
      DLINE2 := OCONV(DEPT.TTL.REC(10),'D2/')"R#8":' ':DEPT.TTL.REC(11)"R#8"
      DLINE2 := ' ':DEPT.TTL.REC(12)"R#6":' ':DEPT.TTL.REC(13)"R#8":' '
      DLINE2 := DEPT.TTL.REC(14)"R#8":' ':DEPT.TTL.REC(15)"R#6":' '
      DLINE2 := DEPT.TTL.REC(16)"R#6":' ':DEPT.TTL.REC(17)"R#8":' '
      DLINE2 := OCONV(DEPT.C.VAR,"MD0-")"R#9":' ':DEPT.TTL.REC(18) "R#7"
* T27266 ^
      D.LINE=DLINE2
      PRINT D.LINE;PRINT
      LINE.CNT=LINE.CNT + 3
    END
  END ELSE
    IF C.D.PRT THEN
* T27266 v
*     DLINE3=SPACE(9):' CO  ':OCONV(DEPT.TTL.REC(10),'D2/')"R#8":'  ':DEPT.TTL.REC(11) "R#6":' ':DEPT.TTL.REC(12) "R#5":'  ':DEPT.TTL.REC(13) "R#6":'   ':DEPT.TTL.REC(14) "R#6":' ':DEPT.TTL.REC(15) "R#5":' ':DEPT.TTL.REC(16) "R#5":' ':DEPT.TTL.REC(17) "R#6":'  CO ':OCONV(DEPT.C.VAR,"MD0-")"R#7":'  ':DEPT.TTL.REC(18) "R#6"
      DLINE3 = 'CO '
      DLINE3 := OCONV(DEPT.TTL.REC(10),'D2/')"R#8":' ':DEPT.TTL.REC(11)"R#8"
      DLINE3 := ' ':DEPT.TTL.REC(12)"R#6":' ':DEPT.TTL.REC(13)"R#8":' '
      DLINE3 := DEPT.TTL.REC(14)"R#8":' ':DEPT.TTL.REC(15)"R#6":' '
      DLINE3 := DEPT.TTL.REC(16)"R#6":' ':DEPT.TTL.REC(17)"R#8":' '
      DLINE3 := OCONV(DEPT.C.VAR,"MD0-")"R#9":' ':DEPT.TTL.REC(18) "R#7"
* T27266 ^
      D.LINE=D.LINE:DLINE3
      PRINT D.LINE;PRINT;LINE.CNT=LINE.CNT + 2
    END
  END
2005 *
  IF LINE.CNT >= 50 THEN GOSUB 20
  C.D.PRT=0
  D.PRT=0
  MAT DEPT.TTL.REC=''
  RETURN
99999 *
  PRINTER OFF
  RETURN
END
