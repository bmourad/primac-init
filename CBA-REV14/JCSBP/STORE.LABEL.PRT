*COPY>CPYLIB>COM1
*********************************************************************
* REVISION    - [08.1]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - DRSBP
* PROGRAM     - STORE.LABEL.PRT
* AUTHOR      - L. ROSS, C.B.A.
* DATE        - 09/24/91
* DESCRIPTION
* This program prints the store labels for a job.
*********************************************************************
*
***** INSERT FILES EQUATES
*
*COPY>JCS.CPYLIB>DRS.JOB.SPEC
*COPY>JCS.CPYLIB>JOB
*COPY>JCS.CPYLIB>CUST.TEMPLATE.LIST
*COPY>JCS.CPYLIB>SHIPTO.MASTER
*COPY>JCS.CPYLIB>TEMPLATE.DETAIL
*COPY>JCS.CPYLIB>FOLD.CODE
*COPY>JCS.CPYLIB>PACK.CODE
*COPY>JCS.CPYLIB>DISTRIBUTION.CODE
*COPY>PMC.CPYLIB>CUSTOMER
*COPY>PMC.CPYLIB>SHIP.VIA
*COPY>CPYLIB>SYSCOM
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*
DIM PLINES(3)
MAT PLINES= ''
DUMMY=''
*
**** SETUP ERRMSG ROUTINE
*
      SYS.TYPE = 1
      CALL SYSCOM(MAT SYSCOM.REC)
*
***** OPEN FILES
*
      OPEN '','JOB' TO JOB ELSE
         ERRMSG ='JOB FILE IS MISSING'
         GOTO 93000
      END
      OPEN '','DRS.JOB.SPEC' TO DRS.JOB.SPEC ELSE
         ERRMSG ='DRS.JOB.SPEC FILE IS MISSING'
         GOTO 93000
      END
      OPEN '','CUST.TEMPLATE.LIST' TO CUST.TEMPLATE.LIST ELSE
         ERRMSG = 'CUST.TEMPLATE.LIST FILE IS MISSING'
         GOTO 93000
      END
      OPEN '','SHIPTO.MASTER' TO SHIPTO.MASTER ELSE
         ERRMSG = 'SHIPTO.MASTER FILE IS MISSING'
         GOTO 93000
      END
      OPEN '','TEMPLATE.DETAIL' TO TEMPLATE.DETAIL ELSE
         ERRMSG = 'TEMPLATE.DETAIL FILE IS MISSING'
         GOTO 93000
      END
      OPEN '','CUSTOMER' TO CUSTOMER ELSE
         ERRMSG = 'CUSTOMER FILE IS MISSING'
         GOTO 93000
      END
      OPEN '','FOLD.CODE' TO FOLD.CODE ELSE
         ERRMSG = 'FOLD.CODE FILE IS MISSING'
         GOTO 93000
      END
      OPEN '','PACK.CODE' TO PACK.CODE ELSE
         ERRMSG = 'PACK.CODE FILE IS MISSING'
         GOTO 93000
      END
      OPEN '','DISTRIBUTION.CODE' TO DISTRIBUTION.CODE ELSE
         ERRMSG = 'DISTRIBUTION.CODE FILE IS MISSING'
         GOTO 93000
      END
      OPEN '','SHIP.VIA' TO SHIP.VIA ELSE
         ERRMSG = 'SHIP.VIA FILE IS MISSING'
         GOTO 93000
      END
*
**** READ PROC VALUES
*
      PROCREAD ID ELSE
         ERRMSG = 'CANNOT PERFORM PROCREAD'
         GOTO 93000
      END
      CONO = ID<1>
      CONO.NAME = ID<2>
      JOB.NO = ID<3>
      CUST.NO = ID<4>
      TEMP.NO = ID<3>
      COPIES = ID<5>
*
**** INITIALIZATION
*
      LN.CNT = 0
      HH.LINE1 = SPACE(5):CUST.NO 'L#6':SPACE(18)
*
      PROMPT''
      CRT @(-1)
*     LOOP
*        CRT @(0,10):CL:@(5,10):'Print (M)ask or (L)abels : ':
*        INPUT X:
*     WHILE X # 'M' AND X # 'L' DO REPEAT
*     IF X = 'M' THEN GOSUB 9000
      READNEXT DKEY ELSE
         ERRMSG = "NO ITEMS SELECTED - HIT RETURN: "
         GOSUB 91000
         GOTO 99999
      END
      GOSUB 9000
*     IF COPIES > 1 THEN
*        PERFORM "SP-ASSIGN =STANDARD ":COPIES
*     END
*     PRINTER ON
FOR C = 1 TO COPIES
*
***** READ AND PROCESS FIRST RECORD
*
100 *
*     READNEXT KEY ELSE GOTO 99999
      MATREAD DJS.REC FROM DRS.JOB.SPEC,DKEY ELSE GOTO 99999
      MATREAD CUST.REC FROM CUSTOMER, CONO:DJS.CUST ELSE
         CUST.NAME = '??????????'
      END
      MATREAD JOB.REC FROM JOB, CONO:JOB.NO ELSE
         JOB.DESC = '??????????'
      END
      MATREAD CTL.REC FROM CUST.TEMPLATE.LIST, CONO:CUST.NO:"!":TEMP.NO:"!001" ELSE
         ERRMSG = 'The CUST.TEMPLATE.LIST record for this job is missing'
         GOSUB 91000
         GOTO 99999
      END
      SHIPTO = CTL.SHIPS<1,1>
      IF SHIPTO = '' THEN
         ERRMSG = 'The first record of CUST.TEMPLATE.LIST has no shipto# - run resequencing'
         GOSUB 91000
         GOTO 99999
      END
      SHIP.CNT = DCOUNT(CTL.SHIPS,VM)
      MATREAD TDT.REC FROM TEMPLATE.DETAIL, CONO:SHIPTO:"!":TEMP.NO ELSE
         MAT TDT.REC = ''
      END
      RSEQ = '001'
      KEY = CONO:CUST.NO:"!":TEMP.NO:"!"
*
***** READ AND PROCESS ALL RECORDS
*
      DATA = 1
      CNT = 0
      LOOP
         IF SHIP.CNT < 1 THEN
            RSEQ =RSEQ + 1
            IF LEN(RSEQ) < 3 THEN RSEQ = STR('0',3-LEN(RSEQ)):RSEQ
            MATREAD CTL.REC FROM CUST.TEMPLATE.LIST, KEY:RSEQ THEN
               SHIP.CNT = DCOUNT(CTL.SHIPS,VM)
            END ELSE DATA = 0
            IF SHIP.CNT < 1 THEN DATA = 0
         END
         IF DATA = 0 AND CNT > 0 THEN GOSUB 2000
      WHILE DATA = 1 DO
         FOR I = 1 TO SHIP.CNT
             SHIPTO = CTL.SHIPS<1,I>
             MATREAD SHM.REC FROM SHIPTO.MASTER, CONO:SHIPTO ELSE
                MAT SHM.REC = ''
             END
             MATREAD TDT.REC FROM TEMPLATE.DETAIL, CONO:SHIPTO:"!":TEMP.NO ELSE
                MAT TDT.REC = ''
             END
             IF TDT.STORE.QTY > 0 THEN GOSUB 1000
          NEXT I
          SHIP.CNT = 0
       REPEAT
NEXT C
GOTO 99999
*
**** DETAIL ROUTINE
*
1000 *
*
       CNT = CNT + 1
       PLINES(CNT)<1,1> = SPACE(2):'FROM   ':CONO.NAME 'L#43':' ZONE':SPACE(9)
       PLINES(CNT)<1,2> = SPACE(53):SHM.SP.ZONE 'R#4':SPACE(9)
       PLINES(CNT)<1,3> = SPACE(53):OCONV(TDT.STORE.QTY, 'MD0') 'R#4':SPACE(9)
       FOR X = 4 TO 7
          PLINES(CNT)<1,X> = SPACE(66)
       NEXT X
       PLINES(CNT)<1,8> = SPACE(2):'TO':SPACE(5):SHM.SP.NAME 'L#57'
       PLINES(CNT)<1,9> = SPACE(66)
       PLINES(CNT)<1,10> = SPACE(9):SHM.SP.ADDR1 'L#57'
       PLINES(CNT)<1,11> = SPACE(66)
       IF SHM.SP.ADDR2 # '' THEN
          PLINES(CNT)<1,12> = SPACE(9):SHM.SP.ADDR2 'L#57'
       END ELSE
          DUMMY1 = SHM.SP.CITY
          DUMMY2 = SHM.SP.STATE
          DUMMY3 = SHM.SP.ZIP
          MXL = 57
          GOSUB 1500
          PLINES(CNT)<1,12> = SPACE(9):DUMMY 'L#57'
       END
       PLINES(CNT)<1,13> = SPACE(66)
       IF SHM.SP.ADDR2 # '' THEN
          DUMMY1 = SHM.SP.CITY
          DUMMY2 = SHM.SP.STATE
          DUMMY3 = SHM.SP.ZIP
          MXL = 57
          GOSUB 1500
          PLINES(CNT)<1,14> = SPACE(9):DUMMY 'L#57'
       END ELSE
          PLINES(CNT)<1,14>= SPACE(66)
       END
       FOR X = 15 TO 24
          PLINES(CNT)<1,X> = SPACE(66)
       NEXT X
       IF CNT = 2 THEN GOSUB 2000
       RETURN
1500 *
      DUMMY = ''
      DUMMY2 = DUMMY2[1,2]
      LC = MXL - LEN(DUMMY3) - LEN(DUMMY2) - 3
      DUMMY1 = DUMMY1[1,LC]
      DUMMY = (DUMMY1 : ' ':DUMMY2 : '  ' : DUMMY3)
      RETURN
*
*---- PRINT 2-UP LABELS
*
2000 *
      FOR P = 1 TO 24
          PRINT PLINES(1)<1,P>:PLINES(2)<1,P>
      NEXT P
      CNT = 0
      MAT PLINES = ''
      RETURN
*
*---- PRINTER LINE-UP
*
9000 *
*     X = 'N'
      PRINTER ON
*     LOOP
      FOR X = 1 TO 2
*        PRINTER ON
         PRINT '  XXXX   ':STR('X',43):' XXXX':SPACE(9):
         PRINT '  XXXX   ':STR('X',43):' XXXX '
         FOR I = 1 TO 6; PRINT; NEXT I
         PRINT '  XX     ':STR('X',43):SPACE(14):
         PRINT '  XX     ':STR('X',43)
         PRINT
         PRINT SPACE(9):STR('X',43):SPACE(14):
         PRINT SPACE(9):STR('X',43)
         PRINT
         PRINT SPACE(9):STR('X',43):SPACE(14):
         PRINT SPACE(9):STR('X',43)
         PRINT
         PRINT SPACE(9):STR('X',25):'  ':STR('9',10):SPACE(20):
         PRINT SPACE(9):STR('X',25):'  ':STR('9',10)
         FOR I = 1 TO 10; PRINT; NEXT I
*        PRINTER OFF
*        PRINTER CLOSE
*        LOOP
*           PRINT @(0,10):CL:@(5,10):'Are the labels aligned? (RET/N) ':
*           INPUT X:
*        WHILE X # '' AND X # 'N' DO REPEAT
*     WHILE X = 'N' DO
*        SLEEP 5
*     REPEAT
      NEXT X
      CRT @(0,12):CL:@(5,12):'Store Labels now printing'
*     SLEEP 20
      RETURN
*
***** CALL SYSCOM(MAT SYSCOM.REC)
*
91000 *
      ERR.TYPE = 1
      CALL SYSCOM(MAT SYSCOM.REC)
      RETURN
92000 *
      ERR.TYPE = 2
      CALL SYSCOM(MAT SYSCOM.REC)
      RETURN
93000 *
      ERR.TYPE = 3
      CALL SYSCOM(MAT SYSCOM.REC)
*
**** END OF JOB
*
99999 *
      PRINTER OFF
      END
