*COPY>CPYLIB>COM1
*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - JCSBP
* PROGRAM     - JOB.STATS.INQ.RPT
* BY          - RHONDA PERRIN, COMPUTER BUSINESS ASSOCIATES
* DATE        - 03/19/87
* DESCRIPTION -
*ENDDOC
*********************************************************************
*
*---- FILE EQUATES
*
*COPY>PMC.CPYLIB>COMPANY
*COPY>PMC.CPYLIB>VEND
*COPY>POS.CPYLIB>OUTSIDE.PO
*COPY>JCS.CPYLIB>JOB.STATS
*COPY>JCS.CPYLIB>CATEGORY.OSP
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*COPY>CPYLIB>SYSCOM
*
*---- SET-UP FOR SYSTEM ERROR MESSAGES
*
      SYS.TYPE = 1
      CALL SYSCOM(MAT SYSCOM.REC)
*
*---- OPEN FILES
*
      OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = "COMPANY FILE IS MISSING";GOTO 93000
      OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = "CONTROL FILE IS MISSING";GOTO 93000
      OPEN '','VEND' TO VEND ELSE ERRMSG = "VEND FILE IS MISSING";GOTO 93000
      OPEN '','JOB.STATS' TO JOB.STATS ELSE ERRMSG = "JOB.STATS FILE IS MISSING";GOTO 93000
      OPEN '','CATEGORY.OSP' TO CATEGORY.OSP ELSE ERRMSG = "CATEGORY.OSP FILE IS MISSING";GOTO 93000
      OPEN '','OUTSIDE.PO' TO OUTSIDE.PO ELSE ERRMSG = "OUTSIDE.PO FILE IS MISSING";GOTO 93000
*
*---- GET COMPANY NUMBER
*
      CONO = ""
      CALL GET.CONO(CONO,MAT COMP.REC)
      IF CONO = "END" THEN GOTO 99999
*
*---- INITIALIZATION
*
      DSH = STR('-',30)
      DSH20 = DSH[1,20]
      DSH12 = DSH[1,12]
      DSH10 = DSH[1,10]
      DSH8 = DSH[1,8]
      DSH7 = DSH[1,7]
      PNO = 0
      SP2 = SPACE(2)
      HD1 = "";HD2 = ""
      REPORT.NAME = "OUTSIDE.PURCHASE.INQUIRY.REPORT"
      REPORT.NUMBER = "XXXX"
      REPORT.DATE = DATE()
      CALL GET.PROG.HEAD(CONO,CO.NAME,REPORT.NAME,REPORT.NUMBER,REPORT.DATE,HD1,HD2)
      PRINTER ON
*
*---- MAIN PROCESSING
*
100 *
      READNEXT JS.ID ELSE GOTO 99999
      MATREAD JSTAT.REC FROM JOB.STATS,JS.ID ELSE GOTO 99999
      IF JSTAT.OPO.NO='' THEN GOTO 99999
      GOSUB 2000
      PO.CNT = COUNT(JSTAT.OPO.NO,VM) + (JSTAT.OPO.NO # '')
      FOR D = 1 TO PO.CNT
         MATREAD OPO.REC FROM OUTSIDE.PO,CONO:JSTAT.OPO.NO<1,D> ELSE GOTO 109
         MATREAD VEND.REC FROM VEND,CONO:OPO.VEND.NO ELSE MAT VEND.REC = ""
         MATREAD CAOS.REC FROM CATEGORY.OSP,CONO:OPO.PROD.LINE ELSE CAOS.DESC = "CATEGORY UNKNOWN"
         IF VEND.DESC = "" THEN
            V.NAME = "VENDOR UNKNOWN"
            V.NAME = V.NAME "L#30"
         END ELSE
            IF VEND.DESC<1,2> # "" THEN
               V.NAME = VEND.DESC<1,2> "L#30"
            END ELSE
               V.NAME = VEND.DESC "L#30"
            END
         END
         OPO.NUM = JSTAT.OPO.NO<1,D> "L#8"
         VEND.NO = OPO.VEND.NO "L#8"
         CATG = OPO.PROD.LINE "L#7"
         C.DESC = CAOS.DESC "L#20"
         DATE.EXP = OCONV(OPO.EXP.DATE,"D2/") "L#8"
         DATE.RECV = OCONV(OPO.DATE.RECVD,"D2/") "L#8"
         O.QTY = OPO.QTY - OPO.QTY.RECVD - OPO.CANCEL.QTY
PRINT 'GETTIN AMTS'
         IF O.QTY < 0 THEN O.QTY = 0
         IF O.QTY # 0 THEN
            O.AMT = OPO.EST.COST - OPO.AMT.RECVD - OPO.CANCEL.COST
            IF O.AMT < 0 THEN O.AMT = 0
         END ELSE
            O.AMT = 0
         END
         O.AMT = OCONV(O.AMT,"MD2,") "R#12"
         O.QTY = OCONV(O.QTY,"MD2") "R#10"
PRINT 'SHOULDA PUT AMTS IN A MASK'
         GOSUB 1000
109 *
      NEXT D
      GOTO 99999
*
*---- PRINT DETAIL LINE
*
1000 *
      IF LINE.CNT >= 55 THEN GOSUB 2000
      PRINT OPO.NUM:SP2:VEND.NO:SP2:V.NAME:SP2:CATG:SP2:C.DESC:SP2:
      PRINT DATE.EXP:SP2:DATE.RECV:SP2:O.QTY:SP2:O.AMT
      LINE.CNT = LINE.CNT + 1
      RETURN
*
*---- PRINT HEADING
*
2000 *
      PRINT CHAR(12)
      PNO = PNO + 1
      PRINT HD1:PNO
      PRINT HD2
      PRINT SPACE(57):"FOR JOB : ":JS.ID[4,99]
      PRINT
      PRINT " OUTSIDE   VENDOR":SPACE(50):"CATEGORY          DATE    LST DATE     OPEN         OPEN"
      PRINT "  PO #     NUMBER             VENDOR NAME            CATEG        DESCRIPTION      EXPECTED  RECEIVED   QUANTITY      AMOUNT"
      PRINT DSH8:SP2:DSH8:SP2:DSH:SP2:DSH7:SP2:DSH20:SP2:
      PRINT DSH8:SP2:DSH8:SP2:DSH10:SP2:DSH12
      PRINT
      LINE.CNT = 8
      RETURN
*
*---- CALLS FOR SYSCOM
*
91000 *
      ERR.TYP = 1
      CALL SYSCOM(MAT SYSCOM.REC)
      RETURN
93000 *
      ERR.TYP = 3
      CALL SYSCOM(MAT SYSCOM.REC)
99999 *
      PRINTER OFF
      END
