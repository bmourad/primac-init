      SUBROUTINE JRS.COST.SUM
*COPY>JCS.CPYLIB>COM.JRS
*************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - JCSBP
* PROGRAM     - JRS.COST.SUM
* BY          - W.R. MCKENZIE, COMPUTER BUSINESS ASSOCIATES
* DATE        - 06/10/88
* DESCRIPTION -
* This program produces a Labor Hours Posted Report
* MODIFIED    - CK 7.14.89 CSF 9250
*T26556 ajibaly 05/09/2002 * USE REPORT NO. AND GET.PROG.HEAD
*************************************************************
*
*---- FILE EQUATES
*
*COPY>JCS.CPYLIB>JOB
*COPY>CPYLIB>CHAR
*COPY>CPYLIB>FILE.VARS
*COPY>JCS.CPYLIB>JOB.RPT.SET
*COPY>PMC.CPYLIB>DEPARTMENT
*COPY>JCS.CPYLIB>JOB.RPT.SUM
*
*---- INITIALIZATION
*
      PG.NO=0
      ERRMSG=''
*T26556 v
*     RPT.NO="XXXX"
      HD1 = ""; HD2 = ""
      RPT.NAME = ""
      RPT.DATE = DATE()
      CALL GET.PROG.HEAD(CONO,C.CO.NAME,RPT.NAME,RPT.NO,RPT.DATE,HD1,HD2)
      PRINTER ON
*T26556 ^
      LINE.CNT = 75
      UNKNOWN=STR("?",30)
      STATUS=''
      DIM D.TOT(12)
      DIM G.TOT(12)
      DIM L.TOT(12)
      DIM M.TOT(12)
      DIM O.TOT(12)
      DIM P.TOT(12)
      DIM S.TOT(12)
      DIM P.REC(12)
      MAT D.TOT = ''
      MAT G.TOT = ''
      MAT L.TOT = ''
      MAT M.TOT = ''
      MAT O.TOT = ''
      MAT P.TOT = ''
      MAT S.TOT = ''
      MAT P.REC = ''
      DEPT.LAST.WORKED.DESC = ''
      M.DATA = ''
      H1.LINE=' DEPARTMENT          TYPE    REG    CO    TOTAL     REG    O/T   D/T     CO   O/T   D/T   TOTAL   DESCRIPTION     AMT  COST   SPOIL'
      H2.LINE='--------------------':' ':'-----':' ':'-------':' ':'-----':' ':'-------':'  ':'-------':' ':'-----':' ':'-----':'  ':'-----':' ':'-----':' ':'-----':' ':'-------':' ':'---------------------':' ':'-----':' ':'-------'
      H3.LINE=SPACE(27):'------ EST COST -----  ----------------- ACTUAL COST ---------------- -- ADDITIONAL COST -- MKT'
      JOB.CNT = DCOUNT(JRS.IDS,AM)
      T.LINE='      ':'-------':' ':'-----':' ':'-------':'  ':'-------':' ':'-----':' ':'-----':'  ':'-----':' ':'-----':' ':'-----':' ':'-------':' ':'                     ':' ':'-----':' ':'-------'
      IF JRSD.CONS ="Y" THEN
         CONSOL="CONSOLIDATED"
      END ELSE
         CONSOL="            "
      END
      IF JRSD.MISSING<1,1>='Y' THEN
         M.DATA='SHIP'
      END
      IF JRSD.MISSING<1,2>='Y' THEN
         IF M.DATA = '' THEN
            M.DATA='O/S PUR'
         END ELSE
            M.DATA=M.DATA:';OS/PUR'
         END
      END
      IF JRSD.MISSING<1,3>='Y' THEN
         IF M.DATA='' THEN
            M.DATA = 'NO PAPER'
         END ELSE
            M.DATA=M.DATA:';PAPER'
         END
      END
      JOB.CNT = DCOUNT(JRS.IDS,AM)
*
*
*CSF 25616 v
      IF JRSD.LB.DEPT # "" THEN
        MATREAD DEPT.REC FROM DEPARTMENT,CONO:JRSD.LB.DEPT ELSE DEPT.DESC=UNKNOWN
      END ELSE MAT DEPT.REC = ''
*CSF 25616 ^
      LAST.DEPARTMENT.DESC=DEPT.DESC
*
      MAT DEPT.REC=''
*-----MAIN PROCESSING
*
10 *
      BEG = 1
      LOOP
      UNTIL JOB.CNT LT BEG DO
         DEPT.NO = FIELD(JRS.IDS<BEG>,"&",2)
         FOR I = BEG TO JOB.CNT UNTIL FIELD(JRS.IDS<I,1>,"&",2) # DEPT.NO
            REC.NO = I
         NEXT I
         IF DP.SEL # 'ALL' THEN
            IF DP.SEL # DEPT.NO THEN
               BEG=REC.NO + 1
               GOTO 15
*           END ELSE
*              JOB.CNT = 0
            END
         END
         MATREAD DEPT.REC FROM DEPARTMENT,CONO:DEPT.NO ELSE DEPT.DESC=UNKNOWN
         PLINE1=DEPT.DESC"L#21"
         PLINE2 = STR("-",LEN(DEPT.DESC))'L#21'
         LAST = REC.NO
         GOSUB 1000
         GOSUB 2000
         GOSUB 3000
         GOSUB 4000
         GOSUB 5000
         BEG = REC.NO+1
         TYPE = '     '
         FOR K = 1 TO 12
            G.TOT(K) = G.TOT(K) + D.TOT(K)
            P.REC(K)=D.TOT(K)
            P.REC(K)=INT((P.REC(K)/100)+.5)
         NEXT K
         MAT D.TOT = ''
         P.LINE = PLINE1:T.LINE
         PLINE1=' ' 'L#21'
         LINE.CNT = LINE.CNT + 1
         PRINT P.LINE
         GOSUB 10000
         PRINT
15 *
      REPEAT
      PLINE1='** TOTALS **        ''L#21'
      PLINE2='                    ''L#21'
      IF L.TOT(3)+L.TOT(10)+L.TOT(12) # '' THEN
         FOR K = 1 TO 12
            L.TOT(K)=INT((L.TOT(K)/100)+.5)
         NEXT K
         TYPE='LABOR'
         MAT P.REC=MAT L.TOT
         GOSUB 10000
      END
      IF M.TOT(3)+M.TOT(10)+M.TOT(12) > 0 THEN
         FOR K = 1 TO 12
            M.TOT(K)=INT((M.TOT(K)/100)+.5)
         NEXT K
         TYPE="MAT'L"
         MAT P.REC=MAT M.TOT
         GOSUB 10000
      END
      IF O.TOT(3)+O.TOT(10)+O.TOT(12) > 0 THEN
         FOR K = 1 TO 12
            O.TOT(K)=INT((O.TOT(K)/100)+.5)
         NEXT K
         TYPE='MISC '
         MAT P.REC=MAT O.TOT
         GOSUB 10000
      END
      IF P.TOT(3)+P.TOT(10)+P.TOT(12) > 0 THEN
         FOR K = 1 TO 12
            P.TOT(K)=INT((P.TOT(K)/100)+.5)
         NEXT K
         TYPE ='O/P  '
         MAT P.REC=MAT P.TOT
         GOSUB 10000
      END
      IF S.TOT(3)+S.TOT(10)+S.TOT(12) > 0 THEN
         FOR K = 1 TO 12
            S.TOT(K)=INT((S.TOT(K)/100)+.5)
         NEXT K
         TYPE ='SHIP '
         MAT P.REC=MAT S.TOT
         GOSUB 10000
      END
      IF LINE.CNT + 8 > 50 THEN GOSUB 20
      FOR K = 1 TO 12
         G.TOT(K)=INT((G.TOT(K)/100)+.5)
      NEXT K
      MAT P.REC=MAT G.TOT
      TYPE='     '
      PRINT SPACE(21):T.LINE
      PLINE1='*** GRAND TOTALS ***''L#21'
      GOSUB 10000
      PRINT
      G.LINE=SPACE(74):'ADJUSTED O/T';PRINT G.LINE
      G.LINE=SPACE(74):'    SPOILAGE';PRINT G.LINE
      G.LINE=SPACE(74):'  PLANT CONV';PRINT G.LINE
      G.LINE=SPACE(74):'       OTHER';PRINT G.LINE
      G.LINE=SPACE(88):'-------':SPACE(24):'----- -------';PRINT G.LINE
      G.LINE=SPACE(65):'ADJUSTED FACTORY COST ';PRINT G.LINE
      GOTO 99999
*
*-----PRINT HEADING
*
20    PRINT CHAR(12)
      PG.NO=PG.NO + 1
      HLINE1="#":JOBNO "L#8":SPACE(1):CONSOL:"  REPORT NO: ":RPT.NO "L#4":SPACE(3)
      N=SPACE((50 - LEN(C.CO.NAME)) / 2)
      HLINE2=N:C.CO.NAME:N
      HLINE3=SPACE(19):OCONV(DATE(),"D2/")"R#8":SPACE(6):"PAGE: ":PG.NO
*T26556 v
*     HLINE=HLINE1:HLINE2:HLINE3;PRINT HLINE
*     HLINE=C.CUST.NAME"L#30":SPACE(17):'J O B   C O S T I N G   S U M M A R Y':SPACE(26):'#':JOBNO "L#8":" ":CONSOL ;PRINT HLINE
      PRINT HD1:PG.NO
      PRINT HD2
      PRINT "Job Number: ":JOBNO "L#8":SPACE(1):CONSOL
      PRINT C.CUST.NAME"L#30"
*T26556 ^
      HLINE="SALESREP: ":C.SALS.NAME"L#30":SPACE(63):C.CUST.NAME ;PRINT HLINE
      HLINE='SALES CD: ':JOB.SALES.CODE"L#6":SPACE(36)
      HLINE=HLINE:'LAST ACTIVITY DATE: ':OCONV(JRSD.DATE,"D2-")"R#8"
      HLINE=HLINE:SPACE(23):JOB.QTY<1,1>
      PRINT HLINE
      HLINE='STATUS  : ':J.STATUS"L#14":SPACE(28)
      HLINE=HLINE:'LAST LABOR ENTRY  : ':OCONV(JRSD.LB.DATE,"D2-")"R#8"
      HLINE=HLINE:SPACE(23):JOB.DESC<1,1>"L#28"
      PRINT HLINE
      HLINE="MISSING DATA: ":M.DATA"L#25":SPACE(13):'LAST LABOR DEPT   : ':LAST.DEPARTMENT.DESC
      PRINT HLINE
      PRINT
      PRINT H3.LINE
      PRINT H1.LINE
      PRINT H2.LINE
*T26556 v
*     LINE.CNT = 10
      LINE.CNT = 12
*T26556 ^
      RETURN
*
*-----LABOR
*
1000 *
      FOR J = BEG TO LAST
         MATREAD JRS.REC FROM JOB.RPT.SET,CONO:JOBNO:'&':JRS.IDS<J> ELSE GOTO 1099
         IF FIELD(JRS.IDS<J>,'&',5) # "L" THEN GOTO 1099
         TYPE = 'LABOR'
         GOSUB 6000
1099 *
      NEXT J
      IF P.REC(3) + P.REC(10) + P.REC(12) > 0 THEN
         FOR K = 1 TO 12
            D.TOT(K)=D.TOT(K)+P.REC(K)
            L.TOT(K)=L.TOT(K)+P.REC(K)
            P.REC(K)=INT((P.REC(K)/100)+.5)
         NEXT K
         GOSUB 10000
      END
      RETURN
*
*-----MATERIAL
*
2000 *
      FOR J = BEG TO LAST
         MATREAD JRS.REC FROM JOB.RPT.SET,CONO:JOBNO:'&':JRS.IDS<J> ELSE GOTO 2099
         IF FIELD(JRS.IDS<J>,'&',5) # "M" THEN GOTO 2099
         TYPE = "MAT'L"
         GOSUB 6000
2099 *
      NEXT J
      IF P.REC(3) + P.REC(10) + P.REC(12) > 0 THEN
         FOR K = 1 TO 12
            D.TOT(K)=D.TOT(K)+P.REC(K)
            M.TOT(K)=M.TOT(K)+P.REC(K)
            P.REC(K)=INT((P.REC(K)/100)+.5)
         NEXT K
         GOSUB 10000
      END
      RETURN
*
*-----MISC
*
3000 *
      FOR J = BEG TO LAST
         MATREAD JRS.REC FROM JOB.RPT.SET,CONO:JOBNO:'&':JRS.IDS<J> ELSE GOTO 3099
         IF FIELD(JRS.IDS<J>,'&',5) # "O" THEN GOTO 3099
         TYPE = 'MISC '
         GOSUB 6000
3099 *
      NEXT J
      IF P.REC(3) + P.REC(10) + P.REC(12) > 0 THEN
         FOR K = 1 TO 12
            D.TOT(K)=D.TOT(K)+P.REC(K)
            O.TOT(K)=O.TOT(K)+P.REC(K)
            P.REC(K)=INT((P.REC(K)/100)+.5)
         NEXT K
         GOSUB 10000
      END
      RETURN
*
*-----OUTSIDE PURCHASE
*
4000 *
      FOR J = BEG TO LAST
         MATREAD JRS.REC FROM JOB.RPT.SET,CONO:JOBNO:'&':JRS.IDS<J> ELSE GOTO 4099
         IF FIELD(JRS.IDS<J>,'&',5) # "P" THEN GOTO 4099
         TYPE = 'O/P  '
         GOSUB 6000
4099 *
      NEXT J
      IF P.REC(3) + P.REC(10) + P.REC(12) > 0 THEN
         FOR K = 1 TO 12
            D.TOT(K)=D.TOT(K)+P.REC(K)
            P.TOT(K)=P.TOT(K)+P.REC(K)
            P.REC(K)=INT((P.REC(K)/100)+.5)
         NEXT K
         GOSUB 10000
      END
      RETURN
*
*-----SHIPPING
*
5000 *
      FOR J = BEG TO LAST
         MATREAD JRS.REC FROM JOB.RPT.SET,CONO:JOBNO:'&':JRS.IDS<J> ELSE GOTO 5099
         IF FIELD(JRS.IDS<J>,'&',5) # "S" THEN GOTO 5099
         TYPE = 'SHIP '
         GOSUB 6000
5099 *
      NEXT J
      IF P.REC(3) + P.REC(10) + P.REC(12) > 0 THEN
         FOR K = 1 TO 12
            D.TOT(K)=D.TOT(K)+P.REC(K)
            S.TOT(K)=S.TOT(K)+P.REC(K)
            P.REC(K)=INT((P.REC(K)/100)+.5)
         NEXT K
         GOSUB 10000
      END
      RETURN
*
*----SETUP VALUES
*
6000 *
      P.REC(1)=P.REC(1) +JRS.E.R.COST<1,1> + JRS.E.R.COST<1,2>
      P.REC(2)=P.REC(2) +JRS.E.C.COST<1,1> + JRS.E.C.COST<1,2>
*      P.REC(3)=P.REC(3) +P.REC(2)+P.REC(1)
      P.REC(3)=P.REC(2)+P.REC(1)
      P.REC(4)=P.REC(4) +JRS.R.COST<1,1>
      P.REC(5)=P.REC(5) +JRS.R.COST<1,2>
      P.REC(6)=P.REC(6) +JRS.R.COST<1,3>
      P.REC(7)=P.REC(7) +JRS.C.COST<1,1>
      P.REC(8)=P.REC(8) +JRS.C.COST<1,2>
      P.REC(9)=P.REC(9) +JRS.C.COST<1,3>
      P.REC(10)=P.REC(10)+JRS.R.COST<1,1> + JRS.R.COST<1,2>+JRS.R.COST<1,3>
      P.REC(10)=P.REC(10)+JRS.C.COST<1,1> + JRS.C.COST<1,2>+JRS.C.COST<1,3>
      P.REC(11)=0
*     P.REC(12)=P.REC(12)+JRS.S.COST<1,1>
      P.REC(12)=P.REC(12)+SUM(JRS.S.COST)
      RETURN
*
*-----PRINT LINE
*
10000 *
      IF LINE.CNT > 50 THEN GOSUB 20
      PLINE=PLINE1:TYPE'L#5':' ':OCONV(P.REC(1),'MD0Z')'R#7':' ':OCONV(P.REC(2),'MD0Z')'R#5':' '
      PLINE=PLINE:OCONV(P.REC(3),'MD0Z')'R#7':'  ':OCONV(P.REC(4),'MD0Z')'R#7':' ':OCONV(P.REC(5),'MD0Z')'R#5':' '
      PLINE=PLINE:OCONV(P.REC(6),'MD0Z')'R#5':'  ':OCONV(P.REC(7),'MD0Z')'R#5':' '
      PLINE=PLINE:OCONV(P.REC(8),'MD0Z')'R#5':' ':OCONV(P.REC(9),'MD0Z')'R#5':' '
      PLINE=PLINE:OCONV(P.REC(10),'MD0Z')'R#7':' ':SPACE(28):OCONV(P.REC(12),'MD0Z')'R#7'
      PRINT PLINE
      MAT P.REC = ''
      LINE.CNT = LINE.CNT + 1
      PLINE1=PLINE2
      PLINE2='                    ''L#21'
      RETURN
99999 *
      PRINTER OFF
      RETURN
      END
