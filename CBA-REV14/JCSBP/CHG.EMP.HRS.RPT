*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC-JCS
* SOURCE      - JCSBP
* PROGRAM     - CHG.EMP.HRS.RPT
* DATE        - OCT,20,1983
* BY          - WALID
* DESCRIPTION - BREAK ON EMPLOYEE
* SSELECT     - EMPLOYEE, DATE, KEY & TYPE # 'N'
*T25901 cmykleb 03/14/2002 * Change heading to use GET.PROG.HEAD pgm.
*T26493 cmykleb 03/26/2002 * Change proc to use REPORT.SCRN.
*********************************************************************
*
***   INSERT EQUATE FROM CPYLIB
*
*
*COPY>JCS.CPYLIB>JOB.TIME
*COPY>CPYLIB>SYSCOM
*COPY>PMC.CPYLIB>EMPLOYEE
*COPY>CPYLIB>CHAR
*
***   INITIALIZATION
*
   LINE.COUNT        = 0
   PAGE.NO           = 0
   TOT.REGULAR     = 0
   TOT.CHARGE      = 0
   TOT.SPOLAGE     = 0
   TOT.CNCR        = 0
   TOT.HRS       = 0
   GTOT.REGULAR     = 0
   GTOT.CHARGE      = 0
   GTOT.SPOLAGE     = 0
   GTOT.CNCR        = 0
   GTOT.HRS       = 0
   PREV.EMP          = ''
   REG.HRS         = 0
   SPL.HRS         = 0
   CHG.HRS         = 0
   CNR.HRS         = 0
*
***   SET UP THE ERRMSG ROUTINE FORM SYSCOM
*
   SYS.TYPE = 1
   CALL SYSCOM(MAT SYSCOM.REC)
*
***   OPEN THE FILE
*
   OPEN '','JOB.TIME' TO JOB.TIME ELSE
      ERRMSG = 'JOB.TIME FILE IS MISSING'
      GOTO 93000
   END
   OPEN '','EMPLOYEE' TO EMPLOYEE ELSE
      ERRMSG = 'EMPLOYEE FILE IS MISSING'
      GOTO 93000
   END
*
***   READ COMPANY NAME
*
   PROCREAD ID ELSE
      ERRMSG = ' CANNOT PERFORM PROCREAD'
      GOTO 93000
   END
   CONO = ID<1>
   CONO.NAME = ID<2>
   S.DATE = ID<3>
   F.DATE = ID<4>
*T26493 v
   CONO.NAME = ""
   REPORT.NAME = ""
   REPORT.NUMBER = ID<2>
   HLINE1 = "" ; HLINE2 = ""
   CALL GET.PROG.HEAD(CONO,CONO.NAME,REPORT.NAME,REPORT.NUMBER,"",HLINE1,HLINE2)
*T26493 ^
*
***   PUT PRINTER ON
*
   PRINTER ON
*
***   READ AND PROCESS FIRST RECORD
*
100*
   READNEXT KEY ELSE GOTO 999999
*
***   READ THE JOB.TIME FILE
*
   MATREAD JLB.REC FROM JOB.TIME,KEY ELSE
      ERRMSG = ' NO RECORD IS READ FROM JOB.TIME'
      GOSUB 92000
      GOTO 100
   END
   JOBNO = FIELD(KEY,"!",1)[4,99]
   DPNO = FIELD(KEY,"!",2)
   CCNO = FIELD(KEY,"!",3)
*
***   PRINT HEADINGS
*
   GOSUB 1000
*
***   PROCESS THE FILE
*
   GOSUB 2000
*
***   SET THE EMPLOYEE
*
   PREV.EMP = JLB.EMP
*
***   GET EMPLOYEE NAME
*
   GOSUB 6000
*
***   PRINT THE RECORD
*
   GOSUB 3000
*
***    READ AND PROCESS ALL THE FILES
*
   DATA = 0
   LOOP
      READNEXT KEY ELSE DATA = 1
   WHILE DATA = 0 DO
      MATREAD JLB.REC FROM JOB.TIME,KEY ELSE
         ERRMSG = 'NO RECORD IS READ ...'
         GOSUB 92000
         GOTO 111
      END
      JOBNO = FIELD(KEY,"!",1)[4,99]
      DPNO = FIELD(KEY,"!",2)
      CCNO = FIELD(KEY,"!",3)
*
***   CHECK FOR NEW EMPLOYEE
*
      GOSUB 4000
*
***   PROCESS THE FILE
*
      GOSUB 2000
*
***   PRINT THE RECORD
*
      GOSUB 3000
111*
   REPEAT
*
***   PRINT TOTS FOR THE LAST EMPLOYEE
*
   GOSUB 5000
   GOSUB 7000
*
***    END OF JOB
*
   PRINTER OFF
   GOTO 999999
*
***   PRINT HEADINGS
*
1000*
   PRINT CHAR(12)
   PAGE.NO = PAGE.NO + 1
*T25901 v
*  H.LINE = ''
*  H.LINE = H.LINE : 'DATE : ' : OCONV(DATE(), 'D2/')
*  H.LINE = H.LINE : SPACE(47)
*  H.LINE = H.LINE : CONO.NAME "L#30"
*  H.LINE = H.LINE : SPACE(23)
*  H.LINE = H.LINE : 'PAGE ' : PAGE.NO
*  PRINT H.LINE
*  H.LINE = ''
*  H.LINE = H.LINE : SPACE(50)
*  H.LINE = H.LINE : 'CHARGED HOURS REPORT BY EMPLOYEE BY DATE'
*  PRINT H.LINE
   PRINT HLINE1:PAGE.NO"R#3"
   PRINT HLINE2
*T25901 ^
   H.LINE = ''
   H.LINE = H.LINE : SPACE(55)
   H.LINE = H.LINE : 'FOR THE PERIOD '
   H.LINE = H.LINE : OCONV(S.DATE, 'D2/') "R#8"
   H.LINE = H.LINE : ' THROUGH '
   H.LINE = H.LINE : OCONV(F.DATE,'D2/') "R#8"
   PRINT H.LINE
   PRINT
   H.LINE = ''
   H.LINE = H.LINE : SPACE(81)
   H.LINE = H.LINE : '<------------------'
   H.LINE = H.LINE : ' HOURS '
   H.LINE = H.LINE : '------------------>'
   PRINT H.LINE
   H.LINE = ''
   D.LINE = ''
   H.LINE = H.LINE : SPACE(9) : 'EMPLOYEE NAME' : SPACE(8)
   D.LINE = D.LINE : '------------------------------'
   H.LINE = H.LINE : SPACE(2)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : SPACE(2) : 'DATE' : SPACE(2)
   D.LINE = D.LINE : '--------'
   H.LINE = H.LINE : SPACE(2)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : '  JOB#  '
   D.LINE = D.LINE : '--------'
   H.LINE = H.LINE : SPACE(2)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : 'DV'
   D.LINE = D.LINE : '--'
   H.LINE = H.LINE : SPACE(2)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : 'DEPT '
   D.LINE = D.LINE : '-----'
   H.LINE = H.LINE : SPACE(2)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : 'CTR'
   D.LINE = D.LINE : '---'
   H.LINE = H.LINE : SPACE(2)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : 'OPER'
   D.LINE = D.LINE : '----'
   H.LINE = H.LINE : SPACE(2)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : 'FC'
   D.LINE = D.LINE : '--'
   H.LINE = H.LINE : SPACE(2)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : 'T'
   D.LINE = D.LINE : '-'
   H.LINE = H.LINE : SPACE(2)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : 'REGULAR'
   D.LINE = D.LINE : '--------'
   H.LINE = H.LINE : SPACE(3)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : 'SPOILG'
   D.LINE = D.LINE : '-------'
   H.LINE = H.LINE : SPACE(3)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : 'CS.ORD'
   D.LINE = D.LINE : '-------'
   H.LINE = H.LINE : SPACE(3)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : ' CONC '
   D.LINE = D.LINE : '-------'
   H.LINE = H.LINE : SPACE(3)
   D.LINE = D.LINE : SPACE(2)
   H.LINE = H.LINE : ' TOTAL '
   D.LINE = D.LINE : '--------'
   PRINT H.LINE
   PRINT D.LINE
   LINE.COUNT = 7
   RETURN
*
***   PROCESS THE RECORD
*
2000*
*
***   CASE FOR HRS TYPE
*
   BEGIN CASE
      CASE JLB.TYPE = 'R'
         REG.HRS = JLB.HRS
         SPL.HRS = 0
         CHG.HRS = 0
         TOT.REGULAR = TOT.REGULAR + JLB.HRS
         GTOT.REGULAR = GTOT.REGULAR + JLB.HRS
      CASE JLB.TYPE = 'C'
         CHG.HRS = JLB.HRS
         REG.HRS = 0
         SPL.HRS = 0
         TOT.CHARGE = TOT.CHARGE + JLB.HRS
         GTOT.CHARGE = GTOT.CHARGE + JLB.HRS
      CASE JLB.TYPE = 'S'
         SPL.HRS = JLB.HRS
         REG.HRS = 0
         CHG.HRS = 0
         TOT.SPOLAGE = TOT.SPOLAGE + JLB.HRS
         GTOT.SPOLAGE = GTOT.SPOLAGE + JLB.HRS
   END CASE
   TOT.HRS = TOT.HRS + JLB.HRS
   GTOT.HRS = GTOT.HRS + JLB.HRS
   CNR.HRS = JLB.CNCR
   TOT.CNCR = TOT.CNCR + JLB.CNCR
   GTOT.CNCR = GTOT.CNCR + JLB.CNCR
   RETURN
*
***   PRINT THE RECORD
*
3000*
   IF LINE.COUNT > 50 THEN
      LINE.COUNT = 0
      GOSUB 1000
   END
   LINE.COUNT = LINE.COUNT + 1
   H.LINE = ''
   H.LINE = H.LINE : EMPLOY "L#30"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(JLB.DATE, 'D2-') "R#8"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : JOBNO "R#8"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : JLB.DIV "R#2"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : DPNO "R#5"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : CCNO "R#3"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : JLB.OPER "R#4"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : JLB.FCTR "R#2"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : JLB.TYPE "L#1"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(REG.HRS, 'MD2') "R#8"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(SPL.HRS, 'MD2') "R#7"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(CHG.HRS, 'MD2') "R#7"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(CNR.HRS, 'MD2') "R#7"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(JLB.HRS, 'MD2') "R#8"
   PRINT H.LINE
   RETURN
*
***   CHECK FOR NEW EMPLOYEE
*
4000*
   IF JLB.EMP # PREV.EMP THEN
      GOSUB 5000
      PREV.EMP = JLB.EMP
      GOSUB 6000
      LINE.COUNT = 0
      GOSUB 1000
   END
   RETURN
*
***   PRINT THE TOTS
*
5000*
*
***   INITIALIZE THE PCT AND CALCULATE IT
*
   REG.PCT = 0
   SPL.PCT = 0
   CNR.PCT = 0
   CUS.PCT = 0
   IF TOT.HRS # 0 THEN CUS.PCT = INT((TOT.CHARGE/TOT.HRS)*100+.5) ELSE CUS.PCT = 0
   IF TOT.HRS # 0 THEN REG.PCT = INT((TOT.REGULAR/TOT.HRS)*100+.5) ELSE REG.PCT = 0
   IF TOT.HRS # 0 THEN SPL.PCT = INT((TOT.SPOLAGE/TOT.HRS)*100+.5) ELSE SPL.PCT = 0
   IF TOT.HRS # 0 THEN CNR.PCT = INT((TOT.CNCR/TOT.HRS)*100+.5) ELSE CNR.PCT = 0
*
*** CHECK FOR END OF PAGE
*
   IF LINE.COUNT + 4 > 50 THEN
      LINE.COUNT = 0
      GOSUB 1000
   END
   LINE.COUNT = LINE.COUNT + 4
   D.LINE = ''
   D.LINE = D.LINE : SPACE(81)
   D.LINE = D.LINE : '--------'
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '-------'
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '-------'
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '-------'
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '--------'
   PRINT D.LINE
   H.LINE = ''
   H.LINE = H.LINE : SPACE(69)
   H.LINE = H.LINE : 'TOTALS : '
   H.LINE = H.LINE : SPACE(3)
   H.LINE = H.LINE : OCONV(TOT.REGULAR, 'MD2') "R#8"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(TOT.SPOLAGE, 'MD2') "R#7"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(TOT.CHARGE, 'MD2') "R#7"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(TOT.CNCR, 'MD2') "R#7"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(TOT.HRS, 'MD2') "R#8"
   PRINT H.LINE
   PRINT D.LINE
   H.LINE = ''
   H.LINE = H.LINE : SPACE(68)
   H.LINE = H.LINE : 'PERCENT :'
   H.LINE = H.LINE : SPACE(3)
   H.LINE = H.LINE : OCONV(REG.PCT, 'MD0') "R#8"
   H.LINE = H.LINE : '%'
   H.LINE = H.LINE : SPACE(1)
   H.LINE = H.LINE : OCONV(SPL.PCT, 'MD0') "R#7"
   H.LINE = H.LINE : '%'
   H.LINE = H.LINE : SPACE(1)
   H.LINE = H.LINE : OCONV(CUS.PCT, 'MD0') "R#7"
   H.LINE = H.LINE : '%'
   H.LINE = H.LINE : SPACE(1)
   H.LINE = H.LINE : OCONV(CNR.PCT, 'MD0') "R#7"
   H.LINE = H.LINE : '%'
   PRINT H.LINE
   D.LINE = ''
   D.LINE = D.LINE : SPACE(81)
   D.LINE = D.LINE : '--------'
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '-------'
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '-------'
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '-------'
   PRINT D.LINE
*
***   CLEARING THE TOTAL VALUES
*
   TOT.CHARGE    = 0
   TOT.REGULAR   = 0
   TOT.SPOLAGE   = 0
   TOT.CNCR      = 0
   TOT.HRS       = 0
   RETURN
*
***   GET EMPLOYEE NAME
*
6000*
*
***   READ THE EMPLOYEE FILE
*
   EMP.KEY = CONO:JLB.EMP
   MATREAD EMP.REC FROM EMPLOYEE,EMP.KEY ELSE
      MAT EMP.REC = "" ; EMP.LAST.NAME = "** BAD EMPLOYEE **"
   END
   EMPLOY = EMP.LAST.NAME:' ':EMP.FRST.NAME
   RETURN
*
**** GRAND TOTAL
*
7000*
   REG.PCT = 0
   SPL.PCT = 0
   CNR.PCT = 0
   CUS.PCT = 0
   IF GTOT.HRS # 0 THEN CUS.PCT = INT((GTOT.CHARGE/GTOT.HRS)*100+.5) ELSE CUS.PCT = 0
   IF GTOT.HRS # 0 THEN REG.PCT = INT((GTOT.REGULAR/GTOT.HRS)*100+.5) ELSE REG.PCT = 0
   IF GTOT.HRS # 0 THEN SPL.PCT = INT((GTOT.SPOLAGE/GTOT.HRS)*100+.5) ELSE SPL.PCT = 0
   IF GTOT.HRS # 0 THEN CNR.PCT = INT((GTOT.CNCR/GTOT.HRS)*100+.5) ELSE CNR.PCT = 0
   IF LINE.COUNT + 4 > 50 THEN
      LINE.COUNT = 0
      GOSUB 1000
   END
   LINE.COUNT = LINE.COUNT + 4
   PRINT
   H.LINE = ''
   H.LINE = H.LINE : SPACE(63)
   H.LINE = H.LINE : 'GRAND TOTALS : '
   H.LINE = H.LINE : SPACE(3)
   H.LINE = H.LINE : OCONV(GTOT.REGULAR, 'MD2') "R#8"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(GTOT.SPOLAGE, 'MD2') "R#7"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(GTOT.CHARGE, 'MD2') "R#7"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(GTOT.CNCR, 'MD2') "R#7"
   H.LINE = H.LINE : SPACE(2)
   H.LINE = H.LINE : OCONV(GTOT.HRS, 'MD2') "R#8"
   PRINT H.LINE
   D.LINE = ''
   D.LINE = D.LINE : SPACE(81)
   D.LINE = D.LINE : '========'
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '======='
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '======='
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '======='
   D.LINE = D.LINE : SPACE(2)
   D.LINE = D.LINE : '========'
   PRINT D.LINE
   H.LINE = ''
   H.LINE = H.LINE : SPACE(62)
   H.LINE = H.LINE : 'GRAND PERCENT :'
   H.LINE = H.LINE : SPACE(3)
   H.LINE = H.LINE : OCONV(REG.PCT, 'MD0') "R#8"
   H.LINE = H.LINE : '%'
   H.LINE = H.LINE : SPACE(1)
   H.LINE = H.LINE : OCONV(SPL.PCT, 'MD0') "R#7"
   H.LINE = H.LINE : '%'
   H.LINE = H.LINE : SPACE(1)
   H.LINE = H.LINE : OCONV(CUS.PCT, 'MD0') "R#7"
   H.LINE = H.LINE : '%'
   H.LINE = H.LINE : SPACE(1)
   H.LINE = H.LINE : OCONV(CNR.PCT, 'MD0') "R#7"
   H.LINE = H.LINE : '%'
   PRINT H.LINE
   D.LINE = D.LINE[1,116]
   PRINT D.LINE
   RETURN
*
***   CALLS FOR SYSCOM
*
91000*
   ERR.TYPE = 1
   CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
92000*
   ERR.TYPE = 2
   CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
93000*
   ERR.TYPE = 3
   PRINTER OFF
   CALL SYSCOM(MAT SYSCOM.REC)
999999*
END
