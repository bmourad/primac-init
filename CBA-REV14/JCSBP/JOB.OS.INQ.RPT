   SUBROUTINE JOB.OS.INQ.RPT(CONO,CO.NAME,JOB.NUM,SUB.CNT,HD1,HD2)
*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - JCSBP
* PROGRAM     - JOB.OS.INQ.RPT
* DATE        - 11/21/83
* MODIFY BY   - BILAL MOGHRABI, C.B.A   DATE - 12/21/88
* DESCRIPTION -
*T26334 epitka 12/19/2001 * REV12
*T26493 cmykleb 04/03/2002 * Change pgm to use headings from calling pgm.
*ENDDOC
*********************************************************************
*COPY>CPYLIB>COM1
*COPY>JCS.CPYLIB>COM.JCS.LINK
*COPY>ICS.CPYLIB>COM.INV.MAIN  
*COPY>ICS.CPYLIB>COM.INV.SERIAL
*COPY>JCS.CPYLIB>COM.INV.STATS 
*COPY>PMC.CPYLIB>COM.CUST
*COPY>OPS.CPYLIB>COM.ORDER
*COPY>JCS.CPYLIB>COM.JOB.INQ
*COPY>JCS.CPYLIB>JOB
*COPY>JCS.CPYLIB>JOB.OSP
*COPY>JCS.CPYLIB>JOB.TOT.REC
*COPY>PMC.CPYLIB>COST.CNTR
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*
   DASHES = STR('-',80)
   PNO = 0
   LINE.COUNT = 99
   SP1 = SPACE(1)
*T26943 v
   HD3 = "JOB # : ":JOB.NUM"L#8":SPACE(44)
   HD3 = HD3 : "OUTSIDE PURCHASES POSTED REPORT"
*T26493 ^
**** PRINT DETAIL LINES AND TOTALS
100 DEPT.CNT = COUNT(OS.DEPT.NO,VM) + (OS.DEPT.NO # '')
   FOR D = 1 TO DEPT.CNT
      DEPT.TOTALS = ''
      PTR.CNT = COUNT(OS.DEPT.PTR<1,D>,SVM)+(OS.DEPT.PTR<1,D> # '')
      DPNO = OS.DEPT.NO<1,D>
      FOR PT = 1 TO PTR.CNT
         CCTR.TOTALS = ''
         PTR.NO = OS.DEPT.PTR<1,D,PT>
         CCNO = JOB.OS.CCTR<1,PTR.NO>; PLNO = JOB.OS.PLINE<1,PTR.NO>
         MATREAD CCTR.REC FROM COST.CNTR, CONO:CCNO ELSE
            CCTR.DESC = STR('?',20)
         END
         OS.ID = CONO:JOB.NUM:"!":DPNO:"!":CCNO:"!":PLNO:"!"
         LINES = JOB.OS.SEQ<1,PTR.NO,1>
         FOR SE = 1 TO LINES
            MATREAD JOS.REC FROM JOB.OSP, OS.ID:SE ELSE GOTO 111
            GOSUB 1000
111      NEXT SE
         FOR K = 2 TO SUB.CNT
            OS.ID = CONO:JOB.SUBS<1,K-1>:"!":DPNO:"!":CCNO:"!":PLNO:"!"
            OLN = LINES + 1; LINES = LINES + JOB.OS.SEQ<1,PTR.NO,K>
            FOR SE = OLN TO LINES
               MATREAD JOS.REC FROM JOB.OSP, OS.ID:(SE-OLN+1) ELSE GOTO 112
               GOSUB 1000
112         NEXT SE
         NEXT K
         GOSUB 2000
      NEXT PT
      GOSUB 3000
   NEXT D
   GOTO 99999
**** PRINT DETAIL LINE
1000 IF LINE.COUNT > 55 THEN
      LINE.COUNT = 0 ; GOSUB 9999
   END
   LINE = ''
   LINE = LINE : JOS.OPER "L#4" :SP1
   LINE = LINE : JOS.VEND "L#8": SP1 : JOS.PO "L#8" :SP1
   LINE = LINE : JOS.SEQ "L#8":SP1:JOS.INV "L#8":SP1
   LINE = LINE : OCONV(JOS.INV.DATE ,"D2/") "L#8": SP1
   LINE = LINE : JOS.MON<1,1>[3,4] "R#4" :SP1
   BEGIN CASE
      CASE JOS.TYPE = 'R'
         LINE = LINE :OCONV(JOS.QTY, "MD2") "R#10":SPACE(25)
      CASE JOS.TYPE = 'N'
         LINE = LINE : SPACE(8):OCONV(JOS.QTY, "MD2") "R#10":SPACE(17)
      CASE JOS.TYPE = 'C'
         LINE = LINE : SPACE(16):OCONV(JOS.QTY, "MD2") "R#10":SPACE(9)
      CASE JOS.TYPE = 'S'
         LINE = LINE : SPACE(24):OCONV(JOS.QTY, "MD2") "R#10":SP1
      CASE 1
         LINE = LINE :OCONV(JOS.QTY, "MD2") "R#10":SPACE(25)
   END CASE
   LINE = LINE :OCONV(JOS.QTY, "MD2") "R#10" :SP1
   LINE = LINE : OCONV(JOS.COST, "MD2") "R#9":SP1
   LINE = LINE : OCONV(JOS.SALE, "MD2") "R#9":SP1
   LINE = LINE : JOS.RC.JOB "L#8"
   PRINT LINE
   LINE.COUNT = LINE.COUNT + 1
   IF JOS.RC.TRAN # '' THEN
      LINE = SPACE(121):JOS.RC.TRAN "L#8"
      PRINT LINE
      LINE.COUNT = LINE.COUNT + 1
   END
   RETURN
**** PRINT TOTALS FOR CCTR
2000 IF LINE.COUNT + 2 > 55 THEN
      LINE.COUNT = 0 ; GOSUB 9999
   END
   GOSUB 9000
   LINE = ''
   LINE = LINE : "** CCTR - ":CCNO "L#3":" ":CCTR.DESC "L#36":" **"
   LINE = LINE : " CATEGORY - " : PLNO "L#11" : " **"
   LINE = LINE : SPACE(22):OCONV(JOB.OS.COST<1,PTR.NO>, "MD2") "R#9"
   LINE = LINE : SP1:OCONV(JOB.OS.SALE<1,PTR.NO>, "MD2") "R#9"
   PRINT LINE
   PRINT
   LINE.COUNT = LINE.COUNT + 2
   RETURN
**** PRINT TOTALS FOR DEPT
3000 IF LINE.COUNT + 2 > 55 THEN
      LINE.COUNT = 0 ; GOSUB 9999
   END
   GOSUB 9100
   LINE = ''
   LINE = LINE : "** DEPT - ":DPNO "L#5":" ":OS.DEPT.DESC<1,D> "L#34":" **"
   LINE = LINE :SPACE(48):OCONV(OS.DEPT.COST<1,D>, "MD2") "R#9"
   LINE = LINE :SP1:OCONV(OS.DEPT.SALE<1,D>, "MD2") "R#9"
   PRINT LINE
   PRINT
   LINE.COUNT = LINE.COUNT + 2
   RETURN
**** UNDER LINE FOR TOTALS
9000 IF LINE.COUNT > 55 THEN
      LINE.COUNT = 0 ; GOSUB 9999
   END
   LINE = ''
   LINE = SPACE(101):"--------- ---------"
   PRINT LINE
   LINE.COUNT = LINE.COUNT + 1
   RETURN
**** UNDER LINE FOR TOTALS
9100 IF LINE.COUNT > 55 THEN
      LINE.COUNT = 0 ; GOSUB 9999
   END
   LINE = ''
   LINE = SPACE(101):"========= ========="
   PRINT LINE
   LINE.COUNT = LINE.COUNT + 1
   RETURN
**** PRINT HEADING
9999 PRINT CHAR(12)
   PNO = PNO + 1
*T264943 v
*  LINE = SPACE(2) : 'DATE - ' : OCONV(DATE(),"D2/") "L#8"
*  LINE = LINE : SPACE(5) : 'TIME - ' : OCONV(TIME(),"MTS") "L#8"
*  LINE = LINE : SPACE(22) : CO.NAME "L#30"
*  LINE = LINE : SPACE(15) : 'PAGE - ' : PNO "R#3"
*  PRINT LINE
*  PRINT SPACE(53) :'O S P   P O S T E D   R E P O R T'
*  PRINT SPACE(53) : '      FOR JOB :':JOB.NUM "L#8"
*  PRINT SPACE(52) :DASHES[1,35]
   PRINT HD1:PNO"R#3"
   PRINT HD2
   PRINT HD3
*T26493 ^
   PRINT SPACE(121):'RCLS JOB'
   LINE = 'OPER  VENDOR   PO NUM  TRANS  # INVOICE  INV DATE PER   REGULAR   NO CHRG CST ORD SPOILAG TOT   QTY  TOT COST  TOT SALE  RC TRAN'
   PRINT LINE
   LINE = '---- -------- -------- -------- -------- -------- ---- ---------- ------- ------- ------- ---------- --------- --------- --------'
   PRINT LINE
   PRINT
   LINE.COUNT = LINE.COUNT + 7
   RETURN
**** PRINT TOTALS FOR DEPT
99999 IF LINE.COUNT + 2 > 55 THEN
      LINE.COUNT = 0 ; GOSUB 9999
   END
   GOSUB 9100
   LINE = ''
   LINE = LINE : "** TOTAL FOR ALL OSP DEPARTMENTS                   **"
   LINE = LINE : SPACE(47)
   LINE = LINE :SP1:OCONV(OS.TOT.COST, "MD2") "R#9"
   LINE = LINE :SP1:OCONV(OS.TOT.SALE, "MD2") "R#9"
   PRINT LINE
   RETURN
END
