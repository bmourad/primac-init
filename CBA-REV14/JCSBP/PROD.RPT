*COPY>CPYLIB>COM1
**************************************************************
*
* REVISION      - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
*
* PROGRAM       - PROD.RPT
*
* SYSTEM        - JCSBP
*
* BY            - RHONDA PERRIN, COMPUTER BUSINESS ASSOCIATES
*
* DATE          - 07/08/85
*
* DESCRIPTION   -
* This program produces a Production Labor Report by :
*    A). Cost Center
*    B). Department
*    C). Division
*
*T22007 stefanie 08/27/1997 * Add Division to the heading.
*T24770 jamesf 02/23/2000 * Changed the rounding routine to the hours
*                           total instead of each hour read in.
*T25901 cmykleb 03/14/2002 * Change heading to use GET.PROG.HEAD pgm.
*T26493 cmykleb 03/22/2002 * Change report to use rpt # from proc.
**************************************************************
*
*---- FILE EQUATES
*
*COPY>CPYLIB>SYSCOM
*COPY>CPYLIB>CHAR
*COPY>CPYLIB>FILE.VARS
*COPY>PMC.CPYLIB>COMPANY
*COPY>JCS.CPYLIB>PROD.STATS
*COPY>PMC.CPYLIB>COST.CNTR
*COPY>PMC.CPYLIB>DEPARTMENT
*COPY>PMC.CPYLIB>DIVISION
*
*---- SETUP FOR SYSTEM ERROR MESSAGES
*
   SYS.TYPE=1
   CALL SYSCOM(MAT SYSCOM.REC)
*
*---- PROCREAD
*
   PROCREAD XX ELSE ERRMSG="MUST BE RUN FROM PROC";GOSUB 91000;GOTO 99999
   PERIOD1=XX<3>
   MM=PERIOD1[5,2]
   YYYY=PERIOD1[1,4]
   PERIOD2=XX<4>
   PERIOD3=XX<8>
   PERIOD4=XX<9>
   DIV.FROM.PROC = XX<6>   ;* T22007 <
   IF PERIOD2=PERIOD1 THEN
      TITLE2=SPACE(67):"PERIOD ":MM:"/":YYYY
   END ELSE
      MM2=PERIOD2[5,2]
      YYYY2=PERIOD2[1,4]
      TITLE2=SPACE(61):"PERIOD ":MM:"/":YYYY:" THROUGH ":MM2:"/":YYYY2
   END
   SAVE.YEAR1=YYYY
   IF PERIOD3 # "" THEN SAVE.YEAR2=PERIOD3[1,4] ELSE SAVE.YEAR2=""
*
*---- DIMENSION RECORDS
*
   DIM CCTR(15)
   DIM DEPT(15)
   DIM DIV(15)
   DIM COMP(15)
   DIM S.DEPT(15)
   DIM S.DIV(15)
*
*---- OPEN FILES
*
   OPEN '','COMPANY' TO COMPANY ELSE ERRMSG='COMPANY FILE MISSING';GOTO 93000
   OPEN '','CONTROL' TO CONTROL ELSE ERRMSG='CONTROL FILE MISSING';GOTO 93000
   OPEN '','COST.CNTR' TO COST.CNTR ELSE ERRMSG='COST.CNTR FILE MISSING';GOTO 93000
   OPEN '','DEPARTMENT' TO DEPARTMENT ELSE ERRMSG='DEPARTMENT FILE MISSING';GOTO 93000
   OPEN '','DIVISION' TO DIVISION ELSE ERRMSG='DIVISION FILE MISSING';GOTO 93000
   OPEN '','PROD.STATS' TO PROD.STATS ELSE ERRMSG='PROD.STATS FILE MISSING';GOTO 93000
*
*---- INITIALIZATION
*
   PG.NUM=0
   LINE.CNT=0
   ERRMSG=""
   RPT.NUM="XXXX"
   UNKNOWN=STR("?",30)
   SP=" ";SP2="  ";SP4="    ";SP11=STR(" ",11)
   SP9=STR(" ",9);SP16=STR(" ",16);SP31=STR(" ",31)
   SP10=STR(" ",10);SP17=STR(" ",17);SP18=STR(" ",18)
   SP19=STR(" ",19);SP34=STR(" ",34);SP23=STR(" ",23);SP57=STR(" ",57)
   DASHES=STR("-",30)
   D5=DASHES[1,5];D7=DASHES[1,7];D8=DASHES[1,8]
   PCT.HRS1='';PCT.HRS2=''
   MAT CCTR=""
   MAT DEPT=""
   MAT DIV=""
   MAT COMP=""
   MAT S.DEPT=""
   MAT S.DIV=""
   PREV.DIV=""
   PREV.DEPT=""
   FIRST.FLAG=1
   CONT.FLAG=0
   RNAME="COST-CNTR"
   NODATA=1
   MAT PRDS.REC=""
   PTR=1
   DPTR=1
   PRINTER ON
*
*---- GET COMPANY NUMBER
*
   CONO=""
   CALL GET.CONO(CONO,MAT COMP.REC)
   IF CONO='END' THEN GOTO 99999
   MAT EDIT.COM.DRIVER=""
*T25901 v
*T26493 v
*  REPORT.NAME = "XX"
*  REPORT.NUMBER = "XXXX"
   REPORT.NAME = ""
   REPORT.NUMBER = XX<2>
   CONO.NAME = ""
*T26943 ^
   HLINE1 = "" ; HLINE2 = ""
   CALL GET.PROG.HEAD(CONO,CONO.NAME,REPORT.NAME,REPORT.NUMBER,"",HLINE1,HLINE2)
*T25901 ^
*
*---- MAIN PROCESSING
*
5*
   READNEXT PRDS.KEY ELSE
      IF NODATA THEN GOTO 99999
      GOTO 10
   END
   DIV.NUM=FIELD(PRDS.KEY,"*",2)
   DEPT.NUM=FIELD(PRDS.KEY,"*",3)
   CCTR.NUM=FIELD(PRDS.KEY,"*",4)
   PERIOD.NUM=FIELD(PRDS.KEY,"*",5)
   YEAR=PERIOD.NUM[1,4]
   IF DIV.NUM="" OR DEPT.NUM="" OR CCTR.NUM="" OR PERIOD.NUM="" OR YEAR="" THEN GOTO 5
   MATREAD PRDS.REC FROM PROD.STATS,PRDS.KEY ELSE GOTO 5
   FND.PRDS=0
   FOR GG=1 TO 14 UNTIL FND.PRDS
      IF PRDS.REC(GG) # "" THEN FND.PRDS=1
   NEXT GG
   IF FND.PRDS THEN GOTO 7
   IF PRDS.REC(22)="" AND PRDS.REC(26)="" AND PRDS.REC(32)="" AND PRDS.REC(36)="" AND FND.PRDS=0 THEN GOTO 5
7*
   NODATA=0
   IF PRDS.LAB.HRS + 0 > 0 THEN
      CHG.HRS=INT((PRDS.LAB.HRS / 100) + .5)
   END ELSE
      CHG.HRS=INT((PRDS.LAB.HRS / 100) - .5)
   END
   NCHG.HOURS=PRDS.LAB.NC.HRS
   IF NCHG.HOURS + 0 > 0 THEN
      NCHG.HRS=INT((NCHG.HOURS / 100) + .5)
   END ELSE
      NCHG.HRS=INT((NCHG.HOURS / 100) - .5)
   END
*T24770 v
   TOT.HRS = PRDS.LAB.HRS + PRDS.LAB.NC.HRS
*    TOT.HRS=CHG.HRS + NCHG.HRS 
*T24770 ^
   OT.HOURS=PRDS.LAB.OT.HRS + PRDS.LAB.DT.HRS
*T24770 v
   TOT.HRS = TOT.HRS + OT.HOURS
*T24770 ^
   IF OT.HOURS + 0 > 0 THEN
      OT.HRS=INT((OT.HOURS / 100) + .5)
   END ELSE
      OT.HRS=INT((OT.HOURS / 100) - .5)
   END
   IF PRDS.LAB.SP.HRS + 0 > 0 THEN
      SP.HRS=INT((PRDS.LAB.SP.HRS / 100) + .5)
   END ELSE
      SP.HRS=INT((PRDS.LAB.SP.HRS / 100) - .5)
   END
*T24770 v
   TOT.HRS = TOT.HRS + PRDS.LAB.SP.HRS
*    TOT.HRS = TOT.HRS + SP.HRS 
*T24770 ^
   IF PRDS.LAB.COST + 0 > 0 THEN
      CHG.COST=INT((PRDS.LAB.COST / 100) + .5)
   END ELSE
      CHG.COST=INT((PRDS.LAB.COST / 100) - .5)
   END
   IF PRDS.LAB.NC.COST + 0 > 0 THEN
      NCHG.COST=INT((PRDS.LAB.NC.COST / 100) + .5)
   END ELSE
      NCHG.COST=INT((PRDS.LAB.NC.COST / 100) - .5)
   END
   IF PRDS.MAT.COST + 0 > 0 THEN
      MATL.COST=INT((PRDS.MAT.COST / 100) + .5)
   END ELSE
      MATL.COST=INT((PRDS.MAT.COST / 100) - .5)
   END
   IF PRDS.OSP.COST + 0 > 0 THEN
      OSP.COST=INT((PRDS.OSP.COST / 100) + .5)
   END ELSE
      OSP.COST=INT((PRDS.OSP.COST / 100) - .5)
   END
   TOT.COST=CHG.COST + MATL.COST + OSP.COST
   IF PRDS.LAB.SP.COST + 0 > 0 THEN
      SP.COST=INT((PRDS.LAB.SP.COST / 100) + .5)
   END ELSE
      SP.COST=INT((PRDS.LAB.SP.COST / 100) - .5)
   END
   SP.OTH.COSTS=PRDS.MAT.SP.COST + PRDS.OSP.SP.COST
   IF SP.OTH.COSTS + 0 > 0 THEN
      SP.OTH.COST=INT((SP.OTH.COSTS / 100) + .5)
   END ELSE
      SP.OTH.COST=INT((SP.OTH.COSTS / 100) - .5)
   END
   SORT.KEY=CONO:"*":DIV.NUM:"*":DEPT.NUM:"*":CCTR.NUM
   GOSUB 30
   GOTO 5
10*
   CT.CNT=COUNT(CCTR(1),VM) + (CCTR(1) # "")
   FOR CC=1 TO CT.CNT
      DIV.NUM=FIELD(CCTR(1)<1,CC>,"*",2)
      DEPT.NUM=FIELD(CCTR(1)<1,CC>,"*",3)
      CCTR.NUM=FIELD(CCTR(1)<1,CC>,"*",4)
      IF FIRST.FLAG=1 AND PREV.DEPT="" THEN GOSUB 20;GOTO 11
      IF PREV.DIV # DIV.NUM THEN
         GOSUB 60
         GOSUB 20
         PREV.DIV=DIV.NUM
         PREV.DEPT=DEPT.NUM
      END
      IF PREV.DEPT # DEPT.NUM THEN
         GOSUB 60
         GOSUB 20
         PREV.DEPT=DEPT.NUM
      END
11*
      GOSUB 40
      IF FIRST.FLAG=1 THEN
         FIRST.FLAG=0
         PREV.DIV=DIV.NUM
         PREV.DEPT=DEPT.NUM
      END
   NEXT CC
12*
   GOSUB 60
   GOSUB 80
   PRINTER OFF
   GOTO 99999
*
*---- PRINT THE HEADINGS
*
20*
   PRINT CHAR(12)
   LINE.CNT=0
   PG.NUM=PG.NUM + 1
*T25901 v
*  H.LINE="";HLINE1="";HLINE2="";HLINE3=""
*  HLINE1="RUN DATE: ":OCONV(DATE(),"D2/") "R#8":SP23
*  K=SPACE((50 - LEN(CO.NAME)) / 2)
*  HLINE2=K:CO.NAME:K
*  HLINE3=SP19:"PAGE ":PG.NUM
*  H.LINE=HLINE1:HLINE2:HLINE3
*  PRINT H.LINE
*  H.LINE="DIVISION: ":DIV.FROM.PROC:SPACE(45):"PRODUCTION REPORT"
*  PRINT H.LINE
   HLINE3="DIVISION: ":DIV.FROM.PROC
   PRINT HLINE1:PG.NUM"R#3"
   PRINT HLINE2
   PRINT HLINE3
*T25901 ^
   H.LINE=TITLE2
   PRINT H.LINE
   BEGIN CASE
      CASE RNAME="COST-CNTR"
         COLUMN.TITLE=SP9:"COST CENTER":SP16
         IF CONT.FLAG=0 THEN
            MATREAD DIV.REC FROM DIVISION,CONO:DIV.NUM ELSE DIV.DESC=UNKNOWN
            MATREAD DEPT.REC FROM DEPARTMENT,CONO:DEPT.NUM ELSE DEPT.DESC=UNKNOWN
            H.LINE="DIVISION    ":DIV.NUM "L#2":"    ":DIV.DESC
            PRINT H.LINE
            H.LINE="DEPARTMENT  ":DEPT.NUM "L#5":" ":DEPT.DESC
            PRINT H.LINE
         END ELSE
            H.LINE="DIVISION    ":PREV.DIV "L#2":"    ":DIV.DESC
            PRINT H.LINE
            H.LINE="DEPARTMENT  ":PREV.DEPT "L#5":" ":DEPT.DESC
            PRINT H.LINE
         END
         LINE.CNT=LINE.CNT + 2
      CASE RNAME="DEPART"
         COLUMN.TITLE=SP9:"DEPARTMENT":SP17
         IF CONT.FLAG=0 THEN
            MATREAD DIV.REC FROM DIVISION,CONO:DIV.NUM ELSE DIV.DESC=UNKNOWN
            H.LINE="DIVISION    ":DIV.NUM "L#2":"    ":DIV.DESC
            PRINT H.LINE
         END ELSE
            H.LINE="DIVISION    ":PREV.DIV "L#2":"    ":DIV.DESC
            PRINT H.LINE
         END
         LINE.CNT=LINE.CNT + 1
      CASE RNAME="DIVISION.RPT"
         COLUMN.TITLE=SP10:"DIVISION":SP18
   END CASE
   PRINT
   H.LINE=SP34:"<------------- H O U R S ------------->  <-------------------- D O L L A R S -------------------->"
   PRINT H.LINE
   H.LINE=COLUMN.TITLE:"CHG    N/C   TOTAL  % CHG  O/T  SPOIL     CHG    MAT'L    O/P     TOTAL    N/C   LAB-SPL OTH-SPL"
   PRINT H.LINE
   H.LINE=DASHES:SP4:D7:SP:D5:SP:D7:SP:D5:SP:D5:SP:D5:SP2:D8:SP:D7:SP:D7:SP:D8:SP:D7:SP:D7:SP:D7
   PRINT H.LINE
   PRINT
   LINE.CNT=LINE.CNT + 8
   CONT.FLAG=0
   RETURN
*
*---- CREATE TABLE
*
30*
   NEW.SORT=0
   LOCATE SORT.KEY IN CCTR(1)<1>,1 SETTING D ELSE
      D=COUNT(CCTR(1),VM) + (CCTR(1) # "") + 1
      CCTR(1)<1,D>=SORT.KEY
      CCTR(2)<1,D,1>=SAVE.YEAR1
      IF SAVE.YEAR2 # "" THEN CCTR(2)<1,D,2>=SAVE.YEAR2
   END
   LOCATE YEAR IN CCTR(2)<1,D>,1 BY "DR" SETTING C ELSE
      IF C <= COUNT(CCTR(2)<1,D>,SVM) + (CCTR(2)<1,D> # "") THEN
         FOR A=2 TO 15
            CCTR(A)=INSERT(CCTR(A),1,D,C,"")
         NEXT A
      END
   END
   CCTR(3)<1,D,C>=CCTR(3)<1,D,C> + CHG.HRS
   CCTR(4)<1,D,C>=CCTR(4)<1,D,C> + NCHG.HRS
*T24770 v
*    CCTR(5)<1,D,C>=CCTR(5)<1,D,C> + TOT.HRS 
   CCTR(5)<1,D,C>=CCTR(5)<1,D,C> + INT((TOT.HRS / 100) + .5)
*T24770 ^
*    IF CCTR(5)<1,D,C> # 0 THEN CCTR(6)<1,D,C>=CCTR(3)<1,D,C> / CCTR(5)<1,D,C> ELSE CCTR(6)<1,D,C>=""
   CCTR(7)<1,D,C>=CCTR(7)<1,D,C> + OT.HRS
   CCTR(8)<1,D,C>=CCTR(8)<1,D,C> + SP.HRS
   CCTR(9)<1,D,C>=CCTR(9)<1,D,C> + CHG.COST
   CCTR(10)<1,D,C>=CCTR(10)<1,D,C> + MATL.COST
   CCTR(11)<1,D,C>=CCTR(11)<1,D,C> + OSP.COST
   CCTR(12)<1,D,C>=CCTR(12)<1,D,C> + TOT.COST
   CCTR(13)<1,D,C>=CCTR(13)<1,D,C> + NCHG.COST
   CCTR(14)<1,D,C>=CCTR(14)<1,D,C> + SP.COST
   CCTR(15)<1,D,C>=CCTR(15)<1,D,C> + SP.OTH.COST
   RETURN
*
*---- PRINT THE VALUES
*
40*
   IF CCTR(2)<1,CC,1>="" AND CCTR(2)<1,CC,2>="" THEN GOTO 45
   GOSUB 50
   MATREAD CCTR.REC FROM COST.CNTR,CONO:CCTR.NUM ELSE CCTR.DESC=UNKNOWN
   IF CCTR(2)<1,CC,1> # "" THEN
      P.LINE=CCTR.DESC"L#30":SP:CCTR(2)<1,CC,1>[3,2]"L#2":SP:CCTR(3)<1,CC,1>"R#7"
      P.LINE=P.LINE:SP:CCTR(4)<1,CC,1>"R#5":SP:CCTR(5)<1,CC,1>"R#7":SP:CCTR(6)<1,CC,1>"R#5"
      P.LINE=P.LINE:SP:CCTR(7)<1,CC,1>"R#5":SP:CCTR(8)<1,CC,1>"R#5":SP2:CCTR(9)<1,CC,1>"R#8"
      P.LINE=P.LINE:SP:CCTR(10)<1,CC,1>"R#7":SP:CCTR(11)<1,CC,1>"R#7":SP:CCTR(12)<1,CC,1>"R#8"
      P.LINE=P.LINE:SP:CCTR(13)<1,CC,1>"R#7":SP:CCTR(14)<1,CC,1>"R#7":SP:CCTR(15)<1,CC,1>"R#7"
      PRINT P.LINE
      LINE.CNT=LINE.CNT + 1
      IF CCTR(2)<1,CC,2> # "" THEN
         P.LINE=SP31:CCTR(2)<1,CC,2>[3,2]"L#2":SP:CCTR(3)<1,CC,2>"R#7"
         P.LINE=P.LINE:SP:CCTR(4)<1,CC,2>"R#5":SP:CCTR(5)<1,CC,2>"R#7":SP:CCTR(6)<1,CC,2>"R#5"
         P.LINE=P.LINE:SP:CCTR(7)<1,CC,2>"R#5":SP:CCTR(8)<1,CC,2>"R#5":SP2:CCTR(9)<1,CC,2>"R#8"
         P.LINE=P.LINE:SP:CCTR(10)<1,CC,2>"R#7":SP:CCTR(11)<1,CC,2>"R#7":SP:CCTR(12)<1,CC,2>"R#8"
         P.LINE=P.LINE:SP:CCTR(13)<1,CC,2>"R#7":SP:CCTR(14)<1,CC,2>"R#7":SP:CCTR(15)<1,CC,2>"R#7"
         PRINT P.LINE
         LINE.CNT=LINE.CNT + 1
      END
   END ELSE
      IF CCTR(2)<1,CC,2> # "" THEN
         P.LINE=CCTR.DESC"L#30":SP:CCTR(2)<1,CC,2>[3,2]"L#2":SP:CCTR(3)<1,CC,2>"R#7"
         P.LINE=P.LINE:SP:CCTR(4)<1,CC,2>"R#5":SP:CCTR(5)<1,CC,2>"R#7":SP:CCTR(6)<1,CC,2>"R#5"
         P.LINE=P.LINE:SP:CCTR(7)<1,CC,2>"R#5":SP:CCTR(8)<1,CC,2>"R#5":SP2:CCTR(9)<1,CC,2>"R#8"
         P.LINE=P.LINE:SP:CCTR(10)<1,CC,2>"R#7":SP:CCTR(11)<1,CC,2>"R#7":SP:CCTR(12)<1,CC,2>"R#8"
         P.LINE=P.LINE:SP:CCTR(13)<1,CC,2>"R#7":SP:CCTR(14)<1,CC,2>"R#7":SP:CCTR(15)<1,CC,2>"R#7"
         PRINT P.LINE
         LINE.CNT=LINE.CNT + 1
      END
   END
   PRINT;PRINT;LINE.CNT=LINE.CNT + 2
45*
   IF LINE.CNT >= 50 THEN
      CONT.FLAG=1;GOSUB 20
   END
   RETURN
*
*---- CALCULATE FIELD VALUES
*
50*
   IF CCTR(5)<1,CC,1> # 0 AND CCTR(5)<1,CC,1> # "" THEN
      IF CCTR(3)<1,CC,1>=CCTR(5)<1,CC,1> THEN
         CCTR(6)<1,CC,1>=OCONV("1000","MD1")
      END ELSE
         PCT.HRS1=(CCTR(3)<1,CC,1> / CCTR(5)<1,CC,1>) * 100
         IF PCT.HRS1 >= 0 THEN
            CCTR(6)<1,CC,1>=OCONV(INT((PCT.HRS1 * 10) + .5),"MD1")
         END ELSE
            CCTR(6)<1,CC,1>=OCONV(INT((PCT.HRS1 * 10) - .5),"MD1")
         END
      END
   END ELSE
      CCTR(6)<1,CC,1>=""
   END
   IF CCTR(5)<1,CC,2> # 0 AND CCTR(5)<1,CC,2> # "" THEN
      IF CCTR(3)<1,CC,2>=CCTR(5)<1,CC,2> THEN
         CCTR(6)<1,CC,2>=OCONV("1000","MD1")
      END ELSE
         PCT.HRS2=(CCTR(3)<1,CC,2> / CCTR(5)<1,CC,2>) * 100
         IF PCT.HRS2 >= 0 THEN
            CCTR(6)<1,CC,2>=OCONV(INT((PCT.HRS2 * 10) + .5),"MD1")
         END ELSE
            CCTR(6)<1,CC,2>=OCONV(INT((PCT.HRS2 * 10) - .5),"MD1")
         END
      END
   END ELSE
      CCTR(6)<1,CC,2>=""
   END
   FOR Z=3 TO 15
      IF CCTR(Z)<1,CC,1>=0 THEN CCTR(Z)<1,CC,1>=""
      IF CCTR(Z)<1,CC,2>=0 THEN CCTR(Z)<1,CC,2>=""
   NEXT Z
   DEPT(1)=CONO:"*":DIV.NUM:"*":DEPT.NUM
   DEPT(2)<1,1>=CCTR(2)<1,CC,1>[3,2]
   DEPT(2)<1,2>=CCTR(2)<1,CC,2>[3,2]
   FOR JJ=3 TO 15
      IF JJ=6 THEN GOTO 56
      DEPT(JJ)<1,1>=DEPT(JJ)<1,1> + CCTR(JJ)<1,CC,1>
      DEPT(JJ)<1,2>=DEPT(JJ)<1,2> + CCTR(JJ)<1,CC,2>
56 NEXT JJ
   IF DEPT(5)<1,1> # 0 AND DEPT(5)<1,1> # "" THEN
      IF DEPT(3)<1,1>=DEPT(5)<1,1> THEN
         DEPT(6)<1,1>=OCONV("1000","MD1")
      END ELSE
         PCT.HRS1=(DEPT(3)<1,1> / DEPT(5)<1,1>) * 100
         IF PCT.HRS1 >= 0 THEN
            DEPT(6)<1,1>=OCONV(INT((PCT.HRS1 * 10) + .5),"MD1")
         END ELSE
            DEPT(6)<1,1>=OCONV(INT((PCT.HRS1 * 10) - .5),"MD1")
         END
      END
   END ELSE
      DEPT(6)<1,1>=""
   END
   IF DEPT(5)<1,2> # 0 AND DEPT(5)<1,2> # "" THEN
      IF DEPT(3)<1,2>=DEPT(5)<1,2> THEN
         DEPT(6)<1,2>=OCONV("1000","MD1")
      END ELSE
         PCT.HRS2=(DEPT(3)<1,2> / DEPT(5)<1,2>) * 100
         IF PCT.HRS2 >= 0 THEN
            DEPT(6)<1,2>=OCONV(INT((PCT.HRS2 * 10) + .5),"MD1")
         END ELSE
            DEPT(6)<1,2>=OCONV(INT((PCT.HRS2 * 10) - .5),"MD1")
         END
      END
   END ELSE
      DEPT(6)<1,2>=""
   END
   FOR Z=3 TO 15
      IF DEPT(Z)<1,1>=0 THEN DEPT(Z)<1,1>=""
      IF DEPT(Z)<1,2>=0 THEN DEPT(Z)<1,2>=""
   NEXT Z
   RETURN
*
*---- PRINT DEPT TOTALS
*
60*
   GOSUB 70
   H.LINE=SP34:D7:SP:D5:SP:D7:SP:D5:SP:D5:SP:D5:SP2:D8:SP:D7:SP:D7:SP:D8:SP:D7:SP:D7:SP:D7
   PRINT H.LINE
   P.LINE="  * DEPARTMENT TOTAL":SP11:DEPT(2)<1,1>"L#2":SP:DEPT(3)<1,1>"R#7"
   P.LINE=P.LINE:SP:DEPT(4)<1,1>"R#5":SP:DEPT(5)<1,1>"R#7":SP:DEPT(6)<1,1>"R#5"
   P.LINE=P.LINE:SP:DEPT(7)<1,1>"R#5":SP:DEPT(8)<1,1>"R#5":SP2:DEPT(9)<1,1>"R#8"
   P.LINE=P.LINE:SP:DEPT(10)<1,1>"R#7":SP:DEPT(11)<1,1>"R#7":SP:DEPT(12)<1,1>"R#8"
   P.LINE=P.LINE:SP:DEPT(13)<1,1>"R#7":SP:DEPT(14)<1,1>"R#7":SP:DEPT(15)<1,1>"R#7"
   PRINT P.LINE
   LINE.CNT=LINE.CNT + 2
   IF DEPT(2)<1,2> # "" THEN
      P.LINE=SP31:DEPT(2)<1,2>"L#2":SP:DEPT(3)<1,2>"R#7"
      P.LINE=P.LINE:SP:DEPT(4)<1,2>"R#5":SP:DEPT(5)<1,2>"R#7":SP:DEPT(6)<1,2>"R#5"
      P.LINE=P.LINE:SP:DEPT(7)<1,2>"R#5":SP:DEPT(8)<1,2>"R#5":SP2:DEPT(9)<1,2>"R#8"
      P.LINE=P.LINE:SP:DEPT(10)<1,2>"R#7":SP:DEPT(11)<1,2>"R#7":SP:DEPT(12)<1,2>"R#8"
      P.LINE=P.LINE:SP:DEPT(13)<1,2>"R#7":SP:DEPT(14)<1,2>"R#7":SP:DEPT(15)<1,2>"R#7"
      PRINT P.LINE
      LINE.CNT=LINE.CNT + 1
   END
   MAT DEPT=""
   RETURN
*
*---- INCREMENT S.DEPT
*
70*
   S.DEPT(1)<1,PTR>=DEPT(1)
   FOR G=2 TO 15
      S.DEPT(G)<1,PTR,1>=DEPT(G)<1,1>
      S.DEPT(G)<1,PTR,2>=DEPT(G)<1,2>
   NEXT G
   PTR=PTR + 1
   RETURN
*
*---- SETUP DEPT REPORT
*
80*
   PREV.DIV=""
   RNAME="DEPART"
   DP.CNT=COUNT(S.DEPT(1),VM) + (S.DEPT(1) # "")
   FOR DD=1 TO DP.CNT
      DIV.NUM=FIELD(S.DEPT(1)<1,DD>,"*",2)
      DEPT.NUM=FIELD(S.DEPT(1)<1,DD>,"*",3)
      IF PREV.DIV="" THEN GOSUB 20;GOTO 81
      IF PREV.DIV # DIV.NUM THEN
         GOSUB 110
         GOSUB 20
         PREV.DIV=DIV.NUM
      END
81*
      GOSUB 90
      PREV.DIV=DIV.NUM
   NEXT DD
   GOSUB 110
   GOSUB 130
   RETURN
*
*---- PRINT DEPT. RPT PAGE(S)
*
90*
   IF S.DEPT(2)<1,DD,1>="" AND S.DEPT(2)<1,DD,2>="" THEN GOTO 95
   GOSUB 100
   MATREAD DEPT.REC FROM DEPARTMENT,CONO:DEPT.NUM ELSE DEPT.DESC=UNKNOWN
   IF S.DEPT(2)<1,DD,1> # "" THEN
      P.LINE=DEPT.DESC"L#30":SP:S.DEPT(2)<1,DD,1>"L#2":SP:S.DEPT(3)<1,DD,1>"R#7"
      P.LINE=P.LINE:SP:S.DEPT(4)<1,DD,1>"R#5":SP:S.DEPT(5)<1,DD,1>"R#7":SP:S.DEPT(6)<1,DD,1>"R#5"
      P.LINE=P.LINE:SP:S.DEPT(7)<1,DD,1>"R#5":SP:S.DEPT(8)<1,DD,1>"R#5":SP2:S.DEPT(9)<1,DD,1>"R#8"
      P.LINE=P.LINE:SP:S.DEPT(10)<1,DD,1>"R#7":SP:S.DEPT(11)<1,DD,1>"R#7":SP:S.DEPT(12)<1,DD,1>"R#8"
      P.LINE=P.LINE:SP:S.DEPT(13)<1,DD,1>"R#7":SP:S.DEPT(14)<1,DD,1>"R#7":SP:S.DEPT(15)<1,DD,1>"R#7"
      PRINT P.LINE
      LINE.CNT=LINE.CNT + 1
      IF S.DEPT(2)<1,DD,2> # "" THEN
         P.LINE=SP31:S.DEPT(2)<1,DD,2>"L#2":SP:S.DEPT(3)<1,DD,2>"R#7"
         P.LINE=P.LINE:SP:S.DEPT(4)<1,DD,2>"R#5":SP:S.DEPT(5)<1,DD,2>"R#7":SP:S.DEPT(6)<1,DD,2>"R#5"
         P.LINE=P.LINE:SP:S.DEPT(7)<1,DD,2>"R#5":SP:S.DEPT(8)<1,DD,2>"R#5":SP2:S.DEPT(9)<1,DD,2>"R#8"
         P.LINE=P.LINE:SP:S.DEPT(10)<1,DD,2>"R#7":SP:S.DEPT(11)<1,DD,2>"R#7":SP:S.DEPT(12)<1,DD,2>"R#8"
         P.LINE=P.LINE:SP:S.DEPT(13)<1,DD,2>"R#7":SP:S.DEPT(14)<1,DD,2>"R#7":SP:S.DEPT(15)<1,DD,2>"R#7"
         PRINT P.LINE
         LINE.CNT=LINE.CNT + 1
      END
   END ELSE
      IF S.DEPT(2)<1,DD,2> # "" THEN
         P.LINE=DEPT.DESC"L#30":SP:S.DEPT(2)<1,DD,2>"L#2":SP:S.DEPT(3)<1,DD,2>"R#7"
         P.LINE=P.LINE:SP:S.DEPT(4)<1,DD,2>"R#5":SP:S.DEPT(5)<1,DD,2>"R#7":SP:S.DEPT(6)<1,DD,2>"R#5"
         P.LINE=P.LINE:SP:S.DEPT(7)<1,DD,2>"R#5":SP:S.DEPT(8)<1,DD,2>"R#5":SP2:S.DEPT(9)<1,DD,2>"R#8"
         P.LINE=P.LINE:SP:S.DEPT(10)<1,DD,2>"R#7":SP:S.DEPT(11)<1,DD,2>"R#7":SP:S.DEPT(12)<1,DD,2>"R#8"
         P.LINE=P.LINE:SP:S.DEPT(13)<1,DD,2>"R#7":SP:S.DEPT(14)<1,DD,2>"R#7":SP:S.DEPT(15)<1,DD,2>"R#7"
         PRINT P.LINE
         LINE.CNT=LINE.CNT + 1
      END
   END
   PRINT;PRINT;LINE.CNT=LINE.CNT + 2
95*
   IF LINE.CNT >= 50 THEN
      CONT.FLAG=1;GOSUB 20
   END
   RETURN
*
*---- INCREMENT DIV TOTALS
*
100*
   DIV(1)=CONO:"*":DIV.NUM
   DIV(2)<1,1>=S.DEPT(2)<1,DD,1>
   DIV(2)<1,2>=S.DEPT(2)<1,DD,2>
   FOR JJ=3 TO 15
      IF JJ=6 THEN GOTO 105
      DIV(JJ)<1,1>=DIV(JJ)<1,1> + S.DEPT(JJ)<1,DD,1>
      DIV(JJ)<1,2>=DIV(JJ)<1,2> + S.DEPT(JJ)<1,DD,2>
105 NEXT JJ
   IF DIV(5)<1,1> # 0  AND DIV(5)<1,1> # "" THEN
      IF DIV(3)<1,1>=DIV(5)<1,1> THEN
         DIV(6)<1,1>=OCONV("1000","MD1")
      END ELSE
         PCT.HRS1=(DIV(3)<1,1> / DIV(5)<1,1>) * 100
         IF PCT.HRS1 >= 0 THEN
            DIV(6)<1,1>=OCONV(INT((PCT.HRS1 * 10) + .5),"MD1")
         END ELSE
            DIV(6)<1,1>=OCONV(INT((PCT.HRS1 * 10) - .5),"MD1")
         END
      END
   END ELSE
      DIV(6)<1,1>=""
   END
   IF DIV(5)<1,2> # 0  AND DIV(5)<1,2> # "" THEN
      IF DIV(3)<1,2>=DIV(5)<1,2> THEN
         DIV(6)<1,2>=OCONV("1000","MD1")
      END ELSE
         PCT.HRS2=(DIV(3)<1,2> / DIV(5)<1,2>) * 100
         IF PCT.HRS2 >= 0 THEN
            DIV(6)<1,2>=OCONV(INT((PCT.HRS2 * 10) + .5),"MD1")
         END ELSE
            DIV(6)<1,2>=OCONV(INT((PCT.HRS2 * 10) - .5),"MD1")
         END
      END
   END ELSE
      DIV(6)<1,2>=""
   END
   FOR Z=3 TO 15
      IF DIV(Z)<1,1>=0 THEN DIV(Z)<1,1>=""
      IF DIV(Z)<1,2>=0 THEN DIV(Z)<1,2>=""
   NEXT Z
   RETURN
*
*---- PRINT DIV TOTAL LINE
*
110*
   GOSUB 120
   H.LINE=SP34:D7:SP:D5:SP:D7:SP:D5:SP:D5:SP:D5:SP2:D8:SP:D7:SP:D7:SP:D8:SP:D7:SP:D7:SP:D7
   PRINT H.LINE
   P.LINE="  * DIVISION TOTAL  ":SP11:DIV(2)<1,1>"L#2":SP:DIV(3)<1,1>"R#7"
   P.LINE=P.LINE:SP:DIV(4)<1,1>"R#5":SP:DIV(5)<1,1>"R#7":SP:DIV(6)<1,1>"R#5"
   P.LINE=P.LINE:SP:DIV(7)<1,1>"R#5":SP:DIV(8)<1,1>"R#5":SP2:DIV(9)<1,1>"R#8"
   P.LINE=P.LINE:SP:DIV(10)<1,1>"R#7":SP:DIV(11)<1,1>"R#7":SP:DIV(12)<1,1>"R#8"
   P.LINE=P.LINE:SP:DIV(13)<1,1>"R#7":SP:DIV(14)<1,1>"R#7":SP:DIV(15)<1,1>"R#7"
   PRINT P.LINE
   LINE.CNT=LINE.CNT + 2
   IF DIV(2)<1,2> # "" THEN
      P.LINE=SP31:DIV(2)<1,2>"L#2":SP:DIV(3)<1,2>"R#7"
      P.LINE=P.LINE:SP:DIV(4)<1,2>"R#5":SP:DIV(5)<1,2>"R#7":SP:DIV(6)<1,2>"R#5"
      P.LINE=P.LINE:SP:DIV(7)<1,2>"R#5":SP:DIV(8)<1,2>"R#5":SP2:DIV(9)<1,2>"R#8"
      P.LINE=P.LINE:SP:DIV(10)<1,2>"R#7":SP:DIV(11)<1,2>"R#7":SP:DIV(12)<1,2>"R#8"
      P.LINE=P.LINE:SP:DIV(13)<1,2>"R#7":SP:DIV(14)<1,2>"R#7":SP:DIV(15)<1,2>"R#7"
      PRINT P.LINE
      LINE.CNT=LINE.CNT + 1
   END
   MAT DIV=""
   RETURN
*
*---- INCREMENT S.DIV
*
120*
   S.DIV(1)<1,DPTR>=DIV(1)
   FOR G=2 TO 15
      S.DIV(G)<1,DPTR,1>=DIV(G)<1,1>
      S.DIV(G)<1,DPTR,2>=DIV(G)<1,2>
   NEXT G
   DPTR=DPTR + 1
   RETURN
*
*---- SETUP DIVISION REPORT
*
130*
   RNAME="DIVISION.RPT"
   NEW.DIV=1
   DV.CNT=COUNT(S.DIV(1),VM) + (S.DIV(1) # "")
   FOR EE=1 TO DV.CNT
      DIV.NUM=FIELD(S.DIV(1)<1,EE>,"*",2)
      IF NEW.DIV THEN NEW.DIV=0;GOSUB 20
      GOSUB 140
   NEXT EE
   GOSUB 160
   RETURN
*
*---- PRINT DIV RPT PAGE(S)
*
140*
   IF S.DIV(2)<1,EE,1>="" AND S.DIV(2)<1,EE,2>="" THEN GOTO 145
   GOSUB 150
   MATREAD DIV.REC FROM DIVISION,CONO:DIV.NUM ELSE DIV.DESC=UNKNOWN
   IF S.DIV(2)<1,EE,1> # "" THEN
      P.LINE=DIV.DESC"L#30":SP:S.DIV(2)<1,EE,1>"L#2":SP:S.DIV(3)<1,EE,1>"R#7"
      P.LINE=P.LINE:SP:S.DIV(4)<1,EE,1>"R#5":SP:S.DIV(5)<1,EE,1>"R#7":SP:S.DIV(6)<1,EE,1>"R#5"
      P.LINE=P.LINE:SP:S.DIV(7)<1,EE,1>"R#5":SP:S.DIV(8)<1,EE,1>"R#5":SP2:S.DIV(9)<1,EE,1>"R#8"
      P.LINE=P.LINE:SP:S.DIV(10)<1,EE,1>"R#7":SP:S.DIV(11)<1,EE,1>"R#7":SP:S.DIV(12)<1,EE,1>"R#8"
      P.LINE=P.LINE:SP:S.DIV(13)<1,EE,1>"R#7":SP:S.DIV(14)<1,EE,1>"R#7":SP:S.DIV(15)<1,EE,1>"R#7"
      PRINT P.LINE
      LINE.CNT=LINE.CNT + 1
      IF S.DIV(2)<1,EE,2> # "" THEN
         P.LINE=SP31:S.DIV(2)<1,EE,2>"L#2":SP:S.DIV(3)<1,EE,2>"R#7"
         P.LINE=P.LINE:SP:S.DIV(4)<1,EE,2>"R#5":SP:S.DIV(5)<1,EE,2>"R#7":SP:S.DIV(6)<1,EE,2>"R#5"
         P.LINE=P.LINE:SP:S.DIV(7)<1,EE,2>"R#5":SP:S.DIV(8)<1,EE,2>"R#5":SP2:S.DIV(9)<1,EE,2>"R#8"
         P.LINE=P.LINE:SP:S.DIV(10)<1,EE,2>"R#7":SP:S.DIV(11)<1,EE,2>"R#7":SP:S.DIV(12)<1,EE,2>"R#8"
         P.LINE=P.LINE:SP:S.DIV(13)<1,EE,2>"R#7":SP:S.DIV(14)<1,EE,2>"R#7":SP:S.DIV(15)<1,EE,2>"R#7"
         PRINT P.LINE
         LINE.CNT=LINE.CNT + 1
      END
   END ELSE
      IF S.DIV(2)<1,EE,2> # "" THEN
         P.LINE=DIV.DESC"L#30":SP:S.DIV(2)<1,EE,2>"L#2":SP:S.DIV(3)<1,EE,2>"R#7"
         P.LINE=P.LINE:SP:S.DIV(4)<1,EE,2>"R#5":SP:S.DIV(5)<1,EE,2>"R#7":SP:S.DIV(6)<1,EE,2>"R#5"
         P.LINE=P.LINE:SP:S.DIV(7)<1,EE,2>"R#5":SP:S.DIV(8)<1,EE,2>"R#5":SP2:S.DIV(9)<1,EE,2>"R#8"
         P.LINE=P.LINE:SP:S.DIV(10)<1,EE,2>"R#7":SP:S.DIV(11)<1,EE,2>"R#7":SP:S.DIV(12)<1,EE,2>"R#8"
         P.LINE=P.LINE:SP:S.DIV(13)<1,EE,2>"R#7":SP:S.DIV(14)<1,EE,2>"R#7":SP:S.DIV(15)<1,EE,2>"R#7"
         PRINT P.LINE
         LINE.CNT=LINE.CNT + 1
      END
   END
   PRINT;PRINT;LINE.CNT=LINE.CNT + 2
145*
   IF LINE.CNT >= 50 THEN
      CONT.FLAG=1;GOSUB 20
   END
   RETURN
*
*---- INCREMENT COMP TOTALS
*
150*
   COMP(1)=CONO
   COMP(2)<1,1>=S.DIV(2)<1,EE,1>
   COMP(2)<1,2>=S.DIV(2)<1,EE,2>
   FOR JJ=3 TO 15
      IF JJ=6 THEN GOTO 155
      COMP(JJ)<1,1>=COMP(JJ)<1,1> + S.DIV(JJ)<1,EE,1>
      COMP(JJ)<1,2>=COMP(JJ)<1,2> + S.DIV(JJ)<1,EE,2>
155 NEXT JJ
   IF COMP(5)<1,1> # 0 AND COMP(5)<1,1> # "" THEN
      IF COMP(3)<1,1>=COMP(5)<1,1> THEN
         COMP(6)<1,1>=OCONV("1000","MD1")
      END ELSE
         PCT.HRS1=(COMP(3)<1,1> / COMP(5)<1,1>) * 100
         IF PCT.HRS1 >= 0 THEN
            COMP(6)<1,1>=OCONV(INT((PCT.HRS1 * 10) + .5),"MD1")
         END ELSE
            COMP(6)<1,1>=OCONV(INT((PCT.HRS1 * 10) - .5),"MD1")
         END
      END
   END ELSE
      COMP(6)<1,1>=""
   END
   IF COMP(5)<1,2> # 0 AND COMP(5)<1,2> # "" THEN
      IF COMP(3)<1,2>=COMP(5)<1,2> THEN
         COMP(6)<1,2>=OCONV("1000","MD1")
      END ELSE
         PCT.HRS2=(COMP(3)<1,2> / COMP(5)<1,2>) * 100
         IF PCT.HRS2 >= 0 THEN
            COMP(6)<1,2>=OCONV(INT((PCT.HRS2 * 10) + .5),"MD1")
         END ELSE
            COMP(6)<1,2>=OCONV(INT((PCT.HRS2 * 10) - .5),"MD1")
         END
      END
   END ELSE
      COMP(6)<1,2>=""
   END
   FOR Z=3 TO 15
      IF COMP(Z)<1,1>=0 THEN COMP(Z)<1,1>=""
      IF COMP(Z)<1,2>=0 THEN COMP(Z)<1,2>=""
   NEXT Z
   RETURN
*
*---- PRINT COMPANY TOTALS
*
160*
   H.LINE=SP34:D7:SP:D5:SP:D7:SP:D5:SP:D5:SP:D5:SP2:D8:SP:D7:SP:D7:SP:D8:SP:D7:SP:D7:SP:D7
   PRINT H.LINE
   P.LINE="  * COMPANY TOTAL   ":SP11:COMP(2)<1,1>"L#2":SP:COMP(3)<1,1>"R#7"
   P.LINE=P.LINE:SP:COMP(4)<1,1>"R#5":SP:COMP(5)<1,1>"R#7":SP:COMP(6)<1,1>"R#5"
   P.LINE=P.LINE:SP:COMP(7)<1,1>"R#5":SP:COMP(8)<1,1>"R#5":SP2:COMP(9)<1,1>"R#8"
   P.LINE=P.LINE:SP:COMP(10)<1,1>"R#7":SP:COMP(11)<1,1>"R#7":SP:COMP(12)<1,1>"R#8"
   P.LINE=P.LINE:SP:COMP(13)<1,1>"R#7":SP:COMP(14)<1,1>"R#7":SP:COMP(15)<1,1>"R#7"
   PRINT P.LINE
   LINE.CNT=LINE.CNT + 2
   IF COMP(2)<1,2> # "" THEN
      P.LINE=SP31:COMP(2)<1,2>"L#2":SP:COMP(3)<1,2>"R#7"
      P.LINE=P.LINE:SP:COMP(4)<1,2>"R#5":SP:COMP(5)<1,2>"R#7":SP:COMP(6)<1,2>"R#5"
      P.LINE=P.LINE:SP:COMP(7)<1,2>"R#5":SP:COMP(8)<1,2>"R#5":SP2:COMP(9)<1,2>"R#8"
      P.LINE=P.LINE:SP:COMP(10)<1,2>"R#7":SP:COMP(11)<1,2>"R#7":SP:COMP(12)<1,2>"R#8"
      P.LINE=P.LINE:SP:COMP(13)<1,2>"R#7":SP:COMP(14)<1,2>"R#7":SP:COMP(15)<1,2>"R#7"
      PRINT P.LINE
      LINE.CNT=LINE.CNT + 1
   END
   RETURN
*
*---- CALLS FOR SYSCOM
*
91000*
   ERR.TYPE=1
   CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
93000*
   PRINTER OFF
   ERR.TYPE=3
   CALL SYSCOM(MAT SYSCOM.REC)
99999*
END
