    SUBROUTINE JRS.MT.SUM
*COPY>JCS.CPYLIB>COM.JRS
*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - JCSBP
* PROGRAM     - JRS.MT.SUM
* BY          - NATALIE BLAKE, COMPUTER BUSINESS ASSOCIATES
* DATE        - 06/08/88
* DESCRIPTION -
* This program produces a Job Material Posted Summary report.
*
* CSF 21356 FIXED PROBLEM WITH CALCULATION ON CHANGE ORDERS
*C33462 gat 06/23/1999 * FIX SHEET CALC FOR QTY FROM ESTIMATE
*T24871 cm 02/23/2000 * If a inventory item exits in INVENTORY and an
*                       item with the same id are in ESTIMATE.MATL a
*                       conflict can arise and display the wrong
*                       description in certain instances.
*T26556 ajibaly 05/08/2002 * Use report # and GET.PROG.HEAD.
*T27141 bmourad 12/20/2002 * Expand total field to millions.
*T28754 thompson 12/29/2005 * Correct report for consolidated output
*T28964 wvaughan 08/08/2006 * Extend JOB.QTY field to display 8 numbers.
*********************************************************************
*
*---- FILE EQUATES
*
*COPY>CPYLIB>CHAR
*COPY>ICS.CPYLIB>INVENTORY
*COPY>ICS.CPYLIB>INV.CNV
*COPY>PMC.CPYLIB>DEPARTMENT
*COPY>JCS.CPYLIB>JOB
*COPY>CPYLIB>FILE.VARS
*COPY>JCS.CPYLIB>JOB.RPT.SET
*COPY>JCS.CPYLIB>JOB.RPT.SUM
*
*---INITIALIZE VARIABLES
*
    PG.NO = 0
*T26556 v
*   RPT.NO="XXXX"
    HD1 = ""; HD2 = ""
    RPT.NAME = ""
    RPT.DATE = DATE()
    CALL GET.PROG.HEAD(CONO,C.CO.NAME,RPT.NAME,RPT.NO,RPT.DATE,HD1,HD2)
    PRINTER ON
*T26556 ^
    DIM DEPT.TOT(6); MAT DEPT.TOT = ""
    EQU DEPT.EST.COST   TO DEPT.TOT(1)
    EQU DEPT.REG.COST   TO DEPT.TOT(2)
    EQU DEPT.REG.VAR    TO DEPT.TOT(3)
    EQU DEPT.CO.COST    TO DEPT.TOT(4)
    EQU DEPT.CO.VAR     TO DEPT.TOT(5)
    EQU DEPT.SP.COST    TO DEPT.TOT(6)
    DIM GRAND.TOT(6); MAT GRAND.TOT = ""
    EQU GT.EST.COST   TO GRAND.TOT(1)
    EQU GT.REG.COST   TO GRAND.TOT(2)
    EQU GT.REG.VAR    TO GRAND.TOT(3)
    EQU GT.CO.COST    TO GRAND.TOT(4)
    EQU GT.CO.VAR     TO GRAND.TOT(5)
    EQU GT.SP.COST    TO GRAND.TOT(6)
    DIM IND(4); MAT IND = ""
    DIM INFO.REC(22); MAT INFO.REC = ""
    EQU INFO.PROD     TO INFO.REC(1)
    EQU INFO.DESC     TO INFO.REC(2)
    EQU INFO.FLAG     TO INFO.REC(3)
    EQU INFO.DATE     TO INFO.REC(4)
    EQU INFO.UM       TO INFO.REC(5)
    EQU INFO.E.QTY    TO INFO.REC(6)
    EQU INFO.E.COST   TO INFO.REC(7)
    EQU INFO.A.QTY    TO INFO.REC(8)
    EQU INFO.A.COST   TO INFO.REC(9)
    EQU INFO.VAR      TO INFO.REC(10)
    EQU INFO.SP.QTY   TO INFO.REC(11)
    EQU INFO.SP.COST  TO INFO.REC(12)
    EQU INFO.IND.FLAG TO INFO.REC(13)
    EQU INFO.IND      TO INFO.REC(14)
    EQU INFO.C.DATE   TO INFO.REC(15)
    EQU INFO.C.VAR    TO INFO.REC(16)
    EQU INFO.C.QTY    TO INFO.REC(17)
    EQU INFO.C.COST   TO INFO.REC(18)
    EQU INFO.IND1     TO INFO.REC(19)
    EQU INFO.IND2     TO INFO.REC(20)
    EQU INFO.IND3     TO INFO.REC(21)
    EQU INFO.IND4     TO INFO.REC(22)
*
    LINE.CNT = 99; IND.FLAG = 0
    D.CO.DATE = 0; D.REG.DATE = 0
    G.CO.DATE = 0; G.REG.DATE = 0
*
*---MAIN PROCESSING
*
    IF JRSD.CONS = "Y" THEN
        CONSOL = "CONSOLIDATED"
    END ELSE
        CONSOL = "            "
    END
    ID.CNT = DCOUNT(JRS.IDS,AM)
    IFND = 0
    FOR J = 1 TO ID.CNT WHILE IFND = 0
        IF FIELD(JRS.IDS<J>,"&",5)#"M" THEN GOTO 100
        DPNO = FIELD(JRS.IDS<J>,"&",2)
        IF DP.SEL # "ALL" AND DP.SEL # DPNO THEN GOTO 100
        MATREAD JRS.REC FROM JOB.RPT.SET,CONO:JOBNO:"&":JRS.IDS<J> ELSE GOTO 100
        IFND = J
100 NEXT J
    IF IFND = 0 THEN GOTO 99999
    PROD = FIELD(JRS.IDS<IFND>,"&",4)
    PREV.DEPT = DPNO
    MATREAD DEPT.REC FROM DEPARTMENT,CONO:DPNO ELSE DEPT.DESC=STR("?",30)
    MATREAD INV.REC FROM INVENTORY,CONO:PROD ELSE MAT INV.REC=""
    GOSUB 2000
    P.LINE = DEPT.DESC:"  ":DPNO
    PRINT P.LINE
    PRINT STR("-",LEN(P.LINE))
    LINE.CNT = LINE.CNT + 2
    GOSUB 3000
    IFND = IFND + 1
    FOR I = IFND TO ID.CNT
        IF FIELD(JRS.IDS<I>,"&",5) # "M" THEN GOTO 899
        DPNO = FIELD(JRS.IDS<I>,"&",2)
        IF DP.SEL # "ALL" AND DP.SEL # DPNO THEN GOTO 899
        MATREAD JRS.REC FROM JOB.RPT.SET,CONO:JOBNO:"&":JRS.IDS<I> ELSE GOTO 899
        PROD = FIELD(JRS.IDS<I>,"&",4)
        IF PREV.DEPT # DPNO THEN
            GOSUB 1000
            GOSUB 4000
            MATREAD DEPT.REC FROM DEPARTMENT,CONO:DPNO ELSE DEPT.DESC=STR("?",30)
            PREV.DEPT = DPNO
            P.LINE = DEPT.DESC:"  ":DPNO
            PRINT P.LINE
            PRINT STR("-",LEN(P.LINE))
            LINE.CNT = LINE.CNT + 2
        END
        MATREAD INV.REC FROM INVENTORY,CONO:PROD ELSE MAT INV.REC=""
        GOSUB 3000
899 NEXT I
    GOSUB 1000
    GOSUB 4000
*27141    PRINT SPACE(69):"-----":
    PRINT SPACE(65):"-----": ;*27141
*27141    PRINT SPACE(14):"------":
    PRINT SPACE(14):"-------": ;*27141
*27141    PRINT SPACE(10):"------ ------":
    PRINT SPACE(10):"------- -------": ;*27141
*27141    PRINT SPACE(9):"------"
    PRINT SPACE(9):"-------" ;*27141
    TOT.LINE = "***  GRAND TOTALS ***"
    IF G.REG.DATE # "" THEN
*27141        TOT.LINE = TOT.LINE:SPACE(48): OCONV(G.REG.DATE,"D0-")
        TOT.LINE = TOT.LINE:SPACE(44): OCONV(G.REG.DATE,"D0-") ;*27141
    END ELSE
*27141        TOT.LINE = TOT.LINE: SPACE(48):OCONV(G.CO.DATE,"D0-")
        TOT.LINE = TOT.LINE: SPACE(44):OCONV(G.CO.DATE,"D0-") ;*27141
    END
    IF GT.EST.COST > 0 THEN RD = .5 ELSE RD = -.5
*27141    TOT.LINE = TOT.LINE:SPACE(14): OCONV(INT(GT.EST.COST/100+RD),"MD0Z") "R#6"
    TOT.LINE = TOT.LINE:SPACE(14): OCONV(INT(GT.EST.COST/100+RD),"MD0Z") "R#7" ;*27141
    BEGIN CASE
        CASE GT.REG.COST > 0
            IF GT.REG.COST > 0 THEN RD = .5 ELSE RD = -.5
*27141            TOT.LINE = TOT.LINE:SPACE(10):OCONV(INT(GT.REG.COST/100+RD),"MD0Z") "R#6 "
            TOT.LINE = TOT.LINE:SPACE(10):OCONV(INT(GT.REG.COST/100+RD),"MD0Z") "R#7 " ;*27141
        CASE GT.CO.COST > 0
            IF GT.CO.COST > 0 THEN RD = .5 ELSE RD = -.5
*27141            TOT.LINE = TOT.LINE:SPACE(10):OCONV(INT(GT.CO.COST/100+RD),"MD0Z") "R#6"
            TOT.LINE = TOT.LINE:SPACE(10):OCONV(INT(GT.CO.COST/100+RD),"MD0Z") "R#7" ;*27141
        CASE 1
            TOT.LINE = TOT.LINE: SPACE(17)
    END CASE
    BEGIN CASE
        CASE GT.REG.VAR # 0 AND GT.REG.VAR # ""
            IF GT.REG.VAR > 0 THEN RD = .5 ELSE RD = -.5
*27141            TOT.LINE = TOT.LINE:OCONV(INT(GT.REG.VAR/100+RD),"MD0Z") "R#6"
            TOT.LINE = TOT.LINE:OCONV(INT(GT.REG.VAR/100+RD),"MD0Z") "R#7" ;*27141
        CASE GT.CO.VAR # 0 AND GT.CO.VAR # ""
            IF GT.CO.VAR > 0 THEN RD = .5 ELSE RD = -.5
*27141            TOT.LINE = TOT.LINE:OCONV(INT(GT.CO.VAR/100+RD),"MD0Z") "R#6"
            TOT.LINE = TOT.LINE:OCONV(INT(GT.CO.VAR/100+RD),"MD0Z") "R#7" ;*27141
        CASE 1
            TOT.LINE = TOT.LINE:SPACE(6)
    END CASE
    IF GT.SP.COST > 0 THEN RD = .5 ELSE RD = -.5
*27141    TOT.LINE = TOT.LINE:SPACE(9):OCONV(INT(GT.SP.COST/100+RD),"MD0Z") "R#6"
    TOT.LINE = TOT.LINE:SPACE(9):OCONV(INT(GT.SP.COST/100+RD),"MD0Z") "R#7" ;*27141
    PRINT TOT.LINE
    LINE.CNT = LINE.CNT + 1
    TOT.LINE = ""
    IF GT.REG.COST > 0 AND GT.CO.COST > 0 THEN
        TOT.LINE = SPACE(66):"CO ":OCONV(G.CO.DATE,"D0-") "L#5"
        IF GT.CO.COST > 0 THEN RD = .5 ELSE RD = -.5
*27141        TOT.LINE = TOT.LINE: SPACE(30):OCONV(INT(GT.CO.COST/100+RD),"MD0Z") "R#6 "
        TOT.LINE = TOT.LINE: SPACE(30):OCONV(INT(GT.CO.COST/100+RD),"MD0Z") "R#7 " ;*27141
        IF GT.CO.VAR > 0 THEN RD = .5 ELSE RD = -.5
*27141        TOT.LINE = TOT.LINE: OCONV(INT(GT.CO.VAR/100+RD),"MD0Z") "R#6"
        TOT.LINE = TOT.LINE: OCONV(INT(GT.CO.VAR/100+RD),"MD0Z") "R#7" ;*27141
        PRINT TOT.LINE
        LINE.CNT = LINE.CNT + 1
    END
    PRINT
    LINE.CNT = LINE.CNT + 1
    GOTO 99999
*
*---PRINT OUT DETAIL LINES FOR DEPARTMENT
*
1000*
    LOOP.CNT = DCOUNT(INFO.PROD,VM)
    FOR A = 1 TO LOOP.CNT
IF @LOGNAME = 'cmykleb' THEN DEBUG
        MATREAD INV.REC FROM INVENTORY,CONO:INFO.PROD<1,A> ELSE MAT INV.REC=""
        MAT INV.CNV.REC = ""
        BEGIN CASE
            CASE INV.UNIT<1,2> = 'SHT' AND INV.UNIT<1,3> = 'LBS'
                ICR.CNV = "MD0Z"
                ICR.DV1 = INV.M.WT; ICR.MT1 = 1; ICR.DV2 = 1
            CASE INV.UNIT<1,2> = 'PC' AND INV.UNIT<1,3> = 'MSI'
                ICR.CNV = "MD0Z"
                ICR.DV1 = INV.PAP.WIDTH/100; ICR.MT1 = 10; ICR.DV2 = 1
            CASE INV.UNIT<1,2> = 'FT' AND INV.UNIT<1,3> = 'MSI'
                ICR.CNV = "MD0Z"
                ICR.DV1 = INV.PAP.WIDTH/100; ICR.MT1 = 100; ICR.DV2 = 12
            CASE 1
                ICR.CNV = "MD0Z"
                ICR.DV1 = 1000; ICR.MT1 = 1; ICR.DV2 = 1
        END CASE
        IF LINE.CNT > 55 THEN
            GOSUB 2000
            P.LINE = DEPT.DESC:"  ":DPNO
            PRINT P.LINE
            PRINT STR("-",LEN(P.LINE))
            LINE.CNT = LINE.CNT + 2
        END
        PRINT SPACE(5): INFO.PROD<1,A> "L#15 ":
*27141        PRINT INFO.DESC<1,A> "L#45 ":
        PRINT INFO.DESC<1,A> "L#41 ": ;*27141
        PRINT INFO.FLAG<1,A> "L#2":
        PRINT INFO.DATE<1,A> "L#5 ":
        PRINT INFO.UM<1,A> "L#3 ":
        QTY = ""
        BEGIN CASE
            CASE INFO.E.QTY<1,A> = 0 OR INFO.E.QTY<1,A> = ""
                QTY = ""
            CASE INFO.E.QTY<1,A> > 0
*CSF 19592
* C33462
                IF INV.UNIT<1,2> # 'SHT' THEN
                    IF ICR.DV1 = 1000 THEN
                        QTY = INT(INFO.E.QTY<1,A>*10/ICR.DV1*ICR.MT1/ICR.DV2+.5)
                    END ELSE
                        QTY = INT(INFO.E.QTY<1,A>/ICR.DV1*ICR.MT1/ICR.DV2+.5)
                    END
                 END ELSE
                         QTY = INT(INFO.E.QTY<1,A> / 100)
                 END
                CASE INFO.E.QTY<1,A> < 0
                IF INV.UNIT<1,2> # 'SHT' THEN
                    IF ICR.DV1 = 1000 THEN
                        QTY = INT(INFO.E.QTY<1,A>*10/ICR.DV1*ICR.MT1/ICR.DV2-.5)
                    END ELSE
                        QTY = INT(INFO.E.QTY<1,A>/ICR.DV1*ICR.MT1/ICR.DV2-.5)
                    END
                END ELSE
                    QTY = INT(INFO.E.QTY<1,A> / 100)
                END
**
*C33462
            END CASE
        GOSUB 5000
        PRINT QTY "R#8 ":
        IF INFO.E.COST<1,A> > 0 THEN
            INFO.E.COST<1,A> = OCONV(INT(INFO.E.COST<1,A>/100+.5),"MD0Z")
        END ELSE
            INFO.E.COST<1,A> = OCONV(INT(INFO.E.COST<1,A>/100-.5),"MD0Z")
        END
*27141        PRINT INFO.E.COST<1,A> "R#6 ":
        PRINT INFO.E.COST<1,A> "R#7 ": ;*27141
        QTY = ""
        BEGIN CASE
            CASE INFO.A.QTY<1,A> = 0 OR INFO.A.QTY<1,A> = ""
                QTY = ""
            CASE INFO.A.QTY<1,A> > 0
                QTY = INT(((INFO.A.QTY<1,A>/ICR.DV1)*ICR.MT1)/ICR.DV2+.5)
            CASE INFO.A.QTY<1,A> < 0
                QTY = INT(((INFO.A.QTY<1,A>/ICR.DV1)*ICR.MT1)/ICR.DV2-.5)
        END CASE
        GOSUB 5000
        PRINT QTY "R#8 ":
        IF INFO.A.COST<1,A> > 0 THEN
            INFO.A.COST<1,A> = OCONV(INT(INFO.A.COST<1,A>/100+.5),"MD0Z")
        END ELSE
            INFO.A.COST<1,A> = OCONV(INT(INFO.A.COST<1,A>/100-.5),"MD0Z")
        END
*27141        PRINT INFO.A.COST<1,A> "R#6 ":
        PRINT INFO.A.COST<1,A> "R#7 ": ;*27141
        DEPT.REG.VAR = DEPT.REG.VAR + INFO.VAR<1,A>
        IF INFO.VAR<1,A> > 0 THEN
            INFO.VAR<1,A> = OCONV(INT(INFO.VAR<1,A>/100+.5),"MD0Z")
        END ELSE
            INFO.VAR<1,A> = OCONV(INT(INFO.VAR<1,A>/100-.5),"MD0Z")
        END
*27141        PRINT INFO.VAR<1,A> "R#6 ":
        PRINT INFO.VAR<1,A> "R#7 ": ;*27141
        QTY = ""
        BEGIN CASE
            CASE INFO.SP.QTY<1,A> = 0 OR INFO.SP.QTY<1,A> = ""
                QTY = ""
            CASE INFO.SP.QTY<1,A> > 0
                QTY = INT(((INFO.SP.QTY<1,A>/ICR.DV1)*ICR.MT1)/ICR.DV2+.5)
            CASE INFO.SP.QTY<1,A> < 0
                QTY = INT(((INFO.SP.QTY<1,A>/ICR.DV1)*ICR.MT1)/ICR.DV2-.5)
        END CASE
        GOSUB 5000
        PRINT QTY "R#7 ":
        IF INFO.SP.COST<1,A> > 0 THEN
            INFO.SP.COST<1,A> = OCONV(INT(INFO.SP.COST<1,A>/100+.5),"MD0Z")
        END ELSE
            INFO.SP.COST<1,A> = OCONV(INT(INFO.SP.COST<1,A>/100-.5),"MD0Z")
        END
*27141        PRINT INFO.SP.COST<1,A> "R#6"
        PRINT INFO.SP.COST<1,A> "R#7" ;*27141
        IF INFO.C.DATE<1,A> # "" THEN
            PRINT SPACE(66):"CO ":
            PRINT INFO.C.DATE<1,A> "L#5 ":
            PRINT INFO.UM<1,A> "L#3 ":
            QTY = ""
            BEGIN CASE
                CASE INFO.C.QTY<1,A> = 0 OR INFO.C.QTY<1,A> = ""
                    QTY = ""
                CASE INFO.C.QTY<1,A> > 0
                    QTY = INT(((INFO.C.QTY<1,A>/ICR.DV1)*ICR.MT1)/ICR.DV2+.5)
                CASE INFO.E.QTY<1,A> < 0
                    QTY = INT(((INFO.C.QTY<1,A>/ICR.DV1)*ICR.MT1)/ICR.DV2-.5)
            END CASE
            GOSUB 5000
            PRINT SPACE(16): QTY "R#8 ":
*            DEPT.CO.COST = DEPT.CO.COST + INFO.C.COST<1,A>
            IF INFO.C.COST<1,A> > 0 THEN
                INFO.C.COST<1,A> = OCONV(INT(INFO.C.COST<1,A>/100+.5),"MD0Z")
            END ELSE
                INFO.C.COST<1,A> = OCONV(INT(INFO.C.COST<1,A>/100-.5),"MD0Z")
            END
*27141            PRINT INFO.C.COST<1,A> "R#6 ":
            PRINT INFO.C.COST<1,A> "R#7 ": ;*27141
*21356            DEPT.CO.VAR = DEPT.CO.VAR + INFO.C.VAR<1,A>
            IF INFO.C.VAR<1,A> > 0 THEN
                INFO.C.VAR<1,A> = OCONV(INT(INFO.C.VAR<1,A>/100+.5),"MD0Z")
            END ELSE
                INFO.C.VAR<1,A> = OCONV(INT(INFO.C.VAR<1,A>/100-.5),"MD0Z")
            END
*27141            PRINT INFO.C.VAR<1,A> "R#6"
            PRINT INFO.C.VAR<1,A> "R#7" ;*27141
            LINE.CNT = LINE.CNT + 1
        END
        LINE.CNT = LINE.CNT + 1
        IF INFO.IND.FLAG<1,A> > 0 THEN
*T28754            PRINT SPACE(65): "IND": SPACE(20):
            PRINT SPACE(65): "IND": SPACE(16):
            IF ABS(INFO.IND1<1,A>) > 0 THEN
                IF INFO.IND1<1,A> > 0 THEN
                    INFO.IND1<1,A>=INT(INFO.IND1<1,A>/100+.5)
                END ELSE
                    INFO.IND1<1,A>=INT(INFO.IND1<1,A>/100-.5)
                END
            END
*27141            PRINT OCONV(INFO.IND1<1,A>,"MD0Z") "R#6":
            PRINT OCONV(INFO.IND1<1,A>,"MD0Z") "R#7": ;*27141
            BEGIN CASE
                CASE ABS(INFO.IND3<1,A>) > 0
                    IF INFO.IND3<1,A> < 0 THEN
                        INFO.IND3<1,A>=INT(INFO.IND3<1,A>/100-.5)
                    END ELSE
                        INFO.IND3<1,A>=INT(INFO.IND3<1,A>/100+.5)
                    END
*27141                    PRINT SPACE(10): OCONV(INFO.IND3<1,A>,"MD0Z") "R#6":
                    PRINT SPACE(10): OCONV(INFO.IND3<1,A>,"MD0Z") "R#7": ;*27141
                CASE ABS(INFO.IND2<1,A>) > 0
                    IF INFO.IND2<1,A> < 0 THEN
                        INFO.IND2<1,A>=INT(INFO.IND2<1,A>/100-.5)
                    END ELSE
                        INFO.IND2<1,A>=INT(INFO.IND2<1,A>/100+.5)
                    END
*27141                    PRINT SPACE(10): OCONV(INFO.IND2<1,A>,"MD0Z") "R#6":
                    PRINT SPACE(10): OCONV(INFO.IND2<1,A>,"MD0Z") "R#7": ;*27141
                CASE 1
                    PRINT SPACE(16):
            END CASE
            IF ABS(INFO.IND4<1,A>) > 0 THEN
                IF INFO.IND4<1,A> < 0 THEN
                    INFO.IND4<1,A>=INT(INFO.IND4<1,A>/100-.5)
                END ELSE
                    INFO.IND4<1,A>=INT(INFO.IND4<1,A>/100+.5)
                END
            END
*27141            PRINT SPACE(16): OCONV(INFO.IND4<1,A>,"MD0Z") "R#6"
            PRINT SPACE(16): OCONV(INFO.IND4<1,A>,"MD0Z") "R#8" ;*27141
            LINE.CNT = LINE.CNT + 1
            IF ABS(INFO.IND2<1,A>) > 0 AND ABS(INFO.IND3<1,A>) > 0 THEN
                IF INFO.IND2<1,A> < 0 THEN
                    INFO.IND2<1,A>=INT(INFO.IND2<1,A>/100-.5)
                END ELSE
                    INFO.IND2<1,A>=INT(INFO.IND2<1,A>/100+.5)
                END
                PRINT SPACE(65):"IND":SPACE(36):
*27141                PRINT OCONV(INFO.IND2<1,A>,"MD0Z") "R#6"
                PRINT OCONV(INFO.IND2<1,A>,"MD0Z") "R#7" ;*27141
                LINE.CNT = LINE.CNT + 1
            END
        END
    NEXT A
    MAT INFO.REC = ""
    RETURN
*
*---- PRINT THE HEADINGS
*
2000*
    PRINT CHAR(12)
    PG.NO=PG.NO + 1
    HLINE1="#":JOBNO"L#8":SPACE(1):CONSOL:"  REPORT NO: ":RPT.NO"L#4":SPACE(3)
    N=SPACE((50 - LEN(C.CO.NAME)) / 2)
    HLINE2=N:C.CO.NAME:N
    HLINE3=SPACE(13):OCONV(DATE(),"D2/")"R#8":SPACE(12):'PAGE: ':PG.NO
*T26556 v
*   PRINT HLINE1:HLINE2:HLINE3
*   PRINT JOB.CUST "L#8":SPACE(36):'M A T E R I A L   P O S T E D   R E P O R T'
    PRINT HD1:PG.NO
    PRINT HD2
    PRINT "Job Number: ":JOBNO "L#8":SPACE(1):CONSOL
    PRINT JOB.CUST "L#8"
*T26556 ^
    PRINT C.CUST.NAME
    *T28964   PRINT JOB.QTY<1,1> "L#7":SPACE(45):'FOR ITEMS THROUGH: ':OCONV(JRSD.DATE,"D2-")
    PRINT JOB.QTY<1,1> "L#8":SPACE(45):'FOR ITEMS THROUGH: ':OCONV(JRSD.DATE,"D2-");*T28964
    PRINT JOB.DESC<1,1> "L#30":SPACE(22):'DATE LAST ENTRY  : ':OCONV(JRSD.MT.DATE,"D2-")
    PRINT 'SM: ':C.SALS.NAME "L#27":'SALES CODE: ':JOB.SALES.CODE
*27141    PRINT SPACE(69):'LAST      --- ESTIMATE --- ---- ACTUAL ----         -- SPOILAGE ---'
    PRINT SPACE(65):'LAST      --- ESTIMATE --- ---- ACTUAL ----         -- SPOILAGE ---' ;*27141
*27141    PRINT 'DEPT PRODUCT NUMBER  PRODUCT DESCRIPTION ':SPACE(28):'ENTRY U/M    QTY    COST      QTY    COST   VAR($)    QTY    COST '
    PRINT 'DEPT PRODUCT NUMBER  PRODUCT DESCRIPTION ':SPACE(24):'ENTRY U/M    QTY    COST      QTY    COST   VAR($)    QTY    COST '
*27141    PRINT '---- --------------- ---------------------------------------------   ----- --- -------- ------ -------- ------ ------ ------- ------'
    PRINT '---- --------------- -----------------------------------------   ----- --- -------- ------- -------- ------- ------- ------- -------' ;*27141
*T26556 v
*   LINE.CNT=9
    LINE.CNT=11
*T26556 ^
    RETURN
*
*---BUILD DETAIL LINES FOR DEPARTMENT
*
3000*
    LOCATE PROD IN INFO.PROD<1>,1 SETTING FND ELSE
        FND = DCOUNT(INFO.PROD,VM) + 1
    END
    BEGIN CASE
        CASE JRS.E.R.COST # "" OR JRS.R.COST # ""
            INFO.VAR<1,FND>=JRS.R.COST - JRS.E.R.COST + INFO.VAR<1,FND>
        CASE JRS.E.C.COST # "" OR JRS.C.COST # ""
            INFO.VAR<1,FND>=JRS.C.COST - JRS.E.C.COST + INFO.VAR<1,FND>
    END CASE
    INFO.PROD<1,FND> = PROD
*T24871 v
*   IF INV.FULL.DESC # "" THEN
    IF INV.FULL.DESC # "" AND (JRS.R.QTY+0) # 0 THEN
*T24871 ^
        INFO.DESC<1,FND> = INV.FULL.DESC
    END ELSE
        INFO.DESC<1,FND> = JRS.E.DESC
    END
    IF JRS.DATE = "" AND JRS.C.DATE # "" THEN
        INFO.FLAG<1,FND> = "CO "
        INFO.DATE<1,FND> = OCONV(JRS.C.DATE,"D0-")
    END ELSE
        INFO.FLAG<1,FND> = "   "
        INFO.DATE<1,FND> = OCONV(JRS.DATE,"D0-")
    END
    INFO.UM<1,FND> = INV.UNIT<1,2>
    INFO.E.QTY<1,FND> = JRS.E.R.QTY + INFO.E.QTY<1,FND>
    INFO.E.COST<1,FND> = INFO.E.COST<1,FND>+JRS.E.R.DCOST
    BEGIN CASE
        CASE JRS.R.QTY # "" OR JRS.R.DCOST # ""
            INFO.A.QTY<1,FND> = INFO.A.QTY<1,FND> + JRS.R.QTY
            INFO.A.COST<1,FND>=JRS.R.DCOST + INFO.A.COST<1,FND>
            DEPT.TOT(2) = DEPT.TOT(2) + JRS.R.DCOST
        CASE JRS.C.QTY # "" OR JRS.C.DCOST # ""
            INFO.A.QTY<1,FND> = INFO.A.QTY<1,FND> + JRS.C.QTY
            INFO.A.COST<1,FND>=JRS.C.DCOST + INFO.A.COST<1,FND>
            DEPT.CO.COST = DEPT.CO.COST + JRS.C.DCOST
* 21356
            DEPT.CO.VAR = DEPT.CO.VAR + JRS.C.DCOST
    END CASE
    INFO.SP.QTY<1,FND> = INFO.SP.QTY<1,FND> + JRS.S.QTY
    INFO.SP.COST<1,FND> = INFO.SP.COST<1,FND> + JRS.S.DCOST
    DEPT.SP.COST = DEPT.SP.COST + JRS.S.DCOST
    DEPT.EST.COST = DEPT.EST.COST + JRS.E.R.DCOST
    IF JRS.R.DCOST # "" AND JRS.C.DCOST # "" THEN
        INFO.C.VAR<1,FND>=JRS.C.COST - JRS.E.C.COST + INFO.C.VAR<1,FND>
*21356         DEPT.CO.VAR = DEPT.CO.VAR + (JRS.C.COST - JRS.E.C.COST)
        DEPT.CO.COST =DEPT.CO.COST + JRS.C.DCOST
*21356
        DEPT.CO.VAR = DEPT.CO.VAR + JRS.C.DCOST
        IF JRS.C.DATE # "" THEN
            INFO.C.DATE<1,FND> = OCONV(JRS.C.DATE,"D0-")
        END ELSE
            INFO.C.DATE<1,FND> = ""
        END
        INFO.C.QTY<1,FND> =  INFO.C.QTY<1,FND> + JRS.C.QTY
        INFO.C.COST<1,FND> = JRS.C.DCOST + INFO.C.COST<1,FND>
    END
    A = JRS.E.R.COST - JRS.E.R.DCOST
    B = JRS.R.COST - JRS.R.DCOST
    C = JRS.C.COST - JRS.C.DCOST
    D = JRS.S.COST - JRS.S.DCOST
    INFO.IND1<1,FND>= A + INFO.IND1<1,FND>
    INFO.IND2<1,FND> = C + INFO.IND2<1,FND>
    INFO.IND3<1,FND> = B + INFO.IND3<1,FND>
    INFO.IND4<1,FND> = D + INFO.IND4<1,FND>
    IF ABS(INFO.IND1<1,FND>) > 49 THEN INFO.IND.FLAG<1,FND> = 1
    IF ABS(INFO.IND2<1,FND>) > 49 THEN INFO.IND.FLAG<1,FND> = 1
    IF ABS(INFO.IND3<1,FND>) > 49 THEN INFO.IND.FLAG<1,FND> = 1
    IF ABS(INFO.IND4<1,FND>) > 49 THEN INFO.IND.FLAG<1,FND> = 1
    IF INFO.IND.FLAG<1,FND> THEN
        DEPT.TOT(1)=DEPT.TOT(1) + A
        DEPT.TOT(2)=DEPT.TOT(2) + B
        DEPT.TOT(4)=DEPT.TOT(4) + C
        DEPT.TOT(6)=DEPT.TOT(6) + D
    END
    IF JRS.DATE > D.REG.DATE THEN D.REG.DATE=JRS.DATE
    IF JRS.C.DATE > D.CO.DATE THEN D.CO.DATE=JRS.C.DATE
    IF JRS.DATE > G.REG.DATE THEN G.REG.DATE=JRS.DATE
    IF JRS.C.DATE > G.CO.DATE THEN G.CO.DATE=JRS.C.DATE
    A=0; B=0; C=0; D=0
    RETURN
*
*---PRINT DEPT TOTALS
*
4000*
    IF LINE.CNT > 55 THEN GOSUB 2000
*27141    PRINT SPACE(69):"-----":
    PRINT SPACE(65):"-----": ;*27141
*27141    PRINT SPACE(14):"------":
    PRINT SPACE(14):"-------": ;*27141
*27141    PRINT SPACE(10):"------ ------":
    PRINT SPACE(10):"------- -------": ;*27141
*27141    PRINT SPACE(9):"------"
    PRINT SPACE(9):"-------" ;*27141
    TOT.LINE = "** ":DEPT.DESC:" DEPARTMENT TOTAL";TOT.LINE=TOT.LINE "L#40"
    IF D.REG.DATE # "" THEN
*27141        TOT.LINE = TOT.LINE: SPACE(29):OCONV(D.REG.DATE,"D0-") "L#5"
        TOT.LINE = TOT.LINE: SPACE(25):OCONV(D.REG.DATE,"D0-") "L#5" ;*27141
    END ELSE
*27141        TOT.LINE = TOT.LINE:SPACE(26):"CO ":OCONV(D.CO.DATE,"D0-")"L#5"
        TOT.LINE = TOT.LINE:SPACE(22):"CO ":OCONV(D.CO.DATE,"D0-")"L#5" ;*27141
    END
    IF DEPT.EST.COST > 0 THEN RD=.5 ELSE RD = -.5
*27141    TOT.LINE = TOT.LINE:SPACE(14): OCONV(INT(DEPT.EST.COST/100+RD),"MD0Z") "R#6"
    TOT.LINE = TOT.LINE:SPACE(14): OCONV(INT(DEPT.EST.COST/100+RD),"MD0Z") "R#7" ;*27141
    IF DEPT.REG.COST # "" THEN
        IF DEPT.REG.COST > 0 THEN RD=.5 ELSE RD = -.5
*27141        TOT.LINE = TOT.LINE:SPACE(10):OCONV(INT(DEPT.REG.COST/100+RD),"MD0Z") "R#6 "
        TOT.LINE = TOT.LINE:SPACE(10):OCONV(INT(DEPT.REG.COST/100+RD),"MD0Z") "R#7 " ;*27141
        DEPT.REG.VAR = DEPT.REG.COST - DEPT.EST.COST
        IF DEPT.REG.VAR > 0 THEN RD=.5 ELSE RD = -.5
*27141        TOT.LINE = TOT.LINE:OCONV(INT(DEPT.REG.VAR/100+RD),"MD0Z") "R#6"
        TOT.LINE = TOT.LINE:OCONV(INT(DEPT.REG.VAR/100+RD),"MD0Z") "R#7" ;*27141
    END ELSE
        IF DEPT.CO.COST > 0 THEN RD=.5 ELSE RD = -.5
*27141        TOT.LINE = TOT.LINE:SPACE(10):OCONV(INT(DEPT.CO.COST/100+RD),"MD0Z") "R#6"
        TOT.LINE = TOT.LINE:SPACE(10):OCONV(INT(DEPT.CO.COST/100+RD),"MD0Z") "R#7" ;*27141
        IF DEPT.CO.VAR > 0 THEN RD=.5 ELSE RD = -.5
*27141        TOT.LINE = TOT.LINE:OCONV(INT(DEPT.CO.VAR/100+RD),"MD0Z") "R#6"
        TOT.LINE = TOT.LINE:OCONV(INT(DEPT.CO.VAR/100+RD),"MD0Z") "R#7" ;*27141
    END
    IF DEPT.SP.COST > 0 THEN RD=.5 ELSE RD = -.5
*27141    TOT.LINE = TOT.LINE:SPACE(9):OCONV(INT(DEPT.SP.COST/100+RD),"MD0Z") "R#6"
    TOT.LINE = TOT.LINE:SPACE(9):OCONV(INT(DEPT.SP.COST/100+RD),"MD0Z") "R#7" ;*27141
    PRINT TOT.LINE
    LINE.CNT = LINE.CNT + 1
    TOT.LINE = ""
    IF DEPT.REG.COST > 0 AND DEPT.CO.COST > 0 THEN
        TOT.LINE = SPACE(66):"CO ":OCONV(D.CO.DATE,"D0-") "L#5"
        IF DEPT.CO.COST > 0 THEN RD=.5 ELSE RD = -.5
*27141        TOT.LINE = TOT.LINE: SPACE(30):OCONV(INT(DEPT.CO.COST/100+RD),"MD0Z") "R#6 "
        TOT.LINE = TOT.LINE: SPACE(30):OCONV(INT(DEPT.CO.COST/100+RD),"MD0Z") "R#7 " ;*27141
        IF DEPT.CO.VAR > 0 THEN RD=.5 ELSE RD=-.5
*27141        TOT.LINE = TOT.LINE: OCONV(INT(DEPT.CO.VAR/100+RD),"MD0Z") "R#6"
        TOT.LINE = TOT.LINE: OCONV(INT(DEPT.CO.VAR/100+RD),"MD0Z") "R#7" ;*27141
        PRINT TOT.LINE
        LINE.CNT = LINE.CNT + 1
    END
    PRINT
    LINE.CNT = LINE.CNT + 1
    FOR K = 1 TO 6
        GRAND.TOT(K) = GRAND.TOT(K) + DEPT.TOT(K)
    NEXT K
    MAT DEPT.TOT = ""
    D.REG.DATE = ""; D.CO.DATE = ""
    RETURN
*
*---CONVERSIONS
*
5000*
    BEGIN CASE
        CASE QTY = "" OR QTY = 0
        CASE ICR.CNV = "MD0Z"
            QTY = OCONV(QTY,ICR.CNV)
        CASE 1
            PQTY = OCONV(QTY,ICR.CNV)
            BEGIN CASE
                CASE FIELD(PQTY,".",2) = 0
                    QTY = FIELD(PQTY,".",1)
                CASE LEN(PQTY) > 7
                    QTY = INT((PQTY / 100) + .5)
                CASE 1
                    QTY = PQTY
            END CASE
    END CASE
    RETURN
99999*
    PRINTER OFF
    RETURN
END
