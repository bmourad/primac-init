*********************************************************************
* REVISION   - [08.0]
* SYSTEM     - PRIMAC
* SOURCE     - JCSBP
* PROGRAM    - DAILY.REVERSE.PRT
* BY         - MARK TRAYWICK
* DATE       - 11/29/88
* DESCRIPTION- Prints Daily Reverse Edit Listing
* MOD TASK 19393  CLS 7/95  ADD DIVISION TO TITLE
* T26493 cmykleb 03/28/2002 * Change pgm to get report # from proc.
*T27146 epitka 12/24/2002 * SEE CSF 41256
*********************************************************************
*
*--- FILE EQU
*
*COPY>JCS.CPYLIB>DAILY.REVERSE
*COPY>CPYLIB>SYSCOM
*COPY>CPYLIB>CHAR
*COPY>ICS.CPYLIB>INV.CNV ;*27146
*COPY>ICS.CPYLIB>INVENTORY ;*27146
  DEFFUN CALC.STK.QTY(COST.QTY,MAT INV.CNV.REC,ROND,LN)
*
*--- SETUP SYSTEM ERROR MESSAGES
*
  SYS.TYPE = 1
  CALL SYSCOM(MAT SYSCOM.REC)
*
*--- INITIALIZE
*
  DSH=STR('-',20); SP = SPACE(1)
*
*--- PROC READ
*
  PROCREAD ID ELSE ERRMSG = "MUST RUN FROM PROC";GOTO 93000
  CONO=ID<1>; CO.NAME=ID<2>
  BDATE = ICONV(ID<3>,"D2/")
  EDATE = ICONV(ID<4>,"D2/")
  PROC.DIV = ID<5>
*
*--- OPEN FILES
*
  OPEN "DAILY.REVERSE" TO DAILY.REVERSE ELSE
    ERRMSG = "CAN'T OPEN DAILY.REVERSE"; GOTO 93000
  END
  ;*27146 v                                   
  OPEN '','INVENTORY' TO INVENTORY ELSE       
    ERRMSG="CAN'T OPEN INVENTORY"; GOSUB 93000
  END                                         
  ;*27146 ^                                   
*
*--- HEADING ROUTINE
*
*T26493 v
*  REPORT.NAME = "REVERSE EDIT LISTING"
*  REPORT.NUMBER = "XXXX"
  CO.NAME = ""
  REPORT.NAME = ""
  REPORT.NUMBER = ID<2>
*T26493 ^
  REPORT.DATE = DATE()
  HEAD1 = ''; HEAD2 = ''
  CALL GET.PROG.HEAD(CONO,CO.NAME,REPORT.NAME,REPORT.NUMBER,REPORT.DATE,HEAD1,HEAD2)
  HEAD1 = HEAD1:"'P''L'"
  HEAD3 = SPACE(52):OCONV(BDATE,"D2/"):" THROUGH ":OCONV(EDATE,"D2/"):" FOR DIV ":PROC.DIV:"'LL'"
  HEAD4 = "REV TRAN JOB NUM  RVS DATE TP DEPT  CCTR OPER / PRODUCT  EM/WH/VN JOB TRAN T COST/QTY  PRT DATE NO POST STATUS":"'L'"
  HEAD5=DSH[1,8]:SP:DSH[1,8]:SP:DSH[1,8]:SP:DSH[1,2]:SP:DSH[1,5]:SP:DSH[1,4]:SP:DSH[1,15]:SP:DSH[1,8]:SP:DSH[1,8]:SP:DSH[1,1]:SP:DSH[1,9]:SP:DSH[1,8]:SP:DSH[1,15]
  PRINTER ON
  PRINT CHAR(12)
  HEADING HEAD1:HEAD2:HEAD3:HEAD4:HEAD5
*
*--- MAIN PROCESSING
*
*     LOOP WHILE READNEXT ID DO
  EOF=0
  LOOP
    READNEXT ID ELSE EOF=1
  UNTIL EOF
    MATREAD DRV.REC FROM DAILY.REVERSE, ID ELSE MAT DRV.REC=''
    CNT = DCOUNT(DRV.OPER,VM)
    FOR LN = 1 TO CNT
      PLINE = ''
      IF LN = 1 THEN
        PLINE = ID[4,999]"L#8":SP
        PLINE = PLINE:DRV.JOB"L#8":SP
        PLINE = PLINE:OCONV(DRV.DATE,"D2/")"L#8":SP
        PLINE = PLINE:DRV.TYPE"R#2":SP
      END ELSE PLINE = SPACE(30)
*
      PLINE = PLINE:DRV.DEPT<1,LN>"L#5":SP
      PLINE = PLINE:DRV.CCTR<1,LN>"L#4":SP
      PLINE = PLINE:DRV.OPER<1,LN>"R#15":SP
      PLINE = PLINE:DRV.EMP<1,LN>"R#8":SP
      PLINE = PLINE:DRV.TRAN<1,LN>"R#8":SP
*
      IF LN = 1 THEN
        PLINE = PLINE:DRV.TTYPE"R#1":SP
      END ELSE PLINE = PLINE:SPACE(2)
      UM = DRV.CONV<1,LN>
      ;*27146 v                                                       
      IF DRV.TTYPE='C' THEN                                           
        PLINE = PLINE:OCONV(DRV.COST<1,LN>,"MD2")"R#9":SP             
      END ELSE                                                        
        INV.ID=CONO:DRV.OPER<1,LN>                                    
        MATREAD INV.REC FROM INVENTORY,INV.ID THEN                    
*COPY>ICSBP>INV.UM.CNV                                              
          TMP=CALC.STK.QTY(DRV.COST<1,LN>,MAT INV.CNV.REC,'','')
          TMP=OCONV(TMP,ICR.CNV)
          PLINE:=TMP"R#9":SP                                          
        END                                                           
      END                                                             
*            IF UM = "SHT" OR UM = "PC" OR UM = "FT" THEN           
*               PLINE = PLINE:DRV.QTY<1,LN>"R#9":SP                 
*            END ELSE                                               
*               IF DRV.TTYPE = "C" THEN                             
*                  PLINE = PLINE:OCONV(DRV.COST<1,LN>,"MD2")"R#9":SP
*               END ELSE                                                   
*                  PLINE = PLINE:OCONV(INT((DRV.COST<1,LN>+5)/10),"MD2")"R#9":SP
*               END   
*            END      
      ;* 27146 ^        
      IF LN = 1 THEN
        PLINE = PLINE:OCONV(DRV.PRINT,"D2/")"R#8":SP
        PLINE = PLINE:DRV.STATUS<1,LN>"R#15"
      END
      PRINT PLINE
    NEXT LN
  REPEAT
  GOTO 99999
*
*--- SYSCOM CALLS
91000 *
  ERR.TYPE = 1
  CALL SYSCOM(MAT SYSCOM.REC)
  RETURN
93000 *
  ERR.TYPE = 3
  CALL SYSCOM(MAT SYSCOM.REC)
99999 *
  PRINTER OFF
END
