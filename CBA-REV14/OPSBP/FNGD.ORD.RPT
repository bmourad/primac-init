*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - ICSBP
* PROGRAM     - FNGD.ORD.RPT
* BY          - JULIANNE RIVERA, VERCOM SOFTWARE, INC
* DATE        - 03/23/92
* DESCRIPTION -
*T26493 cmykleb 03/27/2002 * Change report to read rpt # from the proc.
*ENDDOC
*********************************************************************
*
*COPY>ICS.CPYLIB>INVENTORY
*COPY>ICS.CPYLIB>FNGD.ORDER.STATS
*COPY>ICS.CPYLIB>INV.CNV
*COPY>PMC.CPYLIB>CUSTOMER
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*
*
*---- OPEN FILES
*
   OPEN '','FNGD.ORDER.STATS' TO FNGD.ORDER.STATS ELSE ERRMSG = "FNGD.ORDER.STATS IS MISSING"; GOTO 93000
   OPEN '','CUSTOMER' TO CUSTOMER ELSE ERRMSG = "CUSTOMER IS MISSING"; GOTO 93000
   OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = "CONTROL IS MISSING"; GOTO 93000
   OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = "COMPANY IS MISSING"; GOTO 93000
   OPEN '','INVENTORY' TO INVENTORY ELSE ERRMSG = "INVENTORY IS MISSING"; GOTO 93000
*
*---- DEFINE HEADINGS
*
   PROCREAD BUFFER ELSE
      ERRMSG = 'CANNOT PERFORM PROCREAD'
      GOTO 93000
   END
   CONO = BUFFER<1>
   RPT.TYPE = BUFFER<8>
*T26493 v
*  CONO.NAME = BUFFER<2>
*  IF RPT.TYPE = "S" THEN
*     REPORT.NAME = "FINISHED GOODS ORDER SUMMARY REPORT"
*  END ELSE
*     REPORT.NAME = "FINISHED GOODS ORDER DETAIL REPORT"
*  END
*  REPORT.NUMBER = "XXXX"
   CONO.NAME = ""
   REPORT.NAME = ""
   REPORT.NUMBER = BUFFER<2>
   IF RPT.TYPE = "S" THEN
      HD3 = SPACE(69):"S U M M A R Y"
   END ELSE
      HD3 = SPACE(69):"D E T A I L"
   END
*T26493 ^
   REPORT.DATE = DATE()
   HD1 = "" ; HD2 = ""
   CALL GET.PROG.HEAD(CONO,CONO.NAME,REPORT.NAME,REPORT.NUMBER,REPORT.DATE,HD1,HD2)
   IF RPT.TYPE = "S" THEN
      S.HD1 = "            PRODUCT / DESCRIPTION               ORDERED   RESERVED   ALLOCATED BACK ORDER"
      S.UN1 = "--------------------------------------------- ---------- ---------- ---------- ----------"
   END ELSE
      S.HD1 = "            PRODUCT / DESCRIPTION             CUST/NAME ORDER # ORD DATE    JOB NUMBER    ORDERED   RESERVED   ALLOCATED BACK ORDER" 
      S.UN1 = "--------------------------------------------- --------- ------- --------    ----------- ---------- ---------- ---------- ----------"
      S.UN2 = SPACE(88):"---------- ---------- ---------- ----------"
      S.FT2 = SPACE(54):"TOTAL FOR PRODUCT "
   END
*
*---- INITIALIZATION
*
   FIRST.REC = 1
   LINE.CNT = 99
   UNKNOWN = STR('?',30)
   SP1 = SPACE(1)
   PAGE.NO = 0
   PREV.WHSE = ""
   PREV.PRODNUM = ""
   PREV.PLINE = ""
   PREV.DESC = ""
   TOT.ALOC = 0
   TOT.ORD = 0
   TOT.RESV = 0
   TOT.BO = 0
   PRT.PROD = 0
   PRINTER ON
*
*---- MAIN PROCESSING 
*
   READNEXT ID ELSE GOTO 99999
   ORDNUM = FIELD(ID,"!",3)
   PRODNUM = FIELD(ID,"!",1)[4,99]
   WHSE = FIELD(ID,"!",2)
   WHSE = FIELD(WHSE,"!",1)
   PREV.PRODNUM = PRODNUM
   PREV.WHSE = WHSE
   MATREAD INV.REC FROM INVENTORY, CONO:PRODNUM ELSE
      MAT INV.REC = ""
   END
   PREV.PLINE = INV.LINE
   GOSUB 1000
   DONE = 0
   LOOP
      ORDNUM = FIELD(ID,"!",3)
      PRODNUM = FIELD(ID,"!",1)[4,99]
      WHSE = FIELD(ID,"!",2)
      WHSE = FIELD(WHSE,"!",1)
      MATREAD FOS.REC FROM FNGD.ORDER.STATS, ID ELSE
         MAT FOS.REC = ""
      END
      MATREAD CUST.REC FROM CUSTOMER, CONO:FOS.CUST ELSE CUST.NAME = UNKNOWN
      MATREAD INV.REC FROM INVENTORY, CONO:PRODNUM ELSE
         MAT INV.REC = ""
         INV.FULL.DESC = UNKNOWN
      END
      BEGIN CASE
         CASE WHSE # PREV.WHSE OR INV.LINE # PREV.PLINE 
            IF RPT.TYPE = "D" THEN
               GOSUB 4000
            END ELSE
               GOSUB 600
            END
            GOSUB 1000
         CASE PREV.PRODNUM # PRODNUM 
            IF RPT.TYPE = "D" THEN
               GOSUB 4000
            END ELSE
               GOSUB 600
            END
            IF LINE.CNT > 55 THEN GOSUB 1000
         CASE LINE.CNT > 55
            GOSUB 1000
      END CASE
      GOSUB 2000
      GOSUB 500
   UNTIL DONE DO
      READNEXT ID ELSE   
         IF RPT.TYPE = "D" THEN      
            GOSUB 4000
         END ELSE
            GOSUB 600
         END
         GOTO 99999
      END
   REPEAT
   GOTO 99999
*
*---- PRINT DETAIL LINES
500 *
   BEGIN CASE
      CASE PRODNUM = PREV.PRODNUM AND RPT.TYPE = "D" AND NOT(FIRST.REC) AND NOT(PRT.PROD)
         LINE = SPACE(46)
         LINE2 = SPACE(46)
      CASE 1
         PRT.PROD = 0
         LINE = PRODNUM "L#15":SPACE(31)
         LINE2 = INV.FULL.DESC "L#45":SP1
         IF RPT.TYPE = "S" THEN GOTO 599
   END CASE
   FIRST.REC = 0
   LINE = LINE : FOS.CUST "L#8" :"  "
   LINE2 = LINE2 : CUST.NAME "L#30" 
   LINE = LINE : ORDNUM "L#7" :SP1
   LINE = LINE : OCONV(FOS.DATE,"D2/") "L#8" :SPACE(4)
   LINE = LINE : FOS.JOB<1,1> "L#11" : SP1
   LINE2 = LINE2 : FOS.JOB<1,2> "L#11" : SP1
   LINE = LINE : OCONV(INT(((FOS.O.QTY/ICR.DV1) * ICR.MT1) / ICR.DV2 +.5),ICR.CNV1) "R#10" :SP1
   LINE = LINE : OCONV(INT(((FOS.R.QTY/ICR.DV1) * ICR.MT1) / ICR.DV2  + .5),ICR.CNV1) "R#10" :SP1
   LINE = LINE : OCONV(INT(((FOS.A.QTY/ICR.DV1) * ICR.MT1) / ICR.DV2 +.5),ICR.CNV1) "R#10" :SP1 
   B.QTY = FOS.O.QTY - FOS.R.QTY - FOS.A.QTY - FOS.S.QTY
   IF B.QTY < 1 THEN B.QTY = 0
   LINE = LINE : OCONV(INT(((B.QTY/ICR.DV1) * ICR.MT1) / ICR.DV2 +.5),ICR.CNV1) "R#10" :SP1
   PRINT LINE
   PRINT LINE2
   LINE.CNT = LINE.CNT + 2
   JOBCNT = DCOUNT(FOS.JOB,VM)
   FOR X = 3 TO JOBCNT
      PRINT SPACE(77) : FOS.JOB<1,X> "L#11"
   NEXT X
599 *
   PREV.PRODNUM = PRODNUM
   PREV.WHSE = WHSE
   PREV.PLINE = INV.LINE
   TOT.ORD = TOT.ORD + FOS.O.QTY
   TOT.RESV = TOT.RESV + FOS.R.QTY
   TOT.ALOC = TOT.ALOC + FOS.A.QTY
   B.QTY = FOS.O.QTY - FOS.R.QTY - FOS.A.QTY - FOS.S.QTY
   IF B.QTY < 1 THEN B.QTY = 0
   TOT.BO = TOT.BO + B.QTY
   RETURN
*
*---- PRINT SUMMARY LINE
600 *
   LINE = LINE : OCONV(INT(((TOT.ORD/ICR.DV1) * ICR.MT1) / ICR.DV2  + .5),ICR.CNV1) "R#10" :SP1
   LINE = LINE : OCONV(INT(((TOT.RESV/ICR.DV1) * ICR.MT1) / ICR.DV2 +.5),ICR.CNV1) "R#10":SP1 
   LINE = LINE : OCONV(INT(((TOT.ALOC/ICR.DV1) * ICR.MT1) / ICR.DV2 +.5),ICR.CNV1) "R#10" :SP1 
   LINE = LINE : OCONV(INT(((TOT.BO/ICR.DV1) * ICR.MT1) / ICR.DV2 +.5),ICR.CNV1) "R#10" 
   PRINT LINE
   PRINT LINE2
   LINE.CNT = LINE.CNT + 2
   TOT.ALOC = 0
   TOT.ORD = 0
   TOT.RESV = 0
   TOT.BO = 0
   RETURN
*** PRINT HEADINGS
1000 *
   PRINT CHAR(12)
   PAGE.NO = PAGE.NO + 1
   PRINT HD1:PAGE.NO
   PRINT HD2
   PRINT HD3 ; * T26493
   PRINT "WAREHOUSE : ":WHSE "L#8"
   PRINT "MLINE / PLINE : FNGD / ":INV.LINE
   PRINT
   PRINT S.HD1
   PRINT S.UN1
   PRT.PROD = 1
   LINE.CNT = 8
   RETURN
*
*---- CONVERSION
2000 *
*COPY>ICSBP>INV.UM.CNV
   RETURN
*
*---- PRINT TOTALS
*
4000 *
   LINE = OCONV(INT(((TOT.ORD/ICR.DV1) * ICR.MT1) / ICR.DV2  + .5),ICR.CNV1) "R#10" :SP1
   LINE = LINE : OCONV(INT(((TOT.RESV/ICR.DV1) * ICR.MT1) / ICR.DV2 +.5),ICR.CNV1) "R#10" :SP1 
   LINE = LINE : OCONV(INT(((TOT.ALOC/ICR.DV1) * ICR.MT1) / ICR.DV2 +.5),ICR.CNV1) "R#10" :SP1 
   LINE = LINE : OCONV(INT(((TOT.BO/ICR.DV1) * ICR.MT1) / ICR.DV2 +.5),ICR.CNV1) "R#10" 
   PRINT S.UN2
   PRINT S.FT2:PREV.PRODNUM"L#15":SP1:LINE
   PRINT
   LINE.CNT = LINE.CNT + 3
   TOT.ALOC = 0
   TOT.ORD = 0
   TOT.RESV = 0
   TOT.BO = 0
   RETURN
91000 PRINT @(0,23) : ERRMSG : CL :
   INPUT X :
   PRINT @(0,23) : CL :
   RETURN
93000 PRINT @(0,23) : ERRMSG : CL :
   INPUT X :
   PRINT @(0,23) : CL :
99999 PRINTER OFF
END
