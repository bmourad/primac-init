      SUBROUTINE SCREEN_TRN_SET(STKD_ID,IDDEF,IMGDEF,TRN_FILE,ERRMSG)
*COPY>CPYLIB>COM1
*COPY>JIS.CPYLIB>SYS_TKT_DEF
*COPY>JIS.CPYLIB>SYS_FIELDS
*COPY>CPYLIB>TCC
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*
*---- Setup
*
      ERRMSG = ""
*
      IDCNT = DCOUNT(IDDEF,AM)
      BEGIN CASE
      CASE IDCNT < 1
         ERRMSG = "There is no Item ID fields to transfer"
         GOTO 99999
      CASE IDCNT > 2
         ERRMSG = "Complex Item ID definition"
         GOTO 99999
      CASE IDCNT = 1
      CASE IDDEF<1> # "CO"
         ERRMSG = "Company not included in Item ID"
      END CASE
*
      FLDCNT = DCOUNT(IMGDEF,AM)
      IF FLDCNT < 1 THEN
         ERRMSG = "There is no data fields to transfer"
         GOTO 99999
      END
*
*---- Get transfer criteria if any
*
      IF STKD_ID = "" THEN
         MAT STKD.REC = ""
      END ELSE
         MATREAD STKD.REC FROM SYS_TKT_DEF, STKD_ID ELSE
            MAT STKD.REC = ""
         END
      END
*
*---- Verify transfer DICT and DATA file
*
      FILENAME = STKD_ID:"_TRN"
      OPEN "",FILENAME TO TRN_FILE ELSE
         ERRMSG = "Cannot open ":FILENAME:" file"
         GOTO 99999
      END
      OPEN "DICT",FILENAME TO DICT_TRN_FILE ELSE
         ERRMSG = "Cannot open Dict ":FILENAME:" file"
         GOTO 99999
      END
*
*---- Clear old records
*
      MORE = 1
      SELECT TRN_FILE
      LOOP
         READNEXT ID ELSE MORE = 0
      WHILE MORE DO
         READU ITEM FROM TRN_FILE, ID THEN
            DELETE TRN_FILE, ID
         END ELSE
            RELEASE TRN_FILE, ID
         END
      REPEAT
*
*---- Setup DICT records
*
      ID = IDDEF<1>
      IF ID = "CO" THEN
         MATREAD DFD.REC FROM SYS_FIELDS, ID THEN
            ITEM = "D"
            ITEM<2> = FLDCNT + 1
            ITEM<3> = "";*FLD_CNV<FLD_FNO<FLDLOC>>
            ITEM<4> = ID
            ITEM<5> = DFD_LEN:DFD_JUSTIFY
            WRITE ITEM ON DICT_TRN_FILE, ID
            ID = IDDEF<2>
            MATREAD DFD.REC FROM SYS_FIELDS, ID THEN
               ITEM = "D"
               ITEM<2> = FLDCNT + 2
               ITEM<3> = "";*FLD_CNV<FLD_FNO<FLDLOC>>
               ITEM<4> = ID
               ITEM<5> = DFD_LEN:DFD_JUSTIFY
               WRITE ITEM ON DICT_TRN_FILE, ID
            END ELSE
               ERRMSG = "Cannot locate Item ID definition # ":ID
            END
         END ELSE
            ERRMSG = "Cannot locate Item ID definition # ":ID
         END
      END ELSE
         MATREAD DFD.REC FROM SYS_FIELDS, ID THEN
            ITEM = "D"
            ITEM<2> = FLDCNT + 1
            ITEM<3> = "";*FLD_CNV<FLD_FNO<FLDLOC>>
            ITEM<4> = ID
            ITEM<5> = DFD_LEN:DFD_JUSTIFY
            WRITE ITEM ON DICT_TRN_FILE, ID
         END ELSE
            ERRMSG = "Cannot locate Item ID definition # ":ID
         END
      END
*
      FOR FNO = 1 TO FLDCNT
         ID = IMGDEF<FNO>
         IF ID[1,1] = "@" THEN
            ORG_ID = FIELD(ID,"@",2)
            ID = "_":ORG_ID:"_":FIELD(ID,"@",3)
         END ELSE
            ORG_ID = ID
         END
         MATREAD DFD.REC FROM SYS_FIELDS, ORG_ID THEN
            ITEM = "D"
            ITEM<2> = FNO
            ITEM<3> = "";*FLD_CNV<FLD_FNO<FLDLOC>>
            ITEM<4> = ID
            ITEM<5> = DFD_LEN:DFD_JUSTIFY
            IF DFD_LVL = "M" OR DFD_LVL = "V" THEN
               ITEM<6> = "M"
            END
            WRITE ITEM ON DICT_TRN_FILE, ID
         END ELSE
            ERRMSG = "Cannot locate field definition # ":ORG_ID
         END
      NEXT FNO
*
*---- Verify transfer PC file
*
      IF PC.PORT.TYPE # " wIntegrate" THEN
         GOTO 99999
      END
      IF STKD_TRN_PCFILE # "" THEN
      END
*
*---- Verify if application is valid/running
*
      IF STKD_PC_APL # "" THEN
*
*---- Verify the PC file
*
         IF STKD_APL_PCFILE # "" THEN
         END
      END
*
*---- End of program
99999*
END
