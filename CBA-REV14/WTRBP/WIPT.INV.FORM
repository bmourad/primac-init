*********************************************************************
*
* PROGRAM  - WIPT.INV.FORM
*
* AUTHOR   - NICK AMENDOLA, NASTech, Inc.
*
* DATE     - 09/22/95
*
* DESCRIPTION
*
* This program produces the WIP Inventory Tracking report by Job,
* Customer and Form.
*
*T22322 ct6 01/19/1998 * Add WIP Tracking to Bawden with Modifications.
*                        Add a flag for INSERTS Y/N/B.
*T26395 lhelms 01/23/2002 * WHEN SELECTING A SPECIFIC ITEM PROGRAM
*                           ERRORS
*T25978 adelgado 03/28/2002 * Add the use of prompts (S,SR,SB,ST).
*T26493 cmykleb 04/04/2002 * Change pgm to get the rpt # from the proc
*                            and use GET.PROG.HEAD for the heading.
*********************************************************************
*
*---- COPY STATEMENTS
*
*COPY>CPYLIB>COM1
*COPY>PMC.CPYLIB>COMPANY
*COPY>CPYLIB>EDIT.COM.DRIVER
*COPY>JCS.CPYLIB>JOB
*COPY>PMC.CPYLIB>CUSTOMER
*COPY>WTR.CPYLIB>WIP.TRACK.JOB
*COPY>WTR.CPYLIB>WIP.TRACK.FORM
*COPY>WTR.CPYLIB>WIP.TRACK.PALLET
*COPY>CPYLIB>XREF.DATA
*COPY>CPYLIB>GEN.XREF.SUB
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*COPY>CPYLIB>SYSCOM
   MAT SYSCOM.REC =  ""; SYS.TYPE = 2
*T26493 v
*
*---- READ FROM PROC
*
   PROCREAD BUFFER ELSE
      ERRMSG = "MUST RUN FROM A PROC"
      GOSUB 90000
      GOTO 99999
   END
   SEL.JOB = BUFFER<3>
   SEL.CUST = BUFFER<4>
   SEL.FORM = BUFFER<5>
   SEL.FNUM = BUFFER<5>
   SEL.INS.FLAG = BUFFER<6>
   CUST.NAME = BUFFER<4>
*T26493 ^
*
*---- DEFINE ARRAY STORAGE
*
   DIM STOT(10)               ;* SUB TOTALS
*
*---- OPEN ALL FILES
*
   OPEN "","COMPANY" TO COMPANY ELSE
      ERRMSG = "CANNOT OPEN COMPANY FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","CONTROL" TO CONTROL ELSE
      ERRMSG = "CANNOT OPEN CONTROL FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","PREFIX" TO PREFIX ELSE
      ERRMSG = "CANNOT OPEN PREFIX FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","XREF.DATA" TO XREF.DATA ELSE
      ERRMSG = "CANNOT OPEN XREF.DATA FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","JOB" TO JOB ELSE
      ERRMSG = "CANNOT OPEN JOB FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","CUSTOMER" TO CUSTOMER ELSE
      ERRMSG = "CANNOT OPEN CUSTOMER FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","CUSTOMER.XREF" TO CUSTOMER.XREF ELSE
      ERRMSG = "CANNOT OPEN CUSTOMER.XREF FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","WTR.SCREENS" TO M.SCREENS ELSE
      ERRMSG = "CANNOT OPEN WTR.SCREENS FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","WIP.TRACK.CONTROL" TO WIP.TRACK.CONTROL ELSE
      ERRMSG = "CANNOT OPEN WIP.TRACK.CONTROL FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","WIP.TRACK.JOB" TO WIP.TRACK.JOB ELSE
      ERRMSG = "CANNOT OPEN WIP.TRACK.JOB FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","WIP.TRACK.FORM" TO WIP.TRACK.FORM ELSE
      ERRMSG = "CANNOT OPEN WIP.TRACK.FORM FILE"
      GOSUB 90000
      GOTO 99999
   END
   OPEN "","WIP.TRACK.PALLET" TO WIP.TRACK.PALLET ELSE
      ERRMSG = "CANNOT OPEN WIP.TRACK.PALLET FILE"
      GOSUB 90000
      GOTO 99999
   END
*
*---- INITIALIZATION
*
   CONO = ""
   MAT COMP.REC = ""
   CALL GET.CONO (CONO, MAT COMP.REC)
   IF CONO = "END" THEN GOTO 99999
   MAT GEN.XREF.REC = ""
   GXR.CO = CONO
*
*---- INITIALIZE SCRN.EDIT
*
*T26493 v
*  MAT SCV.REC = ""
*  MAT EDIT.COM.DRIVER = ""
*  ECD.SCRN.CNT = 1
*  ECD.SCRN.NAME<1> = "WIPT.INV.FORM"
*  ECD.ACTION=1; CALL SCRN.EDIT
*  ECD.SCRN.NO = 1
*  ESN = ECD.SCRN.NO
*  ECD.ACTION=2; CALL SCRN.EDIT
*T26493 ^
*
*---- DEFINE HEADINGS
*
*T26493 v
*  REPORT.NAME = "W I P   I N V E N T O R Y   B Y   J O B"
*  TODAY = DATE()
*  CTIME = TIME()
*  IF CTIME < 10 THEN TODAY = DATE()
*  PTIME = OCONV(CTIME,"MTH")
*  PTIME = PTIME[1,5]:" ":PTIME[6,2]
*  HD1A = "RUN: ":OCONV(TODAY,"D2/"):" @ ":PTIME
*  HD1B = SPACE((90-LEN(CO.NAME))/2):CO.NAME
*  HD1C = "PAGE "
*  HD1 = HD1A"L#30":HD1B"L#90":HD1C"R#30"
*  HD2 = SPACE((150-LEN(REPORT.NAME))/2):REPORT.NAME
   CONO.NAME = ""
   REPORT.NAME = ""
   REPORT.NUMBER = BUFFER<2>
   HD1 = "" ; HD2 = ""
   CALL GET.PROG.HEAD(CONO,CONO.NAME,REPORT.NAME,REPORT.NUMBER,"",HD1,HD2)
*T26493 ^
   SH1 = "                          To     WIP               Consumed"
   SH2 = " Form    Pallet #  Skid  CCtr  Quantity  Location  Quantity"   
   SH3 = "-------  --------  ----  ----  --------  --------  --------"
   ST1 = "                              ---------           ---------"
   SH1 = SH1:"  <------ Last Move ----->                    "    
   SH2 = SH2:"    Date      Time    Emp    Loc. 2    Loc. 3 "
   SH3 = SH3:"  --------  --------  ----  --------  --------"
   SH1 = SH1:"                                          "
   SH2 = SH2:"  Description "
*T26493 v
*  SH3 = SH3:"  --------------------------"
   SH3 = SH3:"  ----------------------"
*
*---- INITIALIZE VARIABLES
*
   SP1 = SPACE(1)
   SP2 = SPACE(2)
   SP3 = SPACE(3)
*T26493 v
*  LM = SPACE(3)
   LM = SPACE(0)
*T26493 ^
   BEGIN.PAGE = 8
   PAGE.SIZE = 12
   LINE.SPACE = 1
   OLD.START = 0
   SEL.VNUM = ""
*T26493 v
*  SEL.JOB = "ALL"
*  SEL.CUST = "ALL"
*  SEL.FORM = "ALL"
*  SEL.FNUM = "ALL"
*  SEL.INS.FLAG = "B"
   ESN = ""
   FLIST = ""
   JOBSFX = ""
   GOSUB 70000
   GOTO 99999
*T26493 ^
   GOTO 110
*
*---- MAIN PROCESSING
*
100 *
   ECD.ACTION=6; CALL SCRN.EDIT
   MAT SCV.REC = ""
110 *
   SCV.REC(1)<ESN> = DATE()
   ECD.NUM=1; ECD.ACTION=5; CALL SCRN.EDIT
   GOSUB 1010
   IF ECD.RET.VALUE = "END" THEN GOTO 99999
   IF SEL.JOB = "ALL" THEN
      GOSUB 1020
      IF ECD.RET.VALUE = "END" THEN GOTO 100
   END
   IF JOB.CUST = "" THEN
      MAT CUST.REC = ""
   END ELSE
      SEL.CUST = JOB.CUST
      MATREAD CUST.REC FROM CUSTOMER, CONO:SEL.CUST ELSE
         MAT CUST.REC = ""
         CUST.NAME = "???????????????"
      END
      SCV.REC(3)<ESN> = SEL.CUST
      SCV.REC(4)<ESN> = CUST.NAME
      ECD.NUM=3; ECD.ACTION=5; CALL SCRN.EDIT
      ECD.NUM=4; ECD.ACTION=5; CALL SCRN.EDIT
   END
   GOSUB 80000
   LINES = DCOUNT(JOB.DESC,VM)
   LN = 1
   OLD.START = 0
   GOSUB 50000
   GOSUB 1030
*T22322v
   GOSUB 1040
*T22322^
   IF ECD.RET.VALUE = "END" THEN GOTO 100
*
*---- GET OPERATOR REQUEST
*
500 *
   SCV.REC(21)<ESN> = ""
   ECD.NUM=21; ECD.ACTION=4; CALL SCRN.EDIT
   OPTION = ECD.RET.VALUE
   BEGIN CASE
      CASE OPTION = "E" OR OPTION = 'END'
         GOTO 100
      CASE OPTION = "S"
         LN = LN + PAGE.SIZE
         IF LN > LINES THEN LN = 1
         GOSUB 50000
    * T25978 v
      CASE OPTION = "SR"
         LN = LN - PAGE.SIZE
         IF LN < 1 THEN LN = 1
         GOSUB 50000
      CASE OPTION = "ST"
         LN = 1
         GOSUB 50000
      CASE OPTION = "SB"
         LN = LINES
         GOSUB 50000
    * T25978 ^
      CASE OPTION = "F"
         GOSUB 70000
         IF PRINT.CNT > 0 THEN
            ERRMSG = "** COMPLETED **"
         END ELSE
            ERRMSG = "** NO ITEMS PRINTED **"
         END
         GOSUB 90000
         GOTO 100
   END CASE
   GOTO 500
*
*---- GET JOB NUMBER
*
1010 *
   JOBSFX = ""
   SCV.REC(2)<ESN> = ""
   ECD.NUM=2; ECD.ACTION=4; CALL SCRN.EDIT
   BEGIN CASE
      CASE ECD.RET.VALUE = "END"
         RETURN
      CASE ECD.RET.VALUE = "ALL"
         SEL.JOB = "ALL"
         MAT JOB.REC = ""
         MAT WIPTF.REC = ""
         RETURN
      CASE ECD.RET.VALUE[LEN(ECD.RET.VALUE),1] = "*"
         JOBSFX = "*"
         SEL.JOB = ECD.RET.VALUE[1,LEN(ECD.RET.VALUE)-1]
         MAT JOB.REC = ""
         MAT WIPTF.REC = ""
         RETURN
      CASE ECD.RET.VALUE = ""
         GOSUB 1020
         IF ECD.RET.VALUE = "END" THEN GOTO 1010
         GXR.NAME = "JOB"
         GXR.XREF = CUSTOMER
         GXR.FILE = JOB
         GXR.SRCH.ID = SEL.CUST
         CALL JOB.XREF.SUB(MAT GEN.XREF.REC, PREFIX, XREF.DATA)
         ECD.ACTION=2; CALL SCRN.EDIT
         GOSUB 80050
         IF GXR.ID = "" THEN GOTO 1010
         ECD.RET.VALUE = GXR.ID
   END CASE
   MATREAD WIPTJ.REC FROM WIP.TRACK.JOB, CONO:ECD.RET.VALUE ELSE
      ERRMSG = "No form(s) found for specified job. Try again! "
      GOSUB 90000
      GOTO 1010
   END
   SEL.JOB = ECD.RET.VALUE
   MATREAD JOB.REC FROM JOB, CONO:SEL.JOB THEN
      IF JOB.CUST # WIPTJ.CUST THEN 
         MATREADU WIPTJ.REC FROM WIP.TRACK.JOB, CONO:SEL.JOB THEN
            WIPTJ.CUST = JOB.CUST
            MATWRITE WIPTJ.REC ON WIP.TRACK.JOB, CONO:SEL.JOB
         END ELSE
            RELEASE WIP.TRACK.JOB, CONO:SEL.JOB
         END
      END
   END ELSE 
      MAT JOB.REC = ""
   END
   RETURN
*
*---- GET CUSTOMER ID
*
1020 *
   ECD.NUM=3; ECD.ACTION=4; CALL SCRN.EDIT
   BEGIN CASE
      CASE ECD.RET.VALUE = "END"
         RETURN
      CASE ECD.RET.VALUE = "ALL"
         MAT CUST.REC = ""
         SEL.CUST = "ALL"
         RETURN
      CASE ECD.RET.VALUE = ""
         ECD.NUM=4; ECD.ACTION=4; CALL SCRN.EDIT
         IF ECD.RET.VALUE = "END" THEN RETURN
         IF ECD.RET.VALUE = "" THEN RETURN
         GXR.NAME = "CUSTOMER"
         GXR.XREF = CUSTOMER.XREF
         GXR.FILE = CUSTOMER
         GXR.SRCH.ID = ECD.RET.VALUE
         CALL GEN.XREF.SUB(MAT GEN.XREF.REC, PREFIX, XREF.DATA)
         ECD.ACTION=2; CALL SCRN.EDIT
         GOSUB 80050
         IF GXR.ID = "" THEN GOTO 1010
         ECD.RET.VALUE = GXR.ID
   END CASE
   MATREAD CUST.REC FROM CUSTOMER, CONO:ECD.RET.VALUE ELSE
      ERRMSG = "Customer not on file. Try again! "
      GOSUB 90000
      GOTO 1010
   END
   SEL.CUST = ECD.RET.VALUE
   SCV.REC(3)<ESN> = SEL.CUST
   ECD.NUM=3; ECD.ACTION=5; CALL SCRN.EDIT
   SCV.REC(4)<ESN> = CUST.NAME
   ECD.NUM=4; ECD.ACTION=5; CALL SCRN.EDIT
   RETURN
*
*---- GET FORM NUMBER
*
1030 *
   SCV.REC(5)<ESN> = SEL.FORM
   ECD.NUM=5; ECD.ACTION=4; CALL SCRN.EDIT
   IF ECD.RET.VALUE = "END" THEN RETURN
   IF ECD.RET.VALUE = "ALL" THEN
      SEL.FORM = ECD.RET.VALUE
      FNUM = "ALL"
      VNUM = ""
      SNUM = ""
   END ELSE
      FORMNO = ECD.RET.VALUE; GOSUB 85100
      IF ERRMSG # "" THEN
         GOSUB 90000
         GOTO 1030
      END
      SEL.FORM = FORMNO
* T26395
      FNUM = FORMNO
   END
   SEL.FNUM = FNUM
   SEL.VNUM = VNUM
*T22322      SEL.SNUM = SNUM
   SCV.REC(5)<ESN> = SEL.FORM
   ECD.NUM=5; ECD.ACTION=5; CALL SCRN.EDIT
   RETURN
*T22322v
*
*---- Get Inserts Flag
*
1040 *
   SCV.REC(22)<ESN> = SEL.INS.FLAG
   ECD.NUM=22; ECD.ACTION=4; CALL SCRN.EDIT
   IF ECD.RET.VALUE = "END" THEN RETURN
   SEL.INS.FLAG = ECD.RET.VALUE
   SCV.REC(22)<ESN> = SEL.INS.FLAG
   ECD.NUM=22; ECD.ACTION=5; CALL SCRN.EDIT
   RETURN
*T22322^
*
*---- MULTI-LINE SCROLL ROUTINE
*
50000 *
   START.LINE = 1 + INT((LN-1)/PAGE.SIZE) * PAGE.SIZE
   LAST.LINE = START.LINE + PAGE.SIZE - 1
   IF LAST.LINE > LINES THEN LAST.LINE = LINES
   IF START.LINE = OLD.START THEN RETURN
   OLD.START = START.LINE
   CNT = 1
   FOR N = START.LINE TO LAST.LINE
      SLN = BEGIN.PAGE + LINE.SPACE * MOD(N-1,PAGE.SIZE)
*        PRINT @(00,SLN) : @(-4) : N "R#3" :
*        PRINT @(05,SLN) : JOB.DESC<1,N> "L#75" :
      P_X = 0 ; P_Y = SLN ; P_VALUE = N ; P_OPT = "CL"
      P_X := AM:5 ; P_Y := AM:SLN ; P_VALUE := AM:JOB.DESC<1,N> "L#75"
      CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
      CNT = CNT + 1
   NEXT N
   FOR N = CNT TO PAGE.SIZE
      SLN = BEGIN.PAGE + LINE.SPACE * MOD(N-1,PAGE.SIZE)
      P_X = 0 ; P_Y = 0 ; P_VALUE = '' ; P_OPT = "CL"
      CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
   NEXT N
   RETURN
*
*---- PRINT REPORT
*
70000 *
   LINE.COUNT = 99
   PAGE.NO = 0
   MAT STOT = 0
   PREV.JOB = "!@#$%"
   PREV.FORM = "!@#$%"
   PRINT.CNT = 0
   BREAK.CNT = 0
*T26493   PERFORM "TERM ,,160"
   PRINTER ON
*T26493   PRINT CHAR(27):"E":CHAR(27):"&l1O":
   IF SEL.JOB = "ALL" OR JOBSFX = "*" THEN
      CMD = "SSELECT WIP.TRACK.FORM" 
      CMD = CMD:" BY WIPTF.JOB"
      CMD = CMD:" BY WIPTF.FORM"
      CMD = CMD:" BY WIPTF.VER"
      CMD = CMD:' WITH CONO = "':CONO:'"'
      CMD = CMD:' AND WITH WIP.PALLET = "Y"'
      IF SEL.CUST # "ALL" THEN CMD = CMD:' AND WITH WIPTF.CUST = "':SEL.CUST:'"'
      IF SEL.FNUM # "ALL" THEN CMD = CMD:' AND WITH WIPTF.FORM = "':SEL.FNUM:'"'
      IF SEL.VNUM # "" THEN CMD = CMD:' AND WITH WIPTF.VNUM = "':SEL.VNUM:'"'
      PERFORM CMD RTNLIST FLIST CAPTURING SELMSG
      DONE = 0
      LOOP
         READNEXT ID FROM FLIST ELSE DONE = 1
      UNTIL DONE DO
         IF ID[1,3] = CONO THEN
            JOB.NO = FIELD(ID,"!",1)[4,99]
            IF SEL.JOB = "ALL" OR JOBSFX = "*" AND JOB.NO[1,LEN(SEL.JOB)] = SEL.JOB THEN
               FORM.NO = FIELD(ID,"!",2)
               FNUM = FIELD(FORM.NO,".",1)
               VNUM = FIELD(FORM.NO,".",2)
               SNUM = FIELD(FORM.NO,".",3)
               IF SEL.FNUM = "ALL" OR FNUM = SEL.FNUM THEN
                  IF SEL.VNUM = "" OR VNUM = SEL.VNUM THEN GOSUB 72000
               END
            END
         END
      REPEAT
   END ELSE
      JOB.NO = SEL.JOB
      MATREAD WIPTJ.REC FROM WIP.TRACK.JOB, CONO:JOB.NO THEN
         FCNT = DCOUNT(WIPTJ.FORM,VM)
         FOR FPTR = 1 TO FCNT
            FORM.NO = WIPTJ.FORM<1,FPTR>
            FNUM = FIELD(FORM.NO,".",1)
            VNUM = FIELD(FORM.NO,".",2)
            SNUM = FIELD(FORM.NO,".",3)
*T22322v
*               IF SEL.FNUM = "ALL" OR FNUM = SEL.FNUM THEN
*                  IF SEL.VNUM = "" OR VNUM = SEL.VNUM THEN
*                     IF SEL.SNUM = "" OR SNUM = SEL.SNUM THEN GOSUB 72000
*                  END
            IF SEL.FNUM = "ALL" OR FNUM = SEL.FNUM THEN
               IF SEL.VNUM = "" OR VNUM = SEL.VNUM THEN GOSUB 72000
*T22322^
            END
         NEXT FPTR
      END
   END
   IF PRINT.CNT > 0 THEN
      GOSUB 76000
      PRINT
      PRINT "END OF REPORT"
      PRINT CHAR(12):
   END ELSE
      JOB.NO = SEL.JOB
      GOSUB 79000
      PRINT
      PRINT "NO ITEMS SELECTED"
   END
*T26493   PRINT CHAR(27):"E":
   PRINTER OFF
   PRINTER CLOSE
   RETURN
*
*---- PROCESS JOB FORM
*
72000 *
   MATREAD WIPTF.REC FROM WIP.TRACK.FORM, CONO:JOB.NO:"!":FORM.NO THEN
      PCNT = DCOUNT(WIPTF.PALLET,VM)
      SORT.PAL.ID = ""
      FOR PPTR = 1 TO PCNT
         PAL.ID = WIPTF.PALLET<1,PPTR>
         MATREAD WIPTP.REC FROM WIP.TRACK.PALLET, CONO:PAL.ID THEN
*T22322v
            BEGIN CASE
               CASE SEL.INS.FLAG = "N" AND WIPTP.PTYPE = "I"
               CASE SEL.INS.FLAG = "Y" AND WIPTP.PTYPE # "I"
               CASE 1
*T22322^
                  SID = (1000+WIPTP.SKID):"!":PAL.ID
                  LOCATE SID IN SORT.PAL.ID<1>,1 BY "AL" SETTING PP ELSE NULL
                  SORT.PAL.ID = INSERT(SORT.PAL.ID,1,PP,0,SID)
*T22322v
            END CASE
*T22322^
         END
      NEXT PPTR
      PCNT = DCOUNT(SORT.PAL.ID,VM)
      FOR PPTR = 1 TO PCNT
         PAL.ID = FIELD(SORT.PAL.ID<1,PPTR>,"!",2)
         MATREAD WIPTP.REC FROM WIP.TRACK.PALLET, CONO:PAL.ID THEN
** COMPARE SEL.INS.FLAG WITH WIPTP.PTYPE ('I' = Insert)
            BEGIN CASE
               CASE JOB.NO # PREV.JOB
                  GOSUB 76000
                  MATREAD JOB.REC FROM JOB, CONO:JOB.NO THEN
                     MATREAD CUST.REC FROM CUSTOMER, CONO:JOB.CUST ELSE
                        MAT CUST.REC = ""
                        CUST.NAME = "??????????"
                     END
                  END ELSE
                     MAT JOB.REC = ""
                     MAT CUST.REC = ""
                  END
                  PREV.JOB = JOB.NO
                  PREV.FORM = FORM.NO
                  LINE.COUNT = 99
               CASE FORM.NO # PREV.FORM
                  GOSUB 76000
                  PREV.FORM = FORM.NO
            END CASE
            GOSUB 74000
         END
      NEXT PPTR
   END
   RETURN
*
*---- PRINT DETAIL LINE
*
74000 *
   BEGIN CASE
      CASE BREAK.CNT = 0 AND (LINE.COUNT + 1) = 42
         GOSUB 79000
*T22322v
*         PLINE = FORM.NO"L#14"
         PLINE = FORM.NO"L#7"
*T22322^
      CASE (LINE.COUNT + 1) > 42
         GOSUB 79000
         IF BREAK.CNT = 0 THEN
*T22322v
*            PLINE = FORM.NO"L#14"
            PLINE = FORM.NO"L#7"
*T22322^
         END ELSE
*T22322v
*            PLINE = "(cont'd)""L#14"
            PLINE = "(cont'd)""L#7"
*T22322^
         END
      CASE BREAK.CNT = 0 
*T22322v
*         PLINE = FORM.NO"L#14"
         PLINE = FORM.NO"L#7"
*T22322^
      CASE 1
*T22322v
*         PLINE = """L#14"
         PLINE = """L#7"
*T22322^
   END CASE
   PLINE = PLINE:SP2:PAL.ID"R#8"
   PLINE = PLINE:SP2:WIPTP.SKID"R#4"
*T22322v
*      PLINE = PLINE:SP2:WIPTP.TYPE"L#4"
   PLINE = PLINE:SP2:WIPTP.TO.OPER"L#4"
*T22322^
   PLINE = PLINE:SP2:OCONV(WIPTP.CQTY,"MD0Z,")"R#8"
   PLINE = PLINE:SP2:WIPTP.MLOC<1,1>"L#8"
   PLINE = PLINE:SP2:OCONV((WIPTP.IQTY-WIPTP.CQTY),"MD0Z,")"R#8"
   PLINE = PLINE:SP2:OCONV(WIPTP.MDATE<1,1>,"D2/")"R#8"
   PTIME = OCONV(WIPTP.MTIME<1,1>,"MTH")
   PTIME = PTIME[1,5]:" ":PTIME[6,2]
   PLINE = PLINE:SP2:PTIME"R#8"
   PLINE = PLINE:SP2:WIPTP.MEMP<1,1>"L#4"
   PLINE = PLINE:SP2:WIPTP.MLOC<1,2>"L#8"
   PLINE = PLINE:SP2:WIPTP.MLOC<1,3>"L#8"
*T26493 v
*  PLINE = PLINE:SP2:WIPTP.DESC[1,25]
   PLINE = PLINE:SP2:WIPTP.DESC[1,24]
*T26493 ^
   PRINT LM:PLINE
   LINE.COUNT = LINE.COUNT + 1
*
   IF NUM(WIPTP.CQTY) THEN STOT(1) = STOT(1) + WIPTP.CQTY
   IF NUM(WIPTP.CQTY) THEN STOT(2) = STOT(2) + (WIPTP.IQTY-WIPTP.CQTY)
   PRINT.CNT = PRINT.CNT + 1
   BREAK.CNT = BREAK.CNT + 1
   RETURN
*
*---- PRINT FORM SUB-TOTALS
*
76000 *
   IF BREAK.CNT > 0 THEN
      PRINT LM:ST1
*T22322v
*         TLINE = "                                    " 
*C39110  TLINE = "                             " 
      TLINE = "                             " 
*T22322^
      TLINE = TLINE:OCONV(STOT(1),"MD0,")"R#10"
      TLINE = TLINE:SPACE(10)
      TLINE = TLINE:OCONV(STOT(2),"MD0,")"R#10"
      PRINT LM:TLINE
      PRINT
      LINE.COUNT = LINE.COUNT + 3
      MAT STOT = 0
      BREAK.CNT = 0
   END
   RETURN
*
*---- PRINT HEADINGS
*
79000 *
   PRINT CHAR(12):
   PAGE.NO = PAGE.NO + 1
   PRINT HD1:PAGE.NO
   PRINT HD2
   PRINT
   PRINT
   PRINT "Job #: ":JOB.NO"L#8":SPACE(5):"Customer: ":CUST.NAME
   PRINT
   PRINT LM:SH1
   PRINT LM:SH2
   PRINT LM:SH3
   LINE.COUNT = 9
   RETURN
*
*---- DISPLAY SCREEN DATA
*
80000 *
   SCV.REC(1)<ESN> = DATE()
   SCV.REC(2)<ESN> = SEL.JOB
   SCV.REC(3)<ESN> = SEL.CUST
   SCV.REC(4)<ESN> = CUST.NAME
   SCV.REC(5)<ESN> = SEL.FORM
80050 *
   ECD.ACTION=3; CALL SCRN.EDIT
   RETURN
*
*---- FORMAT FORM NUMBER
*
85100 *
   ERRMSG = ""
   FNUM = FIELD(FORMNO,".",1)
   VNUM = FIELD(FORMNO,".",2)
*T22322      SNUM = FIELD(FORMNO,".",3)
   BEGIN CASE
      CASE NUM(FNUM)
         BEGIN CASE
            CASE FNUM = ""
               ERRMSG = 1
            CASE FNUM = 0
               ERRMSG = 1
*T22322v
*         CASE LEN(FNUM) > 4
            CASE LEN(FNUM) > 3
*T22322^
               ERRMSG = 1
            CASE 1
*T22322v
*            FNUM = (10000+FNUM)[2,4]
               FNUM = (1000+FNUM)[2,3]
*T22322^
               BEGIN CASE
*T22322v
*            CASE VNUM = "" AND SNUM = ""
                  CASE VNUM = ""
*T22322^
                     FORMNO = FNUM
*T22322            CASE VNUM = ""
*T22322               ERRMSG = 2
                  CASE VNUM = 0
                     ERRMSG = 2
                  CASE LEN(VNUM) > 3
                     ERRMSG = 2
                  CASE 1
                     VNUM = (1000+VNUM)[2,3]
*T22322               BEGIN CASE
*T22322               CASE SNUM = ""
                     FORMNO = FNUM:".":VNUM
*T22322               CASE SNUM = 0
*T22322                  ERRMSG = 3
*T22322               CASE LEN(SNUM) > 5
*T22322                  ERRMSG = 3
*T22322               CASE 1
*T22322                  SNUM = (100000+SNUM)[2,5]
*T22322                  FORMNO = FNUM:".":VNUM:".":SNUM
*T22322               END CASE
               END CASE
         END CASE
*T22322v
*T22322      CASE NUM(FNUM[2,99])
      CASE 1
*T22322         BEGIN CASE
*T22322         CASE LEN(FNUM) = 2
*T22322            FNUM = FNUM[1,1]:"00":FNUM[2,99]
*T22322            FORMNO = FNUM
*T22322         CASE LEN(FNUM) = 3
*T22322            FNUM = FNUM[1,1]:"0":FNUM[2,99]
*T22322            FORMNO = FNUM
*T22322         CASE LEN(FNUM) = 4
*T22322         CASE 1
         ERRMSG = 1
*T22322         END CASE
*T22322      CASE NUM(FNUM[3,99])
*T22322         BEGIN CASE
*T22322         CASE LEN(FNUM) = 3
*T22322            FNUM = FNUM[1,2]:"0":FNUM[3,99]
*T22322            FORMNO = FNUM
*T22322         CASE LEN(FNUM) = 4
*T22322         CASE 1
*T22322            ERRMSG = 1
*T22322         END CASE
   END CASE
   BEGIN CASE
      CASE ERRMSG = 1
*T22322v
*         ERRMSG = "Invalid form #, Try again! "
         ERRMSG = "Invalid version #, Try again! "
*T22322^
      CASE ERRMSG = 2
*T22322v
*         ERRMSG = "Invalid run #, Try again! "
         ERRMSG = "Invalid section #, Try again! "
*      CASE ERRMSG = 3
*         ERRMSG = "Invalid sig #, Try again! "
*T22322^
   END CASE
   RETURN
*
*---- ERROR ROUTINE
*
90000 ERR.TYPE=1;CALL SYSCOM(MAT SYSCOM.REC);RETURN
*
*---- END OF JOB
*
99999 *
END
