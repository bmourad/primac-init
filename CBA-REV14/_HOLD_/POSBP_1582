









  #####  #    #   ####   #    #  #####    ####    ####   #    #
    #    #    #  #    #  ##  ##  #    #  #       #    #  ##   #
    #    ######  #    #  # ## #  #    #   ####   #    #  # #  #
    #    #    #  #    #  #    #  #####        #  #    #  #  # #
    #    #    #  #    #  #    #  #       #    #  #    #  #   ##
    #    #    #   ####   #    #  #        ####    ####   #    #

Wed Jun 28 16:47:58 CDT 2006
######  #######  #####  ######  ######
#     # #     # #     # #     # #     #
#     # #     # #       #     # #     #
######  #     #  #####  ######  ######
#       #     #       # #     # #
#       #     # #     # #     # #
#       #######  #####  ######  #

POSBP/MISC.PO.MAINT                                                /vsi/cust/rev11/cbn/CBA-CBN/CBNBP/MISC.PO.MAINT
Printed for thompson at 06/28/2006 04:47:57PM

0001 SUBROUTINE MISC.PO.MAINT                                        <  
0002 *24955 ^                                                        <  
0003 *COPY>CPYLIB>COM1                                                  *COPY>CPYLIB>COM1
0004 *COPY>POS.CPYLIB>COM.MPO                                           *COPY>POS.CPYLIB>COM.MPO
0005 *COPY>POS.CPYLIB>COM.PO.INTRF                                      *COPY>POS.CPYLIB>COM.PO.INTRF
0006 **************************************************************     ************************************************************
0007 * REVISION    - [08.0]                                             * REVISION    - [08.0]

0019 * TASK 18746 RKB 1/25/95 import from DEV where accrue field wa     * TASK 18746 RKB 1/25/95 import from DEV where accrue field 
0020 * TASK 19404 10/22/95 by Bob Sherer - POS DIVISIONALIZATION        * TASK 19404 10/22/95 by Bob Sherer - POS DIVISIONALIZATION
0021 * CLS 5/96 - ADD VEND PHONE AND FAX                                * CLS 5/96 - ADD VEND PHONE AND FAX
0022 *                                                                  *
0023 *T23082 gat 07/20/1998 * FIX PO GUI PROBLEM                        *T23082 gat 07/20/1998 * FIX PO GUI PROBLEM
0024 *T23278 markt 10/21/1998 * Add check for divisional security    |  *T23225 bassem 09/10/1998 * Default Accrue field to 'Y' - Do
0025 *T24231 edvard 08/26/1999 * Added logic for requisitions        |  *                           user.
0026 *T25260 edvard 09/27/2000 * CHAGE THE FUNCITIONALITY OF DOLLAR  |  *T22746 cm 03/08/1999 * UPGRADE TO REV11B
0027 *                           THAT LIMIT CONTROLS ROUTING OF THE  |  *T23689 rik 03/08/1999 * AUTO ASSIGN 'N' TO MPO.ACCRUE (FOR 
0028 *T25463 lanny 10/16/2000 * Misc Po Maint & Receipts both call   |  *                        ACCRUAL).

0029 *                          MISC.VEND.STAT.UPDATE where the on-  <  
0030 *                          Receipt data is updated. This cause  <  
0031 *                          overwrite to receipt data if price   <  
0032 *                          from one receipt to another.         <  
0033 *T25861 bilal 05/30/2001 * Check flag to allow user to enter a  <  
0034 *                          requesition.                         <  
0035 *T25854 cm 06/13/2001 * Add duplicate function to program.      <  

0036 *T25858 edwin 06/14/01 * Add requestor field.                   <  
0037 *T25942 ajibaly 07/10/2001 * Change options to:                 <  
0038 *                         F- release for approval, H- put it o  <  
0039 *T26081 lanny 08/10/2001 * When coming from REQ INQ detail lin  <  
0040 *                          is retaining values from previous P  <  
0041 *                          qty/due date, etc.                   <  
0042 *T26152 alex 10/29/2001 * Set validation rule for the Accrue f  <  

0043 *                         based on the company POS setup.       <  
0044 *T25938 cmykleb 02/20/2002 * Add a duplicate function to PO's.  <  
0045 *T26126 adelgado 02/26/2002 * Implement the LOCKED clause for   <  
0046 *T26471 lross 03/11/2002 * Default new Vendor terms if Vend No  <  
0047 *                          REQS.                                <  
0048 *T25941 ajibaly 06/28/2002 * Add ability to email POs           <  
0049 *C40479 ajibaly 08/02/2002 * Make sure REQ -> PO process gets   <  

0050 *                            flag.                              <  
0051 *T26685 cmykleb 08/15/2002 * Check for divisional security for  <  
0052 *                            number in MISC.PO.IN.MAINT         <  
0053 *T27417 thompson 05/07/2003 * Not allow "F" OR "C" on inquiry.  <  
0054 *T27552 cmykleb 07/11/2003 * Correct error message problem.     <  
0055 *T27701 lross 09/11/2003 * Add SHIP.VIA XREF.                   <  
0056 *T27701 wyamout 10/01/2003 * REMOVE SHIP.VIA XREF FROM THE PRO  <  

0057 *                            HANDLED BY THE SCREEN SEE TASK 27  <  
0058 *                            DEFAULT SHIP.VIA TO VEND SHIP.VIA  <  
0059 *                            SEE CCP REV12 PROBLEM 15           <  
0060 *T27798 cmykleb 11/25/2003 * If a purchase requisition is on h  <  
0061 *                            the approver is a level 1 then al  <  
0062 *                            access to the requusution.         <  
0063 *T28244 lross 09/09/2004 * Delete requisition after Filing PO   <  

0064 *T28687 lross 10/11/2005 * Error in cost extension where per "  <  
0065 *T28715 wvaughan 04/20/2006 * Add the (C)ancel option           <  
0066 *ENDDOC                                                            *ENDDOC
0067 **************************************************************     ************************************************************
0068 **** INSERT FILES EQUATES                                          **** INSERT FILES EQUATES
0069 *COPY>POS.CPYLIB>MISC.PO                                           *COPY>POS.CPYLIB>MISC.PO
0070 *COPY>PMC.CPYLIB>TERMS                                             *COPY>PMC.CPYLIB>TERMS

0081 *COPY>CPYLIB>FILE.VARS                                             *COPY>CPYLIB>FILE.VARS
0082 *COPY>APS.CPYLIB>APS.FILE.VARS                                     *COPY>APS.CPYLIB>APS.FILE.VARS
0083 *COPY>CPYLIB>GEN.XREF.SUB                                          *COPY>CPYLIB>GEN.XREF.SUB
0084 *COPY>CPYLIB>SYSCOM                                                *COPY>CPYLIB>SYSCOM
0085 *COPY>CPYLIB>CHAR                                                  *COPY>CPYLIB>CHAR
0086 *24231 v                                                        <  
0087 *COPY>PMC.CPYLIB>SECURITY                                       <  
0088 *COPY>POS.CPYLIB>APP.REQ                                        <  
0089 DIM HOLD.APP.REQ.REC(20)                                        <  
0090 MAT APP.REQ.REC = ""                                            <  

0091 MAT HOLD.APP.REQ.REC = ""                                       <  
0092 *24231 ^                                                        <  
0093 **** SETUP FOR SYSTEM ERRMSGS                                      **** SETUP FOR SYSTEM ERRMSGS
0094 SYS.TYPE = 1                                                       SYS.TYPE = 1
0095 CALL SYSCOM(MAT SYSCOM.REC)                                        CALL SYSCOM(MAT SYSCOM.REC)
0096 PROCREAD BUFFER ELSE                                            <  
0097 ERRMSG = "MUST BE RUN FROM PROC"                                <  

0098 GOSUB 93000                                                     <  
0099 END                                                             <  
0100 * 25855 v                                                       <  
0101 IF BUFFER<1> = "PI" THEN                                        <  
0102 BUFFER<1> = "P"                                                 <  
0103 BUFFER<5> = "I"                                                 <  
0104 PROCWRITE BUFFER                                                <  

0105 POS.INQ = 1                                                     <  
0106 END ELSE                                                        <  
0107 POS.INQ = 0                                                     <  
0108 END                                                             <  
0109 * 25855 ^                                                       <  
0110 **** OPEN FILES                                                    **** OPEN FILES
0111 OPEN '','COMPANY' TO COMPANY ELSE                               <  

0112 ERRMSG = 'COMPANY FILE IS MISSING'                              <  
0113 GOTO 93000                                                      <  
0114 END                                                             <  
0115 OPEN '','CONTROL' TO CONTROL ELSE                               <  
0116 ERRMSG = 'CONTROL FILE IS MISSING'                              <  
0117 GOTO 93000                                                      <  
0118 END                                                             <  

0119 MAT COMP.REC = ''                                               <  
0120 CONO = ''                                                       <  
0121 CALL GET.CONO(CONO,MAT COMP.REC)                                <  
0122 IF CONO = 'END' THEN GOTO 99999                                 <  
0123 IF BUFFER<1> = "R" AND CO.PO.REQ.FLAG # "Y" THEN                <  
0124 ERRMSG = "Requisition system is not activated."                 <  
0125 GOSUB 91000                                                     <  

0126 GOSUB 99999                                                     <  
0127 END                                                             <  
0128 OPEN '','MISC.PO' TO MISC.PO ELSE                                  OPEN '','MISC.PO' TO MISC.PO ELSE
0129 ERRMSG = 'MISC.PO FILE IS MISSING'                                 ERRMSG = 'MISC.PO FILE IS MISSING'
0130 GOSUB 93000                                                        GOSUB 93000
0131 END                                                                END
0132 OPEN '','TERMS' TO TERMS ELSE                                      OPEN '','TERMS' TO TERMS ELSE

0139 END                                                                END
0140 OPEN '','SHIP.VIA' TO SHIP.VIA ELSE                                OPEN '','SHIP.VIA' TO SHIP.VIA ELSE
0141 ERRMSG = 'SHIP.VIA FILE IS MISSING'                                ERRMSG = 'SHIP.VIA FILE IS MISSING'
0142 GOTO 93000                                                         GOTO 93000
0143 END                                                                END
0144                                                                 >  OPEN '','COMPANY' TO COMPANY ELSE
0145                                                                 >  ERRMSG = 'COMPANY FILE IS MISSING'
0146                                                                 >  GOTO 93000
0147                                                                 >  END
0148 OPEN '','VEND' TO VEND ELSE                                        OPEN '','VEND' TO VEND ELSE

0151 END                                                                END
0152 OPEN '','POS.SCREENS' TO M.SCREENS ELSE                            OPEN '','POS.SCREENS' TO M.SCREENS ELSE
0153 ERRMSG = 'POS.SCREENS FILE IS MISSING'                             ERRMSG = 'POS.SCREENS FILE IS MISSING'
0154 GOTO 93000                                                         GOTO 93000
0155 END                                                                END
0156                                                                 >  OPEN '','CONTROL' TO CONTROL ELSE
0157                                                                 >  ERRMSG = 'CONTROL FILE IS MISSING'
0158                                                                 >  GOTO 93000
0159                                                                 >  END
0160 OPEN '','VENDOR.XREF' TO VENDOR.XREF ELSE                          OPEN '','VENDOR.XREF' TO VENDOR.XREF ELSE

0187 END                                                                END
0188 OPEN '','COST.CNTR' TO COST.CNTR ELSE        ;* Task 17919         OPEN '','COST.CNTR' TO COST.CNTR ELSE        ;* Task 17919
0189 ERRMSG = 'COST.CNTR FILE IS MISSING'                               ERRMSG = 'COST.CNTR FILE IS MISSING'
0190 GOTO 93000                                                         GOTO 93000
0191 END                                                                END
0192 * 25858 v                                                       <  
0193 IF POS.INQ THEN OPEN '','MISC.REQ' TO MISC.REQ ELSE             <  
0194 ERRMSG = 'MISC.REQ FILE IS MISSING' ; GOTO 93000                <  
0195 END                                                             <  
0196 * 25858 ^                                                       <  

0197 ***** GET COMPANY NAME                                             ***** GET COMPANY NAME
0198 *24231 v                                                        |  MAT COMP.REC = ''
0199 IF CO.PO.REQ.FLAG = "Y" THEN                                    |  PW = ''
0200 OPEN '','MISC.REQ' TO MISC.REQ ELSE ERRMSG = 'MISC.REQ FILE IS  |  CONO = ''
0201 OPEN '','APP.REQ' TO APP.REQ ELSE ERRMSG = 'APP.REQ FILE IS MI  |  CALL GET.CONO(CONO,MAT COMP.REC)
0202 OPEN '','SECURITY' TO SECURITY ELSE ERRMSG = 'SECURITY FILE IS  |  IF CONO = 'END' THEN GOTO 99999
0203 USER.ID = UPCASE(@LOGNAME)                                      <  
0204 END                                                             <  

0205 *24231 ^                                                        <  
0206 IF CO.APS.M.INTRF > 1 THEN                                         IF CO.APS.M.INTRF > 1 THEN
0207 OPEN '','VEND.STATS' TO VEND.STATS ELSE                            OPEN '','VEND.STATS' TO VEND.STATS ELSE
0208 ERRMSG = "VEND.STATS FILE IS MISSING" ; GOTO 93000                 ERRMSG = "VEND.STATS FILE IS MISSING" ; GOTO 93000
0209 END                                                                END
0210 OPEN '','VEND.PO.STATS' TO VEND.PO.STATS ELSE                      OPEN '','VEND.PO.STATS' TO VEND.PO.STATS ELSE
0211 ERRMSG = "VEND.PO.STATS FILE IS MISSING" ; GOTO 93000              ERRMSG = "VEND.PO.STATS FILE IS MISSING" ; GOTO 93000

0212 END                                                                END
0213 OPEN '','VEND.PROD.STATS' TO VEND.PROD.STATS ELSE                  OPEN '','VEND.PROD.STATS' TO VEND.PROD.STATS ELSE
0214 ERRMSG = "VEND.PROD.STATS FILE IS MISSING" ; GOTO 93000            ERRMSG = "VEND.PROD.STATS FILE IS MISSING" ; GOTO 93000
0215 END                                                                END
0216 END                                                                END
0217 *24231 v                                                        <  
0218 APPROVER.LIMIT = 99999999999                                    <  
0219 TOTAL.AMT = 0                                                   <  
0220 PW = ''                                                         <  
0221 *24231 ^                                                        <  

0222 DIV = "" ; *24953                                               <  
0223 *T26685 v                                                       <  
0224 READ SECURITY.REC FROM CONTROL, CONO:"DIV.SECURITY" ELSE        <  
0225 ERRMSG = "DIV.SECURITY RECORD NOT FOUND IN CONTROL FILE"        <  
0226 GOTO 93000                                                      <  
0227 END                                                             <  
0228 *T26685 ^                                                       <  

0229 **** SET UP GEN.XREF.REC                                           **** SET UP GEN.XREF.REC
0230 MAT EDIT.COM = ''                                               |  *** T22746 ***
0231                                                                 >  *  MAT EDIT.COM = ''
0232                                                                 >  *** T22746 ***
0233 MAT EDIT.COM.DRIVER = ''                                           MAT EDIT.COM.DRIVER = ''
0234 MAT GEN.XREF.REC = ''                                              MAT GEN.XREF.REC = ''
0235 GXR.CO = CONO                                                      GXR.CO = CONO
0236                                                                 >  *     GXR.HEADING<1,2> = 'DESCRIPTION'

0237                                                                 >  *     GXR.ATT<1,1> = 0
0238                                                                 >  *     GXR.ATT<1,2> = 1
0239                                                                 >  *     GXR.LEN<1,1> = 10
0240                                                                 >  *     GXR.LEN<1,2> = 30
0241 ***** MAIN PROCESSING                                              ***** MAIN PROCESSING
0242 MAT EDIT.COM.DRIVER = ''                                           MAT EDIT.COM.DRIVER = ''
0243 *24231 v                                                        |  ECD.SCRN.CNT = 2

0244 ECD.SCRN.CNT = 5                                                <  
0245 *24231 ^                                                        <  
0246 ECD.SCRN.NAME<1> = 'MISC.PO.MAINT'                                 ECD.SCRN.NAME<1> = 'MISC.PO.MAINT'
0247 ECD.SCRN.NAME<2> = 'MISC.PO.IN.MAINT'                              ECD.SCRN.NAME<2> = 'MISC.PO.IN.MAINT'
0248 ECD.SCRN.NAME<3> = 'MISC.REQ.MAINT'                             <  
0249 ECD.SCRN.NAME<4> = 'PO.REQ.LOG.INQ'                             <  
0250 ECD.SCRN.NAME<5> = 'MISC.PO.INQUIRY'                            <  

0251 *24231 ^                                                        <  
0252 * T23082                                                           * T23082
0253 *24231 v                                                        |  ECD.SCRN.NO = 1
0254 IF BUFFER<1> = "R" THEN                                         <  
0255 SCRN.NO = 3                                                     <  
0256 MENU.FLAG = "R"                                                 <  
0257 END ELSE                                                        <  

0258 IF POS.INQ THEN SCRN.NO = 5 ELSE SCRN.NO = 1                    <  
0259 MENU.FLAG = "P"                                                 <  
0260 END                                                             <  
0261 ECD.SCRN.NO = SCRN.NO                                           <  
0262 *24231 ^                                                        <  
0263 * T23082                                                           * T23082
0264 IF BUFFER<3> # "INQ" THEN ; * 24955                             <  

0265 ECD.ACTION=1;CALL SCRN.EDIT                                        ECD.ACTION=1;CALL SCRN.EDIT
0266 END ; * 24955                                                   <  
0267 GEN.DIV = '00'           ;* Task 17919                             GEN.DIV = '00'           ;* Task 17919
0268 GEN.DEPT = '00'                                                    GEN.DEPT = '00'
0269 GEN.CCTR = '000'                                                   GEN.CCTR = '000'
0270 GENERAL = 'GENERAL'                                                GENERAL = 'GENERAL'
0271 **** PRINT SCREEN                                                  **** PRINT SCREEN
0272 1*                                                                 1*

0273 *T26081  IF BUFFER<3> # "INQ" THEN    ; * 24955                 |  ECD.SCRN.NO = 1
0274 MAT SCV.REC = ""                                                   MAT SCV.REC = ""
0275 *T26081  END                          ; * 24955                 <  
0276 ECD.ACTION=6;CALL SCRN.EDIT                                        ECD.ACTION=6;CALL SCRN.EDIT
0277 ***** ENTER PO NUMBER                                              ***** ENTER PO NUMBER
0278 5*                                                                 5*
0279 DUPLICATED.PO = 0 ; * T25938                                    <  

0282 MPO.M.WHT = ''                                                     MPO.M.WHT = ''
0283 MISC.DIV.DESC = ""                                                 MISC.DIV.DESC = ""
0284 MISC.DEPT.DESC = ""                                                MISC.DEPT.DESC = ""
0285 MISC.CCTR.DESC = ""                                                MISC.CCTR.DESC = ""
0286 NEW = 0                                                            NEW = 0
0287 FIRST.TIME = 0    ;* T26152                                     <  
0288 *24231 v                                                        <  
0289 PORDER= 0                                                       <  
0290 REQ = 0                                                         <  
0291 *24231 ^                                                        <  

0292 OPTION = ''                                                        OPTION = ''
0293 *24955 v                                                        <  
0294 IF BUFFER<4>  # "" THEN                                         <  
0295 ECD.RET.VALUE = BUFFER<4>                                       <  
0296 BUFFER<4> = ""                                                  <  
0297 END ELSE                                                        <  
0298 *24955 ^                                                        <  
0299 IF NOT(POS.INQ) THEN ECD.DEFAULT = 'N'   ; * 25855              <  

0300 ECD.NUM = 5                                                        ECD.NUM = 5
0301 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
0302 END ; *24955                                                    <  
0303 MPO.CODE = ECD.RET.VALUE                                           MPO.CODE = ECD.RET.VALUE
0304 BEGIN CASE                                                         BEGIN CASE
0305 CASE ECD.RET.VALUE = 'END'                                         CASE ECD.RET.VALUE = 'END'
0306 GOTO 99999                                                         GOTO 99999
0307 CASE ECD.RET.VALUE = "N" AND NOT(POS.INQ) ; * 25855             |  CASE ECD.RET.VALUE = "N"
0308 NEW = 1                                                            NEW = 1

0309 *24231 v                                                        |  CASE ECD.RET.VALUE # ""
0310 IF MENU.FLAG = "R" THEN                                         |  MATREADU MPO.REC FROM MISC.PO, CONO:MPO.CODE ELSE
0311 MPO.STATUS<1,-1> = "Entered"                                    |  X = 0; Y = 21; TYP = 8; MAXL = 1
0312 MPO.ST.DATE<1,-1> = DATE()                                      |  *TEST       X = 0; Y = 23; TYP = 8; MAXL = 1
0313 MPO.PREV.APP<1,-1> = USER.ID                                    <  
0314 *T24953      MPO.WRIT.BY = USER.ID                              <  
0315 SCV.REC(48)<ECD.SCRN.NO,1> = MPO.STATUS                         <  

0316 ECD.NUM = 48 ; ECD.ACTION = 5 ; CALL SCRN.EDIT                  <  
0317 SCV.REC(49)<ECD.SCRN.NO,1> = OCONV(MPO.ST.DATE,"D2/")           <  
0318 ECD.NUM = 49 ; ECD.SCRN = 5 ; CALL SCRN.EDIT                    <  
0319 END                                                             <  
0320 *24231 ^                                                        <  
0321 *T25938 v                                                       <  
0322 CASE MENU.FLAG = "P" AND ECD.RET.VALUE = "D" AND NOT(POS.INQ)   <  

0323 ECD.NUM=60;ECD.ACTION=4;CALL SCRN.EDIT                          <  
0324 IF ECD.RET.VALUE = "END" OR ECD.RET.VALUE = "" THEN GOTO 5      <  
0325 DUP.PONO = ECD.RET.VALUE                                        <  
0326 MATREAD MPO.REC FROM MISC.PO, CONO:DUP.PONO ELSE                <  
0327 ERRMSG = "Miscellaneous PO # entered not on file"               <  
0328 GOSUB 91000                                                     <  
0329 GOTO 5                                                          <  

0330 END                                                             <  
0331 ECD.NUM=1;ECD.ACTION=4;CALL SCRN.EDIT                           <  
0332 MPO.CODE = ECD.RET.VALUE                                        <  
0333 BEGIN CASE                                                      <  
0334 CASE MPO.CODE = "END" OR MPO.CODE = ""                          <  
0335 GOTO 5                                                          <  
0336 CASE MPO.CODE = "N"                                             <  

0337 SCV.REC(5)<1> = MPO.CODE; ECD.NUM = 5; ECD.ACTION = 5; CALL SC  <  
0338 CASE MPO.CODE # ""                                              <  
0339 SCV.REC(5)<1> = MPO.CODE; ECD.NUM = 5; ECD.ACTION = 5; CALL SC  <  
0340 READ REC FROM MISC.PO, CONO:MPO.CODE THEN                       <  
0341 ERRMSG = "Micellaneous PO # already exists on file"             <  
0342 GOSUB 91000                                                     <  
0343 GOTO 5                                                          <  

0344 END                                                             <  
0345 MATBUILD SAV.REC FROM MPO.REC                                   <  
0346 END CASE                                                        <  
0347 DUPLICATED.PO = 1                                               <  
0348 MPO.DATE = DATE()                                               <  
0349 MPO.ST.DATE = DATE()                                            <  
0350 MPO.TOT.RECEVED = ""                                            <  

0351 MPO.DATE.RECVD = ""                                             <  
0352 MPO.LAST.RECV = ""                                              <  
0353 MPO.PRT.FLG = "Y"                                               <  
0354 MPO.TOT.OPEN = MPO.TOT.ONORD                                    <  
0355 MPO.TOT.CANCEL = ''                                             <  
0356 MPO.REC.QTY = ''                                                <  
0357 MPO.REC.DATE = ''                                               <  

0358 MPO.REC.PER = ''                                                <  
0359 MPO.PREV.RECEVED = ''                                           <  
0360 MPO.LAST.RECV = ''                                              <  
0361 GOSUB 15                                                        <  
0362 DCNT = DCOUNT(MPO.DEL.DATE<1>,VM)                               <  
0363 FOR D = 1 TO DCNT                                               <  
0364 MPO.DEL.DATE<1,D> = MPO.DUE.DATE                                <  

0365 NEXT D                                                          <  
0366 *T25938 ^                                                       <  
0367 *T25854 v                                                       <  
0368 CASE MENU.FLAG="R" AND ECD.RET.VALUE="D" AND NOT(POS.INQ) ;*25  <  
0369 GOTO DUPE.SUB                                                   <  
0370 *T25854 ^                                                       <  
0371 CASE ECD.RET.VALUE # "" AND NOT(POS.INQ)  ; * 25855             <  

0372 *24231 v                                                        <  
0373 *C38358 Do not lock record at this point.                       <  
0374 * T26126 v                                                      <  
0375 MATREADU MPO.REC FROM MISC.PO, CONO:MPO.CODE LOCKED             <  
0376 ERRMSG = 'P/O record is locked by user - ':GETUSERNAME(STATUS(  <  
0377 GOSUB 91000;GOTO 5                                              <  
0378 END THEN                                                        <  

0379 * T26126 ^                                                      <  
0380 IF MENU.FLAG = "R" THEN                                         <  
0381 ERRMSG = "PO with number ":MPO.CODE: " already exists"          <  
0382 GOSUB 91000; RELEASE MISC.PO,CONO:MPO.CODE                      <  
0383 GOTO 5                                                          <  
0384 END                                                             <  
0385 PORDER = 1  ; * this is a purchase order since found in PO fil  <  

0386 END ELSE                                                        <  
0387 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0388 MATREAD MPO.REC FROM MISC.REQ, CONO:MPO.CODE THEN               <  
0389 IF MENU.FLAG = "P" THEN                                         <  
0390 ERRMSG = "Requisition with number ":MPO.CODE:" already exists"  <  
0391 GOSUB 91000 ; RELEASE MISC.REQ,CONO:MPO.CODE ; GOTO 5           <  
0392 END                                                             <  

0393 REQ = 1 ; * this is still requisition                           <  
0394 END                                                             <  
0395 END                                                             <  
0396 END                                                             <  
0397 *C38258 v                                                       <  
0398 IF REQ THEN                                                     <  
0399 IF BUFFER<3> = 'INQ' THEN                                       <  

0400 MATREAD MPO.REC FROM MISC.REQ, CONO:MPO.CODE ELSE MAT MPO.REC   <  
0401 END ELSE                                                        <  
0402 * T26126 v                                                      <  
0403 MATREADU MPO.REC FROM MISC.REQ, CONO:MPO.CODE LOCKED            <  
0404 ERRMSG = 'P/O record is locked by user - ':GETUSERNAME(STATUS(  <  
0405 GOSUB 91000;GOTO 5                                              <  
0406 END ELSE                                                        <  

0407 MAT MPO.REC = ''                                                <  
0408 END                                                             <  
0409 * T26126 ^                                                      <  
0410 END                                                             <  
0411 END ELSE                                                        <  
0412 * T26126 v                                                      <  
0413 MATREADU MPO.REC FROM MISC.PO, CONO:MPO.CODE LOCKED             <  

0414 ERRMSG = 'P/O record is locked by user - ':GETUSERNAME(STATUS(  <  
0415 GOSUB 91000;GOTO 5                                              <  
0416 END ELSE                                                        <  
0417 MAT MPO.REC = ''                                                <  
0418 END                                                             <  
0419 * T26126 ^                                                      <  
0420 END                                                             <  

0421 *C38258 ^                                                       <  
0422 IF MPO.APP.LEVEL = "C" THEN                                     <  
0423 IF (REQ) THEN                                                   <  
0424 ERRMSG = "Requisition: ":MPO.CODE:" was cancelled. Cannot make  <  
0425 GOSUB 91000                                                     <  
0426 END ELSE                                                        <  
0427 ERRMSG = "PO ":MPO.CODE:" was cancelled. You cannot make any c  <  

0428 GOSUB 91000                                                     <  
0429 END                                                             <  
0430 END                                                             <  
0431 IF NOT(PORDER) AND NOT(REQ) THEN                                <  
0432 *24231 ^                                                        <  
0433 X = 0; Y = 22; TYP = 8; MAXL = 1                                <  
0434 PMSG = MPO.CODE:" IS NOT ON FILE. DO YOU WANT TO ADD (Y/N)"        PMSG = MPO.CODE:" IS NOT ON FILE. DO YOU WANT TO ADD (Y/N)"

0435 CALL EDIT.SUB                                                      CALL EDIT.SUB
0436 P_X  = 0 ; P_Y = 22 ; P_VALUE = "" ; P_OPT = "CL"               |  P_X  = 0 ; P_Y = 21 ; P_VALUE = "" ; P_OPT = "CL"
0437 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
0438 IF VALUE = "Y" THEN                                                IF VALUE = "Y" THEN
0439 NEW = 1                                                            NEW = 1
0440 *24231 v                                                        <  
0441 IF MENU.FLAG = "R" THEN                                         <  
0442 REQ = 1                                                         <  

0443 END ELSE                                                           END ELSE
0444 PORDER = 1                                                      <  
0445 END                                                             <  
0446 *24231 ^                                                        <  
0447 END ELSE                                                        <  
0448 RELEASE MISC.PO, CONO:MPO.CODE                                     RELEASE MISC.PO, CONO:MPO.CODE
0449 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0450 RELEASE MISC.REQ, CONO:MPO.CODE  ; *24231                       <  

0451 END                                                             <  
0452 GOTO 5                                                             GOTO 5
0453 END                                                                END
0454 END                                                                END
0455 *T23278 v                                                       <  
0456 IF NOT(NEW) THEN                                                <  
0457 DIV.CODE = MPO.DIV.OWNER; USER.ID = UPCASE(@LOGNAME); ERRMSG =  <  

0458 CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)               <  
0459 IF ERRMSG # '' THEN                                             <  
0460 GOSUB 91000; SCV.REC(5)<1,1> = ''; GOTO 5                       <  
0461 END                                                             <  
0462 *24231 v                                                        <  
0463 IF MENU.FLAG = "R" THEN                                         <  
0464 *25260 v                                                        <  

0465 ;* moved the logic to subroutine so it can be reused            <  
0466 USER= USER.ID; DIV.OWNER = MPO.DIV.OWNER; APP.REQ.ID = ""       <  
0467 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  
0468 VALID = RET.FLAG                                                <  
0469 *25260 ^                                                        <  
0470 IF NOT(VALID) THEN                                              <  
0471 ERRMSG = "Profile for user ":USER.ID:" is either missing or is  <  

0472 GOSUB 91000                                                     <  
0473 GOTO 5                                                          <  
0474 END                                                             <  
0475 END                                                             <  
0476 END                                                             <  
0477 *24231 ^                                                        <  
0478 *T23278 ^                                                       <  

0479 CASE POS.INQ                ; * 25855                           <  
0480 MPO.CODE = ECD.RET.VALUE                                        <  
0481 MATREAD MPO.REC FROM MISC.PO, CONO:MPO.CODE ELSE                <  
0482 MATREAD MPO.REC FROM MISC.REQ, CONO:MPO.CODE ELSE               <  
0483 ERRMSG = "PO with number ":MPO.CODE:" not found"                <  
0484 GOSUB 91000; GOTO 5                                             <  
0485 END                                                             <  

0486 END                                                             <  
0487 DIV.CODE=MPO.DIV.OWNER ; USER.ID=UPCASE(@LOGNAME) ; ERRMSG=""   <  
0488 CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)               <  
0489 IF ERRMSG # '' THEN GOSUB 91000 ; SCV.REC(5)<1,1> = '' ; GOTO   <  
0490 END CASE                                                           END CASE
0491 IF NEW THEN                                                        IF NEW THEN
0492 FIRST.TIME = 1    ;* T26152                                     <  

0493 *24231 v                                                        <  
0494 IF MENU.FLAG = "R" THEN                                         <  
0495 REQ  = 1                                                        <  
0496 FOR S = 1 TO 14 UNTIL ECD.RET.VALUE = "END"                        FOR S = 1 TO 14 UNTIL ECD.RET.VALUE = "END"
0497 ON S GOSUB 80,9,10,12,15,20,27,30,35,40,45,50,60,70  ; *25858   <  
0498 NEXT S                                                          <  
0499 END ELSE                                                        <  

0500 PORDER = 1                                                      <  
0501 *24231 ^                                                        <  
0502 FOR S = 1 TO 14 UNTIL ECD.RET.VALUE = "END"                     <  
0503 ON S GOSUB 80,9,10,12,15,20,25,30,35,40,45,50,60,70                ON S GOSUB 80,9,10,12,15,20,25,30,35,40,45,50,60,70
0504 NEXT S                                                             NEXT S
0505 END  ; * 24231                                                  <  
0506 FIRST.TIME = 0    ;* T26152                                     <  

0507 IF ECD.RET.VALUE = "END" THEN                                      IF ECD.RET.VALUE = "END" THEN
0508 *24231 v                                                        |  IF MPO.CODE # "N" THEN RELEASE MISC.PO, CONO:MPO.CODE
0509 *  IF MPO.CODE # "N" THEN RELEASE MISC.PO, CONO:MPO.CODE        <  
0510 IF MPO.CODE # "N" THEN                                          <  
0511 RELEASE MISC.PO, CONO:MPO.CODE                                  <  
0512 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0513 RELEASE MISC.REQ, CONO:MPO.CODE                                 <  
0514 END                                                             <  

0515 END                                                             <  
0516 *24231 ^                                                        <  
0517 *24955 v                                                        <  
0518 IF BUFFER<3> = "INQ" THEN                                       <  
0519 ECD.ACTION = 99 ; CALL SCRN.EDIT                                <  
0520 GOSUB 99999                                                     <  
0521 END ELSE                                                        <  

0522 *24955 ^                                                        <  
0523 GOTO 1                                                             GOTO 1
0524 END ; * 24955                                                   <  
0525 END                                                                END
0526 END ELSE                                                           END ELSE
0527 GOSUB 1020                                                         GOSUB 1020
0528 GOSUB 1000                                                         GOSUB 1000

0527 GOSUB 1020                                                         GOSUB 1020
0528 GOSUB 1000                                                         GOSUB 1000
0529 ECD.ACTION = 3; CALL SCRN.EDIT                                     ECD.ACTION = 3; CALL SCRN.EDIT
0530 END                                                                END
0531 ***** ENTER OPTIONS                                                ***** ENTER OPTIONS
0532 *                                                               <  
0533 95 * ; * T25854                                                 <  
0534 IF NOT(NEW) AND MENU.FLAG = "R" THEN                            <  
0535 *25260 v                                                        <  
0536 INQ.MODE = 0                                                    <  

0537 IF USER.ID # MPO.APPROVER THEN                                  <  
0538 BEGIN CASE                                                      <  
0539 CASE APP.PO.LEVEL > 1                                           <  
0540 LOCATE USER.ID IN MPO.PREV.APP<1> SETTING POS ELSE              <  
0541 INQ.MODE = 1                                                    <  
0542 PROMPT.NBR =  54                                                <  
0543 END                                                             <  

0544 *T27798     CASE APP.PO.LEVEL = 1                               <  
0545 *T27798        IF MPO.LEVEL.STATUS='H' AND MPO.APP.LEVEL#1 THE  <  
0546 *T27798           INQ.MODE=1                                    <  
0547 *T27798           PROMPT.NBR = 54                               <  
0548 *T27798        END                                              <  
0549 END CASE                                                        <  
0550 END                                                             <  

0551 IF NOT(INQ.MODE) THEN                                           <  
0552 IF MPO.APP.LEVEL < APP.PO.LEVEL OR MPO.APP.LEVEL = "C" THEN     <  
0553 IF APP.PO.LEVEL = 1 AND MPO.APP.LEVEL # "C" THEN                <  
0554 PROMPT.NBR = 52                                                 <  
0555 END ELSE                                                        <  
0556 PROMPT.NBR = 54 ; * only inquiry                                <  
0557 END                                                             <  

0558 END ELSE                                                        <  
0559 BEGIN CASE                                                      <  
0560 CASE USER.ID=MPO.APPROVER OR APP.PO.LEVEL = 1 OR MPO.APPROVER=  <  
0561 PROMPT.NBR = 52                                                 <  
0562 CASE 1                                                          <  
0563 PROMPT.NBR = 51                                                 <  
0564 END CASE                                                        <  

0565 END                                                             <  
0566 END                                                             <  
0567 END                                                             <  
0568 ;*25260 ^                                                       <  
0569 IF (NEW)  OR MENU.FLAG = "P" THEN                               <  
0570 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0571 IF APP.PO.LEVEL = 1 THEN                                        <  

0572 PROMPT.NBR = 52                                                 <  
0573 END ELSE                                                        <  
0574 IF POS.INQ THEN PROMPT.NBR = 58 ELSE PROMPT.NBR = 31 ; *25855   <  
0575 END                                                             <  
0576 END ELSE                                                        <  
0577 PROMPT.NBR = 57                                                 <  
0578 END                                                             <  

0579 END                                                             <  
0580 *                                                               <  
0581 MORE = 1                                                           MORE = 1
0582 LOOP                                                               LOOP
0583 *  ECD.NUM = 31 ; 24231                                         |  *   IF MPO.PRT.FLG = 'N' THEN
0584 ECD.NUM = PROMPT.NBR   ; *24231                                 |  *     ECD.NUM = 40
0585                                                                 >  *   END ELSE

0586                                                                 >  ECD.NUM = 31
0587                                                                 >  *   END
0588 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
0589 OPTION = ECD.RET.VALUE                                             OPTION = ECD.RET.VALUE
0590 BEGIN CASE                                                         BEGIN CASE
0591 CASE OPTION = 'END' OR OPTION = 'E'                                CASE OPTION = 'END' OR OPTION = 'E'
0592 *24231 v                                                        |  IF MPO.CODE # "N" THEN RELEASE MISC.PO, CONO:MPO.CODE

0593 *      IF MPO.CODE # "N" THEN RELEASE MISC.PO, CONO:MPO.CODE    |  MORE = 1
0594 IF MPO.CODE # "N" THEN                                          <  
0595 RELEASE MISC.PO, CONO:MPO.CODE                                  <  
0596 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0597 RELEASE MISC.REQ, CONO:MPO.CODE                                 <  
0598 END                                                             <  
0599 END                                                             <  

0600 *24231 ^                                                        <  
0601 MORE = 0                                                        <  
0602 CASE NUM(OPTION)                                                   CASE NUM(OPTION)
0603 IF REQ THEN                                                     <  
0604 ON OPTION GOSUB 9,10,12,15,20,27,25,30,35,40,45,50,60,70  ; *2  <  
0605 END ELSE                                                        <  
0606 ON OPTION GOSUB 9,10,12,15,20,25,30,35,40,45,50,60,70              ON OPTION GOSUB 9,10,12,15,20,25,30,35,40,45,50,60,70

0607 END                                                             |  MORE = 0
0608 CASE OPTION = 'N'                                                  CASE OPTION = 'N'
0609 *T26685 v                                                       |  CALL MISC.PO.IN.MAINT(CONO,MPO.CODE)
0610 *           CALL MISC.PO.IN.MAINT(CONO,MPO.CODE)                |  ECD.SCRN.NO = 1
0611 CALL MISC.PO.IN.MAINT(CONO,MPO.CODE,SECURITY.REC)               <  
0612 *T26685 ^                                                       <  
0613 *      ECD.SCRN.NO = 1 ; * 24231                                <  

0614 ECD.SCRN.NO = SCRN.NO  ; *24231                                 <  
0615 GOSUB 1020                                                         GOSUB 1020
0616 PD.CNT = 0;LAST.DATE = ""                                       <  
0617 PD.CNT=DCOUNT(MPO.DEL.DATE,VM)                                  <  
0618 FOR PD = 1 TO PD.CNT                                            <  
0619 IF MPO.DEL.DATE<1,PD> > LAST.DATE THEN LAST.DATE=MPO.DEL.DATE<  <  
0620 NEXT PD                                                         <  

0621 MPO.DUE.DATE = LAST.DATE                                        <  
0622 SCV.REC(19)<ECD.SCRN.NO,1> = MPO.DUE.DATE                       <  
0623 ECD.ACTION=2;CALL SCRN.EDIT                                        ECD.ACTION=2;CALL SCRN.EDIT
0624 ECD.ACTION=3;CALL SCRN.EDIT                                        ECD.ACTION=3;CALL SCRN.EDIT
0625 *      MORE = 0                                                 <  
0626 *24231 v                                                        <  
0627 CASE OPTION = "A"                                               <  

0628 IF MPO.LEVEL.STATUS = "H" THEN                                  <  
0629 ERRMSG = "This requisition has not yet been released for appro  <  
0630 GOSUB  91000                                                    <  
0631 END ELSE                                                        <  
0632 *T36138 v                                                       <  
0633 * IF YOU ARE MAKING CHANGES TO THE FORM YOU HAVE TO MANUALY AD  <  
0634 * passwordAND TURN IT OFF SETTING VALUE TO 0                    <  

0635 * TO DO THIS EDIT PMCFORMS {record name} AND LOCATE THE FIELD   <  
0636 * AND ADD IT TO THE END OF THE ATTRIBUTE. FOR PROMPT IT IS FIE  <  
0637 *IF SHOULD LOOK SOMETHING LIKE THIS                             <  
0638 * 1ªª_pmc70                                                     <  
0639 *x_lenªchar_colªchar_rowªchar_lengthªhelp_stringªcursorªuser_d  <  
0640                                                                 <  
0641 *riableª13n9n27n1551ªª8ª0ª21ª8ªª_IBEAM.CURªª0                   <  

0642 *                                                               <  
0643 P_FIELDS ="_pmc70"                                              <  
0644 P_ATTRS = "password"                                            <  
0645 P_VALUES = 1                                                    <  
0646 ERROR = ""                                                      <  
0647 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
0648 IF ERROR THEN                                                   <  

0649 ERRMSG = ERROR                                                  <  
0650 GOSUB 91000                                                     <  
0651 END                                                             <  
0652 *36138 ^                                                        <  
0653 ECD.NUM = 56 ; ECD.ACTION = 4 ; CALL SCRN.EDIT                  <  
0654 IF ECD.RET.VALUE = APP.CODE THEN                                <  
0655 IF APP.PO.LEVEL = 1 THEN                                        <  

0656 MPO.STATUS<1,-1> = "APPROVED"                                   <  
0657 MPO.APP.LEVEL = APP.PO.LEVEL                                    <  
0658 MPO.APPROVER = ""                                               <  
0659 MPO.PREV.APP<1,-1> = USER.ID                                    <  
0660 MPO.ST.DATE<1,-1> = DATE()                                      <  
0661 *            REQ = 0 ; * this is not requisition any more       <  
0662 GOSUB 1000                                                      <  

0663 ECD.ACTION = 6 ; CALL SCRN.EDIT                                 <  
0664 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
0665 *T36138 v                                                       <  
0666 P_FIELDS = "_pmc70"                                             <  
0667 P_ATTRS = "password"                                            <  
0668 P_VALUES = 0                                                    <  
0669 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  

0670 IF ERROR THEN                                                   <  
0671 ERRMSG = ERROR                                                  <  
0672 GOSUB 91000                                                     <  
0673 END                                                             <  
0674 GOSUB 60                                                        <  
0675 *T36138 ^                                                       <  
0676 PROMPT.NBR = 52                                                 <  

0677 *****                                                           <  
0678 END ELSE                                                        <  
0679 MPO.STATUS<1,-1> = "Lvl ":APP.PO.LEVEL<1>:" Apr"                <  
0680 MPO.ST.DATE<1,-1> = DATE()                                      <  
0681 MPO.PREV.APP<1,-1> = USER.ID                                    <  
0682 MPO.APP.LEVEL = APP.PO.LEVEL                                    <  
0683 *T36138 v                                                       <  

0684 GOSUB 1000                                                      <  
0685 ECD.ACTION = 6 ; CALL SCRN.EDIT                                 <  
0686 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
0687 P_FIELDS = "_pmc70"                                             <  
0688 P_ATTRS = "password"                                            <  
0689 P_VALUES = 0                                                    <  
0690 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  

0691 IF ERROR THEN                                                   <  
0692 ERRMSG = ERROR                                                  <  
0693 GOSUB 91000                                                     <  
0694 END                                                             <  
0695 *T36138 ^                                                       <  
0696 LOOP                                                            <  
0697 ERRMSG = "You have to change Approver Id for the next level"    <  

0698 GOSUB 91000                                                     <  
0699 *                                                               <  
0700 GOSUB 90 ; * enter approver id                                  <  
0701 UNTIL ECD.RET.VALUE # "END" DO REPEAT                           <  
0702 PROMPT.NBR = 51                                                 <  
0703 END                                                             <  
0704 END ELSE                                                        <  

0705 ERRMSG = "Invalid Approval Code. "                              <  
0706 GOSUB 91000                                                     <  
0707 *T36138 v                                                       <  
0708 P_FIELDS = "_pmc70"                                             <  
0709 P_ATTRS = "password"                                            <  
0710 P_VALUES = 0                                                    <  
0711 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  

0712 IF ERROR THEN                                                   <  
0713 ERRMSG = ERROR                                                  <  
0714 GOSUB 91000                                                     <  
0715 END                                                             <  
0716 *T36138 ^                                                       <  
0717 END                                                             <  
0718 END                                                             <  

0719 CASE OPTION = "CA"                                              <  
0720 GOSUB CHOOSE.APPROVER ; * 25260                                 <  
0721 CASE OPTION = "L"                                               <  
0722 ECD.SCRN.NO = 4                                                 <  
0723 STATUS = MPO.STATUS                                             <  
0724 ST.DATE = MPO.ST.DATE                                           <  
0725 USER = MPO.PREV.APP                                             <  

0726 CALL PO.REQ.LOG.INQ(STATUS, ST.DATE, USER)                      <  
0727 ECD.SCRN.NO = SCRN.NO                                           <  
0728 ECD.ACTION=2;CALL SCRN.EDIT                                     <  
0729 *      GOSUB 1000                                               <  
0730 ECD.ACTION=3;CALL SCRN.EDIT                                     <  
0731 CASE OPTION = "C" AND POS.INQ = 0                               <  
0732 X = 0; Y = 22; TYP = 18; MAXL = 1; O.R = "R"                    <  

0733 PMSG = "Do you really want to cancel this requisition (Y/N) ?"  <  
0734 CALL EDIT.SUB                                                   <  
0735 P_X  = 0 ; P_Y = 22 ; P_VALUE = "" ; P_OPT = "CL"               <  
0736 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                           <  
0737 IF VALUE = "Y" THEN                                             <  
0738 MPO.STATUS<1,-1> = "Cancelled"                                  <  
0739 MPO.ST.DATE<1,-1> = DATE()                                      <  

0740 MPO.PREV.APP<1,-1> = USER.ID                                    <  
0741 MPO.APPROVER = ""                                               <  
0742 MPO.APP.LEVEL = "C"                                             <  
0743 MATWRITE MPO.REC ON MISC.REQ,CONO:MPO.CODE                      <  
0744 MORE = 0                                                           MORE = 0
0745 END                                                             |  CASE OPTION = 'F'
0746 *24231 ^                                                        <  

0747 *T25942         CASE OPTION = 'F' OR OPTION = "R"               <  
0748 *T27417         CASE OPTION = "F" OR OPTION = "H"               <  
0749 CASE (OPTION = "F" OR OPTION = "H") AND POS.INQ = 0             <  
0750 ;* F- release for approval, H- put it on hold                   <  
0751 GO.BACK = 0                                                     <  
0752 IF (MENU.FLAG = "R") THEN                                       <  
0753 *T25942               IF OPTION= "R" THEN                       <  

0754 IF OPTION= "F" THEN                                             <  
0755 IF DCOUNT(MPO.PROD.NUM,VM) > 0 THEN                             <  
0756 IF APP.PO.LEVEL # 1 THEN                                        <  
0757 IF APP.PO.LEVEL # CO.PO.APP.LEVELS THEN                         <  
0758 GOSUB ENT.APP.CODE                                              <  
0759 IF (CODE.OK) THEN                                               <  
0760 GOSUB CHOOSE.APPROVER                                           <  

0761 IF (SKIP.RELEASE) THEN                                          <  
0762 GO.BACK = 1                                                     <  
0763 END ELSE                                                        <  
0764 GOSUB SET.RELEASED ; * 25260                                    <  
0765 END                                                             <  
0766 END ELSE                                                        <  
0767 GO.BACK = 1                                                     <  

0768 END                                                             <  
0769 END ELSE                                                        <  
0770 GOSUB CHOOSE.APPROVER                                           <  
0771 IF (SKIP.RELEASE) THEN                                          <  
0772 GO.BACK = 1                                                     <  
0773 END ELSE                                                        <  
0774 GOSUB SET.RELEASED                                              <  

0775 END                                                             <  
0776 END                                                             <  
0777 END ELSE                                                        <  
0778 GOSUB ENT.APP.CODE                                              <  
0779 IF (CODE.OK) THEN                                               <  
0780 REQ = 0; * this is not a requisition any more                   <  
0781 GOSUB SET.RELEASED ; * 25260                                    <  

0782 END ELSE                                                        <  
0783 GO.BACK = 1                                                     <  
0784 END                                                             <  
0785 END                                                             <  
0786 END ELSE                                                        <  
0787 ERRMSG = "Cannot release requisition that does not have any pr  <  
0788 GOSUB 91000                                                     <  

0789 GO.BACK = 1                                                     <  
0790 END                                                             <  
0791 END ELSE                                                        <  
0792 IF APP.PO.LEVEL#CO.PO.APP.LEVELS THEN                           <  
0793 GOSUB ENT.APP.CODE                                              <  
0794 IF CODE.OK THEN                                                 <  
0795 GOSUB SET.ON.HOLD                                               <  

0796 END ELSE                                                        <  
0797 GO.BACK =1                                                      <  
0798 END                                                             <  
0799 END ELSE                                                        <  
0800 GOSUB SET.ON.HOLD                                               <  
0801 END                                                             <  
0802 END                                                             <  

0803 END                                                             <  
0804 IF NOT(GO.BACK) THEN                                            <  
0805 *24231 ^                                                        <  
0806 IF MPO.CODE = "N" THEN                                             IF MPO.CODE = "N" THEN
0807 READU MPO.NUMBER FROM CONTROL, CONO:"MPOCODE" ELSE MPO.NUMBER      READU MPO.NUMBER FROM CONTROL, CONO:"MPOCODE" ELSE MPO.NUMBE
0808 FND = 1                                                            FND = 1
0809 LOOP                                                               LOOP

0808 FND = 1                                                            FND = 1
0809 LOOP                                                               LOOP
0810 WHILE FND DO                                                       WHILE FND DO
0811 MPO.CODE = MPO.NUMBER                                              MPO.CODE = MPO.NUMBER
0812 MPO.NUMBER = MPO.CODE + 1                                          MPO.NUMBER = MPO.CODE + 1
0813 *24231 v                                                        <  
0814 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0815 READU REC FROM MISC.REQ, CONO:MPO.CODE  ELSE                    <  
0816 READU REC FROM MISC.PO, CONO:MPO.CODE ELSE                      <  
0817 FND = 0                                                         <  

0818 END                                                             <  
0819 END                                                             <  
0820 END ELSE                                                        <  
0821 *24231 ^                                                        <  
0822 READU REC FROM MISC.PO, CONO:MPO.CODE ELSE FND = 0                 READU REC FROM MISC.PO, CONO:MPO.CODE ELSE FND = 0
0823 END ; *24231                                                    <  
0824 REC = ""                                                           REC = ""

0825 *24231 v                                                        |  IF FND THEN RELEASE MISC.PO, CONO:MPO.CODE
0826 *            IF FND THEN RELEASE MISC.PO, CONO:MPO.CODE         <  
0827 IF FND THEN                                                     <  
0828 RELEASE MISC.PO, CONO:MPO.CODE                                  <  
0829 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0830 RELEASE MISC.REQ, CONO:MPO.CODE                                 <  
0831 END                                                             <  

0832 END                                                             <  
0833 *24231 ^                                                        <  
0834 REPEAT                                                             REPEAT
0835 WRITE MPO.NUMBER ON CONTROL, CONO:"MPOCODE"                        WRITE MPO.NUMBER ON CONTROL, CONO:"MPOCODE"
0836 ECD.NUM = 5; SCV.REC(ECD.NUM)<ECD.SCRN.NO> = MPO.CODE              ECD.NUM = 5; SCV.REC(ECD.NUM)<ECD.SCRN.NO> = MPO.CODE
0837 ECD.ACTION = 5; CALL SCRN.EDIT                                     ECD.ACTION = 5; CALL SCRN.EDIT
0838 IF MENU.FLAG = "R" THEN                                         |  ERRMSG = "Note new misc. PO number"; GOSUB 91000

0839 IF (REQ) THEN                                                   <  
0840 ERRMSG = "Note new requisition number"                          <  
0841 GOSUB 91000 ; * T27552                                          <  
0842 END                                                                END
0843 END ELSE                                                        <  
0844 ERRMSG = "Note new misc. PO number"                             <  
0845 GOSUB 91000 ; * T27552                                          <  

0846 END                                                             <  
0847 *T27552           GOSUB 91000                                   <  
0848 *T25260 v                                                       <  
0849 END ELSE                                                        <  
0850 *T25942           IF OPTION = "R" THEN                          <  
0851 IF OPTION = "F" AND MENU.FLAG = "R" THEN                        <  
0852 IF APP.PO.LEVEL # "1" THEN                                      <  

0853 ERRMSG = "Requisition forwarded to ":MPO.APPROVER               <  
0854 GOSUB 91000                                                     <  
0855 END                                                             <  
0856 END                                                             <  
0857 END                                                             <  
0858 *T25260 ^                                                       <  
0859 *T24231 v                                                       <  

0860 *T24953 v                                                       <  
0861 IF MENU.FLAG = "R" THEN                                         <  
0862 STATUS.CNT = DCOUNT(MPO.STATUS,VM)                              <  
0863 IF MPO.STATUS<1,STATUS.CNT> = "On-Hold" THEN                    <  
0864 ERRMSG = "Requsition has been placed on On-Hold status."        <  
0865 GOSUB 91000                                                     <  
0866 END                                                             <  

0867 END                                                             <  
0868 *T24953 ^                                                       <  
0869 *T24231 v                                                       <  
0870 IF (NEW) THEN                                                   <  
0871 MPO.APP.LEVEL = APP.PO.LEVEL                                    <  
0872 END                                                             <  
0873 IF MENU.FLAG = "R" THEN                                         <  

0874 IF (REQ) THEN                                                   <  
0875 WORK.FILE = MISC.REQ                                            <  
0876 UPDATE = "REQ"                                                  <  
0877 END ELSE                                                        <  
0878 IF APP.PO.LEVEL = 1 THEN                                        <  
0879 *T28244 v                                                       <  
0880 *                       CMD = 'DELETE MISC.REQ ':'"':CONO:MPO.  <  

0881 *                       UDTEXECUTE CMD CAPTURING MSG            <  
0882 WORK.FILE = MISC.PO                                             <  
0883 *T25260 v                                                       <  
0884 *                       ERRMSG = "New PO number " :MPO.CODE:"   <  
0885 *                       GOSUB 91000                             <  
0886 *T25260 ^                                                       <  
0887 *T28244 ^                                                       <  

0888 UPDATE  = "PO"                                                  <  
0889 END                                                             <  
0890 END                                                             <  
0891 END                                                             <  
0892 ;* C40479 v                                                     <  
0893 ;* Get accrue field if this PO doesnt have one                  <  
0894 ;* As in the case of coming from POR                            <  

0895 ;*                                                              <  
0896 LOOP WHILE NOT(REQ) AND MPO.ACCRUE = '' DO                      <  
0897 GOSUB 60                                                        <  
0898 REPEAT                                                          <  
0899 ;* C40479 ^                                                     <  
0900 IF MENU.FLAG = "P" THEN                                         <  
0901 WORK.FILE = MISC.PO                                             <  

0902 UPDATE = "PO"                                                   <  
0903 END                                                             <  
0904 IF UPDATE = "PO" THEN                                           <  
0905 *24231 ^                                                        <  
0906 IF CO.APS.M.INTRF > 1 THEN                                         IF CO.APS.M.INTRF > 1 THEN
0907 *T25463 v     CALL MISC.VEND.STAT.UPDATE(CONO,MPO.CODE,"M")     |  *T25463        CALL MISC.VEND.STAT.UPDATE(CONO,MPO.CODE,"M")
0908 CALL MISC.VEND.STAT.UPDATE(CONO,MPO.CODE,"M","O","")               CALL MISC.VEND.STAT.UPDATE(CONO,MPO.CODE,"M","O","")

0909 END                                                                END
0910 END ; *24231                                                    <  
0911 MPO.LAST.RECV = ""                                                 MPO.LAST.RECV = ""
0912 *24231 v                                                        |  MATWRITE MPO.REC ON MISC.PO , CONO:MPO.CODE
0913 *      MATWRITE MPO.REC ON MISC.PO , CONO:MPO.CODE              |  MORE = 1
0914 MATWRITE MPO.REC ON WORK.FILE , CONO:MPO.CODE                   <  
0915 *24231 ^                                                        <  
0916 *T28244 v                                                       <  

0917 IF MENU.FLAG = "R" THEN                                         <  
0918 IF NOT(REQ) THEN                                                <  
0919 IF APP.PO.LEVEL = 1 THEN                                        <  
0920 CMD = 'DELETE MISC.REQ ':'"':CONO:MPO.CODE:'"'                  <  
0921 UDTEXECUTE CMD CAPTURING MSG                                    <  
0922 ERRMSG = "New PO number " :MPO.CODE:" has been created."        <  
0923 GOSUB 91000                                                     <  

0924 END                                                             <  
0925 END                                                             <  
0926 END                                                             <  
0927 *T28244 ^                                                       <  
0928 MORE = 0                                                        <  
0929 *24231 v                                                        <  
0930 *T25942               IF OPTION = "R" THEN                      <  

0931 IF OPTION = "F" THEN                                            <  
0932 GOSUB SEND.MAIL                                                 <  
0933 END                                                             <  
0934 RELEASE                                                         <  
0935 END                                                             <  
0936 *24231 ^                                                        <  
0937 CASE (OPTION = 'F' OR OPTION = 'C') AND POS.INQ = 1             <  

0938 ERRMSG = "** INVALID RESPONSE **"                               <  
0939 GOSUB 91000                                                     <  
0940 END CASE                                                           END CASE
0941 WHILE MORE DO REPEAT                                            |  WHILE MORE = 0 DO REPEAT
0942 *24955 v                                                        <  
0943 IF BUFFER<3> = 'INQ' THEN                                       <  
0944 ECD.ACTION = 99 ; CALL SCRN.EDIT                                <  

0945 GOSUB 99999                                                     <  
0946 END ELSE                                                        <  
0947 *24955 ^                                                        <  
0948 GOTO 1                                                             GOTO 1
0949 END  ; * 24955                                                  <  
0950 **** ENTER PO DATE                                                 **** ENTER PO DATE
0951 9*                                                                 9*

0955 MPO.DATE = ECD.RET.VALUE                                           MPO.DATE = ECD.RET.VALUE
0956 END                                                                END
0957 RETURN                                                             RETURN
0958 *** ENTER VEND CODE AND PRINT VEND INFORMATION                     *** ENTER VEND CODE AND PRINT VEND INFORMATION
0959 10*                                                                10*
0960 *T25938 v                                                       |  IF NOT(NEW) THEN
0961 * IF NOT(NEW) THEN                                              <  
0962 IF NOT(NEW) AND NOT(DUPLICATED.PO) THEN                         <  
0963 *T25938 ^                                                       <  
0964 *24953 v                                                        <  

0965 IF MENU.FLAG # "R" THEN                                         <  
0966 ERRMSG = "CANNOT MODIFY VENDOR INFORMATION ON EXISTING PURCHAS     ERRMSG = "CANNOT MODIFY VENDOR INFORMATION ON EXISTING PURCH
0967 GOSUB 91000                                                        GOSUB 91000
0968 GOTO 11                                                            GOTO 11
0969 END ; *24953                                                    <  
0970 END                                                                END
0971 ECD.NUM = 9                                                        ECD.NUM = 9

0987 SCV.REC(13)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)           SCV.REC(13)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)
0988 SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)           SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)
0989 SCV.REC(45)<ECD.SCRN.NO,1> = VEND.PHONE                            SCV.REC(45)<ECD.SCRN.NO,1> = VEND.PHONE
0990 SCV.REC(46)<ECD.SCRN.NO,1> = VEND.FAX                              SCV.REC(46)<ECD.SCRN.NO,1> = VEND.FAX
0991 SCV.REC(15)<ECD.SCRN.NO,1> = VEND.PO.ZIP                           SCV.REC(15)<ECD.SCRN.NO,1> = VEND.PO.ZIP
0992 *26471 v                                                        <  
0993 SCV.REC(27)<ECD.SCRN.NO,1> = VEND.TERMS<1,2>                    <  
0994 MPO.TERMS.DESC = VEND.TERMS<1,2>                                <  
0995 SCV.REC(28)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[1,4]               <  
0996 MPO.TERMS.DIS = VEND.TERMS<1,1>[1,4]                            <  

0997 IF MPO.TERMS.DESC[1,1] = 'P' THEN                               <  
0998 SCV.REC(29)<ECD.SCRN.NO,1> = ''                                 <  
0999 END ELSE                                                        <  
1000 SCV.REC(29)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[5,2]               <  
1001 END                                                             <  
1002 MPO.TERMS.DATE = SCV.REC(29)<ECD.SCRN.NO,1>                     <  
1003 *26471 ^                                                        <  

1023 GOSUB 91000                                                        GOSUB 91000
1024 SCV.REC(10)<1> = ''                                                SCV.REC(10)<1> = ''
1025 GOTO 10                                                            GOTO 10
1026 END                                                                END
1027 MPO.VEND.NO = GXR.ID                                               MPO.VEND.NO = GXR.ID
1028 SCV.REC(9)<ECD.SCRN.NO,1> = MPO.VEND.NO                         |  SCV.REC(9)<1> = MPO.VEND.NO
1029 SCV.REC(10)<ECD.SCRN.NO,1> = VEND.PO.DESC                          SCV.REC(10)<ECD.SCRN.NO,1> = VEND.PO.DESC
1030 SCV.REC(11)<ECD.SCRN.NO,1> = VEND.PO.ADDR1                         SCV.REC(11)<ECD.SCRN.NO,1> = VEND.PO.ADDR1
1031 SCV.REC(12)<ECD.SCRN.NO,1> = VEND.PO.ADDR2                         SCV.REC(12)<ECD.SCRN.NO,1> = VEND.PO.ADDR2
1032 SCV.REC(13)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)           SCV.REC(13)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)

1032 SCV.REC(13)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)           SCV.REC(13)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)
1033 SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)           SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)
1034 SCV.REC(45)<ECD.SCRN.NO,1> = VEND.PHONE                            SCV.REC(45)<ECD.SCRN.NO,1> = VEND.PHONE
1035 SCV.REC(46)<ECD.SCRN.NO,1> = VEND.FAX                              SCV.REC(46)<ECD.SCRN.NO,1> = VEND.FAX
1036 SCV.REC(15)<ECD.SCRN.NO,1> = VEND.PO.ZIP                           SCV.REC(15)<ECD.SCRN.NO,1> = VEND.PO.ZIP
1037 *26471 v                                                        <  
1038 SCV.REC(27)<ECD.SCRN.NO,1> = VEND.TERMS<1,2>                    <  
1039 MPO.TERMS.DESC = VEND.TERMS<1,2>                                <  
1040 SCV.REC(28)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[1,4]               <  
1041 MPO.TERMS.DIS = VEND.TERMS<1,1>[1,4]                            <  

1042 IF MPO.TERMS.DESC[1,1] = 'P' THEN                               <  
1043 SCV.REC(29)<ECD.SCRN.NO,1> = ''                                 <  
1044 END ELSE                                                        <  
1045 SCV.REC(29)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[5,2]               <  
1046 END                                                             <  
1047 MPO.TERMS.DATE = SCV.REC(29)<ECD.SCRN.NO,1>                     <  
1048 *26471 ^                                                        <  

1051 END CASE                                                           END CASE
1052 11*                                                                11*
1053 RETURN                                                             RETURN
1054 **** ENTER SHIP TO INFORMATION                                     **** ENTER SHIP TO INFORMATION
1055 12*                                                                12*
1056 * 25855 v                                                       |  ECD.NUM=32;ECD.ACTION=4;CALL SCRN.EDIT
1057 ECD.NUM = 32                                                    <  
1058 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  
1059 * 25855 ^                                                       <  
1060 IF ECD.RET.VALUE='END' THEN GOTO 13                                IF ECD.RET.VALUE='END' THEN GOTO 13

1072 GOSUB 91000; GOTO 12                                               GOSUB 91000; GOTO 12
1073 END                                                                END
1074 * TASK 19404 ^^                                                    * TASK 19404 ^^
1075 MPO.SHIP.WHSE=ECD.RET.VALUE                                        MPO.SHIP.WHSE=ECD.RET.VALUE
1076 ECD.NUM=33;ECD.ACTION=5                                            ECD.NUM=33;ECD.ACTION=5
1077 SCV.REC(33)<ECD.SCRN.NO,1> = WHS.DESC; CALL SCRN.EDIT           |  SCV.REC(33)<1> = WHS.DESC; CALL SCRN.EDIT
1078 MPO.SHIP.NAME= WHS.DESC                                            MPO.SHIP.NAME= WHS.DESC
1079 ECD.NUM=34;ECD.ACTION=5                                            ECD.NUM=34;ECD.ACTION=5
1080 SCV.REC(34)<ECD.SCRN.NO,1> = WHS.ADDR1; CALL SCRN.EDIT          |  SCV.REC(34)<1> = WHS.ADDR1; CALL SCRN.EDIT
1081 MPO.SHIP.ADD1=WHS.ADDR1                                            MPO.SHIP.ADD1=WHS.ADDR1

1082 ECD.NUM=35;ECD.ACTION=5                                            ECD.NUM=35;ECD.ACTION=5
1083 SCV.REC(35)<ECD.SCRN.NO,1> = WHS.ADDR2; CALL SCRN.EDIT          |  SCV.REC(35)<1> = WHS.ADDR2; CALL SCRN.EDIT
1084 MPO.SHIP.ADD2=WHS.ADDR2                                            MPO.SHIP.ADD2=WHS.ADDR2
1085 ECD.NUM=36;ECD.ACTION=5                                            ECD.NUM=36;ECD.ACTION=5
1086 SCV.REC(36)<ECD.SCRN.NO,1> = WHS.CITY; CALL SCRN.EDIT           |  SCV.REC(36)<1> = WHS.CITY; CALL SCRN.EDIT
1087 ECD.NUM=37;ECD.ACTION=5                                            ECD.NUM=37;ECD.ACTION=5
1088 SCV.REC(37)<ECD.SCRN.NO,1> = WHS.STATE; CALL SCRN.EDIT          |  SCV.REC(37)<1> = WHS.STATE; CALL SCRN.EDIT
1089 MPO.SHIP.ADD3=WHS.CITY:',':WHS.STATE                               MPO.SHIP.ADD3=WHS.CITY:',':WHS.STATE

1090 ECD.NUM=38;ECD.ACTION=5                                            ECD.NUM=38;ECD.ACTION=5
1091 SCV.REC(38)<ECD.SCRN.NO,1> = WHS.ZIP;CALL SCRN.EDIT             |  SCV.REC(38)<1> = WHS.ZIP;CALL SCRN.EDIT
1092 MPO.SHIP.ADD4=WHS.ZIP                                              MPO.SHIP.ADD4=WHS.ZIP
1093 CASE 1                                                             CASE 1
1094 IF ECD.RET.VALUE = "" THEN                                         IF ECD.RET.VALUE = "" THEN
1095 MPO.SHIP.WHSE= "@@@@"                                              MPO.SHIP.WHSE= "@@@@"
1096 END ELSE                                                           END ELSE
1097 MPO.SHIP.WHSE=ECD.RET.VALUE                                        MPO.SHIP.WHSE=ECD.RET.VALUE

1134 MPO.VDR.ORD = ECD.RET.VALUE                                        MPO.VDR.ORD = ECD.RET.VALUE
1135 END                                                                END
1136 RETURN                                                             RETURN
1137 **** ENTER WRITTEN BY                                              **** ENTER WRITTEN BY
1138 25*                                                                25*
1139 *                                                               <  
1140 *24231 v                                                        <  
1141 IF (REQ) THEN                                                   <  
1142 ERRMSG = "You cannot change Written By while using requsition   <  
1143 GOSUB 91000                                                     <  

1144 END ELSE                                                        <  
1145 ECD.NUM = 21                                                       ECD.NUM = 21
1146 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1147 IF ECD.RET.VALUE # 'END' THEN                                      IF ECD.RET.VALUE # 'END' THEN
1148 MPO.WRIT.BY = ECD.RET.VALUE                                        MPO.WRIT.BY = ECD.RET.VALUE
1149 END                                                                END
1150 END                                                             <  

1151 *24231 ^                                                        <  
1152 RETURN                                                             RETURN
1153 **** ENTER REQUESTOR       ; *25858                             <  
1154 27*                                                             <  
1155 *                                                               <  
1156 ECD.NUM = 58                                                    <  
1157 ECD.ACTION=4;CALL SCRN.EDIT                                     <  

1158 IF ECD.RET.VALUE # 'END' THEN                                   <  
1159 MPO.REQUESTOR = ECD.RET.VALUE                                   <  
1160 END                                                             <  
1161 RETURN                                                          <  
1162 **** ENTER CONTRACT                                                **** ENTER CONTRACT
1163 30*                                                                30*
1164 ECD.NUM = 22                                                       ECD.NUM = 22

1168 END                                                                END
1169 RETURN                                                             RETURN
1170 **** ENTER SHIP VIA                                                **** ENTER SHIP VIA
1171 35*                                                                35*
1172 ECD.NUM = 23                                                       ECD.NUM = 23
1173 *T27701 v                                                       <  
1174 IF MPO.SHIP.VIA = "" THEN                                       <  
1175 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = VEND.SHIP.VIA                   <  
1176 END                                                             <  
1177 *T27701 ^                                                       <  

1177 *T27701 ^                                                       <  
1178 ECD.VALDAT.CODE = '2'                                              ECD.VALDAT.CODE = '2'
1179 ECD.VALDAT.FILE = SHIP.VIA                                         ECD.VALDAT.FILE = SHIP.VIA
1180 ECD.PREFIX.ID = CONO                                               ECD.PREFIX.ID = CONO
1181 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1182 *T27701 v                                                       <  
1183 *  IF ECD.RET.VALUE # 'END' THEN                                <  
1184 *    BEGIN CASE                                                 <  
1185 *    CASE ECD.RET.VALUE # '' AND ECD.VALDAT.ITEM # ''           <  
1186 *     FOR SV = 1 TO SHIP.VIA.REC.SIZE                           <  

1187 *        SHIP.VIA.REC(SV) = ECD.VALDAT.ITEM<SV>                 <  
1188 *     NEXT SV                                                   <  
1189 *    CASE ECD.RET.VALUE = ''                                    <  
1190 *     GXR.NAME = 'SHIP.VIA'                                     <  
1191 *     GXR.FILE = SHIP.VIA                                       <  
1192 *     ECD.SRCH.ID = ECD.RET.VALUE                               <  
1193 *     GXR.ID = ''                                               <  

1194 *     CALL GEN.XREF.SUB(MAT GEN.XREF.REC, PREFIX, XREF.DATA)    <  
1195 *     ECD.ACTION=2; CALL SCRN.EDIT                              <  
1196 *     IF GXR.ID # '' THEN                                       <  
1197 *       MATREAD SHIP.VIA.REC FROM SHIP.VIA,CONO:GXR.ID THEN     <  
1198 *         ECD.RET.VALUE = GXR.ID                                <  
1199 *       END                                                     <  
1200 *       SCV.REC(23)<ECD.SCRN.NO,1>=ECD.RET.VALUE; ECD.ACTION=3  <  

1201 *     END                                                       <  
1202 *    END CASE                                                   <  
1203 IF ECD.RET.VALUE # 'END' THEN                                      IF ECD.RET.VALUE # 'END' THEN
1204 FOR SV = 1 TO SHIP.VIA.REC.SIZE                                    FOR SV = 1 TO SHIP.VIA.REC.SIZE
1205 SHIP.VIA.REC(SV) = ECD.VALDAT.ITEM<SV>                             SHIP.VIA.REC(SV) = ECD.VALDAT.ITEM<SV>
1206 NEXT SV                                                            NEXT SV
1207 MPO.SHIP.VIA = ECD.RET.VALUE                                       MPO.SHIP.VIA = ECD.RET.VALUE

1208 MPO.VIA.DESC = SHPV.DESC                                           MPO.VIA.DESC = SHPV.DESC
1209 SCV.REC(24)<ECD.SCRN.NO,1> = MPO.VIA.DESC                          SCV.REC(24)<ECD.SCRN.NO,1> = MPO.VIA.DESC
1210 ECD.NUM = 24                                                       ECD.NUM = 24
1211 ECD.ACTION=5;CALL SCRN.EDIT                                        ECD.ACTION=5;CALL SCRN.EDIT
1212 END                                                                END
1213 *T27701 ^                                                       <  
1214 RETURN                                                             RETURN
1215 **** ENTER FOB                                                     **** ENTER FOB
1216 40*                                                                40*
1217 ECD.NUM = 25                                                       ECD.NUM = 25

1256 *                                                                  *
1257 51*                                                                51*
1258 RETURN                                                             RETURN
1259 *** ENTER ACCRUE FLAG                                              *** ENTER ACCRUE FLAG
1260 60*                                                                60*
1261 IF APP.PO.LEVEL = 1 OR MENU.FLAG = "P" THEN ; * 24953           <  
1262 IF SUM(MPO.TOT.RECEVED) = 0 THEN                                   IF SUM(MPO.TOT.RECEVED) = 0 THEN
1263 * T26152 v                                                      <  
1264 IF CO.PO.ACCRUE.FLAG<1,3> = '' OR CO.PO.ACCRUE.MAINT<1,3> = 'Y  <  
1265 IF CO.PO.ACCRUE.FLAG<1,3> # '' AND FIRST.TIME = 1 THEN          <  

1266 MPO.ACCRUE = CO.PO.ACCRUE.FLAG<1,3>                             <  
1267 ECD.NUM = 16                                                    <  
1268 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = MPO.ACCRUE                      <  
1269 ECD.ACTION = 5 ; CALL SCRN.EDIT                                 <  
1270 END ELSE                                                        <  
1271 * T26152 ^                                                      <  
1272 ECD.NUM=16                                                         ECD.NUM=16

1273 ECD.DEFAULT = CO.PO.ACCRUE.FLAG<1,3> ;* C40479                  |  *T23225      ECD.ACTION=4; CALL SCRN.EDIT
1274 ECD.ACTION=4; CALL SCRN.EDIT                                    |  *T23689 v
1275 IF ECD.RET.VALUE # "END" THEN                                   |  *     ECD.ACTION=5; ECD.DEFAULT="Y"; SCV.REC(ECD.NUM)="Y"; C
1276 MPO.ACCRUE = ECD.RET.VALUE                                      |  ECD.ACTION=5; ECD.DEFAULT="N"; SCV.REC(ECD.NUM)="N"; CALL SC
1277                                                                 >  *T23689 ^
1278                                                                 >  *T23225      IF ECD.RET.VALUE # "END" THEN
1279                                                                 >  *T23225         MPO.ACCRUE = ECD.RET.VALUE

1280                                                                 >  MPO.ACCRUE = "N" ;*T23225 & T23689
1281                                                                 >  *T23225      END
1282 END                                                                END
1283 * T26152 v                                                      <  
1284 END                                                             <  
1285 END ELSE                                                        <  
1286 IF MPO.ACCRUE = '' THEN                                         <  

1287 MPO.ACCRUE = CO.PO.ACCRUE.FLAG<1,3>                             <  
1288 ECD.NUM = 16                                                    <  
1289 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = MPO.ACCRUE                      <  
1290 ECD.ACTION = 5 ; CALL SCRN.EDIT                                 <  
1291 END                                                             <  
1292 END                                                             <  
1293 * T26152 ^                                                      <  

1294 END                                                             <  
1295 END ; * 24953                                                   <  
1296 RETURN                                                             RETURN
1297 *                                                               |  *** ENTER PRINT FLG
1298 *** ENTER PRINT FLG (REWRITE: TASK 25941)                       <  
1299 *                                                               <  
1300 70*                                                                70*

1301 *                                                               |  OLD.PRT.FLG = MPO.PRT.FLG
1302 ECD.NUM = 39                                                    |  ECD.NUM=39
1303 ECD.DEFAULT = MPO.PRT.FLG<1,1>                                  <  
1304 IF SCV.REC(ECD.NUM)<ECD.SCRN.NO> = '' AND VEND.EMAIL.ADDR # ''  <  
1305 ECD.DEFAULT = 'N'                                               <  
1306 END                                                             <  
1307 IF MPO.PRT.FLG<1,1> = 'P' THEN ECD.VALDAT = 'Y,N,P,C'           <  

1308 IF MPO.PRT.FLG<1,1> = 'C' THEN ECD.VALDAT = 'Y,N,C'             <  
1309 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ''                              <  
1310 ECD.ACTION=4;CALL SCRN.EDIT                                     <  
1311 IF ECD.RET.VALUE = 'END' THEN                                   <  
1312 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
1313 RETURN                                                          <  
1314 END                                                             <  

1315 MPO.PRT.FLG<1,1> = ECD.RET.VALUE                                <  
1316 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
1317 ;*                                                              <  
1318 ;* Input Mail flag if Vendor has an email address               <  
1319 ;*                                                              <  
1320 IF VEND.EMAIL.ADDR = '' THEN RETURN                             <  
1321 ECD.NUM = 3                                                     <  

1322 ECD.DEFAULT = MPO.PRT.FLG<1,2>                                  <  
1323 IF MPO.PRT.FLG<1,2> = 'M' THEN ECD.VALDAT = 'Y,N,M,C'           <  
1324 IF MPO.PRT.FLG<1,2> = 'C' THEN ECD.VALDAT = 'Y,N,C'             <  
1325 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ''                              <  
1326 ECD.ACTION=4; CALL SCRN.EDIT                                       ECD.ACTION=4; CALL SCRN.EDIT
1327 IF ECD.RET.VALUE = 'END' THEN                                   |  BEGIN CASE
1328 GOSUB SHOW.PRINT.MAIL.FLAGS                                     |  CASE ECD.RET.VALUE = "END"

1329 RETURN                                                             RETURN
1330                                                                 >  CASE OLD.PRT.FLG = "P"
1331                                                                 >  SCV.REC(39)<ECD.SCRN.NO> = ECD.RET.VALUE
1332                                                                 >  MPO.PRT.FLG = ECD.RET.VALUE
1333                                                                 >  CASE OLD.PRT.FLG = "Y"
1334                                                                 >  IF ECD.RET.VALUE = "C" THEN
1335                                                                 >  ERRMSG = "CAN NOT REPRINT UNTIL PO HAS BEEN PRINTED"
1336                                                                 >  GOSUB 91000; GOTO 70

1337                                                                 >  END ELSE
1338                                                                 >  IF ECD.RET.VALUE = "P" THEN
1339                                                                 >  ERRMSG = "ONLY PRINTING THE PO WILL CHANGE THE PRINT FLAG TO
1340                                                                 >  GOSUB 91000;GOTO 70
1341                                                                 >  END ELSE
1342                                                                 >  SCV.REC(39)<ECD.SCRN.NO> = ECD.RET.VALUE
1343 END                                                                END

1344 MPO.PRT.FLG<1,2> = ECD.RET.VALUE                                |  END
1345 GOSUB SHOW.PRINT.MAIL.FLAGS                                     |  SCV.REC(39)<ECD.SCRN.NO> = ECD.RET.VALUE
1346 RETURN                                                          |  MPO.PRT.FLG = ECD.RET.VALUE
1347 *                                                               <  
1348 SHOW.PRINT.MAIL.FLAGS:                                          <  
1349 ;* Show print flag                                              <  
1350 ECD.NUM = 39                                                    <  

1351 BEGIN CASE                                                      <  
1352 CASE MPO.PRT.FLG<1,1> = 'Y'                                     <  
1353 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Yes"                           <  
1354 CASE MPO.PRT.FLG<1,1> = 'P'                                     <  
1355 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Print"                         <  
1356 CASE MPO.PRT.FLG<1,1> = 'C'                                     <  
1357 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Copy"                          <  

1358 CASE 1                                                             CASE 1
1359 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "No"                            |  MPO.PRT.FLG = ECD.RET.VALUE
1360 END CASE                                                           END CASE
1361 ECD.ACTION = 5; CALL SCRN.EDIT                                  <  
1362 ;* Show mail flag                                               <  
1363 ECD.NUM = 3                                                     <  
1364 BEGIN CASE                                                      <  
1365 CASE MPO.PRT.FLG<1,2> = 'Y'                                     <  

1366 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Yes"                           <  
1367 CASE MPO.PRT.FLG<1,2> = 'M'                                     <  
1368 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Sent"                          <  
1369 CASE MPO.PRT.FLG<1,2> = 'C'                                     <  
1370 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Copy"                          <  
1371 CASE 1                                                          <  
1372 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "No"                            <  

1373 END CASE                                                        <  
1374 ECD.ACTION = 5; CALL SCRN.EDIT                                  <  
1375 RETURN                                                             RETURN
1376 *                                                                  *
1377 *** ENTER OWNING DIVISION NUMBER; * TASK 19404                     *** ENTER OWNING DIVISION NUMBER; * TASK 19404
1378 *                                                                  *
1379 80*                                                                80*

1379 80*                                                                80*
1380 ECD.NUM=44; ECD.ACTION=4                                           ECD.NUM=44; ECD.ACTION=4
1381 CALL SCRN.EDIT                                                     CALL SCRN.EDIT
1382 IF ECD.RET.VALUE # "END" THEN                                      IF ECD.RET.VALUE # "END" THEN
1383 MPO.DIV.OWNER = ECD.RET.VALUE                                      MPO.DIV.OWNER = ECD.RET.VALUE
1384 *24231 v                                                        <  
1385 DIV = ECD.RET.VALUE                                             <  
1386 INVALID = 0                                                     <  
1387 IF MPO.DIV.OWNER # "00" THEN                                       IF MPO.DIV.OWNER # "00" THEN
1388 MATREAD DIV.REC FROM DIVISION,CONO:MPO.DIV.OWNER ELSE              MATREAD DIV.REC FROM DIVISION,CONO:MPO.DIV.OWNER ELSE

1389 INVALID = 1                                                     <  
1390 END                                                             <  
1391 END ELSE                                                        <  
1392 DIV = "ALL"                                                     <  
1393 END                                                             <  
1394 IF NOT(INVALID) THEN                                            <  
1395 IF MENU.FLAG = "R" THEN                                         <  

1396 VALID = 1                                                       <  
1397 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!ALL" THEN       <  
1398 *T25861 v                                                       <  
1399 IF APP.PO.FLAG<1,3> = "Y" THEN                                  <  
1400 *T25861 ^                                                       <  
1401 IF APP.STATUS = "Y" THEN                                        <  
1402 SCV.REC(21)<ECD.SCRN.NO,1> = APP.NAME<1>                        <  

1403 ECD.NUM = 21                                                    <  
1404 ECD.ACTION  = 5 ; CALL SCRN.EDIT                                <  
1405 END ELSE                                                        <  
1406 IF DIV # "ALL" THEN                                             <  
1407 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":DIV THEN      <  
1408 IF APP.STATUS = "Y" THEN                                        <  
1409 SCV.REC(21)<ECD.SCRN.NO,1> = APP.NAME<1>                        <  

1410 ECD.NUM = 21                                                    <  
1411 ECD.ACTION  = 5 ; CALL SCRN.EDIT                                <  
1412 END ELSE                                                        <  
1413 ERRMSG = "User profile is inactive for division ":DIV           <  
1414 GOSUB 91000                                                     <  
1415 GOTO 80                                                         <  
1416 END                                                             <  

1417 END ELSE                                                        <  
1418 ERRMSG = "You are not allowed to enter requisitions for divisi  <  
1419 GOSUB 91000                                                     <  
1420 GOTO 80                                                         <  
1421 END                                                             <  
1422 END ELSE                                                        <  
1423 ERRMSG = "User profile is inactive for division ":DIV           <  

1424 GOSUB 91000                                                     <  
1425 GOTO 80                                                         <  
1426 END                                                             <  
1427 END                                                             <  
1428 *T25861 v                                                       <  
1429 END ELSE                                                        <  
1430 ERRMSG = "You are not allowed to enter a Misc Requisition."     <  

1431 GOSUB 91000                                                     <  
1432 GOTO 5                                                          <  
1433 END                                                             <  
1434 *T25861 ^                                                       <  
1435 END ELSE                                                        <  
1436 IF DIV # "ALL" THEN                                             <  
1437 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":DIV THEN      <  

1438 *T25861 v                                                       <  
1439 IF APP.PO.FLAG<1,3> = "Y" THEN                                  <  
1440 *T25861 ^                                                       <  
1441 IF APP.STATUS = "Y" THEN                                        <  
1442 SCV.REC(21)<ECD.SCRN.NO,1> = APP.NAME<1>                        <  
1443 ECD.NUM = 21                                                    <  
1444 ECD.ACTION  = 5 ; CALL SCRN.EDIT                                <  

1445 END ELSE                                                        <  
1446 ERRMSG = "User profile is inactive for division ":DIV           <  
1447 GOSUB 91000                                                     <  
1448 GOTO 80                                                         <  
1449 END                                                             <  
1450 *T25861 v                                                       <  
1451 END ELSE                                                        <  

1452 ERRMSG = "You are not allowed to enter a Misc Requisition."     <  
1453 GOSUB 91000                                                     <  
1454 GOTO 5                                                          <  
1455 END                                                             <  
1456 *T25861 ^                                                       <  
1457 END ELSE                                                        <  
1458 ERRMSG = "You are not allowed to enter requisitions for divisi  <  

1459 GOSUB 91000                                                     <  
1460 GOTO 80                                                         <  
1461 END                                                             <  
1462 END ELSE                                                        <  
1463 ERRMSG = "You are not allowed to enter requisitions for divisi  <  
1464 GOSUB 91000                                                     <  
1465 GOTO 80                                                         <  

1466 END                                                             <  
1467 END                                                             <  
1468 *T24953 v                                                       <  
1469 IF (NEW) THEN                                                   <  
1470 MPO.WRIT.BY = APP.NAME<1>                                       <  
1471 END                                                             <  
1472 *T24953 ^                                                       <  

1473 END                                                             <  
1474 END ELSE                                                        <  
1475 ERRMSG = "Invalid division number used as PO owning division"      ERRMSG = "Invalid division number used as PO owning division
1476 GOSUB 91000; MPO.DIV.OWNER = ""; GOTO 80                           GOSUB 91000; MPO.DIV.OWNER = ""; GOTO 80
1477 END                                                                END
1478 *24231 ^                                                        <  
1479 *T23278 v                                                       <  

1480 DIV.CODE = MPO.DIV.OWNER; USER.ID = UPCASE(@LOGNAME); ERRMSG =  <  
1481 CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)               <  
1482 IF ERRMSG # '' THEN                                             <  
1483 GOSUB 91000; SCV.REC(44)<1,1> = ''; GOTO 80                     <  
1484 END                                                                END
1485 *T23278 ^                                                       <  
1486 END                                                                END

1487 RETURN                                                             RETURN
1488 *                                                                  *
1489 * ENTER APPROVER ID                                             <  
1490 *                                                               <  
1491 90*                                                             <  
1492 *                                                               <  
1493 IF DIV = "" THEN DIV = MPO.DIV.OWNER ; * 24593                  <  
1494 IF APP.PO.LEVEL # 1 THEN                                        <  
1495 EOI = 0                                                         <  

1496 LOOP                                                            <  
1497 ECD.NUM = 47                                                    <  
1498 *find default approver                                          <  
1499 NBR.IDS = DCOUNT(APP.PO.ID<1,3>,SVM)                            <  
1500 FOUND = 0                                                       <  
1501 MAT HOLD.APP.REQ.REC = MAT APP.REQ.REC                          <  
1502 FOR XX =1 TO NBR.IDS UNTIL FOUND                                <  

1503 READV STATUS FROM APP.REQ,CONO:APP.PO.ID<1,3,XX>:"!ALL",2 THEN  <  
1504 IF STATUS = "Y" THEN                                            <  
1505 ECD.DEFAULT = APP.PO.ID<1,3,XX>                                 <  
1506 FOUND = 1                                                       <  
1507 SCV.REC(47)<ECD.SCRN.NO,1> = APP.PO.ID<1,3,XX>                  <  
1508 END ELSE                                                        <  
1509 READV STATUS FROM APP.REQ,CONO:APP.PO.ID<1,3,XX>:"!":DIV,2 THE  <  

1510 IF STATUS = "Y" THEN                                            <  
1511 ECD.DEFAULT = APP.PO.ID<1,3,XX>                                 <  
1512 FOUND = 1                                                       <  
1513 SCV.REC(47)<ECD.SCRN.NO,1> = APP.PO.ID<1,3,XX>                  <  
1514 END                                                             <  
1515 END                                                             <  
1516 END                                                             <  

1517 END ELSE                                                        <  
1518 READV STATUS FROM APP.REQ,CONO:APP.PO.ID<1,3,XX>:"!":DIV,2 THE  <  
1519 IF STATUS = "Y" THEN                                            <  
1520 ECD.DEFAULT = APP.PO.ID<1,3,XX>                                 <  
1521 FOUND = 1                                                       <  
1522 SCV.REC(47)<ECD.SCRN.NO,1> = APP.PO.ID<1,3,XX>                  <  
1523 END                                                             <  

1524 END                                                             <  
1525 END                                                             <  
1526 IF FOUND THEN FOUND.POS = XX  ; *24953                          <  
1527 NEXT XX                                                         <  
1528 *                                                               <  
1529 *    24953 v                                                    <  
1530 BEGIN CASE                                                      <  

1531 CASE NBR.IDS = 1 AND FOUND = 1                                  <  
1532 MPO.APPROVER = APP.PO.ID<1,3,FOUND.POS>                         <  
1533 SCV.REC(47)<ECD.SCRN.NO,1> = APP.PO.ID<1,3,FOUND.POS>           <  
1534 ECD.ACTION = 5 ; CALL SCRN.EDIT                                 <  
1535 EOI = 1                                                         <  
1536 CASE NBR.IDS = 1 AND FOUND = 0                                  <  
1537 ERRMSG = "No valid approvers setup"                             <  

1538 GOSUB 91000                                                     <  
1539 GOSUB 99999                                                     <  
1540 CASE 1                                                          <  
1541 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  
1542 BEGIN CASE                                                      <  
1543 CASE ECD.RET.VALUE = "END"                                      <  
1544 EOI = 1                                                         <  

1545 CASE ECD.RET.VALUE # ""                                         <  
1546 LOCATE ECD.RET.VALUE IN APP.PO.ID<1,3> SETTING POS THEN         <  
1547 *          MAT HOLD.APP.REQ.REC = MAT APP.REQ.REC               <  
1548 VALID = 1                                                       <  
1549 MATREAD APP.REQ.REC FROM APP.REQ,CONO:APP.PO.ID<1,3,POS>:"!ALL  <  
1550 IF DIV # "ALL" THEN                                             <  
1551 MATREAD APP.REQ.REC FROM APP.REQ,CONO:APP.PO.ID<1,3,POS>:"!":D  <  

1552 VALID = 0                                                       <  
1553 END                                                             <  
1554 END ELSE                                                        <  
1555 VALID = 0                                                       <  
1556 END                                                             <  
1557 END                                                             <  
1558 IF (VALID) THEN                                                 <  

1559 IF APP.STATUS = "N" THEN                                        <  
1560 IF DIV # "ALL" THEN                                             <  
1561 MAT APP.REQ.REC = MAT HOLD.APP.REQ.REC                          <  
1562 MATREAD APP.REQ.REC FROM APP.REQ,CONO:APP.PO.ID<1,3,POS>:"!":D  <  
1563 IF APP.STATUS = "N" THEN                                        <  
1564 ERRMSG = "Approver ":ECD.RET.VALUE:" is inactive."              <  
1565 GOSUB 91000                                                     <  

1566 END ELSE                                                        <  
1567 EOI = 1                                                         <  
1568 MPO.APPROVER = ECD.RET.VALUE                                    <  
1569 APPROVER.LIMIT = APP.PO.LIMIT<1,3>                              <  
1570 END                                                             <  
1571 END ELSE                                                        <  
1572 ERRMSG = "Approver ":ECD.RET.VALUE:" cannot approve your requi  <  

1573 GOSUB 91000                                                     <  
1574 END                                                             <  
1575 END ELSE                                                        <  
1576 ERRMSG = "Approver ":ECD.RET.VALUE:" is inactive."              <  
1577 GOSUB 91000                                                     <  
1578 END                                                             <  
1579 END ELSE                                                        <  

1580 EOI = 1                                                         <  
1581 MPO.APPROVER = ECD.RET.VALUE                                    <  
1582 APPROVER.LIMIT = APP.PO.LIMIT<1,3>                              <  
1583 END                                                             <  
1584 END ELSE                                                        <  
1585 ERRMSG = "Approver ":ECD.RET.VALUE:" cannot approve your requi  <  
1586 GOSUB 91000                                                     <  

1587 END                                                             <  
1588 *          MAT APP.REQ.REC = MAT HOLD.APP.REQ.REC               <  
1589 END ELSE                                                        <  
1590 ERRMSG = "Approver ":ECD.RET.VALUE:" cannot approve your requi  <  
1591 GOSUB 91000                                                     <  
1592 END                                                             <  
1593 END CASE                                                        <  

1594 END CASE ; *24953                                               <  
1595 MAT APP.REQ.REC = MAT HOLD.APP.REQ.REC                          <  
1596 UNTIL (EOI) DO REPEAT                                           <  
1597 END                                                             <  
1598 RETURN                                                          <  
1599 *                                                               <  
1600 ***** GET ALL VALUES FROM FILE                                     ***** GET ALL VALUES FROM FILE

1630 SCV.REC(34)<ECD.SCRN.NO,1> = MPO.SHIP.ADD1                         SCV.REC(34)<ECD.SCRN.NO,1> = MPO.SHIP.ADD1
1631 SCV.REC(35)<ECD.SCRN.NO,1> = MPO.SHIP.ADD2                         SCV.REC(35)<ECD.SCRN.NO,1> = MPO.SHIP.ADD2
1632 SCV.REC(36)<ECD.SCRN.NO,1> = FIELD(MPO.SHIP.ADD3, ",",1)           SCV.REC(36)<ECD.SCRN.NO,1> = FIELD(MPO.SHIP.ADD3, ",",1)
1633 SCV.REC(37)<ECD.SCRN.NO,1> = FIELD(MPO.SHIP.ADD3, ",",2)           SCV.REC(37)<ECD.SCRN.NO,1> = FIELD(MPO.SHIP.ADD3, ",",2)
1634 SCV.REC(38)<ECD.SCRN.NO,1> = MPO.SHIP.ADD4                         SCV.REC(38)<ECD.SCRN.NO,1> = MPO.SHIP.ADD4
1635 ;* T25941 v                                                     |  SCV.REC(39)<ECD.SCRN.NO,1> = MPO.PRT.FLG
1636 ;* SCV.REC(39)<ECD.SCRN.NO,1> = MPO.PRT.FLG                     <  
1637 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
1638 ;* T25941 ^                                                     <  
1639 *TASK 19404*                                                       *TASK 19404*

1640 SCV.REC(44)<ECD.SCRN.NO,1> = MPO.DIV.OWNER                         SCV.REC(44)<ECD.SCRN.NO,1> = MPO.DIV.OWNER
1641 *TASK 19404*                                                       *TASK 19404*
1642 *24231 v                                                        <  
1643 SCV.REC(5)<ECD.SCRN.NO,1> = MPO.CODE                            <  
1644 *24231 v                                                        <  
1645 IF MENU.FLAG = "R" THEN                                         <  
1646 *T24953  SCV.REC(21)<ECD.SCRN.NO,1> = APP.NAME                  <  
1647 LAST.POS = DCOUNT(MPO.STATUS<1>,VM)                             <  
1648 SCV.REC(48)<ECD.SCRN.NO,1> = MPO.STATUS<1,LAST.POS>  ; *24231   <  

1649 SCV.REC(47)<ECD.SCRN.NO,1> = MPO.APPROVER                       <  
1650 SCV.REC(49)<ECD.SCRN.NO,1> = MPO.ST.DATE<1,LAST.POS>            <  
1651 SCV.REC(58)<ECD.SCRN.NO,1> = MPO.REQUESTOR   ; *25858           <  
1652 END                                                             <  
1653 *24231 ^                                                        <  
1654 * 25858 v                                                       <  
1655 IF MENU.FLAG # "R" THEN                                         <  

1656 IF POS.INQ THEN                                                 <  
1657 SCV.REC(60)<ECD.SCRN.NO,1> = MPO.REQUESTOR                      <  
1658 END ELSE                                                        <  
1659 SCV.REC(59)<ECD.SCRN.NO,1> = MPO.REQUESTOR                      <  
1660 END                                                             <  
1661 END                                                             <  
1662 * 25858 ^                                                       <  

1664 *** GET TOTALS                                                     *** GET TOTALS
1665 1020*                                                              1020*
1666 P.CNT = COUNT(MPO.PROD.DESC,VM) + (MPO.PROD.DESC # "")             P.CNT = COUNT(MPO.PROD.DESC,VM) + (MPO.PROD.DESC # "")
1667 TOTAL.QTY = 0 ; TOTAL.AMT = 0                                      TOTAL.QTY = 0 ; TOTAL.AMT = 0
1668 FOR A = 1 TO P.CNT                                                 FOR A = 1 TO P.CNT
1669 *T28687 v                                                       <  
1670 IF MPO.UNIT.MAG<1,A> = 'M' THEN                                 <  
1671 MFACTOR = 1000                                                  <  
1672 END ELSE                                                        <  
1673 MFACTOR = 1                                                     <  

1674 END                                                             <  
1675 *T28687 ^                                                       <  
1676 TOTAL.QTY = TOTAL.QTY + MPO.TOT.ONORD<1,A>                         TOTAL.QTY = TOTAL.QTY + MPO.TOT.ONORD<1,A>
1677 *** TASK 14925 ***                                                 *** TASK 14925 ***
1678 *        IF MPO.DISCOUNT<1,A> * 1  = 0 THEN                        *        IF MPO.DISCOUNT<1,A> * 1  = 0 THEN
1679 *           ONORD.AMT.TOT = INT((MPO.GROS.PRICE<1,A>/100) * (M     *           ONORD.AMT.TOT = INT((MPO.GROS.PRICE<1,A>/100) * 
1680 *        END ELSE                                                  *        END ELSE

1681 *           DESC.PRICE = MPO.GROS.PRICE<1,A> - INT((((MPO.GROS     *           DESC.PRICE = MPO.GROS.PRICE<1,A> - INT((((MPO.GR
1682 DESC.PRICE = INT(MPO.GROS.PRICE<1,A>*(1-(MPO.DISCOUNT<1,A>/100     DESC.PRICE = INT(MPO.GROS.PRICE<1,A>*(1-(MPO.DISCOUNT<1,A>/1
1683 *T28687 ONORD.AMT.TOT = INT((DESC.PRICE) * (MPO.TOT.ONORD<1,A>  |  ONORD.AMT.TOT = INT((DESC.PRICE) * (MPO.TOT.ONORD<1,A>/100)+
1684 ONORD.AMT.TOT = INT((DESC.PRICE) * (MPO.TOT.ONORD<1,A>/100/MFA  <  
1685 *        END                                                       *        END
1686 TOTAL.AMT = TOTAL.AMT + ONORD.AMT.TOT                              TOTAL.AMT = TOTAL.AMT + ONORD.AMT.TOT
1687 NEXT A                                                             NEXT A
1688 SCV.REC(41)<ECD.SCRN.NO,1> = TOTAL.QTY                             SCV.REC(41)<ECD.SCRN.NO,1> = TOTAL.QTY
1689 SCV.REC(42)<ECD.SCRN.NO,1> = ICONV(OCONV(TOTAL.AMT,"MD4"),"MD2     SCV.REC(42)<ECD.SCRN.NO,1> = ICONV(OCONV(TOTAL.AMT,"MD4"),"M

1715 2500*                                                              2500*
1716 ECD.NUM = 51                                                       ECD.NUM = 51
1717 SCV.REC(51)<ECD.SCRN.NO,1> = MISC.CCTR.DESC                        SCV.REC(51)<ECD.SCRN.NO,1> = MISC.CCTR.DESC
1718 ECD.ACTION = 5 ; CALL SCRN.EDIT                                    ECD.ACTION = 5 ; CALL SCRN.EDIT
1719 RETURN                                                             RETURN
1720 *                                                               <  
1721 **********                                                      <  
1722 SEND.MAIL:                                                      <  
1723 **********                                                      <  
1724 *                                                               <  

1725 IF MPO.APP.LEVEL # "C" THEN                                     <  
1726 SUBJECT = "Miscellaneous PO requisition ":MPO.CODE :" is ready  <  
1727 END ELSE                                                        <  
1728 SUBJECT = "Miscellaneous PO requisition " :MPO.CODE:" has been  <  
1729 END                                                             <  
1730 MATREAD SEC.REC FROM SECURITY,CONO:MPO.APPROVER THEN            <  
1731 IF SEC.EMAIL # "" THEN                                          <  

1732 CMD = "!touch ":USER.ID                                         <  
1733 UDTEXECUTE CMD CAPTURING MSG                                    <  
1734 CMD = '!mail -s ':'"':SUBJECT:'" ':SEC.EMAIL:' < ':USER.ID      <  
1735 IF APP.PO.LEVEL # 1 THEN                                        <  
1736 UDTEXECUTE CMD CAPTURING MSG                                    <  
1737 END                                                             <  
1738 END                                                             <  

1739 END                                                             <  
1740 CMD ="!rm ":USER.ID                                             <  
1741 UDTEXECUTE CMD CAPTURING MSG                                    <  
1742 RETURN                                                          <  
1743 *                                                               <  
1744 *                                                               <  
1745 *25260 v                                                        <  

1746 *                                                               <  
1747 *************                                                   <  
1748 SET.RELEASED:                                                   <  
1749 *************                                                   <  
1750 *                                                               <  
1751 MPO.LEVEL.STATUS = "R"                                          <  
1752 MPO.STATUS<1,-1> = "Released"                                   <  

1753 MPO.ST.DATE<1,-1> = DATE()                                      <  
1754 MPO.PREV.APP<1,-1> = USER.ID                                    <  
1755 RETURN                                                          <  
1756 *                                                               <  
1757 *************                                                   <  
1758 SET.ON.HOLD:                                                    <  
1759 *************                                                   <  

1760 *                                                               <  
1761 MPO.LEVEL.STATUS = "H"                                          <  
1762 MPO.STATUS<1,-1> ="On-Hold"                                     <  
1763 MPO.ST.DATE<1,-1> = DATE()                                      <  
1764 MPO.PREV.APP<1,-1> = USER.ID                                    <  
1765 RETURN                                                          <  
1766 *                                                               <  

1767 ****************                                                <  
1768 CHOOSE.APPROVER:                                                <  
1769 ****************                                                <  
1770 *                                                               <  
1771 IF APP.PO.LEVEL # 1 THEN                                        <  
1772 APP.ARR= '' ;*array of valid approvers                          <  
1773 SKIP.RELEASE = 0                                                <  

1774 IF OCONV(TOTAL.AMT,"MD4") <= APP.PO.LIMIT<1,3> OR APP.PO.LIMIT  <  
1775 ;* since order amt. is <= then requestor limit                  <  
1776 ;* it can be released to level 1 approver.                      <  
1777 LEVEL =1 ; ORD.TOT = OCONV(TOTAL.AMT,"MD4") ; APP.ARR = ""      <  
1778 USER= USER.ID ; DIV.OWNER = MPO.DIV.OWNER;TYPE = 3              <  
1779 CALL  FIND.APPROVERS (CONO,USER,DIV.OWNER,TYPE,LEVEL,ORD.TOT,A  <  
1780 END ELSE                                                        <  

1781 ;*check to see if default approver is active                    <  
1782 ;*if not then look for the approver that can send req.          <  
1783 ;*directly to level 1 and make it first in the list.            <  
1784 MAT HOLD.APP.REQ.REC = MAT APP.REQ.REC                          <  
1785 USER = APP.PO.ID<1,3,1>;DIV.OWNER=MPO.DIV.OWNER                 <  
1786 APP.REQ.ID = ""                                                 <  
1787 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  

1788 MAT APP.REQ.REC = MAT HOLD.APP.REQ.REC                          <  
1789 ACTIVE = RET.FLAG                                               <  
1790 IF NOT(ACTIVE) THEN                                             <  
1791 LEVEL= APP.PO.LEVEL-1;ORD.TOT=OCONV(TOTAL.AMT,"MD4");APP.ARR="  <  
1792 USER = USER.ID ; DIV.OWNER = MPO.DIV.OWNER;TYPE = 3             <  
1793 CALL  FIND.APPROVERS (CONO,USER,DIV.OWNER,TYPE,LEVEL,ORD.TOT,A  <  
1794 END                                                             <  

1795 END                                                             <  
1796 ;*now that we have a default approver get all                   <  
1797 ;*active approvers for the user and add them to the list.       <  
1798 NBR.IDS = DCOUNT(APP.PO.ID<1,3>,SVM)                            <  
1799 FOR LL =1 TO NBR.IDS                                            <  
1800 MAT HOLD.APP.REQ.REC = MAT APP.REQ.REC                          <  
1801 USER = APP.PO.ID<1,3,LL>                                        <  

1802 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  
1803 MAT APP.REQ.REC = MAT HOLD.APP.REQ.REC                          <  
1804 IF RET.FLAG = 1 THEN                                            <  
1805 LOCATE APP.REQ.ID IN APP.ARR<1>,1 SETTING JUNK ELSE             <  
1806 APP.ARR<1,-1> = APP.REQ.ID                                      <  
1807 END                                                             <  
1808 END                                                             <  

1809 NEXT LL                                                         <  
1810 ;*set default and valid approvers values                        <  
1811 ECD.DEFAULT = OCONV(APP.ARR<1,1>[4,99],"G!1")                   <  
1812 NBR.IDS = DCOUNT(APP.ARR,VM)                                    <  
1813 VALID.INPUT = ""                                                <  
1814 FOR LL = 1 TO NBR.IDS                                           <  
1815 VALID.INPUT<1,-1>=OCONV(APP.ARR<1,LL>[4,99],"G!1")              <  

1816 NEXT LL                                                         <  
1817 ;*check to see if there are any approvers active                <  
1818 IF VALID.INPUT # "" THEN                                        <  
1819 ;*locate current approver to see if change is needed            <  
1820 CHANGE.NEEDED = 0                                               <  
1821 *    LOCATE MPO.APPROVER IN VALID.INPUT<1>,1 SETTING JUNK ELSE  <  
1822 *      CHANGE.NEEDED=1                                          <  

1823 *    END                                                        <  
1824 IF MPO.APPROVER # VALID.INPUT<1,1> THEN                         <  
1825 CHANGE.NEEDED = 1                                               <  
1826 END                                                             <  
1827 IF (CHANGE.NEEDED) OR OPTION = "CA" THEN                        <  
1828 VALID.INPUT = CONVERT(@VM,",",VALID.INPUT<1>)                   <  
1829 VALID.INPUT :=",???,END"                                        <  

1830 *                                                               <  
1831 EOI = 0                                                         <  
1832 LOOP                                                            <  
1833 ECD.NUM = 47                                                    <  
1834 ECD.VALDAT = VALID.INPUT                                        <  
1835 SCV.REC(47)<ECD.SCRN.NO,1> = ""                                 <  
1836 ECD.DEFAULT = OCONV(APP.ARR<1,1>[4,99],"G!1")                   <  

1837 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  
1838 BEGIN CASE                                                      <  
1839 CASE ECD.RET.VALUE = "END"                                      <  
1840 SKIP.RELEASE = 1                                                <  
1841 EOI = 1                                                         <  
1842 CASE ECD.RET.VALUE = "???"                                      <  
1843 MAT GEN.XREF.REC = ""                                           <  

1844 GXR.NAME = "APPROVER"                                           <  
1845 GXR.FILE = APP.REQ                                              <  
1846 GXR.IDLIST = APP.ARR                                            <  
1847 CALL GEN.XREF.SUB(MAT GEN.XREF.REC,PREFIX,XREF.DATA)            <  
1848 ECD.ACTION = 2 ; CALL SCRN.EDIT                                 <  
1849 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
1850 IF GXR.ID # "" THEN                                             <  

1851 GXR.ID = GXR.ID[4,99]                                           <  
1852 MPO.APPROVER = OCONV(GXR.ID,"G!1")                              <  
1853 SCV.REC(47)<ECD.SCRN.NO,1>= MPO.APPROVER                        <  
1854 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
1855 EOI = 1                                                         <  
1856 END                                                             <  
1857 CASE ECD.RET.VALUE # ""                                         <  

1858 EOI = 1                                                         <  
1859 MPO.APPROVER = ECD.RET.VALUE                                    <  
1860 APPROVER.LIMIT = APP.PO.LIMIT<1,3>                              <  
1861 END CASE                                                        <  
1862 UNTIL (EOI) DO REPEAT                                           <  
1863 END                                                             <  
1864 END ELSE                                                        <  

1865 SKIP.RELEASE = 1                                                <  
1866 ERRMSG="No approvers available at this time. You can only file  <  
1867 GOSUB 91000                                                     <  
1868 END                                                             <  
1869 END                                                             <  
1870 RETURN                                                          <  
1871 *                                                               <  

1872 *                                                               <  
1873 ***************                                                 <  
1874 ENT.APP.CODE:                                                   <  
1875 ***************                                                 <  
1876 *                                                               <  
1877 *T36138 v                                                       <  
1878 * IF YOU ARE MAKING CHANGES TO THE FORM YOU HAVE TO MANUALY AD  <  

1879 * passwordAND TURN IT OFF SETTING VALUE TO 0                    <  
1880 * TO DO THIS EDIT PMCFORMS {record name} AND LOCATE THE FIELD   <  
1881 * AND ADD IT TO THE END OF THE ATTRIBUTE. FOR PROMPT IT IS FIE  <  
1882 *IF SHOULD LOOK SOMETHING LIKE THIS                             <  
1883 * 1¦¦_pmc70                                                     <  
1884 *x_len¦char_col¦char_row¦char_length¦help_string¦cursor¦user_d  <  
1885 *riable¦13n9n27n1551¦¦8¦0¦21¦8¦¦_IBEAM.CUR¦¦0                   <  

1886 *                                                               <  
1887 *                                                               <  
1888 P_FIELDS ="_pmc70"                                              <  
1889 P_ATTRS = "password"                                            <  
1890 P_VALUES = 1                                                    <  
1891 ERROR = ""                                                      <  
1892 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  

1893 IF ERROR THEN                                                   <  
1894 ERRMSG = ERROR                                                  <  
1895 GOSUB 91000                                                     <  
1896 END                                                             <  
1897 *36138 ^                                                        <  
1898 ECD.NUM = 56 ; ECD.ACTION = 4 ; CALL SCRN.EDIT                  <  
1899 CODE.OK = 1                                                     <  

1900 IF ECD.RET.VALUE = APP.CODE THEN                                <  
1901 IF APP.PO.LEVEL = 1 AND OPTION='R' THEN                         <  
1902 MPO.STATUS<1,-1> = "Approved"                                   <  
1903 MPO.APP.LEVEL = APP.PO.LEVEL                                    <  
1904 MPO.APPROVER = ""                                               <  
1905 MPO.PREV.APP<1,-1> = USER.ID                                    <  
1906 MPO.ST.DATE<1,-1> = DATE()                                      <  

1907 GOSUB 1000                                                      <  
1908 ECD.ACTION = 6 ; CALL SCRN.EDIT                                 <  
1909 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
1910 *T36138 v                                                       <  
1911 P_FIELDS = "_pmc70"                                             <  
1912 P_ATTRS = "password"                                            <  
1913 P_VALUES = 0                                                    <  

1914 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
1915 IF ERROR THEN                                                   <  
1916 ERRMSG = ERROR                                                  <  
1917 GOSUB 91000                                                     <  
1918 END                                                             <  
1919 GOSUB 60                                                        <  
1920 *T36138 ^                                                       <  

1921 PROMPT.NBR = 50                                                 <  
1922 END ELSE                                                        <  
1923 *    MPO.STATUS<1,-1> = "Lvl ":APP.PO.LEVEL<1>:" Apr"           <  
1924 *    MPO.ST.DATE<1,-1> = DATE()                                 <  
1925 *    MPO.PREV.APP<1,-1> = USER.ID                               <  
1926 MPO.APP.LEVEL = APP.PO.LEVEL                                    <  
1927 *T36138 v                                                       <  

1928 GOSUB 1000                                                      <  
1929 ECD.ACTION = 6 ; CALL SCRN.EDIT                                 <  
1930 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
1931 P_FIELDS = "_pmc70"                                             <  
1932 P_ATTRS = "password"                                            <  
1933 P_VALUES = 0                                                    <  
1934 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  

1935 IF ERROR THEN                                                   <  
1936 ERRMSG = ERROR                                                  <  
1937 GOSUB 91000                                                     <  
1938 END                                                             <  
1939 *T36138 ^                                                       <  
1940 PROMPT.NBR = 51                                                 <  
1941 END                                                             <  

1942 END ELSE                                                        <  
1943 CODE.OK = 0                                                     <  
1944 ERRMSG = "Invalid Approval Code. "                              <  
1945 GOSUB 91000                                                     <  
1946 *T36138 v                                                       <  
1947 P_FIELDS = "_pmc70"                                             <  
1948 P_ATTRS = "password"                                            <  

1949 P_VALUES = 0                                                    <  
1950 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
1951 IF ERROR THEN                                                   <  
1952 ERRMSG = ERROR                                                  <  
1953 GOSUB 91000                                                     <  
1954 END                                                             <  
1955 *T36138 ^                                                       <  

1956 END                                                             <  
1957 RETURN                                                          <  
1958 *                                                               <  
1959 *25260 ^                                                        <  
1960 *T25854 v                                                       <  
1961 *                                                               <  
1962 DUPE.SUB:                                                       <  

1963 *                                                               <  
1964 ECD.NUM = 59                                                    <  
1965 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  
1966 IF ECD.RET.VALUE = "" OR ECD.RET.VALUE = "END" THEN GOTO 1      <  
1967 MATREAD MPO.REC FROM MISC.REQ, CONO:ECD.RET.VALUE ELSE          <  
1968 ERRMSG = "Requisition # entered not on file"                    <  
1969 GOSUB 91000                                                     <  

1970 GOTO DUPE.SUB                                                   <  
1971 END                                                             <  
1972 USER= USER.ID; DIV.OWNER = MPO.DIV.OWNER; APP.REQ.ID = ""       <  
1973 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  
1974 *T25854.2 v                                                     <  
1975 ECD.NUM = 60                                                    <  
1976 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  

1977 MPO.CODE = ECD.RET.VALUE                                        <  
1978 MATREAD MPO.REC FROM MISC.PO, CONO:MPO.CODE THEN                <  
1979 ERRMSG = "PO with number ":MPO.CODE: " already exists"          <  
1980 GOSUB 91000; RELEASE MISC.PO,CONO:MPO.CODE                      <  
1981 GOTO DUPE.SUB                                                   <  
1982 END                                                             <  
1983 MATREAD MPO.REC FROM MISC.REQ, CONO:MPO.CODE THEN               <  

1984 ERRMSG = "Requisition with number ":MPO.CODE:" already exists"  <  
1985 GOSUB 91000 ; RELEASE MISC.REQ,CONO:MPO.CODE ; GOTO DUPE.SUB    <  
1986 END                                                             <  
1987 *T25854.2 ^                                                     <  
1988 IF MPO.CODE = 'N' THEN                                          <  
1989 MPO.STATUS = 'Entered'                                          <  
1990 END ELSE                                                        <  

1991 MPO.STATUS = ''                                                 <  
1992 END                                                             <  
1993 MPO.ST.DATE = DATE()                                            <  
1994 MPO.PREV.APP = USER.ID                                          <  
1995 MPO.WRIT.BY = APP.NAME<1>                                       <  
1996 MPO.DATE = DATE()                                               <  
1997 MPO.APPROVER = ''                                               <  

1998 MPO.APP.LEVEL = ''                                              <  
1999 MPO.PREV.APP = ''                                               <  
2000 MPO.LEVEL.STATUS = ''                                           <  
2001 NEW = 1                                                         <  
2002 REQ = 1                                                         <  
2003 GOSUB 1000                                                      <  
2004 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  

2005 GOTO 95                                                         <  
2006 *T25854 ^                                                       <  
2007 *                                                               <  
2008 **** CALLS FOR SYSCOM                                              **** CALLS FOR SYSCOM
2009 91000 ERR.TYPE = 1; CALL SYSCOM(MAT SYSCOM.REC)                    91000 ERR.TYPE = 1; CALL SYSCOM(MAT SYSCOM.REC)
2010 RETURN                                                             RETURN
2011 92000 ERR.TYPE = 2; CALL SYSCOM(MAT SYSCOM.REC)                    92000 ERR.TYPE = 2; CALL SYSCOM(MAT SYSCOM.REC)


POSBP/OUTSIDE.PO.MAINT                                             /vsi/cust/rev11/cbn/CBA-CBN/CBNBP/OUTSIDE.PO.MAINT
Printed for thompson at 06/28/2006 04:47:58PM

0001 SUBROUTINE OUTSIDE.PO.MAINT                                     <  
0002 *COPY>CPYLIB>COM1                                                  *COPY>CPYLIB>COM1
0003 *COPY>POS.CPYLIB>COM.OPO                                           *COPY>POS.CPYLIB>COM.OPO
0004 *COPY>PMC.CPYLIB>COM.VEND                                          *COPY>PMC.CPYLIB>COM.VEND
0005 **************************************************************     ************************************************************
0006 * REVISION    - [08.0]                                             * REVISION    - [08.0]
0007 * Copyright 1982 by Computer Business Associates (Vercom Softw     * Copyright 1982 by Computer Business Associates (Vercom Sof

0027 *CSF25926 RKB 06101996 FIX BUG WITH MULTI VALUED ENTRIES           *CSF25926 RKB 06101996 FIX BUG WITH MULTI VALUED ENTRIES
0028 *T21177 diane 11/06/1996 * REV11 UPG                               *T21177 diane 11/06/1996 * REV11 UPG
0029 *                                                                  *
0030 *T23082 gat 07/20/1998 * FIX PO GUI PROBLEM                        *T23082 gat 07/20/1998 * FIX PO GUI PROBLEM
0031 *T23180 cindy 08/14/1998 * comment's prompt not gui'd, no tool     *T23180 cindy 08/14/1998 * comment's prompt not gui'd, no to
0032 *T23278 markt 10/21/1998 * Add check for divisional security    |  *T23225 bassem 09/10/1998 * Default Accrue field to 'Y' - Do
0033 *T23653 markt 02/04/1999 * Change erroneous GOSUB stmt to GOTO  |  *                           user.
0034 *T24231 edvard 08/25/1999 * Added logic for requisitions.       |  *T22746 cm 03/08/1999 * UPGRADE TO REV 11B
0035 *T24622 edvard 12/01/99   * Merge all fixes of the bugs found   |  *T23499 rick 08/12/1999 * Open file for operations for use i
0036 *                           testing LITHO version of the requi  |  *                         modify save logic to include new O

0037 *T24953 edvard 03/20/00 * Added additional logic for POR.       |  *                         attribute when identifying detail 
0038 *T24955 edvard 03/25/00 * Modified for requisition inquiry pro  |  *T23319 lanny 04/07/2000 * Correct UOM 'C' calc of cost
0039 *NOTE :                                                         <  
0040 *THIS PROGRAM IS ACTUALY A MAIN PROGRAM EXCEPT IF IT IS CALLED  <  
0041 *REQUISITION MENU.                                              <  
0042 *IF MAKING ANY CHANGES TO THIS PROGRAM MAKE SURE THAT YOU DO N  <  
0043 *BUFFER VALUES FOR IT IS VERY CRITICAL FOR PROPER FUNCTIONING   <  

0044 *BUFFER<1> CONTAINS EITHER "R" OR A "P" DEPENDING FROM WHAT ME  <  
0045 *COMMING FROM (PURCHASE ORDERS OR REQUISITION)                  <  
0046 *BUFFER<2> IS POPULATED IN A PROGRAM AND CAN BE "REQ" OR "PO"   <  
0047 *THAT THIS IS A PO OR A REQUISITION.                            <  
0048 *BUFFER<3> IS POPULATED IN REQ.INQ PROGRAM PRIOR TO CALLING TH  <  
0049 *AND HAS A VALUE OF "INQ".                                      <  
0050 *BUFFER<4> IS ALSO POPULATED IN REQ.INQ AND HAS A REQ NUMBER.   <  

0051 *ALSO CHECK A NOTE IN A PROGRAM ABOUT CHANGING AND REFILING TH  <  
0052 *LOOK FOR password KEYWORD.                                     <  
0053 *T23319 alex 04/11/2000 * Fix calculation of UOM Type ":C"; it  <  
0054 *                         defaulting as a "EA" Type.            <  
0055 *T25260 edvard 09/27/2000 * CHAGE THE FUNCITIONALITY OF DOLLAR  <  
0056 *                           THAT LIMIT CONTROLS ROUTING OF THE  <  
0057 *T25755 cm 04/17/2001 * Open file for operations for use in su  <  

0058 *                       modify save logic to include new POP.P  <  
0059 *                       attribute when identifying detail line  <  
0060 *T25861 bilal 05/30/2001 * Check flag to allow requestor to en  <  
0061 *                          requesition.                         <  
0062 *T25854 cm 06/13/2001 * Add duplicate function to program.      <  
0063 *T25858 edwin 06/14/01  * Add requestor field.                  <  
0064 *T25942 ajibaly 07/10/2001 * Change options to:                 <  

0065 *                         F- release for approval, H- put it o  <  
0066 *T26081 lanny 08/10/2001 * When coming from REQ INQ detail lin  <  
0067 *                          is retaining values from previous P  <  
0068 *                          qty/due date, etc.                   <  
0069 *T26127 lanny 08/31/2001 * The total $ on main screen have rou  <  
0070 *                          for um 'C' & 'M'.                    <  
0071 *T26152 alex 10/29/2001 * Set validation rule for the Accrue f  <  

0072 *                         based on the company POS setup.       <  
0073 *T25978 adelgado 02/07/2002 * Add the use of prompts (S,SR,SB,  <  
0074 *T25938 cmykleb 02/19/2002 * Add a duplicate function to Purch  <  
0075 *                            entry.                             <  
0076 *T26126 adelgado 02/26/2002 * Implement the LOCKED clause for   <  
0077 *T26471 lross 03/11/2002 * Default new Vendor terms if Vend No  <  
0078 *                          REQS.                                <  

0079 *T25941 ajibaly 06/27/2002 * Allow emailing POs to vendor func  <  
0080 *                            Removed unreachable subroutines (  <  
0081 *C40479 ajibaly 08/02/2002 * Make sure REQ -> PO process gets   <  
0082 *                            flag.                              <  
0083 *C40768 cmykleb 10/04/2002 * Requestor not displaying on PO Ma  <  
0084 *T27417 thompson 05/07/2003 * Change to not allow "F" or "C" o  <  
0085 *T27552 cmykleb 07/11/2003 * Correct error message problem.     <  

0086 *T27701 lross 09/11/2003 * Add SHIP.VIA XREF.                   <  
0087 *T27701 wyamout 10/01/2003 * REMOVE THE SHIP.VIA XREF FROM THE  <  
0088 *                            IT IS HANDLED BY THE SCREEN ALSO   <  
0089 *                            THE SHIP.VIA DEFAULT FROM THE VEN  <  
0090 *                            REV12 PROBLEM 15                   <  
0091 *T27786 thompson 11/13/2003 * Catch missing Accrued Flag PO's   <  
0092 *                             receipts had already been made.   <  

0093 *T27798 cmykleb 11/25/2003 * If a purchase requisition is on h  <  
0094 *                            the approver is a level 1 then al  <  
0095 *                            access to the requusution.         <  
0096 *T28244 lross 09/09/2004 * Delete requisition after Filing PO   <  
0097 **************************************************************     ************************************************************
0098 *ENDDOC                                                            *ENDDOC
0099 *                                                               <  

0100 **** INSERT FILES EQUATES                                          **** INSERT FILES EQUATES
0101 *                                                               <  
0102 *COPY>POS.CPYLIB>OUTSIDE.PO                                        *COPY>POS.CPYLIB>OUTSIDE.PO
0103 *COPY>PMC.CPYLIB>COMPANY                                           *COPY>PMC.CPYLIB>COMPANY
0104 *COPY>PMC.CPYLIB>VEND                                              *COPY>PMC.CPYLIB>VEND
0105 *COPY>JCS.CPYLIB>JOB                                               *COPY>JCS.CPYLIB>JOB
0106 *COPY>JCS.CPYLIB>CATEGORY.OSP                                      *COPY>JCS.CPYLIB>CATEGORY.OSP
0107 *COPY>JCS.CPYLIB>JOB.STATS                                         *COPY>JCS.CPYLIB>JOB.STATS

0106 *COPY>JCS.CPYLIB>CATEGORY.OSP                                      *COPY>JCS.CPYLIB>CATEGORY.OSP
0107 *COPY>JCS.CPYLIB>JOB.STATS                                         *COPY>JCS.CPYLIB>JOB.STATS
0108 *COPY>APS.CPYLIB>VEND.STATS                                        *COPY>APS.CPYLIB>VEND.STATS
0109 *COPY>APS.CPYLIB>VEND.PO.STATS                                     *COPY>APS.CPYLIB>VEND.PO.STATS
0110 *COPY>APS.CPYLIB>VEND.PROD.STATS                                   *COPY>APS.CPYLIB>VEND.PROD.STATS
0111                                                                 >  ***COPY>DEV.CPYLIB>PO.COMMENT.CODE
0112 *COPY>ICS.CPYLIB>WAREHOUSE                                         *COPY>ICS.CPYLIB>WAREHOUSE
0113 *COPY>PMC.CPYLIB>DIVISION                                          *COPY>PMC.CPYLIB>DIVISION
0114 *COPY>PMC.CPYLIB>TERMS                                             *COPY>PMC.CPYLIB>TERMS
0115 *COPY>PMC.CPYLIB>SHIP.VIA                                          *COPY>PMC.CPYLIB>SHIP.VIA

0118 *COPY>CPYLIB>EDIT.COM.DRIVER                                       *COPY>CPYLIB>EDIT.COM.DRIVER
0119 *COPY>CPYLIB>FILE.VARS                                             *COPY>CPYLIB>FILE.VARS
0120 *COPY>CPYLIB>GEN.XREF.SUB                                          *COPY>CPYLIB>GEN.XREF.SUB
0121 *COPY>CPYLIB>SYSCOM                                                *COPY>CPYLIB>SYSCOM
0122 *COPY>CPYLIB>CHAR                                                  *COPY>CPYLIB>CHAR
0123 *24231 v                                                        <  
0124 *COPY>PMC.CPYLIB>SECURITY                                       <  
0125 *COPY>POS.CPYLIB>APP.REQ                                        <  
0126 *                                                               <  
0127 DIM HOLD.APP.REQ.REC(20)                                        <  

0128 MAT APP.REQ.REC = ""                                            <  
0129 MAT HOLD.APP.REQ.REC = ""                                       <  
0130 *24231 ^                                                        <  
0131 *                                                               <  
0132 **** SETUP FOR SYSTEM ERRMSGS                                      **** SETUP FOR SYSTEM ERRMSGS
0133 *                                                               <  
0134 SYS.TYPE = 1                                                       SYS.TYPE = 1

0135 CALL SYSCOM(MAT SYSCOM.REC)                                        CALL SYSCOM(MAT SYSCOM.REC)
0136 PROCREAD BUFFER ELSE                                            <  
0137 ERRMSG = "MUST BE RUN FROM PROC"                                <  
0138 GOSUB 93000                                                     <  
0139 END                                                             <  
0140 * 25855 v                                                       <  
0141 IF BUFFER<1> = 'PI' THEN                                        <  
0142 BUFFER<1> = 'P'                                                 <  

0143 BUFFER<5> = 'I'                                                 <  
0144 PROCWRITE BUFFER                                                <  
0145 POS.INQ = 1                                                     <  
0146 END ELSE                                                        <  
0147 POS.INQ = 0                                                     <  
0148 END                                                             <  
0149 * 25855 ^                                                       <  

0150 *                                                               <  
0151 ***** GET COMPANY NAME                                             ***** GET COMPANY NAME
0152 *                                                               <  
0153 OPEN '','COMPANY' TO COMPANY ELSE                                  OPEN '','COMPANY' TO COMPANY ELSE
0154 ERRMSG = 'COMPANY FILE IS MISSING'                                 ERRMSG = 'COMPANY FILE IS MISSING'
0155 GOSUB 93000                                                        GOSUB 93000
0156 END                                                                END

0160 END                                                                END
0161 MAT COMP.REC = ''                                                  MAT COMP.REC = ''
0162 CONO = ''                                                          CONO = ''
0163 CALL GET.CONO(CONO,MAT COMP.REC)                                   CALL GET.CONO(CONO,MAT COMP.REC)
0164 IF CONO = "END" THEN GOSUB 99999                                   IF CONO = "END" THEN GOSUB 99999
0165 IF BUFFER<1> = "R" AND CO.PO.REQ.FLAG # "Y" THEN                <  
0166 ERRMSG = "Requisition system is not activated."                 <  
0167 GOSUB 91000                                                     <  
0168 GOSUB 99999                                                     <  
0169 END                                                             <  

0170 *                                                               <  
0171 **** OPEN FILES                                                    **** OPEN FILES
0172 *                                                               <  
0173 OPEN '','OUTSIDE.PO' TO OUTSIDE.PO ELSE                            OPEN '','OUTSIDE.PO' TO OUTSIDE.PO ELSE
0174 ERRMSG = 'OUTSIDE.PO FILE IS MISSING'                              ERRMSG = 'OUTSIDE.PO FILE IS MISSING'
0175 GOSUB 93000                                                        GOSUB 93000
0176 END                                                                END

0200 END                                                                END
0201 OPEN '','WAREHOUSE' TO WAREHOUSE ELSE                              OPEN '','WAREHOUSE' TO WAREHOUSE ELSE
0202 ERRMSG = 'WAREHOUSE FILE IS MISSING'                               ERRMSG = 'WAREHOUSE FILE IS MISSING'
0203 GOSUB 93000                                                        GOSUB 93000
0204 END                                                                END
0205                                                                 >  *OPEN '','PO.COMMENT.CODE' TO PO.COMMENT.CODE ELSE
0206                                                                 >  *  ERRMSG = 'PO.COMMENT.CODE FILE IS MISSING'
0207                                                                 >  *  GOSUB 93000
0208                                                                 >  *END
0209 OPEN '','XREF.DATA' TO XREF.DATA ELSE                              OPEN '','XREF.DATA' TO XREF.DATA ELSE

0208                                                                 >  *END
0209 OPEN '','XREF.DATA' TO XREF.DATA ELSE                              OPEN '','XREF.DATA' TO XREF.DATA ELSE
0210 ERRMSG = 'XREF.DATA FILE IS MISSING'                               ERRMSG = 'XREF.DATA FILE IS MISSING'
0211 GOSUB 93000                                                        GOSUB 93000
0212 END                                                                END
0213                                                                 >  * 16414
0214 OPEN '','POS.SCREENS' TO M.SCREENS ELSE                            OPEN '','POS.SCREENS' TO M.SCREENS ELSE
0215 ERRMSG = 'POS.SCREENS FILE IS MISSING'                             ERRMSG = 'POS.SCREENS FILE IS MISSING'
0216 GOSUB 93000                                                        GOSUB 93000
0217 END                                                                END

0218 ;*24231 v                                                       <  
0219 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0220 OPEN '','OUT.REQ' TO OUT.REQ ELSE                               <  
0221 ERRMSG = 'OUT.REQ FILE IS MISSING'; GOTO 93000                  <  
0222 END                                                             <  
0223 OPEN '','APP.REQ' TO APP.REQ ELSE                               <  
0224 ERRMSG = 'APP.REQ FILE IS MISSING'; GOTO 93000                  <  

0225 END                                                             <  
0226 OPEN '','SECURITY' TO SECURITY ELSE                             <  
0227 ERRMSG = 'SECURITY FILE IS MISSING'; GOTO 93000                 <  
0228 END                                                             <  
0229 USER.ID = UPCASE(@LOGNAME)                                      <  
0230 END                                                             <  
0231 ;*24231 ^                                                       <  

0259 END                                                                END
0260 OPEN 'COST.CNTR' TO COST.CNTR ELSE                                 OPEN 'COST.CNTR' TO COST.CNTR ELSE
0261 ERRMSG = "CANNOT OPEN COST.CNTR FILE"                              ERRMSG = "CANNOT OPEN COST.CNTR FILE"
0262 GOTO 93000                                                         GOTO 93000
0263 END                                                                END
0264 *T25755 v                                                       |  *T23499 v
0265 OPEN '','OPERATION' TO OPERATION ELSE                           |  OPEN "OPERATION" TO OPERATION ELSE 
0266 ERRMSG = 'OPERATION FILE IS MISSING'                            |  ERRMSG = "CANNOT OPEN OPERATION FILE"
0267 GOSUB 93000                                                     |  GOTO 93000
0268 END                                                                END

0269 *T25755 ^                                                       |  OPEN "CBN.SCREENS" TO SECOND.SCREENS ELSE
0270                                                                 >  ERRMSG="CANNOT OPEN CBN.SCREENS FILE"
0271                                                                 >  GOTO 93000
0272                                                                 >  END
0273                                                                 >  *T23499 ^
0274 IF CO.APS.O.INTRF > 2 THEN                                         IF CO.APS.O.INTRF > 2 THEN
0275 OPEN '','VEND.STATS' TO VEND.STATS ELSE                            OPEN '','VEND.STATS' TO VEND.STATS ELSE

0283 OPEN '','VEND.PROD.STATS' TO VEND.PROD.STATS ELSE                  OPEN '','VEND.PROD.STATS' TO VEND.PROD.STATS ELSE
0284 ERRMSG = 'VEND.PROD.STATS FILE IS MISSING'                         ERRMSG = 'VEND.PROD.STATS FILE IS MISSING'
0285 GOSUB 93000                                                        GOSUB 93000
0286 END                                                                END
0287 END                                                                END
0288 IF POS.INQ THEN                                                 <  
0289 OPEN '','OUT.REQ' TO OUT.REQ ELSE                               <  
0290 ERRMSG = 'OUT.REQ FILE IS MISSING'; GOTO 93000                  <  
0291 END                                                             <  
0292 END                                                             <  

0293 *                                                               <  
0294 ***** INIT                                                         ***** INIT
0295 *                                                               <  
0296 PW = ''                                                            PW = ''
0297 ACTION = ""                                                        ACTION = ""
0298 SAVE.REC = ''                                                      SAVE.REC = ''
0299 PAGE.SIZE = 2                                                      PAGE.SIZE = 2

0300 LINE.SPACE = 1                                                     LINE.SPACE = 1
0301 BEGIN.PAGE = 19                                                 |  BEGIN.PAGE = 18
0302 LINES = 0                                                          LINES = 0
0303 LN = 1                                                             LN = 1
0304 GEN.DIV = "00"; GEN.DEPT = "00"; GEN.CCTR = "000"; * 20080      |  * TASK 20080 v
0305                                                                 >  GEN.DIV = "00"; GEN.DEPT = "00"; GEN.CCTR = "000"
0306                                                                 >  * TASK 20080 ^
0307 START.LINE = 1                                                     START.LINE = 1

0308 OLD.START.LINE = 0                                                 OLD.START.LINE = 0
0309 ;*24231 v                                                       <  
0310 APPROVER.LIMIT = 999999999999                                   <  
0311 DIV = "" ; * 24953                                              <  
0312 TOTAL.AMT = 0                                                   <  
0313 ;*24231 ^                                                       <  
0314 *                                                               <  
0315 ***** READ SPECIAL INST                                            ***** READ SPECIAL INST

0316 *                                                               <  
0317 MATREAD SI.REC FROM CONTROL , CONO:"SPEC.INST" ELSE                MATREAD SI.REC FROM CONTROL , CONO:"SPEC.INST" ELSE
0318 MAT SI.REC = ''                                                    MAT SI.REC = ''
0319 END                                                                END
0320 SPI.CNT = COUNT(SI.INST, VM) + (SI.INST # '')                      SPI.CNT = COUNT(SI.INST, VM) + (SI.INST # '')
0321 *                                                               <  
0322 **** SET UP GEN.XREF.REC                                           **** SET UP GEN.XREF.REC

0323 *                                                               <  
0324 MAT GEN.XREF.REC = ''                                              MAT GEN.XREF.REC = ''
0325 GXR.CO = CONO                                                      GXR.CO = CONO
0326 *                                                               |  *     GXR.ATT<1,1> = 0
0327                                                                 >  *     GXR.ATT<1,2> = 1
0328                                                                 >  *     GXR.LEN<1,1> = 10
0329                                                                 >  *     GXR.LEN<1,2> = 30

0330 ***** MAIN PROCESSING                                              ***** MAIN PROCESSING
0331 *                                                               <  
0332 MAT EDIT.COM.DRIVER = ''                                           MAT EDIT.COM.DRIVER = ''
0333 ECD.SCRN.CNT = 5    ;*24231                                     |  ECD.SCRN.CNT = 2
0334 ECD.SCRN.NAME<1> = "OUTSIDE.PO.MAINT"                              ECD.SCRN.NAME<1> = "OUTSIDE.PO.MAINT"
0335 ECD.SCRN.NAME<2> = "OUTSIDE.PO.MAINT.SUB"                          ECD.SCRN.NAME<2> = "OUTSIDE.PO.MAINT.SUB"
0336 ;*24231 v                                                       |  ECD.SCRN.FLAG<2> = 2  ;*T23499
0337 ECD.SCRN.NAME<3> = "OUTSIDE.REQ.MAINT"                          |  * T23082

0338 ECD.SCRN.NAME<4> = "PO.REQ.LOG.INQ" ; *24231                    |  ECD.SCRN.NO = 1
0339 ECD.SCRN.NAME<5> = "OUTSIDE.PO.INQUIRY"                         |  * T23082
0340 IF BUFFER<1> = "R" THEN                                         |  ECD.ACTION=1;CALL SCRN.EDIT
0341 SCRN.NO = 3                                                     <  
0342 MENU.FLAG = "R"                                                 <  
0343 X_SCROLL1 = 11 ; X_SCROLL2 = 15       ; * 25858                 <  
0344 END ELSE                                                        <  

0345 IF POS.INQ THEN SCRN.NO = 5 ELSE SCRN.NO = 1                    <  
0346 MENU.FLAG = "P"                                                 <  
0347 BEGIN.PAGE -= 1                       ; * 25858                 <  
0348 X_SCROLL1 = 15 ; X_SCROLL2 = 19       ; * 25858                 <  
0349 END                                                             <  
0350 ECD.SCRN.NO = SCRN.NO                                           <  
0351 IF BUFFER<3> # "INQ" THEN ; * 24955                             <  

0352 ECD.ACTION = 1; CALL SCRN.EDIT                                  <  
0353 END ; * 24955                                                   <  
0354 ECD.SCRN.NO = SCRN.NO                                           <  
0355 ;*24231 ^                                                       <  
0356 1*                                                              <  
0357 *                                                               <  
0358 **** PRINT SCREEN                                                  **** PRINT SCREEN

0359 *                                                               |  1 *
0360 *T26081  IF BUFFER<3> # "INQ" THEN  ;*24955                     |  ECD.SCRN.NO = 1
0361 MAT SCV.REC = ""                                                   MAT SCV.REC = ""
0362 *26081  END ; * 24955                                           |  ECD.ACTION=6;CALL SCRN.EDIT
0363 ECD.ACTION=2;CALL SCRN.EDIT                                     <  
0364 5 *                                                             <  
0365 *                                                               <  

0366 ***** ENTER PO NUMBER                                              ***** ENTER PO NUMBER
0367 *                                                               |  5 *
0368 DUPLICATED.PO = 0 ; * T25938                                    <  
0369 NEW = 0                                                            NEW = 0
0370 FIRST.TIME = 0     ;* T26152                                    <  
0371 ;*24231 v                                                       <  
0372 PORDER = 0                                                      <  
0373 REQ = 0                                                         <  

0374 ;*24231 ^                                                       <  
0375 LINES = 0                                                          LINES = 0
0376 NEW.FLG = 1                                                        NEW.FLG = 1
0377 MAT OPO.REC = ''                                                   MAT OPO.REC = ''
0378 OPTION = ""                                                        OPTION = ""
0379 OLD.DATE = ""                                                      OLD.DATE = ""
0380 OLD.JOB = ""                                                       OLD.JOB = ""

0381                                                                 >  * 16414 *
0382 OLD.JOB.NO = ""                                                    OLD.JOB.NO = ""
0383 JOB.CNT = 1                                                        JOB.CNT = 1
0384 LAST.JOB.LN = 1                                                    LAST.JOB.LN = 1
0385                                                                 >  *
0386 JOB.LN = ""                                                        JOB.LN = ""
0387 OLD.PLINE = ""                                                     OLD.PLINE = ""

0386 JOB.LN = ""                                                        JOB.LN = ""
0387 OLD.PLINE = ""                                                     OLD.PLINE = ""
0388 OLD.QTY = ""                                                       OLD.QTY = ""
0389 OLD.COST = ""                                                      OLD.COST = ""
0390 REVIEW.FLAG = 0                                                    REVIEW.FLAG = 0
0391 ;*24955 v                                                       <  
0392 IF BUFFER<4>  # "" THEN                                         <  
0393 ECD.RET.VALUE = BUFFER<4>                                       <  
0394 BUFFER<4> = ""                                                  <  
0395 END ELSE                                                        <  

0396 ;*24955 ^                                                       <  
0397 IF NOT(POS.INQ) THEN ECD.DEFAULT = 'N'  ; * 25855               <  
0398 ECD.NUM = 5                                                        ECD.NUM = 5
0399 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
0400 END ; *24955                                                    <  
0401 OPO.CODE = ECD.RET.VALUE                                           OPO.CODE = ECD.RET.VALUE
0402 BEGIN CASE                                                         BEGIN CASE

0403 CASE ECD.RET.VALUE = 'END'                                         CASE ECD.RET.VALUE = 'END'
0404 GOSUB 99999                                                        GOSUB 99999
0405 CASE ECD.RET.VALUE = "N" AND NOT(POS.INQ)   ; * 25855           |  CASE ECD.RET.VALUE = "N"
0406 NEW = 1                                                            NEW = 1
0407 LINES = 0                                                          LINES = 0
0408 ; *24231 v                                                      |  CASE ECD.RET.VALUE # ""
0409 IF MENU.FLAG = "R" THEN                                         |  MATREADU OPO.REC FROM OUTSIDE.PO, CONO:OPO.CODE THEN
0410 OPO.STAT<1,-1> = "Entered"                                      <  
0411 OPO.ST.DATE<1,-1> = DATE()                                      <  

0412 OPO.PREV.APP<1,-1> = USER.ID                                    <  
0413 SCV.REC(3)<ECD.SCRN.NO,1> = OPO.STAT                            <  
0414 ECD.NUM = 3 ; ECD.ACTION = 5 ; CALL SCRN.EDIT                   <  
0415 SCV.REC(4)<ECD.SCRN.NO,1> = OCONV(OPO.ST.DATE,"D2/")            <  
0416 ECD.NUM = 4 ;  CALL SCRN.EDIT                                   <  
0417 END                                                             <  
0418 ; *24231 ^                                                      <  

0419 *T25938 v                                                       <  
0420 CASE MENU.FLAG = "P" AND ECD.RET.VALUE = "D" AND NOT(POS.INQ)   <  
0421 ECD.NUM=1;ECD.ACTION=4;CALL SCRN.EDIT                           <  
0422 IF ECD.RET.VALUE = "END" OR ECD.RET.VALUE = "" THEN GOTO 5      <  
0423 DUP.PONO = ECD.RET.VALUE                                        <  
0424 MATREAD OPO.REC FROM OUTSIDE.PO, CONO:DUP.PONO ELSE             <  
0425 ERRMSG = "Outside PO # entered not on file"                     <  

0426 GOSUB 91000                                                     <  
0427 GOTO 5                                                          <  
0428 END                                                             <  
0429 ECD.NUM=2;ECD.ACTION=4;CALL SCRN.EDIT                           <  
0430 OPO.CODE = ECD.RET.VALUE                                        <  
0431 BEGIN CASE                                                      <  
0432 CASE OPO.CODE = "END" OR OPO.CODE = ""                          <  

0433 GOTO 5                                                          <  
0434 CASE OPO.CODE = "N"                                             <  
0435 SCV.REC(5)<1> = OPO.CODE;ECD.NUM = 5; ECD.ACTION = 5; CALL SCR  <  
0436 CASE OPO.CODE # ""                                              <  
0437 SCV.REC(5)<1> = OPO.CODE;ECD.NUM = 5; ECD.ACTION = 5; CALL SCR  <  
0438 READ REC FROM OUTSIDE.PO, CONO: OPO.CODE THEN                   <  
0439 ERRMSG = "Outside PO # already exists on file"                  <  

0440 GOSUB 91000                                                     <  
0441 GOTO 5                                                          <  
0442 END                                                             <  
0443 MATBUILD SAVE.REC FROM OPO.REC                                     MATBUILD SAVE.REC FROM OPO.REC
0444 END CASE                                                        <  
0445 ECD.NUM=3;ECD.ACTION=4;CALL SCRN.EDIT                           <  
0446 JOB.CLEAR = ECD.RET.VALUE                                       <  

0447 DUPLICATED.PO = 1                                               <  
0448 OPO.DATE = DATE()                                               <  
0449 OPO.ST.DATE = DATE()                                            <  
0450 OPO.DATE.RECVD = ""                                             <  
0451 OPO.CANCEL.DATE = ""                                            <  
0452 OPO.QTY.RECVD = ""                                              <  
0453 OPO.EXP.DATE = ""                                               <  

0454 OPO.PRT.FLG = "Y"                                               <  
0455 IF JOB.CLEAR = "Y" THEN OPO.JOB.NO = ""                         <  
0456 *T25938 ^                                                       <  
0457 *T25854 v                                                       <  
0458 CASE MENU.FLAG="R" AND ECD.RET.VALUE="D" AND NOT(POS.INQ) ; *2  <  
0459 GOTO DUPE.SUB                                                   <  
0460 *T25854 ^                                                       <  

0461 CASE ECD.RET.VALUE # "" AND NOT(POS.INQ)   ; * 25855            <  
0462 * T26126 v                                                      <  
0463 MATREADU OPO.REC FROM OUTSIDE.PO, CONO:OPO.CODE LOCKED          <  
0464 ERRMSG = 'P/O record is locked by user - ':GETUSERNAME(STATUS(  <  
0465 GOSUB 91000;GOTO 5                                              <  
0466 END THEN                                                        <  
0467 * T26126 ^                                                      <  

0468 ;*24231 v                                                       <  
0469 IF MENU.FLAG = "R" THEN                                         <  
0470 ERRMSG = "PO with number ":OPO.CODE: " already exists"          <  
0471 GOSUB 91000; RELEASE OUTSIDE.PO,CONO:OPO.CODE                   <  
0472 GOTO 5                                                          <  
0473 END                                                             <  
0474 PORDER = 1  ; * this is a purchase order since found in PO fil  <  

0475 END ELSE                                                           END ELSE
0476 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0477 * T26126 v                                                      <  
0478 MATREADU OPO.REC FROM OUT.REQ, CONO:OPO.CODE LOCKED             <  
0479 ERRMSG = 'P/O record is locked by user - ':GETUSERNAME(STATUS(  <  
0480 GOSUB 91000;GOTO 5                                              <  
0481 END THEN                                                        <  
0482 * T26126 ^                                                      <  

0483 IF MENU.FLAG = "P" THEN                                         <  
0484 ERRMSG = "Requisition with number ":OPO.CODE:" already exists"  <  
0485 GOSUB 91000 ; RELEASE OUT.REQ,CONO:OPO.CODE ; GOTO 5            <  
0486 END                                                             <  
0487 REQ = 1 ; * this is still requisition                           <  
0488 END                                                             <  
0489 END                                                             <  

0490 END                                                             <  
0491 IF OPO.APP.LEVEL = "C" THEN                                     <  
0492 IF (REQ) THEN                                                   <  
0493 ERRMSG = "Requisition: ":OPO.CODE:" was cancelled. Cannot make  <  
0494 GOSUB 91000                                                     <  
0495 END ELSE                                                        <  
0496 ERRMSG = "PO ":OPO.CODE:" was cancelled. You cannot make any c  <  

0497 GOSUB 91000                                                     <  
0498 END                                                             <  
0499 END                                                             <  
0500 IF NOT(PORDER) AND NOT (REQ) THEN                               <  
0501 ;*24231 ^                                                       <  
0502 X = 0; Y = 22; TYP = 8; MAXL = 1                                   X = 0; Y = 22; TYP = 8; MAXL = 1
0503 PMSG = OPO.CODE:" IS NOT ON FILE. DO YOU WANT TO ADD (Y/N)"        PMSG = OPO.CODE:" IS NOT ON FILE. DO YOU WANT TO ADD (Y/N)"

0504 CALL EDIT.SUB                                                      CALL EDIT.SUB
0505 P_X  = 0 ; P_Y = 22 ; P_VALUE = "" ; P_OPT = "CL"                  P_X  = 0 ; P_Y = 22 ; P_VALUE = "" ; P_OPT = "CL"
0506 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
0507 IF VALUE = "Y" THEN                                                IF VALUE = "Y" THEN
0508 NEW = 1                                                            NEW = 1
0509 ;*24231 v                                                       <  
0510 IF MENU.FLAG = "R" THEN                                         <  
0511 REQ = 1                                                         <  
0512 END ELSE                                                           END ELSE
0513 PORDER = 1                                                      <  

0514 END                                                             <  
0515 ;*24231^                                                        <  
0516 END ELSE                                                        <  
0517 RELEASE OUTSIDE.PO, CONO:OPO.CODE                                  RELEASE OUTSIDE.PO, CONO:OPO.CODE
0518 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0519 RELEASE OUT.REQ, CONO:OPO.CODE  ; *24231                        <  
0520 END                                                             <  

0521 GOTO 5                                                             GOTO 5
0522 END                                                                END
0523 END ; *24231                                                    <  
0524 IF NOT(NEW) THEN ;*24231                                        <  
0525 ;*T23278 v                                                      <  
0526 DIV.CODE = OPO.DIV.OWNER; USER.ID = UPCASE(@LOGNAME); ERRMSG =  <  
0527 CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)               <  
0528 IF ERRMSG # '' THEN                                             <  
0529 GOSUB 91000; SCV.REC(5)<1,1> = ''; GOTO 5                       <  

0530 END                                                                END
0531 ;*T23278 ^                                                      <  
0532 ;*24231 v                                                       <  
0533 IF MENU.FLAG = "R" THEN                                         <  
0534 ;*25260 v                                                       <  
0535 ;* moved the logic to subroutine so it can be reused            <  
0536 USER= USER.ID; DIV.OWNER = OPO.DIV.OWNER; APP.REQ.ID = ""       <  
0537 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  

0538 VALID = RET.FLAG                                                <  
0539 ;*25260 ^                                                       <  
0540 IF NOT(VALID) THEN                                              <  
0541 ERRMSG = "Profile for user ":USER.ID:" is either missing or is  <  
0542 GOSUB 91000                                                     <  
0543 GOTO 5                                                          <  
0544 END                                                             <  

0545 END                                                             <  
0546 ;*24231 ^                                                       <  
0547 MATBUILD SAVE.REC FROM OPO.REC                                  <  
0548 END;*24231                                                      <  
0549 CASE POS.INQ                 ; * 25855                          <  
0550 OPO.CODE = ECD.RET.VALUE                                        <  
0551 MATREAD OPO.REC FROM OUTSIDE.PO, CONO:OPO.CODE ELSE             <  

0552 MATREAD OPO.REC FROM OUT.REQ, CONO:OPO.CODE ELSE                <  
0553 ERRMSG = "PO with number ":OPO.CODE:" not found"                <  
0554 GOSUB 91000; GOTO 5                                             <  
0555 END                                                             <  
0556 END                                                             <  
0557 DIV.CODE=OPO.DIV.OWNER ; USER.ID=UPCASE(@LOGNAME) ; ERRMSG=""   <  
0558 CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)               <  

0559 IF ERRMSG # '' THEN GOSUB 91000 ; SCV.REC(5)<1,1> = '' ; GOTO   <  
0560 END CASE                                                           END CASE
0561 IF NEW THEN                                                        IF NEW THEN
0562                                                                 >  * 16414 *
0563 OPTION.3 = 'A'                                                     OPTION.3 = 'A'
0564 FIRST.TIME = 1     ;* T26152                                    <  
0565 ;*24231 v                                                       <  

0566 IF MENU.FLAG = "R" THEN                                         <  
0567 REQ = 1                                                         <  
0568 FOR S=1 TO 13 UNTIL ECD.RET.VALUE = "END"                       <  
0569 ON S GOSUB 150,100,200,300,500,650,700,800,900,3000,1100,1200,  <  
0570 NEXT S                                                          <  
0571 END ELSE                                                        <  
0572 PORDER = 1                                                      <  

0573 ;*24231 ^                                                       <  
0574 FOR S = 1 TO 14 UNTIL ECD.RET.VALUE = "END"                        FOR S = 1 TO 14 UNTIL ECD.RET.VALUE = "END"
0575 ON S GOSUB 150,100,200,300,500,600,700,800,900,3000,1100,1200,     ON S GOSUB 150,100,200,300,500,600,700,800,900,3000,1100,120
0576 NEXT S                                                             NEXT S
0577 END ;*24231                                                     <  
0578 FIRST.TIME = 0     ;* T26152                                    <  
0579 IF ECD.RET.VALUE = "END" THEN                                      IF ECD.RET.VALUE = "END" THEN

0580 ;*24231 v                                                       |  IF OPO.CODE # "N" THEN RELEASE OUTSIDE.PO, CONO:OPO.CODE
0581 IF OPO.CODE # "N" THEN                                          <  
0582 RELEASE OUTSIDE.PO, CONO:OPO.CODE                               <  
0583 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0584 RELEASE OUT.REQ, CONO:OPO.CODE                                  <  
0585 END                                                             <  
0586 END                                                             <  

0587 ;*24231 ^                                                       <  
0588 ;*24955 v                                                       <  
0589 IF BUFFER<3> = 'INQ' THEN                                       <  
0590 GOSUB 99999                                                     <  
0591 END ELSE                                                        <  
0592 ;*24955 ^                                                       <  
0593 GOTO 1                                                             GOTO 1

0594 END ; * 24955                                                   <  
0595 ECD.ACTION = 99 ; CALL SCRN.EDIT                                <  
0596 END                                                                END
0597 END ELSE                                                           END ELSE
0598 GOSUB BUILD.SCV.REC                                             |  VEND.KEY = CONO:OPO.VEND.NO
0599                                                                 >  MATREAD VEND.REC FROM VEND , VEND.KEY ELSE
0600                                                                 >  MAT VEND.REC = "????????????????"

0601                                                                 >  END
0602                                                                 >  * 16414
0603                                                                 >  MATREAD JOB.REC FROM JOB, CONO:OPO.JOB.NO<1,1> ELSE
0604                                                                 >  JOB.DESC = "??????????????????????"
0605                                                                 >  END
0606                                                                 >  JOB.CNT = DCOUNT(OPO.JOB.NO<1>,VM)
0607                                                                 >  *

0608                                                                 >  *CSF25926 v
0609                                                                 >  *        MATREAD CAOS.REC FROM CATEGORY.OSP, CONO:OPO.PROD.L
0610                                                                 >  *           MAT CAOS.REC = ""
0611                                                                 >  *        END
0612                                                                 >  *        IF OPO.CANCEL.QTY # "" THEN
0613                                                                 >  *           EXP.QTY = OPO.QTY - OPO.CANCEL.QTY
0614                                                                 >  *        END ELSE

0615                                                                 >  *           EXP.QTY = OPO.QTY
0616                                                                 >  *        END
0617                                                                 >  *CSF25926 ^
0618                                                                 >  SCV.REC(6)<ECD.SCRN.NO,1> = OPO.VEND.NO
0619                                                                 >  SCV.REC(7)<ECD.SCRN.NO,1> = OPO.DATE
0620                                                                 >  SCV.REC(8)<ECD.SCRN.NO,1> = VEND.PO.DESC
0621                                                                 >  SCV.REC(9)<ECD.SCRN.NO,1> = OPO.JOB.NO<1,1>

0622                                                                 >  SCV.REC(10)<ECD.SCRN.NO,1> = VEND.PO.ADDR1
0623                                                                 >  *   SCV.REC(11)<ECD.SCRN.NO,1> = OPO.JOB.DESC<1,1>[1,25]
0624                                                                 >  SCV.REC(12)<ECD.SCRN.NO,1> = VEND.PO.ADDR2
0625                                                                 >  *   SCV.REC(13)<ECD.SCRN.NO,1> = OPO.JOB.DESC<1,1>[25,25]
0626                                                                 >  SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)
0627                                                                 >  SCV.REC(15)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)
0628                                                                 >  SCV.REC(16)<ECD.SCRN.NO,1> = VEND.PO.ZIP

0629                                                                 >  SCV.REC(54)<ECD.SCRN.NO,1> = VEND.PHONE
0630                                                                 >  SCV.REC(55)<ECD.SCRN.NO,1> = VEND.FAX
0631                                                                 >  SCV.REC(17)<ECD.SCRN.NO,1> = OPO.ACCRUE
0632                                                                 >  *   SCV.REC(17)<ECD.SCRN.NO,1> = EXP.QTY
0633                                                                 >  *   SCV.REC(18)<ECD.SCRN.NO,1> = OPO.FIN.SIZE
0634                                                                 >  *   SCV.REC(19)<ECD.SCRN.NO,1> = OPO.EST.COST
0635                                                                 >  *  SCV.REC(17)<ECD.SCRN.NO,1> = OPO.DATE

0636                                                                 >  SCV.REC(20)<ECD.SCRN.NO,1> = OPO.VDR.ORD
0637                                                                 >  SCV.REC(48)<ECD.SCRN.NO,1> = OPO.WHSE
0638                                                                 >  SCV.REC(21)<ECD.SCRN.NO,1> = OPO.SHIP.NAME
0639                                                                 >  SCV.REC(22)<ECD.SCRN.NO,1> = OPO.SHIP.ADDR1
0640                                                                 >  SCV.REC(23)<ECD.SCRN.NO,1> = OPO.SHIP.ADDR2
0641                                                                 >  SCV.REC(24)<ECD.SCRN.NO,1> = FIELD(OPO.SHIP.ADDR3,",",1)
0642                                                                 >  SCV.REC(25)<ECD.SCRN.NO,1> = FIELD(OPO.SHIP.ADDR3,",",2)

0643                                                                 >  SCV.REC(26)<ECD.SCRN.NO,1> = OPO.SHIP.ADDR4
0644                                                                 >  SCV.REC(27)<ECD.SCRN.NO,1> = OPO.TERMS.DESC
0645                                                                 >  SCV.REC(28)<ECD.SCRN.NO,1> = OPO.TERMS.DISC
0646                                                                 >  SCV.REC(29)<ECD.SCRN.NO,1> = OPO.TERMS.DATE
0647                                                                 >  SCV.REC(30)<ECD.SCRN.NO,1> = OPO.SHIP.VIA
0648                                                                 >  SCV.REC(31)<ECD.SCRN.NO,1> = OPO.VIA.DESC
0649                                                                 >  SCV.REC(32)<ECD.SCRN.NO,1> = OPO.FOB

0650                                                                 >  SCV.REC(43)<ECD.SCRN.NO,1> = OPO.PRT.FLG
0651                                                                 >  SCV.REC(44)<ECD.SCRN.NO,1> = OPO.ORD.BY
0652                                                                 >  *   SCV.REC(37)<ECD.SCRN.NO,1> = OPO.PROD.LINE
0653                                                                 >  SCV.REC(47)<ECD.SCRN.NO,1> = OPO.CONTACT
0654                                                                 >  *   SCV.REC(48)<ECD.SCRN.NO,1> = OPO.WHSE
0655                                                                 >  GOSUB 1020
0656                                                                 >  * 16414

0657                                                                 >  SCV.REC(52)<ECD.SCRN.NO,1> = OPO.INTRAL.INT
0658                                                                 >  OLD.DATE = OPO.DATE
0659                                                                 >  * 16414 *
0660                                                                 >  * 19404 *
0661                                                                 >  SCV.REC(53)<ECD.SCRN.NO,1> = OPO.DIV.OWNER
0662                                                                 >  * 19404 *
0663                                                                 >  OLD.JOB = OPO.JOB.NO<1,1>

0664                                                                 >  OLD.JOB.NO = OPO.JOB.NO
0665                                                                 >  OLD.PLINE = OPO.PROD.LINE
0666                                                                 >  *CSF25926      OLD.QTY = OPO.QTY - OPO.CANCEL.QTY
0667                                                                 >  *CSF25926      OLD.COST = OPO.EST.COST - OPO.CANCEL.COST
0668 ECD.ACTION=3;CALL SCRN.EDIT                                        ECD.ACTION=3;CALL SCRN.EDIT
0669 END                                                                END
0670 IF OPO.INTRAL.INT # '' THEN                                        IF OPO.INTRAL.INT # '' THEN

0669 END                                                                END
0670 IF OPO.INTRAL.INT # '' THEN                                        IF OPO.INTRAL.INT # '' THEN
0671 LINES = DCOUNT(OPO.INTRAL.INT,VM)                                  LINES = DCOUNT(OPO.INTRAL.INT,VM)
0672 GOSUB 3800                                                         GOSUB 3800
0673 END                                                                END
0674 ;*24231 v                                                       <  
0675 *                                                               <  
0676 **** ENTER OPTIONS                                              <  
0677 *                                                               <  
0678 90 * ; * T25854                                                 <  

0679 ;*25260 v                                                       <  
0680 IF NOT(NEW) AND MENU.FLAG = "R" THEN                            <  
0681 INQ.MODE = 0                                                    <  
0682 IF USER.ID # OPO.APPROVER THEN                                  <  
0683 BEGIN CASE                                                      <  
0684 CASE APP.PO.LEVEL > 1                                           <  
0685 LOCATE USER.ID IN OPO.PREV.APP<1> SETTING POS ELSE              <  

0686 INQ.MODE = 1                                                    <  
0687 PROMPT.NBR = 60                                                 <  
0688 END                                                             <  
0689 *T27798     CASE APP.PO.LEVEL=1                                 <  
0690 *T27798        IF OPO.LEVEL.STATUS='H' AND OPO.APP.LEVEL#1 THE  <  
0691 *T27798           INQ.MODE=1                                    <  
0692 *T27798           PROMPT.NBR = 60                               <  

0693 *T27798        END                                              <  
0694 END CASE                                                        <  
0695 END                                                             <  
0696 IF NOT(INQ.MODE) THEN                                           <  
0697 IF OPO.APP.LEVEL < APP.PO.LEVEL OR OPO.APP.LEVEL = "C" THEN     <  
0698 IF APP.PO.LEVEL = 1 AND OPO.APP.LEVEL # "C" THEN                <  
0699 PROMPT.NBR = 58                                                 <  

0700 END ELSE                                                        <  
0701 PROMPT.NBR = 60 ; * only inquiry                                <  
0702 END                                                             <  
0703 END ELSE                                                        <  
0704 BEGIN CASE                                                      <  
0705 CASE USER.ID=OPO.APPROVER OR APP.PO.LEVEL = 1 OR OPO.APPROVER=  <  
0706 PROMPT.NBR = 58 ;* #,N,L,F,C,R,SI,P,E                           <  

0707 CASE 1                                                          <  
0708 PROMPT.NBR = 57                                                 <  
0709 END CASE                                                        <  
0710 END                                                             <  
0711 END                                                             <  
0712 END                                                             <  
0713 ;*25260                                                         <  

0714 IF (NEW) OR MENU.FLAG = "P" THEN                                <  
0715 IF CO.PO.REQ.FLAG= "Y" THEN                                     <  
0716 IF APP.PO.LEVEL = 1 THEN                                        <  
0717 ;*25260        PROMPT.NBR = 56                                  <  
0718 PROMPT.NBR = 58                                                 <  
0719 END ELSE                                                        <  
0720 IF POS.INQ THEN PROMPT.NBR = 57 ELSE PROMPT.NBR = 35            <  

0721 END                                                             <  
0722 END ELSE                                                        <  
0723 PROMPT.NBR = 56                                                 <  
0724 END                                                             <  
0725 END                                                             <  
0726 MORE = 0                                                           MORE = 0
0727 LOOP                                                               LOOP

0728 ECD.NUM = PROMPT.NBR ; * 24231                                  |  *       IF REVIEW.FLAG THEN
0729                                                                 >  *          ECD.NUM = 39
0730                                                                 >  *       END ELSE
0731                                                                 >  ECD.NUM = 35
0732                                                                 >  *       END
0733 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
0734 OPTION = ECD.RET.VALUE                                             OPTION = ECD.RET.VALUE

0735 BEGIN CASE                                                         BEGIN CASE
0736 CASE OPTION = 'END' OR OPTION = 'E'                                CASE OPTION = 'END' OR OPTION = 'E'
0737 ;*24231 v                                                       |  IF OPO.CODE # "N" THEN RELEASE OUTSIDE.PO, CONO:OPO.CODE
0738 IF OPO.CODE # "N" THEN                                          <  
0739 RELEASE OUTSIDE.PO, CONO:OPO.CODE                               <  
0740 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0741 RELEASE OUT.REQ, CONO:OPO.CODE                                  <  
0742 END                                                             <  
0743 END                                                             <  

0744 MORE = 1                                                           MORE = 1
0745 CASE NUM(OPTION)                                                   CASE NUM(OPTION)
0746 IF REQ THEN                                                     <  
0747 ON OPTION GOSUB 100,200,300,500,650,600,700,800,900,3000,1100,  <  
0748 END ELSE                                                        <  
0749 ON OPTION GOSUB 100,200,300,500,600,700,800,900,3000,1100,1200     ON OPTION GOSUB 100,200,300,500,600,700,800,900,3000,1100,12
0750 END                                                             |  *     CASE OPTION = "C"
0751 CASE OPTION = "CO"                                              |  *       GOSUB 6000
0752 GOSUB 3600                                                      <  

0753 CASE OPTION = "SI"                                                 CASE OPTION = "SI"
0754 ***         IF POS.INQ THEN GOSUB 7500 ELSE GOSUB 5000          <  
0755 GOSUB 5000                                                         GOSUB 5000
0756 CASE OPTION = 'N'                                                  CASE OPTION = 'N'
0757                                                                 >  ECD.SCRN.NO = 2
0758                                                                 >  ECD.ACTION = 2 ; CALL SCRN.EDIT
0759 IF NOT(NEW) THEN NEW.FLG = 0                                       IF NOT(NEW) THEN NEW.FLG = 0
0760 *T25938 v                                                       |  CALL OUTSIDE.PO.MAINT.SUB(CONO,OPO.CODE,NEW.FLG)

0761 *           CALL OUTSIDE.PO.MAINT.SUB(CONO,OPO.CODE,NEW.FLG)    <  
0762 CALL OUTSIDE.PO.MAINT.SUB(CONO,OPO.CODE,NEW.FLG,DUPLICATED.PO)  <  
0763 *T25938 ^                                                       <  
0764 IF NEW.FLG THEN NEW.FLG = 0                                        IF NEW.FLG THEN NEW.FLG = 0
0765 ECD.SCRN.NO = SCRN.NO ;*24231                                   |  ECD.SCRN.NO = 1
0766 GOSUB 1020                                                         GOSUB 1020
0767 ECD.ACTION=2;CALL SCRN.EDIT                                        ECD.ACTION=2;CALL SCRN.EDIT

0768 ECD.ACTION=3;CALL SCRN.EDIT                                        ECD.ACTION=3;CALL SCRN.EDIT
0769                                                                 >  *            LN = 1; OLD.START.LINE = 0
0770                                                                 >  *            GOSUB 10000
0771 GOSUB 3800                                                         GOSUB 3800
0772 MORE = 0                                                           MORE = 0
0773 CASE OPTION = "CA"                                              |  CASE OPTION = 'F'
0774 GOSUB CHOOSE.APPROVER ; *25260                                  <  
0775 CASE OPTION = "L"                                               <  

0776 ECD.SCRN.NO = 4                                                 <  
0777 STATUS = OPO.STAT                                               <  
0778 ST.DATE = OPO.ST.DATE                                           <  
0779 USER = OPO.PREV.APP                                             <  
0780 CALL PO.REQ.LOG.INQ(STATUS, ST.DATE, USER)                      <  
0781 ECD.SCRN.NO = SCRN.NO                                           <  
0782 ECD.ACTION=2;CALL SCRN.EDIT                                     <  

0783 ECD.ACTION=3;CALL SCRN.EDIT                                     <  
0784 *T27417  CASE OPTION = "C"                                      <  
0785 CASE OPTION = "C" AND POS.INQ = 0                               <  
0786 X = 0; Y = 22; TYP = 18; MAXL = 1; O.R = "R"                    <  
0787 PMSG = "Do you really want to cancel thisi requistion (Y/N) ?"  <  
0788 CALL EDIT.SUB                                                   <  
0789 P_X = 0 ; P_Y = 22 ; P_VALUE = "" ; P_OPT = "CL"                <  

0790 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                           <  
0791 IF VALUE = "Y" THEN                                             <  
0792 OPO.STAT<1,-1> = "Cancelled"                                    <  
0793 OPO.ST.DATE<1,-1> = DATE()                                      <  
0794 OPO.PREV.APP<1,-1> = USER.ID                                    <  
0795 OPO.APPROVER = ""                                               <  
0796 OPO.APP.LEVEL = "C"                                             <  

0797 MATWRITE OPO.REC ON OUT.REQ,CONO:OPO.CODE                       <  
0798 MORE = 1                                                        <  
0799 END                                                             <  
0800 ;*24231 ^                                                       <  
0801 ;*25260 v                                                       <  
0802 *T27417         CASE OPTION = 'F' OR OPTION = 'H'               <  
0803 CASE (OPTION = 'F' OR OPTION = 'H') AND POS.INQ = 0             <  

0804 *T25938 v                                                       <  
0805 IF MENU.FLAG = "P" THEN                                         <  
0806 OCNT = DCOUNT(OPO.PROD.LINE<1>,VM)                              <  
0807 OFLAG = ""                                                      <  
0808 FOR O = 1 TO OCNT                                               <  
0809 IF OPO.EXP.DATE<1,O> = "" THEN OFLAG = 1                        <  
0810 NEXT O                                                          <  

0811 IF OFLAG THEN                                                   <  
0812 ERRMSG = "Some Delivery dates have not been entered on the det  <  
0813 GOSUB 91000                                                     <  
0814 GOTO 90                                                         <  
0815 END                                                             <  
0816 END                                                             <  
0817 *T25938 ^                                                       <  

0818 *T25942     CASE OPTION = 'F' OR OPTION = "R"  ; *24231         <  
0819 ;* R- release for approval, F- put it on hold                   <  
0820 GO.BACK = 0                                                     <  
0821 IF (MENU.FLAG = "R") THEN                                       <  
0822 *T25942               IF OPTION= "R" THEN                       <  
0823 IF OPTION= "F" THEN                                             <  
0824 IF DCOUNT(OPO.PROD.LINE,VM) > 0 THEN                            <  

0825 IF APP.PO.LEVEL # 1 THEN                                        <  
0826 IF APP.PO.LEVEL # CO.PO.APP.LEVELS THEN                         <  
0827 GOSUB ENT.APP.CODE                                              <  
0828 IF (CODE.OK) THEN                                               <  
0829 GOSUB CHOOSE.APPROVER                                           <  
0830 IF (SKIP.RELEASE) THEN                                          <  
0831 GO.BACK = 1                                                     <  

0832 END ELSE                                                        <  
0833 GOSUB SET.RELEASED ; * 25260                                    <  
0834 END                                                             <  
0835 END ELSE                                                        <  
0836 GO.BACK = 1                                                     <  
0837 END                                                             <  
0838 END ELSE                                                        <  

0839 GOSUB CHOOSE.APPROVER                                           <  
0840 IF (SKIP.RELEASE) THEN                                          <  
0841 GO.BACK = 1                                                     <  
0842 END ELSE                                                        <  
0843 GOSUB SET.RELEASED                                              <  
0844 END                                                             <  
0845 END                                                             <  

0846 END ELSE                                                        <  
0847 GOSUB ENT.APP.CODE                                              <  
0848 IF (CODE.OK) THEN                                               <  
0849 REQ = 0; * * this is not requisition any more                   <  
0850 GOSUB SET.RELEASED ; * 25260                                    <  
0851 END ELSE                                                        <  
0852 GO.BACK = 1                                                     <  

0853 END                                                             <  
0854 END                                                             <  
0855 END ELSE                                                        <  
0856 ERRMSG = "Cannot release requisition that does not have any pr  <  
0857 GOSUB 91000                                                     <  
0858 GO.BACK = 1                                                     <  
0859 END                                                             <  

0860 END ELSE                                                        <  
0861 IF APP.PO.LEVEL#CO.PO.APP.LEVELS THEN                           <  
0862 GOSUB ENT.APP.CODE                                              <  
0863 IF CODE.OK THEN                                                 <  
0864 GOSUB SET.ON.HOLD                                               <  
0865 END ELSE                                                        <  
0866 GO.BACK =1                                                      <  

0867 END                                                             <  
0868 END ELSE                                                        <  
0869 GOSUB SET.ON.HOLD                                               <  
0870 END                                                             <  
0871 END                                                             <  
0872 END                                                             <  
0873 IF NOT(GO.BACK) THEN                                            <  

0874 ;*25260 ^                                                       <  
0875 IF OPO.CODE = "N" THEN                                             IF OPO.CODE = "N" THEN
0876 READU OPO.NUMBER FROM CONTROL, CONO:"OPOCODE" ELSE OPO.NUMBER      READU OPO.NUMBER FROM CONTROL, CONO:"OPOCODE" ELSE OPO.NUMBE
0877 FND = 1                                                            FND = 1
0878 LOOP                                                               LOOP
0879 WHILE FND DO                                                       WHILE FND DO
0880                                                                 >  *         OPO.CODE = ('00000000':OPO.NUMBER)'R#8'

0881 OPO.NUMBER = OPO.NUMBER + 1                                        OPO.NUMBER = OPO.NUMBER + 1
0882 ;*24231 v                                                       |  READU REC FROM OUTSIDE.PO, CONO:OPO.NUMBER ELSE FND = 0
0883 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0884 READU REC FROM OUTSIDE.PO, CONO:OPO.NUMBER ELSE                 <  
0885 READU REC FROM OUT.REQ, CONO:OPO.NUMBER ELSE                    <  
0886 FND = 0                                                         <  
0887 END                                                             <  
0888 END                                                             <  

0889 END ELSE                                                        <  
0890 READU REC FROM OUTSIDE.PO, CONO:OPO.NUMBER ELSE                 <  
0891 FND= 0                                                          <  
0892 END                                                             <  
0893 END                                                             <  
0894 ;*24231 ^                                                       <  
0895 REC = ""                                                           REC = ""

0896 ;*24231 v                                                       |  IF FND THEN RELEASE OUTSIDE.PO, CONO:OPO.NUMBER
0897 IF FND THEN                                                     <  
0898 RELEASE OUTSIDE.PO, CONO:OPO.CODE                               <  
0899 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0900 RELEASE OUT.REQ, CONO:OPO.CODE                                  <  
0901 END                                                             <  
0902 END                                                             <  

0903 ;*24231 ^                                                       <  
0904 REPEAT                                                             REPEAT
0905 WRITE OPO.NUMBER ON CONTROL, CONO:"OPOCODE"                        WRITE OPO.NUMBER ON CONTROL, CONO:"OPOCODE"
0906 ECD.NUM = 5; SCV.REC(ECD.NUM)<ECD.SCRN.NO> = OPO.NUMBER            ECD.NUM = 5; SCV.REC(ECD.NUM)<ECD.SCRN.NO> = OPO.NUMBER
0907 ECD.ACTION = 5; CALL SCRN.EDIT                                     ECD.ACTION = 5; CALL SCRN.EDIT
0908 ;*24231 v                                                       |  ERRMSG = "Note new outside PO number"; GOSUB 91000
0909 IF MENU.FLAG = "R"  THEN                                        <  

0910 IF (REQ) THEN                                                   <  
0911 ERRMSG = "Note new requisition number"                          <  
0912 GOSUB 91000 ; * T27552                                          <  
0913 END                                                             <  
0914 END ELSE                                                        <  
0915 ERRMSG = "Note new PO number"                                   <  
0916 GOSUB 91000 ; * T27552                                          <  

0917 END                                                             <  
0918 *T27552           GOSUB 91000                                   <  
0919 ;*24231 ^                                                       <  
0920 OPO.CODE = OPO.NUMBER                                              OPO.CODE = OPO.NUMBER
0921 END ELSE                                                        <  
0922 IF OPTION = "F" AND MENU.FLAG = "R" THEN                        <  
0923 IF APP.PO.LEVEL # "1" THEN                                      <  

0924 ERRMSG = "Requisition forwarded to ":OPO.APPROVER               <  
0925 GOSUB 91000                                                     <  
0926 END                                                                END
0927 END                                                             <  
0928 END                                                             <  
0929 ;*25260 ^                                                       <  
0930 ; *24953 v                                                      <  

0931 IF MENU.FLAG = "R" THEN                                         <  
0932 STATUS.CNT = DCOUNT(OPO.STAT,VM)                                <  
0933 IF OPO.STAT<1,STATUS.CNT> = "On-Hold" THEN                      <  
0934 ERRMSG = "Requsition has been placed on On-Hold status."        <  
0935 GOSUB 91000                                                     <  
0936 END                                                             <  
0937 END                                                             <  

0938 ; *24953 ^                                                      <  
0939 ;*24231 v                                                       <  
0940 IF (NEW) THEN                                                   <  
0941 OPO.APP.LEVEL = APP.PO.LEVEL                                    <  
0942 END                                                             <  
0943 IF MENU.FLAG = "R" THEN                                         <  
0944 IF (REQ) THEN                                                   <  

0945 WORK.FILE = OUT.REQ                                             <  
0946 UPDATE = "REQ"                                                  <  
0947 END ELSE                                                        <  
0948 IF APP.PO.LEVEL = 1 THEN                                        <  
0949 *T28244 v                                                       <  
0950 *                       CMD = 'DELETE OUT.REQ ':'"':CONO:OPO.C  <  
0951 *                       UDTEXECUTE CMD CAPTURING MSG            <  

0952 WORK.FILE = OUTSIDE.PO                                          <  
0953 ;*25260 v                                                       <  
0954 *                       ERRMSG = "New PO number " :OPO.CODE:"   <  
0955 *                       GOSUB 91000                             <  
0956 ;*25260 ^                                                       <  
0957 *T28244 ^                                                       <  
0958 UPDATE  = "PO"                                                  <  

0959 END                                                             <  
0960 END                                                             <  
0961 END                                                             <  
0962 IF MENU.FLAG = "P" THEN                                         <  
0963 WORK.FILE = OUTSIDE.PO                                          <  
0964 UPDATE = "PO"                                                   <  
0965 END                                                             <  

0966 ;*24231 ^                                                       <  
0967 ;* C40479 v                                                     <  
0968 ;* Get accrue field if this PO doesnt have one                  <  
0969 ;* As in the case of coming from POR                            <  
0970 ;*                                                              <  
0971 LOOP WHILE NOT(REQ) AND OPO.ACCRUE = '' DO                      <  
0972 GOSUB 1200                                                      <  

0973 REPEAT                                                          <  
0974 ;* C40479 ^                                                     <  
0975 OLD.JOB.CNT = DCOUNT(OLD.JOB.NO<1>,VM)                             OLD.JOB.CNT = DCOUNT(OLD.JOB.NO<1>,VM)
0976 FOR J = 1 TO OLD.JOB.CNT                                           FOR J = 1 TO OLD.JOB.CNT
0977 THIS.JOB=OLD.JOB.NO<1,J>                                           THIS.JOB=OLD.JOB.NO<1,J>
0978 LOCATE THIS.JOB IN OPO.JOB.NO<1>,1 SETTING VAL ELSE                LOCATE THIS.JOB IN OPO.JOB.NO<1>,1 SETTING VAL ELSE
0979 MATREADU JSTAT.REC FROM JOB.STATS,CONO:THIS.JOB ELSE MAT JSTAT     MATREADU JSTAT.REC FROM JOB.STATS,CONO:THIS.JOB ELSE MAT JST

0991 JSTAT.OPO.QTY = DELETE(JSTAT.OPO.QTY,1,SS,0)                       JSTAT.OPO.QTY = DELETE(JSTAT.OPO.QTY,1,SS,0)
0992 JSTAT.PROD.LINE = DELETE(JSTAT.PROD.LINE,1,SS,0)                   JSTAT.PROD.LINE = DELETE(JSTAT.PROD.LINE,1,SS,0)
0993 IF JSTAT.OPO.NO = "" AND JSTAT.SHP.TRANS = "" THEN                 IF JSTAT.OPO.NO = "" AND JSTAT.SHP.TRANS = "" THEN
0994 DELETE JOB.STATS, CONO : THIS.JOB                                  DELETE JOB.STATS, CONO : THIS.JOB
0995 END ELSE                                                           END ELSE
0996 ;*24231 v                                                       <  
0997 IF UPDATE = "PO" THEN                                           <  
0998 MATWRITE JSTAT.REC ON JOB.STATS,CONO:THIS.JOB                      MATWRITE JSTAT.REC ON JOB.STATS,CONO:THIS.JOB
0999 END                                                                END
1000 END                                                             <  

1009 MAT JSTAT.REC = ""                                                 MAT JSTAT.REC = ""
1010 END                                                                END
1011 PTR = 1                                                            PTR = 1
1012 55                                                                 55             
1013 LOCATE OPO.CODE IN JSTAT.OPO.NO<1>,PTR SETTING SS THEN             LOCATE OPO.CODE IN JSTAT.OPO.NO<1>,PTR SETTING SS THEN
1014 *T25755 v                                                       <  
1015 *                    IF JSTAT.PROD.LINE<1,SS> # OPO.PROD.LINE<  <  
1016 IF JSTAT.PROD.LINE<1,SS> # OPO.PROD.LINE<1,J>:"@":OPO.PROD.SEQ     IF JSTAT.PROD.LINE<1,SS> # OPO.PROD.LINE<1,J>:"@":OPO.PROD.S
1017 *T25755 ^                                                       <  
1018 PTR = SS + 1                                                       PTR = SS + 1

1019 GOTO 55                                                            GOTO 55
1020 END                                                                END
1021                                                                 >  *         SS = COUNT(JSTAT.OPO.NO,VM) + (JSTAT.OPO.NO # "") 
1022 END                                                                END
1023 JSTAT.OPO.NO<1,SS> = OPO.CODE                                      JSTAT.OPO.NO<1,SS> = OPO.CODE
1024 JSTAT.OPO.DATE<1,SS> = OPO.DATE                                    JSTAT.OPO.DATE<1,SS> = OPO.DATE
1025 JSTAT.OPO.AMT<1,SS> = OPO.EST.COST<1,J>                            JSTAT.OPO.AMT<1,SS> = OPO.EST.COST<1,J>                
1026 JSTAT.OPO.QTY<1,SS> = OPO.QTY<1,J>                                 JSTAT.OPO.QTY<1,SS> = OPO.QTY<1,J>
1027 *T25755 v                                                       <  

1028 *                 JSTAT.PROD.LINE<1,SS> = OPO.PROD.LINE<1,J>    <  
1029 JSTAT.PROD.LINE<1,SS> = OPO.PROD.LINE<1,J>:"@":OPO.PROD.SEQ<1,     JSTAT.PROD.LINE<1,SS> = OPO.PROD.LINE<1,J>:"@":OPO.PROD.SEQ<
1030 *T25755 ^                                                       <  
1031 ;*24231 v                                                       <  
1032 IF UPDATE = "PO" THEN                                           <  
1033 MATWRITE JSTAT.REC ON JOB.STATS,CONO:OPO.JOB.NO<1,J>               MATWRITE JSTAT.REC ON JOB.STATS,CONO:OPO.JOB.NO<1,J>
1034 END                                                             <  

1035 ;*24231 ^                                                       <  
1036 NEXT J                                                             NEXT J
1037 6 *                                                             <  
1038 *                                                                  *
1039 *--- APS STATISTICS                                                *--- APS STATISTICS
1040 *                                                                  *
1041                                                                 >  6 *

1042 IF CO.APS.O.INTRF > 2 THEN GOSUB 5001                              IF CO.APS.O.INTRF > 2 THEN GOSUB 5001
1043 ;* T25941 OPO.PRT.FLG = SCV.REC(43)<ECD.SCRN.NO>                |  *      GOSUB 80000
1044 MATWRITE OPO.REC ON WORK.FILE , CONO:OPO.CODE                   |  OPO.PRT.FLG = SCV.REC(43)<ECD.SCRN.NO>
1045 *T28244 v                                                       |  MATWRITE OPO.REC ON OUTSIDE.PO , CONO:OPO.CODE
1046 IF MENU.FLAG = "R" THEN                                         <  
1047 IF NOT(REQ) THEN                                                <  
1048 IF APP.PO.LEVEL = 1 THEN                                        <  
1049 CMD = 'DELETE OUT.REQ ':'"':CONO:OPO.CODE:'"'                   <  

1050 UDTEXECUTE CMD CAPTURING MSG                                    <  
1051 ERRMSG = "New PO number " :OPO.CODE:" has been created."        <  
1052 GOSUB 91000                                                     <  
1053 END                                                             <  
1054 END                                                             <  
1055 END                                                             <  
1056 *T28244 ^                                                       <  

1057 MORE = 1                                                           MORE = 1
1058 ;*24231 v                                                       <  
1059 *T25942               IF OPTION = "R" THEN                      <  
1060 IF OPTION = "F" THEN                                            <  
1061 GOSUB SEND.MAIL                                                 <  
1062 END                                                             <  
1063 RELEASE                                                         <  
1064 END                                                             <  

1065 ;*24231 ^                                                       <  
1066 CASE (OPTION = "C" OR OPTION = "F") AND POS.INQ = 1             <  
1067 ERRMSG = " ** INVALID RESPONSE **"                              <  
1068 GOSUB 91000                                                     <  
1069 END CASE                                                           END CASE
1070 WHILE MORE = 0 DO                                                  WHILE MORE = 0 DO
1071 REPEAT                                                             REPEAT

1072 ;*24955 v                                                       |  GOSUB 1
1073 IF BUFFER<3> = 'INQ' THEN                                       <  
1074 ECD.ACTION = 99 ; CALL SCRN.EDIT                                <  
1075 GOSUB 99999                                                     <  
1076 END ELSE                                                        <  
1077 ;*24955 ^                                                       <  
1078 GOTO 1                                                          <  

1079 END ; * 24955                                                   <  
1080 ;*24231 ^                                                       <  
1081 *                                                                  *
1082 100 *                                                           <  
1083 *                                                               <  
1084 ***** PRINT DATE ENTER                                             ***** PRINT DATE ENTER
1085 *                                                               |  100 *

1087 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1088 IF ECD.RET.VALUE # 'END' THEN                                      IF ECD.RET.VALUE # 'END' THEN
1089 OPO.DATE = ECD.RET.VALUE                                           OPO.DATE = ECD.RET.VALUE
1090 END                                                                END
1091 RETURN                                                             RETURN
1092 *                                                               <  
1093 150*                                                            <  
1094 *                                                               <  
1095 *** ENTER OWNING DIVISION NUMBER; * TASK 19404                     *** ENTER OWNING DIVISION NUMBER; * TASK 19404
1096 *                                                                  *

1097                                                                 >  150*
1098 ECD.NUM=53; ECD.ACTION=4                                           ECD.NUM=53; ECD.ACTION=4
1099 CALL SCRN.EDIT                                                     CALL SCRN.EDIT
1100 IF ECD.RET.VALUE # "END" THEN                                      IF ECD.RET.VALUE # "END" THEN
1101 OPO.DIV.OWNER = ECD.RET.VALUE                                      OPO.DIV.OWNER = ECD.RET.VALUE
1102 ;*24231 v                                                       |  *T20080 v
1103 DIV = ECD.RET.VALUE                                             <  

1104 INVALID = 0                                                     <  
1105 ;*T20080 v                                                      <  
1106 IF OPO.DIV.OWNER # "00" THEN                                       IF OPO.DIV.OWNER # "00" THEN
1107 MATREAD DIV.REC FROM DIVISION, CONO:OPO.DIV.OWNER ELSE             MATREAD DIV.REC FROM DIVISION, CONO:OPO.DIV.OWNER ELSE
1108 INVALID = 1                                                     <  
1109 END                                                             <  
1110 END ELSE                                                        <  

1111 DIV = "ALL"                                                     <  
1112 END                                                             <  
1113 IF NOT(INVALID) THEN                                            <  
1114 IF MENU.FLAG = "R" THEN                                         <  
1115 VALID = 1                                                       <  
1116 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!ALL" THEN       <  
1117 *T25861 v                                                       <  

1118 IF APP.PO.FLAG<1,2> = "Y" THEN                                  <  
1119 *T25861 ^                                                       <  
1120 IF APP.STATUS = "Y" THEN                                        <  
1121 SCV.REC(44)<ECD.SCRN.NO,1> = APP.NAME<1>                        <  
1122 ECD.NUM = 44                                                    <  
1123 ECD.ACTION  = 5 ; CALL SCRN.EDIT                                <  
1124 END ELSE                                                        <  

1125 IF DIV # "ALL" THEN                                             <  
1126 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":DIV THEN      <  
1127 IF APP.STATUS = "Y" THEN                                        <  
1128 SCV.REC(44)<ECD.SCRN.NO,1> = APP.NAME<1>                        <  
1129 ECD.NUM = 44                                                    <  
1130 ECD.ACTION  = 5 ; CALL SCRN.EDIT                                <  
1131 END ELSE                                                        <  

1132 ERRMSG = "User profile is inactive for division ":DIV           <  
1133 GOSUB 91000                                                     <  
1134 GOTO 150                                                        <  
1135 END                                                             <  
1136 END ELSE                                                        <  
1137 ERRMSG = "You are not allowed to enter requisitions for divisi  <  
1138 GOSUB 91000                                                     <  

1139 GOTO 150                                                        <  
1140 END                                                             <  
1141 END ELSE                                                        <  
1142 ERRMSG = "User profile is inactive for division ":DIV           <  
1143 GOSUB 91000                                                     <  
1144 GOTO 150                                                        <  
1145 END                                                             <  

1146 END                                                             <  
1147 *T25861 v                                                       <  
1148 END ELSE                                                        <  
1149 ERRMSG = "You are not allowed to enter an Outside Requesition.  <  
1150 GOSUB 91000                                                     <  
1151 GOTO 5                                                          <  
1152 END                                                             <  

1153 *T25861 ^                                                       <  
1154 END ELSE                                                        <  
1155 IF DIV # "ALL" THEN                                             <  
1156 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":DIV THEN      <  
1157 *T25861 v                                                       <  
1158 IF APP.PO.FLAG<1,2> = "Y" THEN                                  <  
1159 *T25861 ^                                                       <  

1160 IF APP.STATUS = "Y" THEN                                        <  
1161 SCV.REC(44)<ECD.SCRN.NO,1> = APP.NAME<1>                        <  
1162 ECD.NUM = 44                                                    <  
1163 ECD.ACTION  = 5 ; CALL SCRN.EDIT                                <  
1164 END ELSE                                                        <  
1165 ERRMSG = "User profile is inactive for division ":DIV           <  
1166 GOSUB 91000                                                     <  

1167 GOTO 150                                                        <  
1168 END                                                             <  
1169 *T25861 v                                                       <  
1170 END ELSE                                                        <  
1171 ERRMSG = "You are not allowed to enter an Outside Requesition.  <  
1172 GOSUB 91000                                                     <  
1173 GOTO 5                                                          <  

1174 END                                                             <  
1175 *T25861 ^                                                       <  
1176 END ELSE                                                        <  
1177 ERRMSG = "You are not allowed to enter requisitions for divisi  <  
1178 GOSUB 91000                                                     <  
1179 GOTO 150                                                        <  
1180 END                                                             <  

1181 END ELSE                                                        <  
1182 ERRMSG = "You are not allowed to enter requisitions for divisi  <  
1183 GOSUB 91000                                                     <  
1184 GOTO 150                                                        <  
1185 END                                                             <  
1186 END                                                             <  
1187 ;*T24953 v                                                      <  

1188 IF (NEW) THEN                                                   <  
1189 OPO.ORD.BY = APP.NAME<1>                                        <  
1190 END                                                             <  
1191 ;*T24953 ^                                                      <  
1192 END                                                             <  
1193 END ELSE                                                        <  
1194 ERRMSG = "Invalid division number used for PO owning division"     ERRMSG = "Invalid division number used for PO owning divisio

1195 GOSUB 91000; OPO.DIV.OWNER = ""; GOTO 150                          GOSUB 91000; OPO.DIV.OWNER = ""; GOTO 150
1196 END                                                                END
1197 ;*24231 ^                                                       <  
1198 ;*T23278 v                                                      <  
1199 DIV.CODE = OPO.DIV.OWNER; USER.ID = UPCASE(@LOGNAME); ERRMSG =  <  
1200 CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)               <  
1201 IF ERRMSG # '' THEN                                             <  
1202 GOSUB 91000; SCV.REC(53)<1,1> = ''; GOTO 150                    <  
1203 END                                                                END

1204 ;*T23278 ^                                                      <  
1205 END                                                                END
1206 RETURN                                                             RETURN
1207 *                                                                  *
1208 *** INPUT ACCRUE FLAG                                              *** INPUT ACCRUE FLAG
1209 1200*                                                              1200*
1210 *                                                               <  

1211 IF APP.PO.LEVEL = 1 OR MENU.FLAG = "P" THEN ; * 24953           <  
1212 IF SUM(OPO.QTY.RECVD) = 0 THEN                                     IF SUM(OPO.QTY.RECVD) = 0 THEN
1213 * T26152 v                                                      <  
1214 IF CO.PO.ACCRUE.FLAG<1,2> = '' OR CO.PO.ACCRUE.MAINT<1,2> = 'Y  <  
1215 IF CO.PO.ACCRUE.FLAG<1,2> # '' AND FIRST.TIME = 1 THEN          <  
1216 OPO.ACCRUE = CO.PO.ACCRUE.FLAG<1,2>                             <  
1217 ECD.NUM = 17                                                       ECD.NUM = 17

1218 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = OPO.ACCRUE                      |  *T23225      ECD.ACTION=4;CALL SCRN.EDIT
1219 ECD.ACTION = 5 ; CALL SCRN.EDIT                                 |  ECD.ACTION=5 ; SCV.REC(ECD.NUM)="Y"; ECD.DEFAULT="Y"; CALL S
1220 END ELSE                                                        |  *T23225      IF ECD.RET.VALUE # 'END' THEN
1221 * T26152 ^                                                      |  *T23225         OPO.ACCRUE = ECD.RET.VALUE
1222 ECD.NUM = 17                                                    |  OPO.ACCRUE = "Y"  ;*T23225
1223 ECD.DEFAULT = CO.PO.ACCRUE.FLAG<1,2> ;* C40479                  |  *T23225      END
1224 ECD.ACTION=4;CALL SCRN.EDIT                                     <  

1225 IF ECD.RET.VALUE # 'END' THEN                                   <  
1226 OPO.ACCRUE = ECD.RET.VALUE                                      <  
1227 END                                                                END
1228 * T26152 v                                                      <  
1229 END                                                             <  
1230 END ELSE                                                        <  
1231 IF OPO.ACCRUE = '' THEN                                         <  

1232 OPO.ACCRUE = CO.PO.ACCRUE.FLAG<1,2>                             <  
1233 ECD.NUM = 17                                                    <  
1234 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = OPO.ACCRUE                      <  
1235 ECD.ACTION = 5 ; CALL SCRN.EDIT                                 <  
1236 END                                                             <  
1237 END                                                             <  
1238 * T26152 ^                                                      <  

1239 END ; * 24953                                                   <  
1240 END ELSE ;*T27786                                               <  
1241 OPO.ACCRUE = "N"                                                <  
1242 END ; * 24953                                                   <  
1243 RETURN                                                             RETURN
1244 *                                                               |  ***** ENTER PRINT FLAG
1245 ***** ENTER PRINT FLAG (REWRITE: TASK 25941)                    <  

1246 *                                                               <  
1247 1300 *                                                             1300 *
1248 *                                                               |  OLD.PRT.FLG = OPO.PRT.FLG
1249 ECD.NUM = 43                                                    |  ECD.NUM=43
1250 ECD.DEFAULT = OPO.PRT.FLG<1,1>                                  <  
1251 IF SCV.REC(ECD.NUM)<ECD.SCRN.NO> = '' AND VEND.EMAIL.ADDR # ''  <  
1252 ECD.DEFAULT = 'N'                                               <  

1253 END                                                             <  
1254 IF OPO.PRT.FLG<1,1> = 'P' THEN ECD.VALDAT = 'Y,N,P,C'           <  
1255 IF OPO.PRT.FLG<1,1> = 'C' THEN ECD.VALDAT = 'Y,N,C'             <  
1256 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ''                              <  
1257 ECD.ACTION=4;CALL SCRN.EDIT                                     <  
1258 IF ECD.RET.VALUE = 'END' THEN                                   <  
1259 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  

1260 RETURN                                                          <  
1261 END                                                             <  
1262 OPO.PRT.FLG<1,1> = ECD.RET.VALUE                                <  
1263 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
1264 ;*                                                              <  
1265 ;* Input Mail flag if Vendor has an email address               <  
1266 ;*                                                              <  

1267 IF VEND.EMAIL.ADDR = '' THEN RETURN                             <  
1268 ECD.NUM = 34                                                    <  
1269 ECD.DEFAULT = OPO.PRT.FLG<1,2>                                  <  
1270 IF OPO.PRT.FLG<1,2> = 'M' THEN ECD.VALDAT = 'Y,N,M,C'           <  
1271 IF OPO.PRT.FLG<1,2> = 'C' THEN ECD.VALDAT = 'Y,N,C'             <  
1272 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ''                              <  
1273 ECD.ACTION=4; CALL SCRN.EDIT                                       ECD.ACTION=4; CALL SCRN.EDIT

1274 IF ECD.RET.VALUE = 'END' THEN                                   <  
1275 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
1276 RETURN                                                          <  
1277 END                                                             <  
1278 OPO.PRT.FLG<1,2> = ECD.RET.VALUE                                <  
1279 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
1280 RETURN                                                          <  

1281 *                                                               <  
1282 SHOW.PRINT.MAIL.FLAGS:                                          <  
1283 ;* Show print flag                                              <  
1284 ECD.NUM = 43                                                    <  
1285 BEGIN CASE                                                         BEGIN CASE
1286 CASE OPO.PRT.FLG<1,1> = 'Y'                                     |  CASE ECD.RET.VALUE = "END" OR ECD.RET.VALUE = "E"
1287 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Yes"                           |  GOTO 210

1288 CASE OPO.PRT.FLG<1,1> = 'P'                                     |  CASE OLD.PRT.FLG = "P"
1289 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Print"                         |  SCV.REC(43)<ECD.SCRN.NO> = ECD.RET.VALUE
1290 CASE OPO.PRT.FLG<1,1> = 'C'                                     |  CASE OLD.PRT.FLG = "Y"
1291 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Copy"                          |  IF ECD.RET.VALUE = "C" THEN
1292                                                                 >  ERRMSG = "CAN NOT REPRINT UNTIL PO HAS BEEN PRINTED"
1293                                                                 >  GOSUB 91000;SCV.REC(43)<ECD.SCRN.NO>=OLD.PRT.FLG; GOTO 1300
1294                                                                 >  END ELSE

1295                                                                 >  IF ECD.RET.VALUE = "P" THEN
1296                                                                 >  ERRMSG = "ONLY PRINTING THE PO WILL CHANGE THE PRINT FLAG TO
1297                                                                 >  GOSUB 91000;SCV.REC(43)<ECD.SCRN.NO>=OLD.PRT.FLG;GOTO 1300
1298                                                                 >  END ELSE
1299                                                                 >  SCV.REC(43)<ECD.SCRN.NO> = ECD.RET.VALUE
1300                                                                 >  END
1301                                                                 >  END

1302                                                                 >  SCV.REC(43)<ECD.SCRN.NO> = ECD.RET.VALUE
1303 CASE 1                                                             CASE 1
1304 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "No"                            |  OPO.PRT.FLG = ECD.RET.VALUE
1305 END CASE                                                           END CASE
1306 ECD.ACTION = 5; CALL SCRN.EDIT                                  |  *IF OLD.PRT.FLG = "P" THEN
1307 ;* Show mail flag                                               |  *  ECD.DEFAULT = 'C'
1308 ECD.NUM = 34                                                    |  *END ELSE

1309 BEGIN CASE                                                      |  *  ECD.O.R = "O"
1310 CASE OPO.PRT.FLG<1,2> = 'Y'                                     |  *  ECD.DEFAULT = "Y"
1311 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Yes"                           |  *END
1312 CASE OPO.PRT.FLG<1,2> = 'M'                                     |  *IF ECD.RET.VALUE # "END" THEN
1313 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Sent"                          |  *  OPO.PRT.FLG = ECD.RET.VALUE
1314 CASE OPO.PRT.FLG<1,2> = 'C'                                     |  *END
1315 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Copy"                          <  

1316 CASE 1                                                          <  
1317 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "No"                            <  
1318 END CASE                                                        <  
1319 ECD.ACTION = 5; CALL SCRN.EDIT                                  <  
1320 RETURN                                                             RETURN
1321 *                                                               <  
1322 *** ENTER VEND CODE AND PRINT VEND INFORMATION                     *** ENTER VEND CODE AND PRINT VEND INFORMATION

1323 200 *                                                              200 *
1324 *                                                               |  IF NOT(NEW) THEN
1325 *T25854 v                                                       |  ERRMSG = "CANNOT MODIFY VENDOR INFORMATION ON EXISTING PURCH
1326 *  IF NOT(NEW) THEN                                             <  
1327 IF NOT(NEW) AND NOT(DUPLICATED.PO) THEN                         <  
1328 *T25854 ^                                                       <  
1329 ;*24953 v                                                       <  
1330 IF MENU.FLAG # "R" THEN                                         <  

1331 ERRMSG="CANNOT MODIFY VENDOR INFORMATION ON EXISTING PURCHASE   <  
1332 GOSUB 91000                                                        GOSUB 91000
1333 RETURN                                                             RETURN
1334 END ; *24953                                                    <  
1335 END                                                                END
1336 ECD.NUM = 6                                                        ECD.NUM = 6
1337 ECD.VALDAT.CODE = 2                                                ECD.VALDAT.CODE = 2

1352 SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)           SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)
1353 SCV.REC(15)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)           SCV.REC(15)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)
1354 SCV.REC(54)<ECD.SCRN.NO,1> = VEND.PHONE                            SCV.REC(54)<ECD.SCRN.NO,1> = VEND.PHONE
1355 SCV.REC(55)<ECD.SCRN.NO,1> = VEND.FAX                              SCV.REC(55)<ECD.SCRN.NO,1> = VEND.FAX
1356 SCV.REC(16)<ECD.SCRN.NO,1> = VEND.PO.ZIP                           SCV.REC(16)<ECD.SCRN.NO,1> = VEND.PO.ZIP
1357 *26471 v                                                        <  
1358 SCV.REC(27)<ECD.SCRN.NO,1> = VEND.TERMS<1,2>                    <  
1359 OPO.TERMS.DESC = VEND.TERMS<1,2>                                <  
1360 SCV.REC(28)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[1,4]               <  
1361 OPO.TERMS.DISC = VEND.TERMS<1,1>[1,4]                           <  

1362 IF OPO.TERMS.DESC[1,1] = 'P' THEN                               <  
1363 SCV.REC(29)<ECD.SCRN.NO,1> = ''                                 <  
1364 END ELSE                                                        <  
1365 SCV.REC(29)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[5,2]               <  
1366 END                                                             <  
1367 OPO.TERMS.DATE = SCV.REC(29)<ECD.SCRN.NO,1>                     <  
1368 *26471 ^                                                        <  

1399 SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)           SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)
1400 SCV.REC(15)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)           SCV.REC(15)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)
1401 SCV.REC(54)<ECD.SCRN.NO,1> = VEND.PHONE                            SCV.REC(54)<ECD.SCRN.NO,1> = VEND.PHONE
1402 SCV.REC(55)<ECD.SCRN.NO,1> = VEND.FAX                              SCV.REC(55)<ECD.SCRN.NO,1> = VEND.FAX
1403 SCV.REC(16)<ECD.SCRN.NO,1> = VEND.PO.ZIP                           SCV.REC(16)<ECD.SCRN.NO,1> = VEND.PO.ZIP
1404 *26471 v                                                        <  
1405 SCV.REC(27)<ECD.SCRN.NO,1> = VEND.TERMS<1,2>                    <  
1406 OPO.TERMS.DESC = VEND.TERMS<1,2>                                <  
1407 SCV.REC(28)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[1,4]               <  
1408 OPO.TERMS.DISC = VEND.TERMS<1,1>[1,4]                           <  

1409 IF OPO.TERMS.DESC[1,1] = 'P' THEN                               <  
1410 SCV.REC(29)<ECD.SCRN.NO,1> = ''                                 <  
1411 END ELSE                                                        <  
1412 SCV.REC(29)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[5,2]               <  
1413 END                                                             <  
1414 OPO.TERMS.DATE = SCV.REC(29)<ECD.SCRN.NO,1>                     <  
1415 *26471 ^                                                        <  

1420 210 *                                                              210 *
1421 RETURN                                                             RETURN
1422 *                                                                  *
1423 **** ENTER SHIP TO INFORMATION                                     **** ENTER SHIP TO INFORMATION
1424 300 *                                                              300 *
1425 *                                                               <  
1426 ECD.NUM=48;ECD.ACTION=4;CALL SCRN.EDIT                             ECD.NUM=48;ECD.ACTION=4;CALL SCRN.EDIT
1427 IF ECD.RET.VALUE='END' THEN GOSUB 310                              IF ECD.RET.VALUE='END' THEN GOSUB 310
1428 BEGIN CASE                                                         BEGIN CASE
1429 CASE ECD.RET.VALUE = 'END'                                         CASE ECD.RET.VALUE = 'END'

1429 CASE ECD.RET.VALUE = 'END'                                         CASE ECD.RET.VALUE = 'END'
1430 GOSUB 310                                                          GOSUB 310
1431 CASE ECD.RET.VALUE # '' AND ECD.RET.VALUE # "@@@@"                 CASE ECD.RET.VALUE # '' AND ECD.RET.VALUE # "@@@@"
1432 MATREAD WHSE.REC FROM WAREHOUSE,CONO:ECD.RET.VALUE ELSE            MATREAD WHSE.REC FROM WAREHOUSE,CONO:ECD.RET.VALUE ELSE
1433 ERRMSG = "Can't locate Warehouse"                                  ERRMSG = "Can't locate Warehouse"
1434 GOSUB 91000 ; GOTO 300;* T23653                                 |  GOSUB 91000 ; GOSUB 300
1435 END                                                                END
1436 ;* TASK 20080 v                                                 |  * TASK 19404
1437                                                                 >  * TASK 20080 v
1438                                                                 >  *        IF ECD.RET.VALUE # OPO.DIV.OWNER THEN

1439 IF WHS.DIV # OPO.DIV.OWNER AND OPO.DIV.OWNER # GEN.DIV THEN        IF WHS.DIV # OPO.DIV.OWNER AND OPO.DIV.OWNER # GEN.DIV THEN
1440 ;* TASK 20080 ^                                                 |  * TASK 20080 ^
1441 ERRMSG = "Warehouse Division does not match Owning Division"       ERRMSG = "Warehouse Division does not match Owning Division"
1442 GOSUB 91000; GOTO 300                                              GOSUB 91000; GOTO 300
1443 END                                                                END
1444                                                                 >  * TASK 19404
1445 OPO.WHSE=ECD.RET.VALUE                                             OPO.WHSE=ECD.RET.VALUE
1446 ECD.NUM=21;ECD.ACTION=5                                            ECD.NUM=21;ECD.ACTION=5

1447 SCV.REC(21)<ECD.SCRN.NO,1> = WHS.DESC; CALL SCRN.EDIT           |  SCV.REC(21)<1> = WHS.DESC; CALL SCRN.EDIT
1448 OPO.SHIP.NAME= WHS.DESC                                            OPO.SHIP.NAME= WHS.DESC
1449 ECD.NUM=22;ECD.ACTION=5                                            ECD.NUM=22;ECD.ACTION=5
1450 SCV.REC(22)<ECD.SCRN.NO,1> = WHS.ADDR1; CALL SCRN.EDIT          |  SCV.REC(22)<1> = WHS.ADDR1; CALL SCRN.EDIT
1451 OPO.SHIP.ADDR1=WHS.ADDR1                                           OPO.SHIP.ADDR1=WHS.ADDR1
1452 ECD.NUM=23;ECD.ACTION=5                                            ECD.NUM=23;ECD.ACTION=5
1453 SCV.REC(23)<ECD.SCRN.NO,1> = WHS.ADDR2; CALL SCRN.EDIT          |  SCV.REC(23)<1> = WHS.ADDR2; CALL SCRN.EDIT

1454 OPO.SHIP.ADDR2=WHS.ADDR2                                           OPO.SHIP.ADDR2=WHS.ADDR2
1455 ECD.NUM=24;ECD.ACTION=5                                            ECD.NUM=24;ECD.ACTION=5
1456 SCV.REC(24)<ECD.SCRN.NO,1> = WHS.CITY; CALL SCRN.EDIT           |  SCV.REC(24)<1> = WHS.CITY; CALL SCRN.EDIT
1457 ECD.NUM=25;ECD.ACTION=5                                            ECD.NUM=25;ECD.ACTION=5
1458 SCV.REC(25)<ECD.SCRN.NO,1> = WHS.STATE; CALL SCRN.EDIT          |  SCV.REC(25)<1> = WHS.STATE; CALL SCRN.EDIT
1459 OPO.SHIP.ADDR3=WHS.CITY:',':WHS.STATE                              OPO.SHIP.ADDR3=WHS.CITY:',':WHS.STATE
1460 ECD.NUM=26;ECD.ACTION=5                                            ECD.NUM=26;ECD.ACTION=5
1461 SCV.REC(26)<ECD.SCRN.NO,1> = WHS.ZIP;CALL SCRN.EDIT             |  SCV.REC(26)<1> = WHS.ZIP;CALL SCRN.EDIT
1462 OPO.SHIP.ADDR4=WHS.ZIP                                             OPO.SHIP.ADDR4=WHS.ZIP

1489 310 *                                                              310 *
1490 RETURN                                                             RETURN
1491 *                                                                  *
1492 *****ENTER PO DUE DATE                                             *****ENTER PO DUE DATE
1493 *400 *                                                             *400 *
1494 *                                                               |  *ECD.NUM=17;ECD.DEFAULT=DATE();ECD.ACTION=4;CALL SCRN.EDIT
1495                                                                 >  *IF ECD.RET.VALUE = 'END' THEN 
1496                                                                 >  *  GOSUB 420
1497                                                                 >  *END ELSE
1498                                                                 >  *  OPO.DATE = ECD.RET.VALUE

1499                                                                 >  *END
1500                                                                 >  **
1501 420 *                                                              420 *
1502 RETURN                                                             RETURN
1503 ************                                                       ************
1504 * ENTER ORDERED BY                                              |  ***** ENTER ORDERED BY
1505 500 *                                                              500 *

1506 *                                                               <  
1507 ECD.NUM = 20                                                       ECD.NUM = 20
1508 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1509 IF ECD.RET.VALUE # 'END' THEN                                      IF ECD.RET.VALUE # 'END' THEN
1510 OPO.VDR.ORD = ECD.RET.VALUE                                        OPO.VDR.ORD = ECD.RET.VALUE
1511 END                                                                END
1512 RETURN                                                             RETURN

1513 ****WRITTEN BY*****                                                ****WRITTEN BY*****
1514 600 *                                                              600 *
1515 *                                                               |  ECD.NUM=44
1516 ;*24231 v                                                       |  ECD.ACTION=4; CALL SCRN.EDIT
1517 IF (REQ) THEN                                                   |  IF ECD.RET.VALUE # "END" THEN
1518 ERRMSG = "You cannot change Written By while using requsition   <  
1519 GOSUB 91000                                                     <  
1520 END ELSE                                                        <  
1521 ECD.NUM = 44                                                    <  

1522 ECD.ACTION=4;CALL SCRN.EDIT                                     <  
1523 IF ECD.RET.VALUE # 'END' THEN                                   <  
1524 OPO.ORD.BY = ECD.RET.VALUE                                         OPO.ORD.BY = ECD.RET.VALUE
1525 END                                                                END
1526 END                                                             <  
1527 ;*24231 ^                                                       <  
1528 RETURN                                                             RETURN

1529 **** ENTER REQUESTOR          ; *25858                          <  
1530 650 *                                                           <  
1531 *                                                               <  
1532 ECD.NUM = 1                                                     <  
1533 ECD.ACTION=4;CALL SCRN.EDIT                                     <  
1534 IF ECD.RET.VALUE # 'END' THEN                                   <  
1535 OPO.REQUESTOR = ECD.RET.VALUE                                   <  

1536 END                                                             <  
1537 RETURN                                                          <  
1538 ***** ENTER CONTACT                                                ***** ENTER CONTACT
1539 700 *                                                              700 *
1540 ECD.NUM = 47                                                       ECD.NUM = 47
1541 ECD.ACTION = 4;CALL SCRN.EDIT                                      ECD.ACTION = 4;CALL SCRN.EDIT
1542 IF ECD.RET.VALUE # "END" THEN                                      IF ECD.RET.VALUE # "END" THEN

1552 ERRMSG = 'Invalid pattern match for terms'                         ERRMSG = 'Invalid pattern match for terms'
1553 GOSUB 91000                                                        GOSUB 91000
1554 GOTO 1100                                                          GOTO 1100
1555 END                                                                END
1556 OPO.TERMS.DESC = ECD.RET.VALUE                                     OPO.TERMS.DESC = ECD.RET.VALUE
1557                                                                 >  *
1558 ECD.NUM = 28                                                       ECD.NUM = 28
1559 ECD.DEFAULT = VEND.TERMS<1,1>[1,4]                                 ECD.DEFAULT = VEND.TERMS<1,1>[1,4]
1560 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1561 IF ECD.RET.VALUE = "END" THEN GOTO 810                             IF ECD.RET.VALUE = "END" THEN GOTO 810

1563 OPO.TERMS.DISC = ECD.RET.VALUE                                     OPO.TERMS.DISC = ECD.RET.VALUE
1564 IF OPO.TERMS.DESC[1,1] = "P" THEN                                  IF OPO.TERMS.DESC[1,1] = "P" THEN
1565 ECD.NUM = 29;SCV.REC(29)<1> = "";ECD.ACTION=5;CALL SCRN.EDIT       ECD.NUM = 29;SCV.REC(29)<1> = "";ECD.ACTION=5;CALL SCRN.EDIT
1566 GOTO 810                                                           GOTO 810
1567 END                                                                END
1568                                                                 >  *
1569 ECD.NUM = 29                                                       ECD.NUM = 29
1570 ECD.DEFAULT = VEND.TERMS<1,1>[5,2]                                 ECD.DEFAULT = VEND.TERMS<1,1>[5,2]
1571 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1572 IF ECD.RET.VALUE = "END" THEN GOTO 1100                            IF ECD.RET.VALUE = "END" THEN GOTO 1100

1577 *                                                                  *
1578 * SHIP VIA                                                         * SHIP VIA
1579 *                                                                  *
1580 800 *                                                              800 *
1581 ECD.NUM = 30                                                       ECD.NUM = 30
1582 *T27701 v                                                       |  ECD.DEFAULT = VEND.SHIP.VIA
1583 *  ECD.DEFAULT = VEND.SHIP.VIA                                  <  
1584 IF OPO.SHIP.VIA = "" THEN                                       <  
1585 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = VEND.SHIP.VIA                   <  
1586 END                                                             <  

1587 *T27701 ^                                                       <  
1588 ECD.VALDAT.CODE = '2'                                              ECD.VALDAT.CODE = '2'
1589 ECD.VALDAT.FILE = SHIP.VIA                                         ECD.VALDAT.FILE = SHIP.VIA
1590 ECD.PREFIX.ID = CONO                                               ECD.PREFIX.ID = CONO
1591 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1592 *T27701 IF ECD.RET.VALUE = '' THEN GOTO 810                     |  IF ECD.RET.VALUE = '' THEN GOTO 810
1593 *T27701 v                                                       <  

1594 *  IF ECD.RET.VALUE # 'END' THEN                                <  
1595 *    BEGIN CASE                                                 <  
1596 *    CASE ECD.RET.VALUE # '' AND ECD.VALDAT.ITEM # ''           <  
1597 *     FOR SV = 1 TO SHIP.VIA.REC.SIZE                           <  
1598 *        SHIP.VIA.REC(SV) = ECD.VALDAT.ITEM<SV>                 <  
1599 *     NEXT SV                                                   <  
1600 *    CASE ECD.RET.VALUE = ''                                    <  

1601 *     GXR.NAME = 'SHIP.VIA'                                     <  
1602 *     GXR.FILE = SHIP.VIA                                       <  
1603 *     ECD.SRCH.ID = ECD.RET.VALUE                               <  
1604 *     GXR.ID = ''                                               <  
1605 *     CALL GEN.XREF.SUB(MAT GEN.XREF.REC, PREFIX, XREF.DATA)    <  
1606 *     ECD.ACTION=2; CALL SCRN.EDIT                              <  
1607 *     IF GXR.ID # '' THEN                                       <  

1608 *       MATREAD SHIP.VIA.REC FROM SHIP.VIA,CONO:GXR.ID THEN     <  
1609 *         ECD.RET.VALUE = GXR.ID                                <  
1610 *       END                                                     <  
1611 *       SCV.REC(30)<ECD.SCRN.NO,1>=ECD.RET.VALUE; ECD.ACTION=3  <  
1612 *     END                                                       <  
1613 *    END CASE                                                   <  
1614 IF ECD.RET.VALUE # 'END' THEN                                      IF ECD.RET.VALUE # 'END' THEN

1614 IF ECD.RET.VALUE # 'END' THEN                                      IF ECD.RET.VALUE # 'END' THEN
1615 FOR SV = 1 TO SHIP.VIA.REC.SIZE                                    FOR SV = 1 TO SHIP.VIA.REC.SIZE
1616 SHIP.VIA.REC(SV) = ECD.VALDAT.ITEM<SV>                             SHIP.VIA.REC(SV) = ECD.VALDAT.ITEM<SV>
1617 NEXT SV                                                            NEXT SV
1618 OPO.SHIP.VIA = ECD.RET.VALUE                                       OPO.SHIP.VIA = ECD.RET.VALUE
1619 *T27701 READV VIA.DESC FROM SHIP.VIA,CONO:ECD.RET.VALUE,1 ELSE  |  READV VIA.DESC FROM SHIP.VIA,CONO:ECD.RET.VALUE,1 ELSE VIA.D
1620 OPO.VIA.DESC = SHPV.DESC                                        |  OPO.VIA.DESC = VIA.DESC
1621 SCV.REC(31)<ECD.SCRN.NO,1> = SHPV.DESC                          |  SCV.REC(31)<ECD.SCRN.NO,1> = VIA.DESC
1622 ECD.NUM = 31                                                       ECD.NUM = 31
1623 ECD.ACTION=5;CALL SCRN.EDIT                                        ECD.ACTION=5;CALL SCRN.EDIT

1624 END                                                                END
1625 *T27701 ^                                                       <  
1626 RETURN                                                             RETURN
1627 *                                                                  *
1628 * FOB                                                              * FOB
1629 *                                                                  *
1630 900 *                                                              900 *
1631 ECD.NUM = 32                                                       ECD.NUM = 32

1645 GOSUB 3001                                                         GOSUB 3001
1646 END                                                                END
1647 WHILE LINES > OLD.LINES DO REPEAT                                  WHILE LINES > OLD.LINES DO REPEAT
1648 OLD.START.LINE = 0                                                 OLD.START.LINE = 0
1649 LN = 1;GOSUB 3800                                                  LN = 1;GOSUB 3800
1650                                                                 >  * LN = 1
1651                                                                 >  * GOSUB 3001
1652 END ELSE                                                           END ELSE
1653 LINES = DCOUNT(OPO.INTRAL.INT,VM)                                  LINES = DCOUNT(OPO.INTRAL.INT,VM)
1654 LN = 1                                                             LN = 1

1657 GOSUB 3800                                                         GOSUB 3800
1658 GOSUB 3600                                                         GOSUB 3600
1659 LN = 1                                                             LN = 1
1660 GOSUB 3800                                                         GOSUB 3800
1661 RETURN                                                             RETURN
1662                                                                 >  *
1663                                                                 >  *
1664                                                                 >  ********************
1665 5001 *                                                             5001 *
1666                                                                 >  *FROM MISC.VEND.STAT.UPDATE (MODIFIED)

1667 *                                                                  *
1668 GTOT.ORD.AMT = 0                                                   GTOT.ORD.AMT = 0
1669 GTOT.REC.AMT = 0                                                   GTOT.REC.AMT = 0
1670 PO.CNT = DCOUNT(OPO.JOB.NO,VM)                                     PO.CNT = DCOUNT(OPO.JOB.NO,VM) 
1671 FOR P = 1 TO PO.CNT                                                FOR P = 1 TO PO.CNT
1672                                                                 >  *CSF 25279 v REMOVE RECVD QTY/AMT FROM ORD QTY/AMT
1673                                                                 >  *        ORD.QTY = OPO.QTY<1,P> - OPO.CANCEL.QTY<1,P> - OPO.
1674 ORD.QTY = OPO.QTY<1,P> - OPO.CANCEL.QTY<1,P>                       ORD.QTY = OPO.QTY<1,P> - OPO.CANCEL.QTY<1,P>
1675                                                                 >  * CSF 25279 ^
1676 IF OPO.UOM<1,P> = 'M' THEN                                         IF OPO.UOM<1,P> = 'M' THEN

1677 ORD.QTY = ORD.QTY / 1000                                           ORD.QTY = ORD.QTY / 1000
1678                                                                 >  *T23319 v
1679                                                                 >  END ELSE
1680                                                                 >  IF OPO.UOM<1,P> = 'C' THEN
1681                                                                 >  ORD.QTY = ORD.QTY / 100
1682 END                                                                END
1683                                                                 >  END
1684                                                                 >  *T23319 ^

1686 DISC.AMT = INT(OPO.U.PRICE<1,P>*(OPO.DISCOUNT<1,P>/10000))         DISC.AMT = INT(OPO.U.PRICE<1,P>*(OPO.DISCOUNT<1,P>/10000))
1687 COST = INT(OPO.U.PRICE<1,P> - DISC.AMT)                            COST = INT(OPO.U.PRICE<1,P> - DISC.AMT)
1688 END ELSE                                                           END ELSE
1689 COST = OPO.U.PRICE<1,P>                                            COST = OPO.U.PRICE<1,P>
1690 END                                                                END
1691 *T23319 v                                                       |  ORD.COST = INT(((ORD.QTY * COST)/10000) + .5) ;* 18746
1692 GTOT.ORD.AMT = GTOT.ORD.AMT + (OPO.EST.COST<1,P> - OPO.CANCEL.  |  IF ORD.COST < 0 THEN ORD.COST = 0
1693 *T23319 ^                                                       |  *ERRMSG = ORD.COST ; GOSUB 91000
1694                                                                 >  GTOT.ORD.AMT = GTOT.ORD.AMT + ORD.COST
1695                                                                 >  *        GTOT.ORD.AMT = GTOT.ORD.AMT + OPO.EST.COST<1,P>

1700 END                                                                END
1701 VSTAT.CNT = DCOUNT(VSTAT.PO,VM)                                    VSTAT.CNT = DCOUNT(VSTAT.PO,VM)
1702 LOCATE OPO.CODE IN VSTAT.PO<1>,1 SETTING POFND ELSE POFND = VS     LOCATE OPO.CODE IN VSTAT.PO<1>,1 SETTING POFND ELSE POFND = 
1703 VSTAT.PO<1,POFND> = OPO.CODE                                       VSTAT.PO<1,POFND> = OPO.CODE
1704 VSTAT.PO.ORDERD<1,POFND> = GTOT.ORD.AMT                            VSTAT.PO.ORDERD<1,POFND> = GTOT.ORD.AMT
1705 ;*24231 v                                                       <  
1706 IF UPDATE = "PO" THEN                                           <  
1707 MATWRITE VSTAT.REC ON VEND.STATS, VSTAT.KEY                        MATWRITE VSTAT.REC ON VEND.STATS, VSTAT.KEY
1708 END                                                             <  
1709 ;*24231 ^                                                       <  

1719 DONE = 0                                                           DONE = 0
1720 LOOP                                                               LOOP
1721 UNTIL PTR > JBCNT OR DONE DO                                       UNTIL PTR > JBCNT OR DONE DO
1722 LOCATE VPS.PROD<1,DP> IN OPO.JOB.NO<1>,PTR SETTING PDFND ELSE      LOCATE VPS.PROD<1,DP> IN OPO.JOB.NO<1>,PTR SETTING PDFND ELS
1723 IF PDFND THEN                                                      IF PDFND THEN 
1724 *T25755 v                                                       |  *T23499 v
1725 *           IF VPS.WHSE<1,DP> = OPO.PROD.LINE<1,PDFND> THEN     |  *******            IF VPS.WHSE<1,DP> = OPO.PROD.LINE<1,PDFND
1726 IF VPS.WHSE<1,DP> = OPO.PROD.LINE<1,PDFND>:'@':OPO.PROD.SEQ<1,  |  IF VPS.WHSE<1,DP> = OPO.PROD.LINE<1,PDFND>:"@":OPO.PROD.SEQ<
1727 *T25755 ^                                                       |  *T23499 ^           
1728 DONE = 1                                                           DONE = 1

1757 LOOP                                                               LOOP
1758 VPS.CNT = DCOUNT(VPS.PROD<1>,VM)                                   VPS.CNT = DCOUNT(VPS.PROD<1>,VM)
1759 UNTIL PTR > VPS.CNT OR DONE = 1 DO                                 UNTIL PTR > VPS.CNT OR DONE = 1 DO
1760 LOCATE OPO.JOB.NO<1,UAP> IN VPS.PROD<1>,PTR SETTING PDFND ELSE     LOCATE OPO.JOB.NO<1,UAP> IN VPS.PROD<1>,PTR SETTING PDFND EL
1761 IF PDFND THEN                                                      IF PDFND THEN
1762 *T25755 v                                                       |  *T23499 v
1763 *           IF OPO.PROD.LINE<1,UAP> = VPS.WHSE<1,PDFND> THEN D  |  ******            IF OPO.PROD.LINE<1,UAP> = VPS.WHSE<1,PDFND
1764 IF OPO.PROD.LINE<1,UAP>:'@':OPO.PROD.SEQ<1,UAP> = VPS.WHSE<1,P  |  IF OPO.PROD.LINE<1,UAP>:"@":OPO.PROD.SEQ<1,UAP> = VPS.WHSE<1
1765 *T25755 ^                                                       |  *T23499 ^
1766 END                                                                END

1769 IF DONE THEN                                                       IF DONE THEN
1770 LOC = PDFND                                                        LOC = PDFND
1771 END ELSE                                                           END ELSE
1772 LOC = VPS.CNT+1                                                    LOC = VPS.CNT+1
1773 END                                                                END
1774 ;*CSF 25279 v                                                   |  *CSF 25279 v
1775                                                                 >  *        ORD.QTY = OPO.QTY<1,UAP> - OPO.CANCEL.QTY<1,UAP> - 
1776 ORD.QTY = OPO.QTY<1,UAP> - OPO.CANCEL.QTY<1,UAP>                   ORD.QTY = OPO.QTY<1,UAP> - OPO.CANCEL.QTY<1,UAP>
1777 IF OPO.UOM<1,UAP> = 'M' THEN                                       IF OPO.UOM<1,UAP> = 'M' THEN
1778 ORD.QTY = ORD.QTY / 1000                                           ORD.QTY = ORD.QTY / 1000

1779                                                                 >  *T23319 v
1780                                                                 >  END ELSE
1781                                                                 >  IF OPO.UOM<1,UAP> = 'C' THEN
1782                                                                 >  ORD.QTY = ORD.QTY / 100
1783 END                                                                END
1784                                                                 >  *T23319 ^
1785                                                                 >  END

1787 DISC.AMT = INT(OPO.U.PRICE<1,UAP>*(OPO.DISCOUNT<1,UAP>/10000))     DISC.AMT = INT(OPO.U.PRICE<1,UAP>*(OPO.DISCOUNT<1,UAP>/10000
1788 COST = INT(OPO.U.PRICE<1,UAP> - DISC.AMT)                          COST = INT(OPO.U.PRICE<1,UAP> - DISC.AMT)
1789 END ELSE                                                           END ELSE
1790 COST = OPO.U.PRICE<1,UAP>                                          COST = OPO.U.PRICE<1,UAP>
1791 END                                                                END
1792 ; *T23319 v                                                     |  ORD.COST = INT(((ORD.QTY * COST)/10000) + .5) ;* 18746
1793 BEGIN CASE                                                      <  
1794 CASE OPO.UOM<1,UAP> = "M"                                       <  
1795 ORD.COST = INT(((COST/100) * (ORD.QTY/100)) + .5)               <  
1796 CASE OPO.UOM<1,UAP> = "C"                                       <  

1797 ORD.COST = INT(((COST/100) * (ORD.QTY/10000)) + .5)             <  
1798 CASE 1                                                          <  
1799 ORD.COST = INT(((COST/100) * (ORD.QTY/100)) + .5)               <  
1800 END CASE                                                        <  
1801 ;*T23319 ^                                                      <  
1802 IF ORD.COST < 0 THEN ORD.COST = 0                                  IF ORD.COST < 0 THEN ORD.COST = 0
1803 IF OPO.UOM<1,UAP> = 'M' THEN                                       IF OPO.UOM<1,UAP> = 'M' THEN

1804 ORD.QTY = ORD.QTY * 1000                                           ORD.QTY = ORD.QTY * 1000
1805                                                                 >  *T23319 v
1806                                                                 >  END ELSE
1807                                                                 >  IF OPO.UOM<1,UAP> = 'C' THEN
1808                                                                 >  ORD.QTY = ORD.QTY * 100
1809 END                                                                END
1810                                                                 >  *T23319 ^
1811                                                                 >  END

1811                                                                 >  END
1812 VPS.PROD<1,LOC> = OPO.JOB.NO<1,UAP>                                VPS.PROD<1,LOC> = OPO.JOB.NO<1,UAP>
1813 READV JOB.DESCR FROM JOB,CONO:OPO.JOB.NO<1,UAP>,16 ELSE JOB.DE     READV JOB.DESCR FROM JOB,CONO:OPO.JOB.NO<1,UAP>,16 ELSE JOB.
1814 VPS.PROD.DESC<1,LOC> = JOB.DESCR<1,1>                              VPS.PROD.DESC<1,LOC> = JOB.DESCR<1,1>
1815 VPS.U.M<1,LOC> = OPO.UOM<1,UAP>                                    VPS.U.M<1,LOC> = OPO.UOM<1,UAP>
1816 *T25755 v                                                       |  *T23499 v
1817 *     VPS.WHSE<1,LOC> = OPO.PROD.LINE<1,UAP>                    |  ****      VPS.WHSE<1,LOC> = OPO.PROD.LINE<1,UAP>
1818 VPS.WHSE<1,LOC> = OPO.PROD.LINE<1,UAP>:'@':OPO.PROD.SEQ<1,UAP>  |  VPS.WHSE<1,LOC> = OPO.PROD.LINE<1,UAP>:"@":OPO.PROD.SEQ<1,UA
1819 *T25755 ^                                                       |  *T23499 ^
1820                                                                 >  *        VPS.ORD.QTY<1,LOC> = OPO.QTY<1,UAP>

1821 VPS.ORD.QTY<1,LOC> = ORD.QTY                                       VPS.ORD.QTY<1,LOC> = ORD.QTY
1822                                                                 >  *        VPS.ORD.AMT<1,LOC> = OPO.EST.COST<1,UAP>
1823 VPS.ORD.AMT<1,LOC> = ORD.COST                                      VPS.ORD.AMT<1,LOC> = ORD.COST
1824 *CSF 25279 ^                                                       *CSF 25279 ^
1825 *T25755 v                                                       |  *T23499 v
1826 *     VPDS.KEY = VPS.KEY:"!":OPO.JOB.NO<1,UAP>:"!":OPO.PROD.LI  |  ***      VPDS.KEY = VPS.KEY:"!":OPO.JOB.NO<1,UAP>:"!":OPO.PR
1827 VPDS.KEY = VPS.KEY:"!":OPO.JOB.NO<1,UAP>:"!":OPO.PROD.LINE<1,U  |  VPDS.KEY = VPS.KEY:"!":OPO.JOB.NO<1,UAP>:"!":OPO.PROD.LINE<1
1828 *T25755 ^                                                       |  *T23499 ^

1828 *T25755 ^                                                       |  *T23499 ^
1829 MATREADU VPDS.REC FROM VEND.PROD.STATS, VPDS.KEY ELSE              MATREADU VPDS.REC FROM VEND.PROD.STATS, VPDS.KEY ELSE
1830 MAT VPDS.REC = ""                                                  MAT VPDS.REC = ""
1831 END                                                                END
1832 VPDS.ORD.DATE = "" ; VPDS.ORD.QTY = "" ; VPDS.ORD.UN.COST = ""     VPDS.ORD.DATE = "" ; VPDS.ORD.QTY = "" ; VPDS.ORD.UN.COST = 
1833                                                                 >  * D.CNT = DCOUNT(OPO.JOB.NO<1>,VM) 
1834                                                                 >  * FOR UPD = 1 TO D.CNT
1835 VPDS.ORD.DATE<1> = OPO.DATE<1>                                     VPDS.ORD.DATE<1> = OPO.DATE<1>
1836                                                                 >  *        VPDS.ORD.QTY<1> = OPO.QTY<1,UAP>
1837 VPDS.ORD.QTY<1> = ORD.QTY                                          VPDS.ORD.QTY<1> = ORD.QTY

1844 VPDS.TAX.FLG<1> = OPO.TAXABLE<1,UAP>                               VPDS.TAX.FLG<1> = OPO.TAXABLE<1,UAP>
1845 VPDS.PO.ACCT<1> = OPO.ACCTNO<1,UAP>                                VPDS.PO.ACCT<1> = OPO.ACCTNO<1,UAP>
1846 VPDS.PO.DIV<1> = OPO.DVDPCC<1,1,UAP>                               VPDS.PO.DIV<1> = OPO.DVDPCC<1,1,UAP>
1847 VPDS.PO.DEPT<1> = OPO.DVDPCC<1,2,UAP>                              VPDS.PO.DEPT<1> = OPO.DVDPCC<1,2,UAP>
1848 VPDS.PO.CCTR<1> = OPO.DVDPCC<1,3,UAP>                              VPDS.PO.CCTR<1> = OPO.DVDPCC<1,3,UAP>
1849 *T25755 v                                                       |  *T23499 v
1850 VPDS.OPER.PERF<1> = OPO.OPER.CODE<1,1,UAP>                         VPDS.OPER.PERF<1> = OPO.OPER.CODE<1,1,UAP>
1851 *T25755 ^                                                       |  *T23499 ^      
1852 ;*24231 v                                                       |  *   VPDS.INV.PPF<1> = OPO.INV.PPF<1,UAP>
1853 IF UPDATE = "PO" THEN                                           |  * NEXT UPD

1854 MATWRITE VPDS.REC ON VEND.PROD.STATS, VPDS.KEY                     MATWRITE VPDS.REC ON VEND.PROD.STATS, VPDS.KEY
1855 END                                                             <  
1856 ;*24231 ^                                                       <  
1857 NEXT UAP                                                           NEXT UAP
1858 ;*24231 v                                                       <  
1859 IF UPDATE = "PO" THEN                                           <  
1860 MATWRITE VPS.REC ON VEND.PO.STATS, VPS.KEY                         MATWRITE VPS.REC ON VEND.PO.STATS, VPS.KEY
1861                                                                 >  RETURN

1862                                                                 >  **** CANCEL QUANTITY
1863                                                                 >  6000 *
1864                                                                 >  VPS.KEY=CONO:OPO.VEND.NO:"!":"O":"!":OPO.CODE
1865                                                                 >  READV QTY.RECVD FROM VEND.PO.STATS,VPS.KEY,7 ELSE QTY.RECVD 
1866                                                                 >  READV AMT.RECVD FROM VEND.PO.STATS,VPS.KEY,8 ELSE AMT.RECVD 
1867                                                                 >  REMAIN = SUM(OPO.QTY) - QTY.RECVD
1868                                                                 >  BEGIN CASE

1869                                                                 >  CASE REMAIN > 0
1870                                                                 >  IF OPO.CANCEL.QTY = "" THEN
1871                                                                 >  ECD.NUM = 46
1872                                                                 >  ECD.ACTION = 4;CALL SCRN.EDIT
1873                                                                 >  IF ECD.RET.VALUE = "N" THEN GOSUB 6999
1874                                                                 >  OPO.CANCEL.QTY = REMAIN
1875                                                                 >  OPO.CANCEL.COST = OPO.EST.COST - AMT.RECVD

1876                                                                 >  OPO.CANCEL.DATE = DATE()
1877                                                                 >  EXP.QTY = OPO.QTY - REMAIN
1878                                                                 >  SCV.REC(17)<ECD.SCRN.NO,1> = EXP.QTY
1879                                                                 >  ECD.NUM = 17
1880                                                                 >  ECD.ACTION = 5;CALL SCRN.EDIT
1881                                                                 >  ERRMSG = "REMAINING QUANTITY ":OCONV(REMAIN,"MD2"):" HAS BEE
1882                                                                 >  GOSUB 91000

1883                                                                 >  END ELSE
1884                                                                 >  ERRMSG = "REMAINING QUANTITY ":OCONV(OPO.CANCEL.QTY,"MD2"):"
1885                                                                 >  GOSUB 91000
1886 END                                                                END
1887 ;*24231 ^                                                       |  CASE 1
1888                                                                 >  ERRMSG = "CANNOT CANCEL QUANTITY ON THIS ORDER"
1889                                                                 >  GOSUB 91000

1890                                                                 >  END CASE
1891                                                                 >  6999 *
1892 RETURN                                                             RETURN
1893 *                                                                  *
1894 *** GET TOTALS                                                     *** GET TOTALS
1895 *                                                               <  
1896 1020*                                                              1020*

1897 *                                                               |  P.CNT = COUNT(OPO.JOB.NO,VM) + (OPO.JOB.NO # "")
1898 P.CNT = DCOUNT(OPO.JOB.NO,VM)                                   <  
1899 TOTAL.QTY = 0 ; TOTAL.AMT = 0                                      TOTAL.QTY = 0 ; TOTAL.AMT = 0
1900 FOR A = 1 TO P.CNT                                                 FOR A = 1 TO P.CNT
1901 TOTAL.QTY = TOTAL.QTY + OPO.QTY<1,A> - OPO.CANCEL.QTY<1,A>         TOTAL.QTY = TOTAL.QTY + OPO.QTY<1,A> - OPO.CANCEL.QTY<1,A>
1902 DESC.PRICE = OPO.U.PRICE<1,A>                                   <  
1903 IF OPO.DISCOUNT<1,A> * 1 # 0 THEN                                  IF OPO.DISCOUNT<1,A> * 1  # 0 THEN

1904 DESC.PRICE -= INT((((OPO.U.PRICE<1,A>/100)*OPO.DISCOUNT<1,A>/1  |  DESC.PRICE = OPO.U.PRICE<1,A> - INT((((OPO.U.PRICE<1,A>/100)
1905                                                                 >  END ELSE
1906                                                                 >  DESC.PRICE = OPO.U.PRICE<1,A>
1907 END                                                                END
1908 ;*T23319 v                                                      |  IF OPO.UOM<1,A> = "M" THEN
1909 BEGIN CASE                                                      |  ONORD.AMT.TOT = INT(((DESC.PRICE/1000)*((OPO.QTY<1,A> - OPO.
1910 CASE OPO.UOM<1,A> = "M"                                         |  *T23319 v

1911 *T26127 v                                                       |  END ELSE
1912 *       ONORD.AMT.TOT = INT(((DESC.PRICE/1000)*((OPO.QTY<1,A>   |  IF OPO.UOM<1,A> = 'C' THEN
1913 ONORD.AMT.TOT = INT(((DESC.PRICE/1000)*((OPO.QTY<1,A> - OPO.CA  |  ONORD.AMT.TOT = INT(((DESC.PRICE/1000)*((OPO.QTY<1,A> - OPO.
1914 *T26127 ^                                                       |  *T23319 ^
1915 CASE OPO.UOM<1,A> = "C"                                         |  END ELSE
1916 *T26127 v                                                       <  
1917 *       ONORD.AMT.TOT = INT(((DESC.PRICE/1000)*((OPO.QTY<1,A>   <  

1918 ONORD.AMT.TOT = INT(((DESC.PRICE/1000)*((OPO.QTY<1,A> - OPO.CA  <  
1919 *T26127 ^                                                       <  
1920 CASE 1                                                          <  
1921 ONORD.AMT.TOT = INT((DESC.PRICE/100)*((OPO.QTY<1,A> - OPO.CANC     ONORD.AMT.TOT = INT((DESC.PRICE/100)*((OPO.QTY<1,A> - OPO.CA
1922 END CASE                                                        |  END
1923 ;*T23319 ^                                                      |  END
1924 TOTAL.AMT = TOTAL.AMT + ONORD.AMT.TOT                              TOTAL.AMT = TOTAL.AMT + ONORD.AMT.TOT

1925 NEXT A                                                             NEXT A
1926 SCV.REC(18)<ECD.SCRN.NO,1> = TOTAL.QTY                             SCV.REC(18)<ECD.SCRN.NO,1> = TOTAL.QTY
1927 SCV.REC(19)<ECD.SCRN.NO,1> = TOTAL.AMT                             SCV.REC(19)<ECD.SCRN.NO,1> = TOTAL.AMT
1928 RETURN                                                             RETURN
1929 *                                                                  *
1930 3600 *                                                          <  
1931 *                                                                  *
1932                                                                 >  * CHECK FOR ANY CHANGES TO UPDATE PRT FLAG TO REVISED
1933                                                                 >  *
1934                                                                 >  80000 *

1935                                                                 >  IF NOT(NEW) THEN
1936                                                                 >  MATBUILD NEW.REC FROM OPO.REC
1937                                                                 >  OLD.FIELD.CNT = DCOUNT(SAVE.REC,AM)
1938                                                                 >  NEW.FIELD.CNT = DCOUNT(NEW.REC,AM)
1939                                                                 >  IF NEW.FIELD.CNT # OLD.FIELD.CNT THEN
1940                                                                 >  ECD.NUM = 51
1941                                                                 >  ECD.ACTION = 4; CALL SCRN.EDIT

1942                                                                 >  OPO.PRT.FLG = ECD.RET.VALUE
1943                                                                 >  END ELSE
1944                                                                 >  SAME = 1
1945                                                                 >  APTR = 0
1946                                                                 >  LOOP
1947                                                                 >  APTR += 1
1948                                                                 >  UNTIL NOT(SAME) OR APTR = NEW.FIELD.CNT DO

1949                                                                 >  IF SAVE.REC<APTR> # NEW.REC<APTR> THEN
1950                                                                 >  IF APTR # '18' THEN
1951                                                                 >  SAME = 0
1952                                                                 >  ECD.NUM = 51
1953                                                                 >  ECD.ACTION = 4; CALL SCRN.EDIT
1954                                                                 >  OPO.PRT.FLG = ECD.RET.VALUE
1955                                                                 >  END

1956                                                                 >  END
1957                                                                 >  REPEAT
1958                                                                 >  END
1959                                                                 >  END
1960                                                                 >  RETURN
1961                                                                 >  *
1962                                                                 >  3600 * 

1961                                                                 >  *
1962                                                                 >  3600 * 
1963 MORE1 = 1                                                          MORE1 = 1
1964 LOOP                                                               LOOP
1965 *T23180 v                                                          *T23180 v
1966 IF POS.INQ THEN ECD.NUM = 59 ELSE ECD.NUM = 49                  |  *        X = 0 ; Y = 22; TYP = 1; MAXL = 1; O.R = 'O'
1967                                                                 >  *        PMSG = 'Enter (A)dd, (C)hange, (D)elete, (S)croll, 
1968                                                                 >  *        CALL EDIT.SUB
1969                                                                 >  *        OPTION = VALUE
1970                                                                 >  ECD.NUM = 49

1969                                                                 >  *        OPTION = VALUE
1970                                                                 >  ECD.NUM = 49
1971 ECD.ACTION = 4                                                     ECD.ACTION = 4
1972 CALL SCRN.EDIT                                                     CALL SCRN.EDIT
1973 OPTION = ECD.RET.VALUE                                             OPTION = ECD.RET.VALUE
1974 ;*T23180 ^                                                      |  *T23180 ^
1975 BEGIN CASE                                                         BEGIN CASE
1976 CASE OPTION = 'E' OR OPTION = 'END' OR OPTION = ''                 CASE OPTION = 'E' OR OPTION = 'END' OR OPTION = ''
1977 MORE1 = 0                                                          MORE1 = 0
1978 P_X  = 0 ; P_Y = 22 ; P_VALUE = "" ; P_OPT = "CL"                  P_X  = 0 ; P_Y = 22 ; P_VALUE = "" ; P_OPT = "CL"

1979 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1980 CASE OPTION = 'A' AND NOT(POS.INQ)                              |  CASE OPTION = 'A'
1981 LOOP                                                               LOOP
1982 LN = LINES + 1                                                     LN = LINES + 1
1983 OLD.LINES = LINES                                                  OLD.LINES = LINES
1984 IF LN < 99 THEN                                                    IF LN < 99 THEN
1985 GOSUB 3001                                                         GOSUB 3001
1986 END                                                                END

1985 GOSUB 3001                                                         GOSUB 3001
1986 END                                                                END
1987 WHILE LINES > OLD.LINES DO REPEAT                                  WHILE LINES > OLD.LINES DO REPEAT
1988 OLD.START.LINE = 0                                                 OLD.START.LINE = 0
1989 LN = 1; GOSUB 3800                                                 LN = 1; GOSUB 3800
1990 CASE OPTION = 'C' AND NOT(POS.INQ)                              |  CASE OPTION = 'C'
1991 GOSUB 3400                                                         GOSUB 3400
1992 IF LNO THEN                                                        IF LNO THEN
1993 LN = LNO                                                           LN = LNO
1994 END                                                                END

1995 SLN = BEGIN.PAGE + LINE.SPACE * MOD(LN - 1,PAGE.SIZE)              SLN = BEGIN.PAGE + LINE.SPACE * MOD(LN - 1,PAGE.SIZE)
1996 GOSUB 3110                                                         GOSUB 3110
1997 CASE OPTION = 'D' AND NOT(POS.INQ)                              |  CASE OPTION = 'D'
1998 GOSUB 3400                                                         GOSUB 3400
1999 IF LNO THEN                                                        IF LNO THEN
2000 LN = LNO                                                           LN = LNO
2001 OPO.INTRAL.INT = DELETE(OPO.INTRAL.INT,1,LN)                       OPO.INTRAL.INT = DELETE(OPO.INTRAL.INT,1,LN)
2002 LINES = DCOUNT(OPO.INTRAL.INT,VM)                                  LINES = DCOUNT(OPO.INTRAL.INT,VM)
2003 IF LN > 1 AND LN > LINES THEN LN = LN - 1                          IF LN > 1 AND LN > LINES THEN LN = LN - 1

2007 GOSUB 3800                                                         GOSUB 3800
2008 CASE OPTION = 'S'                                                  CASE OPTION = 'S'
2009 LN = LN + PAGE.SIZE                                                LN = LN + PAGE.SIZE
2010 IF LN > LINES THEN LN = 1                                          IF LN > LINES THEN LN = 1
2011 GOSUB 3800                                                         GOSUB 3800
2012 * T25978 v                                                      <  
2013 CASE OPTION = 'SR'                                              <  
2014 LN -= PAGE.SIZE                                                 <  
2015 IF LN < 1 THEN LN = 1                                           <  
2016 GOSUB 3800                                                      <  

2017 CASE OPTION = 'ST'                                              <  
2018 LN = 1                                                          <  
2019 GOSUB 3800                                                      <  
2020 CASE OPTION = 'SB'                                              <  
2021 LN = LINES                                                      <  
2022 GOSUB 3800                                                      <  
2023 * T25978 ^                                                      <  

2032 *                                                                  *
2033 *                                                                  *
2034 3001 *                                                             3001 *
2035 GOSUB 3800                                                         GOSUB 3800
2036 SLN = BEGIN.PAGE + LINE.SPACE * MOD(LN - 1,PAGE.SIZE)              SLN = BEGIN.PAGE + LINE.SPACE * MOD(LN - 1,PAGE.SIZE)
2037 P_X  = X_SCROLL1 ; P_Y = SLN ; P_VALUE = LN "R#2" ; P_OPT = ""  |  P_X  = 15 ; P_Y = SLN ; P_VALUE = LN "R#2" ; P_OPT = "CL"
2038 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
2039 *                                                                  *
2040 *---- ENTER INSTUCTIONS                                            *---- ENTER INSTUCTIONS
2041 *                                                                  *

2042                                                                 >  *3100 *
2043                                                                 >  *
2044                                                                 >  *---- ENTER PO COMMENT CODE
2045                                                                 >  *X = 18 ; Y = SLN ; TYP = 1 ; MAXL = 5 ; O.R = 'O'
2046                                                                 >  *HMSG = "Enter comment code for prestored comment or ??? for
2047                                                                 >  *DEFAULT = ""
2048                                                                 >  *CALL EDIT.SUB

2049                                                                 >  *COM.CODE = VALUE
2050                                                                 >  *IF COM.CODE = 'END' THEN RETURN
2051                                                                 >  *IF COM.CODE = "???" THEN
2052                                                                 >  *  GXR.FILE = PO.COMMENT.CODE
2053                                                                 >  *  GXR.ID = ''
2054                                                                 >  *  GXR.NAME = 'COMMENT.CODE'
2055                                                                 >  *  GXR.SORT.FILE = 'PO.COMMENT.CODE'

2056                                                                 >  *  CALL GEN.XREF.SUB(MAT GEN.XREF.REC,PREFIX,XREF.DATA)
2057                                                                 >  *  ECD.ACTION = 2
2058                                                                 >  *  CALL SCRN.EDIT
2059                                                                 >  *  IF GXR.ID = ''THEN
2060                                                                 >  *    ECD.ACTION = 3; CALL SCRN.EDIT
2061                                                                 >  *    GOSUB 3100
2062                                                                 >  *  END ELSE

2063                                                                 >  *    COM.CODE = GXR.ID
2064                                                                 >  *    ECD.ACTION = 3; CALL SCRN.EDIT
2065                                                                 >  *  END
2066                                                                 >  *END
2067                                                                 >  *IF COM.CODE = "" THEN
2068                                                                 >  *  GOSUB 3110
2069                                                                 >  *  GOSUB 3105

2070                                                                 >  *END ELSE
2071                                                                 >  *  TEXT.REC = ""
2072                                                                 >  *  READ TEXT.REC FROM PO.COMMENT.CODE, CONO:COM.CODE ELSE
2073                                                                 >  *    ERRMSG = 'CODE NOT ON FILE';GOSUB 91000
2074                                                                 >  **          ECD.NUM = 46
2075                                                                 >  **          ECD.ACTION = 4
2076                                                                 >  **          CALL SCRN.EDIT

2077                                                                 >  *    GOSUB 3100
2078                                                                 >  *  END
2079                                                                 >  *  COMMENT.LINES = DCOUNT(TEXT.REC,VM)
2080                                                                 >  *  FOR I = 1 TO COMMENT.LINES
2081                                                                 >  *    OPO.INTRAL.INT<1,LN> = TEXT.REC<2,I>
2082                                                                 >  *    LN = LN + 1
2083                                                                 >  *  NEXT I

2084                                                                 >  *  LINES = DCOUNT(OPO.INTRAL.INT,VM)
2085                                                                 >  *  LN = 1
2086                                                                 >  *  GOSUB 3800
2087                                                                 >  *END
2088                                                                 >  *3105 *
2089                                                                 >  *RETURN
2090                                                                 >  *

2091 3110 *                                                             3110 *
2092 X = X_SCROLL2 ; Y = SLN ; TYP = 1 ; MAXL = 42 ; O.R = 'O' ; *   |  X = 19 ; Y = SLN ; TYP = 1 ; MAXL = 42 ; O.R = 'O'
2093 IF OPO.INTRAL.INT<1,LN> # '' THEN                                  IF OPO.INTRAL.INT<1,LN> # '' THEN
2094 DEFAULT = OPO.INTRAL.INT<1,LN>                                     DEFAULT = OPO.INTRAL.INT<1,LN>
2095 END                                                                END
2096 HMSG = "Enter comments to be printed on the purchase order."       HMSG = "Enter comments to be printed on the purchase order."
2097 CALL EDIT.SUB                                                      CALL EDIT.SUB
2098 IF (VALUE = 'END' OR VALUE = 'E' OR VALUE = '') AND OPTION = '     IF (VALUE = 'END' OR VALUE = 'E' OR VALUE = '') AND OPTION =

2098 IF (VALUE = 'END' OR VALUE = 'E' OR VALUE = '') AND OPTION = '     IF (VALUE = 'END' OR VALUE = 'E' OR VALUE = '') AND OPTION =
2099 OPO.INTRAL.INT = DELETE(OPO.INTRAL.INT,1,LN)                       OPO.INTRAL.INT = DELETE(OPO.INTRAL.INT,1,LN)
2100 GOTO 1199                                                          GOTO 1199
2101 END                                                                END
2102 IF VALUE = 'END' AND OPTION = 'C' THEN                             IF VALUE = 'END' AND OPTION = 'C' THEN
2103 P_X  = X_SCROLL2 ; P_Y = SLN ; P_VALUE = OPO.INTRAL.INT<1,LN>   |  P_X  = 19 ; P_Y = SLN ; P_VALUE = OPO.INTRAL.INT<1,LN> "L#4
2
2104 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
2105 GOTO 1199                                                          GOTO 1199
2106 END                                                                END
2107 IF VALUE # '' THEN                                                 IF VALUE # '' THEN 

2117 OLD.START.LINE = START.LINE                                        OLD.START.LINE = START.LINE
2118 LAST.LINE = START.LINE + PAGE.SIZE - 1                             LAST.LINE = START.LINE + PAGE.SIZE - 1
2119 CNT = 1                                                            CNT = 1
2120 FOR N = START.LINE TO LAST.LINE UNTIL N > LINES                    FOR N = START.LINE TO LAST.LINE UNTIL N > LINES
2121 SLN = BEGIN.PAGE + LINE.SPACE * MOD(N-1,PAGE.SIZE)                 SLN = BEGIN.PAGE + LINE.SPACE * MOD(N-1,PAGE.SIZE)
2122 P_X  = X_SCROLL1 ; P_Y = SLN ; P_VALUE = N "R#2" ; P_OPT = ""   |  P_X  = 15 ; P_Y = SLN ; P_VALUE = N "R#2" ; P_OPT = ""
2123 P_X  := AM:X_SCROLL2 ; P_Y := AM:SLN ; P_VALUE := AM:OPO.INTRA  |  P_X  := AM:19 ; P_Y := AM:SLN ; P_VALUE := AM:OPO.INTRAL.INT
2124 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
2125 CNT = CNT + 1                                                      CNT = CNT + 1
2126 NEXT N                                                             NEXT N

2127 FOR M = CNT TO PAGE.SIZE                                           FOR M = CNT TO PAGE.SIZE
2128 SLN = BEGIN.PAGE + LINE.SPACE * MOD(M-1,PAGE.SIZE)                 SLN = BEGIN.PAGE + LINE.SPACE * MOD(M-1,PAGE.SIZE)
2129 P_X  = X_SCROLL1 ; P_Y = SLN ; P_VALUE = SPACE(3) ; P_OPT = ""  |  P_X  = 15 ; P_Y = SLN ; P_VALUE = "" ; P_OPT = "CL"
2130 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
2131 P_X  = X_SCROLL2 ; P_Y = SLN ; P_VALUE = SPACE(45) ; P_OPT = "  <  
2132 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT) ; * 25858                 <  
2133 NEXT M                                                             NEXT M
2134 3801 *                                                             3801 *
2135 RETURN                                                             RETURN

2134 3801 *                                                             3801 *
2135 RETURN                                                             RETURN
2136 *                                                                  *
2137 3400 *                                                             3400 * 
2138 GOSUB 3800 ;X = 0 ; Y = 22 ; TYP = 3                               GOSUB 3800 ;X = 0 ; Y = 22 ; TYP = 3
2139 ECD.NUM=45;ECD.MINV=OLD.START.LINE                              |  PMSG = 'ENTER LINE NUMBER : '
2140                                                                 >  MINV = OLD.START.LINE
2141 IF LAST.LINE < LINES THEN                                          IF LAST.LINE < LINES THEN
2142 ECD.MAXV=LAST.LINE                                              |  MAXV = LAST.LINE
2143 END ELSE                                                           END ELSE

2144 ECD.MAXV=LINES                                                  |  MAXV = LINES
2145 END                                                                END
2146 ECD.ACTION=4;CALL SCRN.EDIT                                     |  O.R = 'O'; MAXL = 3
2147 LNO = ECD.RET.VALUE                                             |  CALL EDIT.SUB
2148                                                                 >  P_X  = 0 ; P_Y = 22 ; P_VALUE = "" ; P_OPT = "CL"
2149                                                                 >  CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
2150                                                                 >  LNO = VALUE

2177 ***** SCROLL SPECIAL INST                                          ***** SCROLL SPECIAL INST
2178 5200*                                                              5200*
2179 N1 = 0                                                             N1 = 0
2180 FOR N = 1 TO SPI.CNT UNTIL N1 > 0                                  FOR N = 1 TO SPI.CNT UNTIL N1 > 0
2181 IF SI.USED<1,N> = 'Y' THEN                                         IF SI.USED<1,N> = 'Y' THEN
2182                                                                 >  *          SLN = BEGIN.PAGE.2 + LINE.SPACE * MOD(N-1,PAGE.SI
2183 SLN = 23                                                           SLN = 23
2184 P_X  = 0 ; P_Y = SLN ; P_VALUE = "" ; P_OPT = "CL"                 P_X  = 0 ; P_Y = SLN ; P_VALUE = "" ; P_OPT = "CL"
2185 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
2186                                                                 >  *            PRINT @(0,SLN): SI.INST<1,N>:" : ":OPO.JOB.SPEC

2187 IF OPO.DATE.RECVD # "" AND OPTION = "JS" THEN                      IF OPO.DATE.RECVD # "" AND OPTION = "JS" THEN
2188                                                                 >  *               INPUT X :
2189 X = 0; Y = SLN; TYP = 11; MAXL = 1                                 X = 0; Y = SLN; TYP = 11; MAXL = 1
2190 PMSG = SI.INST<1,N>:" : ":OPO.JOB.SPEC<1,N>                        PMSG = SI.INST<1,N>:" : ":OPO.JOB.SPEC<1,N>
2191 CALL EDIT.SUB                                                      CALL EDIT.SUB
2192 P_X  = 0 ; P_Y = 23 ; P_VALUE = "" ; P_OPT = "CL"                  P_X  = 0 ; P_Y = 23 ; P_VALUE = "" ; P_OPT = "CL"
2193 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
2194 END ELSE                                                           END ELSE

2196 END                                                                END
2197 END                                                                END
2198 NEXT N                                                             NEXT N
2199 RETURN                                                             RETURN
2200 5300*                                                              5300*
2201                                                                 >  *      SLN = BEGIN.PAGE.2 + LINE.SPACE * MOD(LN1 - 1,PAGE.SI
2202 SLN=23                                                             SLN=23
2203 X = 0 ; Y = SLN ; TYP = 10+SI.TYP<1,SI>                            X = 0 ; Y = SLN ; TYP = 10+SI.TYP<1,SI>
2204 MAXL = SI.MAX<1,SI> ; O.R = 'O'                                    MAXL = SI.MAX<1,SI> ; O.R = 'O'
2205 IF OPO.JOB.SPEC<1,SI> = "" THEN                                    IF OPO.JOB.SPEC<1,SI> = "" THEN

2209 DEFAULT = OCONV(OPO.JOB.SPEC<1,SI>,'D2/')                          DEFAULT = OCONV(OPO.JOB.SPEC<1,SI>,'D2/')
2210 END ELSE                                                           END ELSE
2211 DEFAULT = OPO.JOB.SPEC<1,SI>                                       DEFAULT = OPO.JOB.SPEC<1,SI>
2212 END                                                                END
2213 END                                                                END
2214 IF POS.INQ THEN                                                 <  
2215 ERRMSG = SI.INST<1,SI>:" ":OPO.JOB.SPEC<1,SI>                   <  
2216 GOSUB 91000                                                     <  
2217 END ELSE                                                        <  
2218 PMSG = SI.INST<1,SI>:" :"                                          PMSG = SI.INST<1,SI>:" :"

2219 CALL EDIT.SUB                                                      CALL EDIT.SUB
2220 END                                                             |  IF VALUE # 'END' THEN
2221 IF VALUE # 'END' AND NOT(POS.INQ) THEN                          <  
2222 OPO.JOB.SPEC<1,SI> = VALUE                                         OPO.JOB.SPEC<1,SI> = VALUE
2223 END                                                                END
2224 RETURN                                                             RETURN
2225 ****************                                                <  
2226 BUILD.SCV.REC:                                                  <  

2227 ****************                                                <  
2228 VEND.KEY = CONO:OPO.VEND.NO                                     <  
2229 MATREAD VEND.REC FROM VEND , VEND.KEY ELSE                      <  
2230 MAT VEND.REC = "????????????????"                               <  
2231 END                                                             <  
2232 ;* 16414                                                        <  
2233 MATREAD JOB.REC FROM JOB, CONO:OPO.JOB.NO<1,1> ELSE             <  

2234 JOB.DESC = "??????????????????????"                             <  
2235 END                                                             <  
2236 JOB.CNT = DCOUNT(OPO.JOB.NO<1>,VM)                              <  
2237 SCV.REC(6)<ECD.SCRN.NO,1> = OPO.VEND.NO                         <  
2238 SCV.REC(7)<ECD.SCRN.NO,1> = OPO.DATE                            <  
2239 SCV.REC(8)<ECD.SCRN.NO,1> = VEND.PO.DESC                        <  
2240 SCV.REC(5)<ECD.SCRN.NO,1> = OPO.CODE                            <  

2241 SCV.REC(10)<ECD.SCRN.NO,1> = VEND.PO.ADDR1                      <  
2242 SCV.REC(12)<ECD.SCRN.NO,1> = VEND.PO.ADDR2                      <  
2243 SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)        <  
2244 SCV.REC(15)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)        <  
2245 SCV.REC(16)<ECD.SCRN.NO,1> = VEND.PO.ZIP                        <  
2246 SCV.REC(54)<ECD.SCRN.NO,1> = VEND.PHONE                         <  
2247 SCV.REC(55)<ECD.SCRN.NO,1> = VEND.FAX                           <  

2248 SCV.REC(17)<ECD.SCRN.NO,1> = OPO.ACCRUE                         <  
2249 SCV.REC(20)<ECD.SCRN.NO,1> = OPO.VDR.ORD                        <  
2250 SCV.REC(48)<ECD.SCRN.NO,1> = OPO.WHSE                           <  
2251 SCV.REC(21)<ECD.SCRN.NO,1> = OPO.SHIP.NAME                      <  
2252 SCV.REC(22)<ECD.SCRN.NO,1> = OPO.SHIP.ADDR1                     <  
2253 SCV.REC(23)<ECD.SCRN.NO,1> = OPO.SHIP.ADDR2                     <  
2254 SCV.REC(24)<ECD.SCRN.NO,1> = FIELD(OPO.SHIP.ADDR3,",",1)        <  

2255 SCV.REC(25)<ECD.SCRN.NO,1> = FIELD(OPO.SHIP.ADDR3,",",2)        <  
2256 SCV.REC(26)<ECD.SCRN.NO,1> = OPO.SHIP.ADDR4                     <  
2257 SCV.REC(27)<ECD.SCRN.NO,1> = OPO.TERMS.DESC                     <  
2258 SCV.REC(28)<ECD.SCRN.NO,1> = OPO.TERMS.DISC                     <  
2259 SCV.REC(29)<ECD.SCRN.NO,1> = OPO.TERMS.DATE                     <  
2260 SCV.REC(30)<ECD.SCRN.NO,1> = OPO.SHIP.VIA                       <  
2261 SCV.REC(31)<ECD.SCRN.NO,1> = OPO.VIA.DESC                       <  

2262 SCV.REC(32)<ECD.SCRN.NO,1> = OPO.FOB                            <  
2263 ;* T25941 v                                                     <  
2264 ;* SCV.REC(43)<ECD.SCRN.NO,1> = OPO.PRT.FLG                     <  
2265 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
2266 ;* T25941 ^                                                     <  
2267 SCV.REC(44)<ECD.SCRN.NO,1> = OPO.ORD.BY                         <  
2268 SCV.REC(47)<ECD.SCRN.NO,1> = OPO.CONTACT                        <  

2269 GOSUB 1020                                                      <  
2270 * 16414                                                         <  
2271 SCV.REC(52)<ECD.SCRN.NO,1> = OPO.INTRAL.INT                     <  
2272 OLD.DATE = OPO.DATE                                             <  
2273 SCV.REC(53)<ECD.SCRN.NO,1> = OPO.DIV.OWNER                      <  
2274 OLD.JOB = OPO.JOB.NO<1,1>                                       <  
2275 OLD.JOB.NO = OPO.JOB.NO                                         <  

2276 OLD.PLINE = OPO.PROD.LINE                                       <  
2277 ;*24231 v                                                       <  
2278 IF MENU.FLAG = "R" THEN                                         <  
2279 LAST.POS = DCOUNT(OPO.STAT<1>,VM)                               <  
2280 SCV.REC(3)<ECD.SCRN.NO,1> = OPO.STAT<1,LAST.POS>  ; *24231      <  
2281 SCV.REC(2)<ECD.SCRN.NO,1> = OPO.APPROVER                        <  
2282 SCV.REC(4)<ECD.SCRN.NO,1> = OPO.ST.DATE<1,LAST.POS>             <  

2283 SCV.REC(1)<ECD.SCRN.NO,1> = OPO.REQUESTOR         ; *25858      <  
2284 END                                                             <  
2285 ;*24231 ^                                                       <  
2286 *C40768 v                                                       <  
2287 IF MENU.FLAG # "R" THEN                                         <  
2288 SCV.REC(60)<ECD.SCRN.NO,1> = OPO.REQUESTOR                      <  
2289 END                                                             <  

2290 *C40768 ^                                                       <  
2291 RETURN                                                          <  
2292 *                                                               <  
2293 **********                                                      <  
2294 SEND.MAIL:                                                      <  
2295 **********                                                      <  
2296 *                                                               <  

2297 IF OPO.APP.LEVEL # "C" THEN                                     <  
2298 SUBJECT = "Outside PO requisition ":OPO.CODE :" is ready for a  <  
2299 END ELSE                                                        <  
2300 SUBJECT = "Outside PO requisition " :OPO.CODE:" has been cance  <  
2301 END                                                             <  
2302 MATREAD SEC.REC FROM SECURITY,CONO:OPO.APPROVER THEN            <  
2303 IF SEC.EMAIL # "" THEN                                          <  

2304 CMD = "!touch ":USER.ID                                         <  
2305 UDTEXECUTE CMD CAPTURING MSG                                    <  
2306 CMD = '!mail -s ':'"':SUBJECT:'" ':SEC.EMAIL:' < ':USER.ID      <  
2307 IF APP.PO.LEVEL # 1 THEN                                        <  
2308 UDTEXECUTE CMD CAPTURING MSG                                    <  
2309 END                                                             <  
2310 END                                                             <  

2311 END                                                             <  
2312 CMD ="!rm ":USER.ID                                             <  
2313 UDTEXECUTE CMD CAPTURING MSG                                    <  
2314 RETURN                                                          <  
2315 *                                                               <  
2316 *************                                                   <  
2317 SET.RELEASED:                                                   <  

2318 *************                                                   <  
2319 *                                                               <  
2320 OPO.LEVEL.STATUS = "R"                                          <  
2321 OPO.STAT<1,-1> = "Released"                                     <  
2322 OPO.ST.DATE<1,-1> = DATE()                                      <  
2323 OPO.PREV.APP<1,-1> = USER.ID                                    <  
2324 RETURN                                                          <  

2325 *                                                               <  
2326 *************                                                   <  
2327 SET.ON.HOLD:                                                    <  
2328 *************                                                   <  
2329 *                                                               <  
2330 OPO.LEVEL.STATUS = "H"                                          <  
2331 OPO.STAT<1,-1> ="On-Hold"                                       <  

2332 OPO.ST.DATE<1,-1> = DATE()                                      <  
2333 OPO.PREV.APP<1,-1> = USER.ID                                    <  
2334 RETURN                                                          <  
2335 *                                                               <  
2336 ****************                                                <  
2337 CHOOSE.APPROVER:                                                <  
2338 ****************                                                <  

2339 *                                                               <  
2340 IF APP.PO.LEVEL # 1 THEN                                        <  
2341 APP.ARR= '' ;*array of valid approvers                          <  
2342 SKIP.RELEASE = 0                                                <  
2343 IF OCONV(TOTAL.AMT,"MD2") <= APP.PO.LIMIT<1,2> OR APP.PO.LIMIT  <  
2344 ;* since order amt. is <= then requestor limit                  <  
2345 ;* it can be released to level 1 approver.                      <  

2346 LEVEL =1 ; ORD.TOT = OCONV(TOTAL.AMT,"MD2") ; APP.ARR = ""      <  
2347 USER= USER.ID ; DIV.OWNER = OPO.DIV.OWNER;TYPE = 2              <  
2348 CALL  FIND.APPROVERS (CONO,USER,DIV.OWNER,TYPE,LEVEL,ORD.TOT,A  <  
2349 END ELSE                                                        <  
2350 ;*check to see if default approver is active                    <  
2351 ;*if not then look for the approver that can send req.          <  
2352 ;*directly to level 1 and make it first in the list.            <  

2353 MAT HOLD.APP.REQ.REC = MAT APP.REQ.REC                          <  
2354 USER = APP.PO.ID<1,2,1>;DIV.OWNER=OPO.DIV.OWNER                 <  
2355 APP.REQ.ID = ""                                                 <  
2356 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  
2357 MAT APP.REQ.REC = MAT HOLD.APP.REQ.REC                          <  
2358 ACTIVE = RET.FLAG                                               <  
2359 IF NOT(ACTIVE) THEN                                             <  

2360 LEVEL= APP.PO.LEVEL-1;ORD.TOT=OCONV(TOTAL.AMT,"MD2");APP.ARR="  <  
2361 USER = USER.ID ; DIV.OWNER = OPO.DIV.OWNER;TYPE = 2             <  
2362 CALL  FIND.APPROVERS (CONO,USER,DIV.OWNER,TYPE,LEVEL,ORD.TOT,A  <  
2363 END                                                             <  
2364 END                                                             <  
2365 ;*now that we have a default approver get all                   <  
2366 ;*active approvers for the user and add them to the list.       <  

2367 NBR.IDS = DCOUNT(APP.PO.ID<1,2>,SVM)                            <  
2368 FOR LL =1 TO NBR.IDS                                            <  
2369 MAT HOLD.APP.REQ.REC = MAT APP.REQ.REC                          <  
2370 USER = APP.PO.ID<1,2,LL>                                        <  
2371 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  
2372 MAT APP.REQ.REC = MAT HOLD.APP.REQ.REC                          <  
2373 IF RET.FLAG = 1 THEN                                            <  

2374 LOCATE APP.REQ.ID IN APP.ARR<1>,1 SETTING JUNK ELSE             <  
2375 APP.ARR<1,-1> = APP.REQ.ID                                      <  
2376 END                                                             <  
2377 END                                                             <  
2378 NEXT LL                                                         <  
2379 ;*set default and valid approvers values                        <  
2380 ECD.DEFAULT = OCONV(APP.ARR<1,1>[4,99],"G!1")                   <  

2381 NBR.IDS = DCOUNT(APP.ARR,VM)                                    <  
2382 VALID.INPUT = ""                                                <  
2383 FOR LL = 1 TO NBR.IDS                                           <  
2384 VALID.INPUT<1,-1>=OCONV(APP.ARR<1,LL>[4,99],"G!1")              <  
2385 NEXT LL                                                         <  
2386 ;*check to see if there are any approvers active                <  
2387 IF VALID.INPUT # "" THEN                                        <  

2388 ;*locate current approver to see if change is needed            <  
2389 CHANGE.NEEDED = 0                                               <  
2390 *    LOCATE OPO.APPROVER IN VALID.INPUT<1>,1 SETTING JUNK ELSE  <  
2391 *      CHANGE.NEEDED=1                                          <  
2392 *    END                                                        <  
2393 IF OPO.APPROVER # VALID.INPUT<1,1> THEN                         <  
2394 CHANGE.NEEDED = 1                                               <  

2395 END                                                             <  
2396 IF (CHANGE.NEEDED) OR OPTION = "CA" THEN                        <  
2397 VALID.INPUT = CONVERT(@VM,",",VALID.INPUT<1>)                   <  
2398 VALID.INPUT :=",???,END"                                        <  
2399 ;*                                                              <  
2400 EOI = 0                                                         <  
2401 LOOP                                                            <  

2402 ECD.NUM = 2                                                     <  
2403 ECD.VALDAT = VALID.INPUT                                        <  
2404 SCV.REC(2)<ECD.SCRN.NO,1> = ""                                  <  
2405 ECD.DEFAULT = OCONV(APP.ARR<1,1>[4,99],"G!1")                   <  
2406 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  
2407 BEGIN CASE                                                      <  
2408 CASE ECD.RET.VALUE = "END"                                      <  

2409 SKIP.RELEASE = 1                                                <  
2410 EOI = 1                                                         <  
2411 CASE ECD.RET.VALUE = "???"                                      <  
2412 MAT GEN.XREF.REC = ""                                           <  
2413 GXR.NAME = "APPROVER"                                           <  
2414 GXR.FILE = APP.REQ                                              <  
2415 GXR.IDLIST = APP.ARR                                            <  

2416 CALL GEN.XREF.SUB(MAT GEN.XREF.REC,PREFIX,XREF.DATA)            <  
2417 ECD.ACTION = 2 ; CALL SCRN.EDIT                                 <  
2418 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
2419 IF GXR.ID # "" THEN                                             <  
2420 GXR.ID = GXR.ID[4,99]                                           <  
2421 OPO.APPROVER = OCONV(GXR.ID,"G!1")                              <  
2422 SCV.REC(2)<ECD.SCRN.NO,1>= OPO.APPROVER                         <  

2423 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
2424 EOI = 1                                                         <  
2425 END                                                             <  
2426 CASE ECD.RET.VALUE # ""                                         <  
2427 EOI = 1                                                         <  
2428 OPO.APPROVER = ECD.RET.VALUE                                    <  
2429 APPROVER.LIMIT = APP.PO.LIMIT<1,2>                              <  

2430 END CASE                                                        <  
2431 UNTIL (EOI) DO REPEAT                                           <  
2432 END                                                             <  
2433 END ELSE                                                        <  
2434 SKIP.RELEASE = 1                                                <  
2435 ERRMSG="No approvers available at this time. You can only file  <  
2436 GOSUB 91000                                                     <  

2437 END                                                             <  
2438 END                                                             <  
2439 RETURN                                                          <  
2440 *                                                               <  
2441 ****************                                                <  
2442 ENT.APP.CODE:                                                   <  
2443 ****************                                                <  

2444 *                                                               <  
2445 *T36138 v                                                       <  
2446 * IF YOU ARE MAKING CHANGES TO THE FORM YOU HAVE TO MANUALY AD  <  
2447 * passwordAND TURN IT OFF SETTING VALUE TO 0                    <  
2448 * TO DO THIS EDIT PMCFORMS {record name} AND LOCATE THE FIELD   <  
2449 * AND ADD IT TO THE END OF THE ATTRIBUTE. FOR PROMPT IT IS FIE  <  
2450 *IF SHOULD LOOK SOMETHING LIKE THIS                             <  

2451 * 1ªª_pmc70                                                     <  
2452 *x_lenªchar_colªchar_rowªchar_lengthªhelp_stringªcursorªuser_d  <  
2453                                                                 <  
2454 *riableª13n9n27n1551ªª8ª0ª21ª8ªª_IBEAM.CURªª0                   <  
2455 P_FIELDS ="_pmc70"                                              <  
2456 P_ATTRS = "password"                                            <  
2457 P_VALUES = 1                                                    <  

2458 ERROR = ""                                                      <  
2459 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
2460 IF ERROR THEN                                                   <  
2461 ERRMSG = ERROR                                                  <  
2462 GOSUB 91000                                                     <  
2463 END                                                             <  
2464 ;*24593 ^                                                       <  

2465 ECD.NUM = 9 ; ECD.ACTION = 4 ; CALL SCRN.EDIT                   <  
2466 CODE.OK = 1                                                     <  
2467 IF ECD.RET.VALUE = APP.CODE THEN                                <  
2468 IF APP.PO.LEVEL = 1 AND OPTION='R' THEN                         <  
2469 OPO.STAT<1,-1> = "Approved"                                     <  
2470 OPO.APP.LEVEL = APP.PO.LEVEL                                    <  
2471 OPO.APPROVER = ""                                               <  

2472 OPO.PREV.APP<1,-1> = USER.ID                                    <  
2473 OPO.ST.DATE<1,-1> = DATE()                                      <  
2474 GOSUB BUILD.SCV.REC                                             <  
2475 ECD.ACTION = 6 ; CALL SCRN.EDIT                                 <  
2476 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
2477 ; *T36138 v                                                     <  
2478 P_FIELDS = "_pmc70"                                             <  

2479 P_ATTRS = "password"                                            <  
2480 P_VALUES = 0                                                    <  
2481 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
2482 IF ERROR THEN                                                   <  
2483 ERRMSG = ERROR                                                  <  
2484 GOSUB 91000                                                     <  
2485 END                                                             <  

2486 GOSUB 1200                                                      <  
2487 ; *T36138 ^                                                     <  
2488 PROMPT.NBR = 58                                                 <  
2489 END ELSE                                                        <  
2490 *    OPO.STAT<1,-1> = "Lvl ":APP.PO.LEVEL<1>:" Apr"             <  
2491 *    OPO.ST.DATE<1,-1> = DATE()                                 <  
2492 *    OPO.PREV.APP<1,-1> = USER.ID                               <  

2493 OPO.APP.LEVEL = APP.PO.LEVEL                                    <  
2494 ;*T36138 v                                                      <  
2495 GOSUB BUILD.SCV.REC                                             <  
2496 ECD.ACTION = 6 ; CALL SCRN.EDIT                                 <  
2497 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
2498 P_FIELDS = "_pmc70"                                             <  
2499 P_ATTRS = "password"                                            <  

2500 P_VALUES = 0                                                    <  
2501 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
2502 IF ERROR THEN                                                   <  
2503 ERRMSG = ERROR                                                  <  
2504 GOSUB 91000                                                     <  
2505 END                                                             <  
2506 ;*T36138 ^                                                      <  

2507 PROMPT.NBR = 57                                                 <  
2508 END                                                             <  
2509 END ELSE                                                        <  
2510 CODE.OK = 0                                                     <  
2511 ERRMSG = "Invalid Approval Code. "                              <  
2512 GOSUB 91000                                                     <  
2513 ;*T36138 v                                                      <  

2514 P_FIELDS = "_pmc70"                                             <  
2515 P_ATTRS = "password"                                            <  
2516 P_VALUES = 0                                                    <  
2517 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
2518 IF ERROR THEN                                                   <  
2519 ERRMSG = ERROR                                                  <  
2520 GOSUB 91000                                                     <  

2521 END                                                             <  
2522 ;*T36138 ^                                                      <  
2523 END                                                             <  
2524 RETURN                                                          <  
2525 *                                                               <  
2526 *T25854 v                                                       <  
2527 *                                                               <  

2528 DUPE.SUB:                                                       <  
2529 *                                                               <  
2530 ECD.NUM = 11                                                    <  
2531 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  
2532 IF ECD.RET.VALUE = "" OR ECD.RET.VALUE = "END" THEN GOTO 1      <  
2533 MATREAD OPO.REC FROM OUT.REQ, CONO:ECD.RET.VALUE ELSE           <  
2534 ERRMSG = 'Requisition # entered not on file'                    <  

2535 GOSUB 91000                                                     <  
2536 GOTO DUPE.SUB                                                   <  
2537 END                                                             <  
2538 USER= USER.ID; DIV.OWNER = OPO.DIV.OWNER; APP.REQ.ID = ""       <  
2539 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  
2540 *T25854.2 v                                                     <  
2541 ECD.NUM = 13                                                    <  

2542 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  
2543 OPO.CODE = ECD.RET.VALUE                                        <  
2544 MATREADU OPO.REC FROM OUTSIDE.PO, CONO:OPO.CODE THEN            <  
2545 IF MENU.FLAG = "R" THEN                                         <  
2546 ERRMSG = "PO with number ":OPO.CODE: " already exists"          <  
2547 GOSUB 91000; RELEASE OUTSIDE.PO,CONO:OPO.CODE                   <  
2548 GOTO DUPE.SUB                                                   <  

2549 END                                                             <  
2550 END ELSE                                                        <  
2551 MATREADU OPO.REC FROM OUT.REQ, CONO:OPO.CODE THEN               <  
2552 ERRMSG = "Requisition with number ":OPO.CODE:" already exists"  <  
2553 GOSUB 91000 ; RELEASE OUT.REQ,CONO:OPO.CODE ; GOTO DUPE.SUB     <  
2554 REQ = 1 ; * this is still requisition                           <  
2555 END                                                             <  

2556 END                                                             <  
2557 IF OPO.CODE = 'N' THEN                                          <  
2558 OPO.STAT<1> = 'Entered'                                         <  
2559 END ELSE                                                        <  
2560 OPO.STAT<1> = ''                                                <  
2561 END                                                             <  
2562 *T25854.2 ^                                                     <  

2563 OPO.ST.DATE<1> = DATE()                                         <  
2564 OPO.PREV.APP = USER.ID                                          <  
2565 OPO.ORD.BY = APP.NAME<1>                                        <  
2566 OPO.DATE = DATE()                                               <  
2567 OPO.APPROVER = ''                                               <  
2568 OPO.APP.LEVEL = ''                                              <  
2569 OPO.PREV.APP = ''                                               <  

2570 OPO.LEVEL.STATUS = ''                                           <  
2571 NEW = 1                                                         <  
2572 REQ = 1                                                         <  
2573 GOSUB BUILD.SCV.REC                                             <  
2574 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
2575 GOTO 90                                                         <  
2576 *T25854 ^                                                       <  

2577 ****                                                            <  
2578 7500                                                            <  
2579 JOB.SPEC.PROMPT = '' ; JOB.SPEC.RESPONSE = ''                   <  
2580 JOB.SPEC.START.LINE=1; JOB.SPEC.PAGE.SIZE=1; JOB.SPEC.OLD.STAR  <  
2581 JOB.SPEC.BEGIN.PAGE = 23 ; JOB.SPEC.LINE.SPACE = 1 ; JOB.SPEC.  <  
2582 FOR NDX = 1 TO SPI.CNT                                          <  
2583 IF TRIM(OPO.JOB.SPEC<1,NDX>) # "" THEN                          <  

2584 JOB.SPEC.PROMPT<1,-1> = SI.INST<1,NDX>                          <  
2585 JOB.SPEC.RESPONSE<1,-1> = OPO.JOB.SPEC<1,NDX>                   <  
2586 END                                                             <  
2587 NEXT NDX                                                        <  
2588 JOB.SPEC.LINES = DCOUNT(JOB.SPEC.PROMPT,VM)                     <  
2589 LOOP COMPLETE = 0                                               <  
2590 ECD.NUM=59 ; ECD.ACTION=4 ; CALL SCRN.EDIT ; OPTION=ECD.RET.VA  <  

2591 BEGIN CASE                                                      <  
2592 CASE OPTION = 'E' OR OPTION = 'END' OR OPTION = ''              <  
2593 COMPLETE = 1                                                    <  
2594 P_X = 0 ; P_Y = 23 ; P_VALUE = "" ; P_CL = "CL"                 <  
2595 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                           <  
2596 CASE OPTION = 'S'                                               <  
2597 JOB.SPEC.LN = JOB.SPEC.LN + JOB.SPEC.PAGE.SIZE                  <  

2598 IF JOB.SPEC.LN > JOB.SPEC.LINES THEN JOB.SPEC.LN = 1            <  
2599 GOSUB 7700                                                      <  
2600 * T25978 v                                                      <  
2601 CASE OPTION = 'SR'                                              <  
2602 JOB.SPEC.LN -= JOB.SPEC.PAGE.SIZE                               <  
2603 IF JOB.SPEC.LN < 1 THEN JOB.SPEC.LN = 1                         <  
2604 GOSUB 7700                                                      <  

2605 CASE OPTION = 'ST'                                              <  
2606 JOB.SPEC.LN = 1                                                 <  
2607 GOSUB 7700                                                      <  
2608 CASE OPTION = 'SB'                                              <  
2609 JOB.SPEC.LN = JOB.SPEC.LINES                                    <  
2610 GOSUB 7700                                                      <  
2611 * T25978 ^                                                      <  

2612 CASE 1                                                          <  
2613 ERRMSG = "INVALID RESPONSE"                                     <  
2614 GOSUB 91000                                                     <  
2615 END CASE                                                        <  
2616 UNTIL COMPLETE REPEAT                                           <  
2617 RETURN                                                          <  
2618 ***                                                             <  

2619 7700                                                            <  
2620 JOB.SPEC.START.LINE = 1 + INT((JOB.SPEC.START.LINE-1)/JOB.SPEC  <  
2621 IF JOB.SPEC.START.LINE # JOB.SPEC.OLD.START.LINE THEN           <  
2622 JOB.SPEC.OLD.START.LINE = JOB.SPEC.START.LINE                   <  
2623 JOB.SPEC.LAST.LINE = JOB.SPEC.START.LINE + JOB.SPEC.PAGE.SIZE   <  
2624 CNT = 1                                                         <  
2625 FOR N = JOB.SPEC.START.LINE TO JOB.SPEC.LAST.LINE UNTIL N > JO  <  

2626 SLN = JOB.SPEC.BEGIN.PAGE + JOB.SPEC.LINE.SPACE * MOD(N-1,JOB.  <  
2627 P_X = 0 ; P_Y = SLN ; P_VALUE = JOB.SPEC.PROMPT<1,N> "L#40":"   <  
2628 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                           <  
2629 CNT = CNT + 1                                                   <  
2630 NEXT N                                                          <  
2631 END                                                             <  
2632 RETURN                                                          <  

2633 *                                                               <  
2634 **** CALLS FOR SYSCOM                                              **** CALLS FOR SYSCOM
2635 *                                                               <  
2636 91000 *                                                            91000 *
2637 ERR.TYPE = 1; CALL SYSCOM(MAT SYSCOM.REC)                          ERR.TYPE = 1; CALL SYSCOM(MAT SYSCOM.REC)
2638 RETURN                                                             RETURN
2639 92000 *                                                            92000 *

2640 ERR.TYPE = 2; CALL SYSCOM(MAT SYSCOM.REC)                          ERR.TYPE = 2; CALL SYSCOM(MAT SYSCOM.REC)
2641 RETURN                                                             RETURN
2642 93000 *                                                            93000 *
2643 ERR.TYPE = 3; CALL SYSCOM(MAT SYSCOM.REC)                          ERR.TYPE = 3; CALL SYSCOM(MAT SYSCOM.REC)
2644 99999 *                                                            99999 *
2645                                                                 >  *       PRINT @(-1):
2646 RELEASE                                                            RELEASE
2647 END                                                                END
2648 


POSBP/OUTSIDE.PO.MAINT.SUB                                         /vsi/cust/rev11/cbn/CBA-CBN/CBNBP/OUTSIDE.PO.MAINT.SUB
Printed for thompson at 06/28/2006 04:48:01PM

0001 * T25938 v   SUBROUTINE OUTSIDE.PO.MAINT.SUB(CONO,OPO.NO,NEW)   |  SUBROUTINE OUTSIDE.PO.MAINT.SUB(CONO,OPO.NO,NEW)
0002 SUBROUTINE OUTSIDE.PO.MAINT.SUB(CONO,OPO.NO,NEW,DUPLICATED.PO)  <  
0003 * T25938 ^                                                      <  
0004 *COPY>CPYLIB>COM1                                                  *COPY>CPYLIB>COM1
0005 *COPY>POS.CPYLIB>COM.OPO                                           *COPY>POS.CPYLIB>COM.OPO
0006 *COPY>PMC.CPYLIB>COM.VEND                                          *COPY>PMC.CPYLIB>COM.VEND
0007 **************************************************************     ************************************************************

0021 *                          for DIVISION error msg issued but D     *                          for DIVISION error msg issued but
0022 *                          cleared from OPO REC so gets in loo     *                          cleared from OPO REC so gets in l
0023 *T21177 diane 11/06/1996 * REV11 UPG                               *T21177 diane 11/06/1996 * REV11 UPG
0024 *T23310 rik 10/08/1998 * ASCII DISPLAY: DON'T CLEAR DEV,DEPT &     *T23310 rik 10/08/1998 * ASCII DISPLAY: DON'T CLEAR DEV,DEPT
0025 *                        DESCRIPTIONS WHEN SCROLLING.              *                        DESCRIPTIONS WHEN SCROLLING.
0026 *T23319 cindy 10/16/1998 * was not calculating uom type 'c' co  |  *T23499 rick 08/07/1999 * Mod to pgm to force ability to hav
0027 *T24231 edvard 08/23/1999 * Disallow changes is requisition ap  |  *                         detail lines that contain the same
0028 *                           moved to the next level.            |  *                         and the same category
0029 *                         FIELD, TO DEFAULT THE PREVIOUS VALUE  |  *T23319 lanny 04/07/2000 * Correct UOM 'C' calc of cost
0030 *T24519 alex 11/02/1999 * Mods to the order quantity, cancel a  |  *T28501 bmourad 03/28/2005 * DO NOT ALLOW ENTRY OF CANCELED 

0031 *                         field, to default the previous value  |  *                            JOB
0032 *T24555 alex 11/16/1999 * MOD TO DISPLAY THE ESTIMATE ORDER AM  <  
0033 *                         GUI MODE.                             <  
0034 *T24765 alex 01/28/2000 * THE WORD 'UNKNOWN' IS NOT IN DOUBLE   <  
0035 *T25662 lanny 03/02/2001 * Cancel date field not being updated  <  
0036 *T25755 cm 04/18/2001 * Mod to pgm to force ability to have mu  <  
0037 *                       detail lines that contain the same job  <  

0038 *                       the same category.                      <  
0039 *T25852 edwin 06/14/2001 * Add ability to insert line in comme  <  
0040 *T25855 edwin 06/30/2001 * Add PO inquiry function.             <  
0041 *T25944 ajibaly 07/11/2001 * One product/screen, expand commen  <  
0042 *T26213 cmykleb 02/04/2002 * Remove prompt for line # to chang  <  
0043 *                            (C)hange, (D)elete and (CO)mments  <  
0044 *                            there is only 1 line item per scr  <  

0045 *T25978 adelgado 02/13/2002 * Add the use of prompts (S,SR,SB,  <  
0046 *T25938 cmykleb 02/20/2002 * Add a duplicate function to PO's.  <  
0047 *T26645 cmykleb 06/03/2002 * Do not allow a del date past the   <  
0048 *                            on the job.                        <  
0049 *C40465 ajibaly 08/01/2002 * Case of disappearing div/dept/cct  <  
0050 *T27715 thompson 09/19/2003 * Add read to job file if going to  <  
0051 *                             due date on line after original   <  

0052 *C42996 cmykleb 01/22/2004 * If a line is changed and the deli  <  
0053 *                            is some reason blank then an erro  <  
0054 *T27938 cmykleb 02/05/2004 * If the unit price is a negative a  <  
0055 *                            the unit of measure is EA, then t  <  
0056 *                            amount displayed is off by a penn  <  
0057 **************************************************************     ************************************************************
0058 *ENDDOC                                                            *ENDDOC

0071 *COPY>JCS.CPYLIB>CATEGORY.OSP                                      *COPY>JCS.CPYLIB>CATEGORY.OSP
0072 *COPY>PMC.CPYLIB>COA                                               *COPY>PMC.CPYLIB>COA
0073 *COPY>CPYLIB>FILE.VARS                                             *COPY>CPYLIB>FILE.VARS
0074 *COPY>CPYLIB>SYSCOM                                                *COPY>CPYLIB>SYSCOM
0075 *COPY>CPYLIB>CHAR                                                  *COPY>CPYLIB>CHAR
0076 *24231 v                                                        <  
0077 *COPY>POS.CPYLIB>APP.REQ                                        <  
0078 PROCREAD BUFFER ELSE                                            <  
0079 ERRMSG = "MUST BE RUN FROM PROC"                                <  
0080 GOSUB 93000                                                     <  

0081 END                                                             <  
0082 *24231 ^                                                        <  
0083 ***COPY>CPYLIB>GEN.XREF                                            ***COPY>CPYLIB>GEN.XREF
0084 *COPY>CPYLIB>GEN.XREF.SUB                                          *COPY>CPYLIB>GEN.XREF.SUB
0085 *COPY>JCS.CPYLIB>OPERATION            ; * T25755                |  *T23499 add operation cpylib for input validation
0086                                                                 >  *COPY>JCS.CPYLIB>OPERATION
0087 *                                                                  *

0088 IF BUFFER<5> = "I" THEN POS.INQ = 1 ELSE POS.INQ = 0  ; *25855  <  
0089 *                                                               <  
0090 **** SETUP FOR SYSTEM ERRMSGS                                      **** SETUP FOR SYSTEM ERRMSGS
0091 SYS.TYPE = 1                                                       SYS.TYPE = 1
0092 CALL SYSCOM(MAT SYSCOM.REC)                                        CALL SYSCOM(MAT SYSCOM.REC)
0093 CONO=''; MAT COMP.REC = ''                                         CONO=''; MAT COMP.REC = ''
0094 CALL GET.CONO(CONO,MAT COMP.REC)                                   CALL GET.CONO(CONO,MAT COMP.REC)

0095 *                                                                  *
0096 *24231 v                                                        <  
0097 OPEN 'APP.REQ' TO APP.REQ ELSE                                  <  
0098 ERRMSG = "Cannot open APP.REQ"                                  <  
0099 GOSUB 91000                                                     <  
0100 GOSUB 99999                                                     <  
0101 END                                                             <  
0102 IF BUFFER<1> = "R" THEN                                         <  

0103 USER.ID = UPCASE(@LOGNAME)                                      <  
0104 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!ALL" THEN       <  
0105 IF APP.STATUS = "Y" THEN                                        <  
0106 NULL                                                            <  
0107 END ELSE                                                        <  
0108 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":OPO.DIV.OWNE  <  
0109 MAT APP.REQ.REC = ""                                            <  

0110 END                                                             <  
0111 END                                                             <  
0112 END ELSE                                                        <  
0113 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":OPO.DIV.OWNE  <  
0114 MAT APP.REQ.REC = ""                                            <  
0115 END                                                             <  
0116 END                                                             <  

0117 MENU.FLAG = "R"                                                 <  
0118 END ELSE                                                        <  
0119 MENU.FLAG = "P"                                                 <  
0120 END                                                             <  
0121 *24231 ^                                                        <  
0122 *                                                               <  
0123 IF CO.APS.O.INTRF > 2 THEN                                         IF CO.APS.O.INTRF > 2 THEN

0125 ERRMSG = 'VEND.PROD.STATS FILE IS MISSING'                         ERRMSG = 'VEND.PROD.STATS FILE IS MISSING'
0126 GOSUB 93000                                                        GOSUB 93000
0127 END                                                                END
0128 END                                                                END
0129 ***** INT                                                          ***** INT
0130 OPTION1 = '' ; *T25938                                          <  
0131 EXT.FLAG = 0                                                       EXT.FLAG = 0
0132 MAT GEN.XREF.REC = ''                                              MAT GEN.XREF.REC = ''
0133 GXR.CO = CONO                                                      GXR.CO = CONO
0134                                                                 >  *  GXR.HEADING<1,2>='DESCRIPTION'

0135                                                                 >  * GXR.ATT<1,1>=0;GXR.ATT<1,2>=2;GXR.LEN<1,1>=5;GXR.LEN<1,2>=
0136 MAT DIV.REC = ''; MAT DEPT.REC = ''; MAT CCTR.REC = ''             MAT DIV.REC = ''; MAT DEPT.REC = ''; MAT CCTR.REC = ''
0137 BEGIN.PAGE.1 = 7                                                   BEGIN.PAGE.1 = 7
0138 *T25944    PAGE.SIZE.1 = 2                                      |  PAGE.SIZE.1 = 2
0139 PAGE.SIZE.1 = 1                                                 |  LINE.SPACE.1 = 6
0140 *T25944    LINE.SPACE.1 = 6                                     <  
0141 LINE.SPACE.1 = 1                                                <  

0142 BEGIN.PAGE.3 = ''                                                  BEGIN.PAGE.3 = ''
0143 *T25944    PAGE.SIZE.3 = 2                                      |  PAGE.SIZE.3 = 2
0144 PAGE.SIZE.3 = 9                                                 <  
0145 LINE.SPACE.3 = 1                                                   LINE.SPACE.3 = 1
0146 OLD.START.LINE.3 = 0                                               OLD.START.LINE.3 = 0
0147 LINES.3 = 0;S.LINES.3 = 0                                          LINES.3 = 0;S.LINES.3 = 0
0148 LN3 = 0                                                            LN3 = 0
0149 LINES.1 = 0 ; S.LINES.1 = 0                                        LINES.1 = 0 ; S.LINES.1 = 0

0150 OLD.START.LINE.1 = 0                                               OLD.START.LINE.1 = 0
0151 OPTION = ''                                                        OPTION = ''
0152 * TASK 20080 v                                                     * TASK 20080 v
0153 GEN.DIV = "00";GEN.DEPT = "00"; GEN.CCTR = "000"                   GEN.DIV = "00";GEN.DEPT = "00"; GEN.CCTR = "000"
0154 * TASK 20080 ^                                                     * TASK 20080 ^
0155 QTY.RECVD = 0                                                   |  * QTY.RECVD = 0
0156 *                                                               |  *t23499 v
0157 IF OPO.LAST.SEQ = '' THEN OPO.LAST.SEQ = 0 ; * T25755           |  IF OPO.LAST.SEQ = "" THEN OPO.LAST.SEQ=0
0158 *display background                                             |  *T23499 ^
0159 *                                                               <  

0160 ECD.SCRN.NO = 2;ECD.ACTION=2;CALL SCRN.EDIT                     <  
0161 *                                                               <  
0162 **** MAIN PROCESSING                                               **** MAIN PROCESSING
0163 *24231 v                                                        <  
0164 IF BUFFER<1> = "R" THEN                                         <  
0165 HEADING = "OUTSIDE DETAIL PURCHASE REQUISITION ENTRY"           <  
0166 CAPTION36 = "Req #"                                             <  

0167 IF GUIFORM THEN                                                 <  
0168 CALL VSI_SETATTR("_pmc36","border_style","raised",ERROR)        <  
0169 *    CALL VSI_SETATTR("_pmc36","font","Fixedsys*10*normal*norm  <  
0170 END                                                             <  
0171 END ELSE                                                        <  
0172 * 25855 v                                                       <  
0173 IF POS.INQ THEN                                                 <  

0174 HEADING = "DETAIL OUTSIDE PURCHASE ORDER INQUIRY"               <  
0175 END ELSE                                                        <  
0176 HEADING = "DETAIL OUTSIDE PURCHASE ORDER ENTRY"                 <  
0177 END                                                             <  
0178 * 25855 ^                                                       <  
0179 CAPTION36 = "Po #"                                              <  
0180 IF GUIFORM THEN                                                 <  

0181 CALL VSI_SETATTR("_pmc36","border_style","raised",ERROR)        <  
0182 *    CALL VSI_SETATTR("_pmc36","font","Fixedsys*10*normal*norm  <  
0183 END                                                             <  
0184 END                                                             <  
0185 SCV.REC(50)<ECD.SCRN.NO> = HEADING                              <  
0186 SCV.REC(36)<ECD.SCRN.NO> = CAPTION36                            <  
0187 *24231 ^                                                        <  

0188 SCV.REC(5)<ECD.SCRN.NO,1> = OPO.VEND.NO                            SCV.REC(5)<ECD.SCRN.NO,1> = OPO.VEND.NO
0189                                                                 >  ECD.NUM = 5
0190                                                                 >  ECD.ACTION=5;CALL SCRN.EDIT
0191 SCV.REC(14)<ECD.SCRN.NO,1> = VEND.PO.DESC                          SCV.REC(14)<ECD.SCRN.NO,1> = VEND.PO.DESC
0192                                                                 >  ECD.NUM = 14
0193                                                                 >  ECD.ACTION=5;CALL SCRN.EDIT
0194 SCV.REC(1)<ECD.SCRN.NO,1> = OPO.NO                                 SCV.REC(1)<ECD.SCRN.NO,1> = OPO.NO
0195 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  

0196 IF GUIFORM THEN                                                 <  
0197 CALL VSI_PTITLE(HEADING, ERROR)                                 <  
0198 END                                                             <  
0199 ECD.NUM = 1                                                        ECD.NUM = 1
0200 ECD.ACTION=5; CALL SCRN.EDIT                                       ECD.ACTION=5; CALL SCRN.EDIT
0201 *24231 ^                                                        |  IF OPO.JOB.NO = '' THEN
0202 IF OPO.JOB.NO = '' AND NOT(POS.INQ) THEN       ; * 25855        <  

0244 MATREAD JOB.REC FROM JOB, CONO:ECD.RET.VALUE ELSE                  MATREAD JOB.REC FROM JOB, CONO:ECD.RET.VALUE ELSE
0245 ERRMSG = "Not a Valid Job Number"                                  ERRMSG = "Not a Valid Job Number"
0246 GOSUB 91000                                                        GOSUB 91000
0247 GOTO 1001                                                          GOTO 1001
0248 END                                                                END
0249                                                                 >  *T28501 v
0250                                                                 >  STATUS = ""
0251                                                                 >  CALL JOB.STATUS.SUB(JOB.STATUS,JOB.TRACK.DATE,STATUS)
0252                                                                 >  IF STATUS = "COMPLETED" OR STATUS = "CANCELLED" THEN
0253                                                                 >  ERRMSG = "JOB IS ":STATUS

0254                                                                 >  GOSUB 91000
0255                                                                 >  GOTO 1001
0256                                                                 >  END
0257                                                                 >  *T28501 ^
0258 *** 19404                                                          *** 19404
0259 *T20080 v                                                          *T20080 v
0260 IF OPO.DIV.OWNER # "00" THEN                                       IF OPO.DIV.OWNER # "00" THEN

0321 END                                                                END
0322 SCV.REC(4)<ECD.SCRN.NO,LN1> = ECD.RET.VALUE                        SCV.REC(4)<ECD.SCRN.NO,LN1> = ECD.RET.VALUE
0323 END CASE                                                           END CASE
0324 ****                                                               ****
0325 DONE = 0                                                           DONE = 0
0326 *T25755 v                                                       |  *T23499 v  comment out the following code so as to allow 
0327 * Comment out the following code so as to allow detail lines i  |  *           detail lines in the same PO to be same job same 
0328 * PO to be the same job and the same osp.category.              <  
0329 *  JCNT = DCOUNT(OPO.JOB.NO<1>,@VM)                                *      JCNT = DCOUNT(OPO.JOB.NO<1>,@VM)
0330 *  FOR F = 1 TO JCNT                                               *      FOR F = 1 TO JCNT

0336 *           GOSUB 1100;GOTO 1001                                   *               GOSUB 1100;GOTO 1001
0337 *           DONE = 1                                               *               DONE = 1
0338 *        END                                                       *            END
0339 *     END                                                          *         END
0340 *  NEXT F                                                          *      NEXT F
0341 *T25755 ^                                                       |  *T23499 ^
0342 ****                                                               ****
0343 OPO.PROD.LINE<1,LN1> = SCV.REC(4)<ECD.SCRN.NO,LN1>                 OPO.PROD.LINE<1,LN1> = SCV.REC(4)<ECD.SCRN.NO,LN1>
0344 IF GXR.ID # '' THEN                                                IF GXR.ID # '' THEN
0345 OLD.LN1 = LN1                                                      OLD.LN1 = LN1

0358 ****GET RECEIVED INFO                                              ****GET RECEIVED INFO
0359 1003 *                                                             1003 *
0360 IF CO.APS.O.INTRF < 3 THEN RETURN                                  IF CO.APS.O.INTRF < 3 THEN RETURN
0361 *TASK 18416 CLS                                                    *TASK 18416 CLS
0362 IF OPO.PROD.LINE<1,LN1> # '' AND OPO.JOB.NO<1,LN1> # '' THEN       IF OPO.PROD.LINE<1,LN1> # '' AND OPO.JOB.NO<1,LN1> # '' THEN
0363 *T25755 v                                                       <  
0364 *     VPDS.KEY=CONO:OPO.VEND.NO:"!O!":OPO.NO:"!":OPO.JOB.NO<1,  <  
0365 VPDS.KEY=CONO:OPO.VEND.NO:"!O!":OPO.NO:"!":OPO.JOB.NO<1,LN1>:"     VPDS.KEY=CONO:OPO.VEND.NO:"!O!":OPO.NO:"!":OPO.JOB.NO<1,LN1>
0366 *T25755 ^                                                       <  
0367 MATREAD VPDS.REC FROM VEND.PROD.STATS,VPDS.KEY ELSE MAT VPDS.R     MATREAD VPDS.REC FROM VEND.PROD.STATS,VPDS.KEY ELSE MAT VPDS

0389 GOSUB 1100 ; GOTO 1001                                             GOSUB 1100 ; GOTO 1001
0390 END ELSE                                                           END ELSE
0391 GOTO 1999                                                          GOTO 1999
0392 END                                                                END
0393 END                                                                END
0394 *T26645 v                                                       <  
0395 MATREAD JOB.REC FROM JOB,CONO:OPO.JOB.NO<1,LN1> ELSE MAT JOB.R  <  
0396 IF ECD.RET.VALUE GT JOB.TRACK.DATE<1,4> THEN                    <  
0397 ERRMSG = "Date entered is past the job due date of ":OCONV(JOB  <  
0398 GOSUB 91000                                                     <  

0399 GOTO 1333                                                       <  
0400 END                                                             <  
0401 *T26645 ^                                                       <  
0402 OPO.EXP.DATE<1,LN1> = ECD.RET.VALUE                                OPO.EXP.DATE<1,LN1> = ECD.RET.VALUE
0403 **** INPUT U.PRICE PRICE                                           **** INPUT U.PRICE PRICE
0404 1004  *                                                            1004  *
0405 OLD.U.PRICE = OPO.U.PRICE<1,LN1>                                   OLD.U.PRICE = OPO.U.PRICE<1,LN1>

0492 ECD.SUB.NUM = LN1                                                  ECD.SUB.NUM = LN1
0493 IF OPTION = 'C' THEN                                               IF OPTION = 'C' THEN
0494 *        IF OPO.CANCEL.QTY<1,LN1>+0=0 AND OPO.QTY.RECVD<1,LN1>     *        IF OPO.CANCEL.QTY<1,LN1>+0=0 AND OPO.QTY.RECVD<1,LN
0495 *          TEMP.XCL = OPO.QTY<1,LN1> - OPO.QTY.RECVD<1,LN1>        *          TEMP.XCL = OPO.QTY<1,LN1> - OPO.QTY.RECVD<1,LN1>
0496 TEMP.XCL = OPO.QTY<1,LN1> - OPO.QTY.RECVD<1,LN1> - OPO.CANCEL.     TEMP.XCL = OPO.QTY<1,LN1> - OPO.QTY.RECVD<1,LN1> - OPO.CANCE
0497 *24519 v                                                        <  
0498 IF TEMP.XCL < 0 THEN TEMP.XCL = 0                                  IF TEMP.XCL < 0 THEN TEMP.XCL = 0
0499                                                                 >  *        END ELSE TEMP.XCL = 0
0500 END ELSE TEMP.XCL = 0                                              END ELSE TEMP.XCL = 0
0501 IF OPO.CANCEL.QTY<1,LN1> + 0 = 0 THEN                           |  *     IF OPO.CANCEL.QTY<1,LN1> + 0 = 0 THEN

0502 ECD.DEFAULT = '0'                                               |  *        ECD.DEFAULT = '0'
0503 *     ECD.DEFAULT = TEMP.XCL                                    |  ECD.DEFAULT = TEMP.XCL
0504 END ELSE                                                        |  *     END ELSE
0505 ECD.DEFAULT = OPO.CANCEL.QTY<1,LN1>                             |  *        ECD.DEFAULT = OPO.CANCEL.QTY<1,LN1>
0506 END                                                             |  *     END
0507 * 24519 ^                                                       <  
0508 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT

0523 IF OPO.QTY<1,LN1> > 0 AND ECD.RET.VALUE < 0 THEN                   IF OPO.QTY<1,LN1> > 0 AND ECD.RET.VALUE < 0 THEN
0524 ERRMSG="CANCELLED QUANTITY IS LESS THAN THE OPEN QUANTITY"         ERRMSG="CANCELLED QUANTITY IS LESS THAN THE OPEN QUANTITY"
0525 GOSUB 91000; GOTO 1009                                             GOSUB 91000; GOTO 1009
0526 END                                                                END
0527 IF ECD.RET.VALUE = '' THEN ECD.RET.VALUE = 0                       IF ECD.RET.VALUE = '' THEN ECD.RET.VALUE = 0
0528 IF ECD.RET.VALUE # 0 AND ECD.RET.VALUE # OPO.CANCEL.QTY<1,LN1>  <  
0529 OPO.CANCEL.QTY<1,LN1> = ECD.RET.VALUE                              OPO.CANCEL.QTY<1,LN1> = ECD.RET.VALUE
0530 DESC.PRICE = INT(OPO.U.PRICE<1,LN1>*((OPO.DISCOUNT<1,LN1>/1000     DESC.PRICE = INT(OPO.U.PRICE<1,LN1>*((OPO.DISCOUNT<1,LN1>/1
0
0531 DESC.PRICE = INT(OPO.U.PRICE<1,LN1> - DESC.PRICE)                  DESC.PRICE = INT(OPO.U.PRICE<1,LN1> - DESC.PRICE)
0532 *T23319 v                                                          *T23319 v

0533                                                                 >  *     IF OPO.UOM<1,LN1> = "M" THEN
0534 BEGIN CASE                                                         BEGIN CASE
0535 CASE OPO.UOM<1,LN1> = "M"                                       |  CASE OPO.UOM<1,LN1> = 'M'
0536 CANCEL.AMT = INT(((DESC.PRICE/100)*(OPO.CANCEL.QTY<1,LN1>/1000     CANCEL.AMT = INT(((DESC.PRICE/100)*(OPO.CANCEL.QTY<1,LN1>/10
0537 CASE OPO.UOM<1,LN1> = "C"                                       |  CASE OPO.UOM<1,LN1> = 'C'
0538 CANCEL.AMT = INT(((DESC.PRICE/100)*(OPO.CANCEL.QTY<1,LN1>/1000     CANCEL.AMT = INT(((DESC.PRICE/100)*(OPO.CANCEL.QTY<1,LN1>/10
0539                                                                 >  *     END ELSE

0540 CASE 1                                                             CASE 1
0541 CANCEL.AMT = INT((DESC.PRICE/100) * (OPO.CANCEL.QTY<1,LN1>/100     CANCEL.AMT = INT((DESC.PRICE/100) * (OPO.CANCEL.QTY<1,LN1>/1
0542                                                                 >  *     END
0543 END CASE                                                           END CASE
0544 *T23319 ^                                                          *T23319 ^
0545 OPO.CANCEL.COST<1,LN1> = CANCEL.AMT                                OPO.CANCEL.COST<1,LN1> = CANCEL.AMT
0546 AA=LN1                                                             AA=LN1
0547 GOSUB 1020                                                         GOSUB 1020
0548 IF S.LINES.1 = 0 THEN                                              IF S.LINES.1 = 0 THEN

0559 *                                                                  *
0560 *  READV DIV FROM JOB,CONO:OPO.JOB.NO<1,LN1>,6 ELSE DIV = ''       *  READV DIV FROM JOB,CONO:OPO.JOB.NO<1,LN1>,6 ELSE DIV = ''
0561 MATREAD JOB.REC FROM JOB, CONO:OPO.JOB.NO<1,LN1> ELSE  JOB.DIV     MATREAD JOB.REC FROM JOB, CONO:OPO.JOB.NO<1,LN1> ELSE  JOB.D
0562 OPO.DVDPCC<1,1,LN1> = JOB.DIV                                      OPO.DVDPCC<1,1,LN1> = JOB.DIV
0563 ECD.NUM=26;ECD.SUB.NUM=LN1;SCV.REC(26)<ECD.SCRN.NO,LN1>=JOB.DI     ECD.NUM=26;ECD.SUB.NUM=LN1;SCV.REC(26)<ECD.SCRN.NO,LN1>=JOB.
0564                                                                 >  *READV DIVDESC FROM DIVISION,CONO:DIV,1 ELSE DIVDESC = ''
0565 MATREAD DIV.REC FROM DIVISION,CONO:JOB.DIV ELSE                    MATREAD DIV.REC FROM DIVISION,CONO:JOB.DIV ELSE
0566 ERRMSG = "DIVISION NOT ON FILE"                                    ERRMSG = "DIVISION NOT ON FILE"
0567 GOSUB 91000                                                        GOSUB 91000
0568 GOSUB 1100;GOTO 1001                                               GOSUB 1100;GOTO 1001

0576 GOTO 1999                                                          GOTO 1999
0577 CASE ECD.RET.VALUE = 'END' AND OPTION = 'A'                        CASE ECD.RET.VALUE = 'END' AND OPTION = 'A'
0578 GOSUB 1100; GOTO 1001                                              GOSUB 1100; GOTO 1001
0579 CASE ECD.RET.VALUE = '???'                                         CASE ECD.RET.VALUE = '???'
0580 IF OPO.DVDPCC<1,2,LN1> # "" THEN                                   IF OPO.DVDPCC<1,2,LN1> # "" THEN
0581 MATREAD DEPT.REC FROM DEPARTMENT, CONO:OPO.DVDPCC<1,2,LN1> ELS  |  MATREAD DEPT.REC FROM DEPARTMENT, CONO:OPO.DVDPCC<1,2,LN1> E
0582 END ELSE                                                           END ELSE
0583 GXR.NAME = 'DEPARTMENT'                                            GXR.NAME = 'DEPARTMENT'
0584 GXR.XREF=DIVISION                                                  GXR.XREF=DIVISION
0585 GXR.FILE=DEPARTMENT                                                GXR.FILE=DEPARTMENT

0586 GXR.ID=''                                                          GXR.ID=''
0587 GXR.SRCH.ID=JOB.DIV                                                GXR.SRCH.ID=JOB.DIV
0588 CALL GEN.XREF.SUB(MAT GEN.XREF.REC,PREFIX,XREF.DATA)               CALL GEN.XREF.SUB(MAT GEN.XREF.REC,PREFIX,XREF.DATA)
0589 ECD.ACTION=2;CALL SCRN.EDIT                                        ECD.ACTION=2;CALL SCRN.EDIT
0590 ECD.ACTION=3;CALL SCRN.EDIT                                        ECD.ACTION=3;CALL SCRN.EDIT
0591 *T26556 v                                                       <  
0592 ECD.NUM=28;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=O  <  
0593 ECD.NUM=22;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=O  <  
0594 *T26556 ^                                                       <  
0595 IF GXR.ID='' THEN GOTO 1016                                        IF GXR.ID='' THEN GOTO 1016

0658 END ELSE                                                           END ELSE
0659 ECD.NUM=27;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=O     ECD.NUM=27;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>
0660 ECD.NUM=41;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=D     ECD.NUM=41;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>
0661 ECD.NUM=28;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=O     ECD.NUM=28;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>
0662 ECD.NUM=42;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=C     ECD.NUM=42;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>
0663 *T25755 v                                                       <  
0664 ECD.NUM=22;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=O     ECD.NUM=22;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>
0665 ECD.NUM=2;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=OP     ECD.NUM=2;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=
0666 *T25755 ^                                                       <  
0667 END                                                                END

0687 OPO.DVDPCC<1,2,LN1>=CCTR.DEPT                                      OPO.DVDPCC<1,2,LN1>=CCTR.DEPT
0688 ECD.NUM=27;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=C     ECD.NUM=27;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>
0689 ECD.NUM=41;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=D     ECD.NUM=41;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>
0690 ECD.NUM=42;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=C     ECD.NUM=42;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>
0691 ECD.RET.VALUE=""                                                   ECD.RET.VALUE=""
0692 *                                                               |  *T23499 v
0693 CASE 1                                                          <  
0694 GOTO 1016                                                       <  
0695 END CASE                                                        <  
0696 *T25755 v                                                       <  

0697 1030 *                                                          <  
0698 ECD.NUM=22;ECD.SUB.NUM=LN1                                         ECD.NUM=22;ECD.SUB.NUM=LN1
0699 IF OPO.OPER.CODE<1,1,LN1> THEN ECD.DEFAULT = OPO.OPER.CODE<1,1     IF OPO.OPER.CODE<1,1,LN1> THEN ECD.DEFAULT = OPO.OPER.CODE<1
0700 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
0701 BEGIN CASE                                                         BEGIN CASE 
0702 CASE ECD.RET.VALUE = "END"                                         CASE ECD.RET.VALUE = "END"
0703 ERRMSG='Operation required'                                        ERRMSG='Operation required'

0704 GOSUB 91000; GOTO 1030                                          |  GOSUB 91000; GOTO 1016
0705 CASE ECD.RET.VALUE = "???"                                         CASE ECD.RET.VALUE = "???"
0706 MAT GEN.XREF.REC=''                                                MAT GEN.XREF.REC=''
0707 GXR.CO=CONO                                                        GXR.CO=CONO
0708 GXR.XREF=COST.CNTR                                                 GXR.XREF=COST.CNTR
0709 GXR.FILE=OPERATION                                                 GXR.FILE=OPERATION
0710 GXR.NAME="CCTR.OPER.1"                                             GXR.NAME="CCTR.OPER.1"

0711 GXR.ID=''                                                          GXR.ID=''
0712 GXR.SRCH.ID=OPO.DVDPCC<1,3,LN1>                                    GXR.SRCH.ID=OPO.DVDPCC<1,3,LN1>
0713 CALL GEN.XREF.SUB(MAT GEN.XREF.REC,PREFIX,XREF.DATA)               CALL GEN.XREF.SUB(MAT GEN.XREF.REC,PREFIX,XREF.DATA)
0714 ECD.ACTION=2;CALL SCRN.EDIT                                        ECD.ACTION=2;CALL SCRN.EDIT
0715 ECD.ACTION = 3;CALL SCRN.EDIT                                      ECD.ACTION = 3;CALL SCRN.EDIT
0716 IF GXR.ID='' THEN GOTO 1030                                     |  IF GXR.ID='' THEN GOTO 1016
0717 ECD.RET.VALUE = GXR.ID                                             ECD.RET.VALUE = GXR.ID
0718 OLD.LN1 = LN1                                                   <  
0719 OLD.SLN = SLN                                                   <  
0720 GOSUB 10000                                                     <  

0721 LN1 = OLD.LN1                                                   <  
0722 SLN = OLD.SLN                                                   <  
0723 CASE ECD.RET.VALUE # ""                                            CASE ECD.RET.VALUE # ""
0724 NULL                                                               NULL
0725 CASE 1                                                             CASE 1
0726 ERRMSG='Operation required'                                        ERRMSG='Operation required'
0727 GOSUB 91000; GOTO 1030                                          |  GOSUB 91000; GOTO 1016

0727 GOSUB 91000; GOTO 1030                                          |  GOSUB 91000; GOTO 1016
0728 END CASE                                                           END CASE
0729 OPER.CODE=ECD.RET.VALUE                                            OPER.CODE=ECD.RET.VALUE
0730 MATREAD OPER.REC FROM OPERATION,CONO:OPER.CODE ELSE                MATREAD OPER.REC FROM OPERATION,CONO:OPER.CODE ELSE
0731 ERRMSG=OPER.CODE:" is not a valid operation code"                  ERRMSG=OPER.CODE:" is not a valid operation code"
0732 GOSUB 91000 ; GOTO 1030                                         |  GOSUB 91000 ; GOTO 1016
0733 END                                                                END
0734 MATREAD CCTR.REC FROM COST.CNTR,CONO:OPO.DVDPCC<1,3,LN1> THEN      MATREAD CCTR.REC FROM COST.CNTR,CONO:OPO.DVDPCC<1,3,LN1> THE
0735 LOCATE OPER.CODE IN CCTR.OPER<1>,1 SETTING OP.POS THEN             LOCATE OPER.CODE IN CCTR.OPER<1>,1 SETTING OP.POS THEN
0736 *   found oper in cost cntr can proceed                            *   found oper in cost cntr can proceed

0735 LOCATE OPER.CODE IN CCTR.OPER<1>,1 SETTING OP.POS THEN             LOCATE OPER.CODE IN CCTR.OPER<1>,1 SETTING OP.POS THEN
0736 *   found oper in cost cntr can proceed                            *   found oper in cost cntr can proceed
0737 OPO.OPER.CODE<1,1,LN1> = OPER.CODE                                 OPO.OPER.CODE<1,1,LN1> = OPER.CODE
0738 END ELSE                                                           END ELSE
0739 ERRMSG='Operation is not related to CCTR ':OPO.DVDPCC<1,3,LN1>     ERRMSG='Operation is not related to CCTR ':OPO.DVDPCC<1,3,LN
0740 GOSUB 91000; GOTO 1030                                          |  GOSUB 91000; GOTO 1016
0741 END                                                                END
0742 END ELSE                                                           END ELSE
0743 ERRMSG="Cost Center ":OPO.DVDPCC<1,3,LN1>:" is not valid"          ERRMSG="Cost Center ":OPO.DVDPCC<1,3,LN1>:" is not valid"
0744 GOSUB 91000 ; GOTO 1030                                         |  GOSUB 91000 ; GOTO 1016

0743 ERRMSG="Cost Center ":OPO.DVDPCC<1,3,LN1>:" is not valid"          ERRMSG="Cost Center ":OPO.DVDPCC<1,3,LN1>:" is not valid"
0744 GOSUB 91000 ; GOTO 1030                                         |  GOSUB 91000 ; GOTO 1016
0745 END                                                                END
0746 ECD.NUM=22;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=E     ECD.NUM=22;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>
0747 ECD.NUM=2;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=OP     ECD.NUM=2;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.NO,LN1>=
0748 *T25755 ^                                                       |  *T23499 ^            
0749                                                                 >  *
0750                                                                 >  CASE 1
0751                                                                 >  GOTO 1016
0752                                                                 >  END CASE

0753                                                                 >  *IF JOB.DIV # '' THEN
0754                                                                 >  *  LOCATE JOB.DIV IN DEPT.DIV<1>,1 SETTING DPTR ELSE
0755                                                                 >  *    ERRMSG="CCTR/DEPT NOT VALID FOR THE DIVISION"
0756                                                                 >  *    GOSUB 91000;GOTO 1016
0757                                                                 >  *  END
0758                                                                 >  *  OPO.DVDPCC<1,1,LN1> = JOB.DIV
0759                                                                 >  *  ECD.NUM=26;ECD.SUB.NUM=LN1;SCV.REC(26)<ECD.SCRN.NO,LN1>=J

0760                                                                 >  *END ELSE
0761                                                                 >  *  DCNT=COUNT(DEPT.DIV,VM) + (DEPT.DIV # "")
0762                                                                 >  *  BEGIN CASE
0763                                                                 >  *    CASE DCNT < 1
0764                                                                 >  *      ERRMSG="NO DIVISIONS FOR COST CENTER DEPARTMENT"
0765                                                                 >  *      GOSUB 91000;GOTO 1016
0766                                                                 >  *    CASE DCNT=1

0767                                                                 >  *      ECD.NUM=26;ECD.SUB.NUM=LN1;SCV.REC(ECD.NUM)<ECD.SCRN.
0768                                                                 >  *      MATREAD DIV.REC FROM DIVISION, CONO:DEPT.DIV<1,1> ELS
0769                                                                 >  *        ERRMSG="DEPARTMENT DIVISION IS MISSING"
0770                                                                 >  *        GOSUB 91000;GOTO 1016
0771                                                                 >  *      END
0772                                                                 >  *      OPO.DVDPCC<1,1,LN1>=DEPT.DIV<1,1>
0773                                                                 >  *    CASE 1

0774                                                                 >  *      ECD.NUM=26;ECD.SUB.NUM=LN1
0775                                                                 >  *      ECD.VALDAT=DEPT.DIV<1,1>
0776                                                                 >  *      DV=1
0777                                                                 >  *      ECD.HMSG<1,1,DV>="VALID DIVISIONS - ":DEPT.DIV<1,1>
0778                                                                 >  *      FOR K=2 TO DCNT
0779                                                                 >  *        ECD.VALDAT=ECD.VALDAT :",":DEPT.DIV<1,K>
0780                                                                 >  *        IF LEN(ECD.HMSG<1,1,DV>) > 70 THEN DV=DV + 1

0781                                                                 >  *        ECD.HMSG<1,1,DV>=ECD.HMSG<1,1,DV>:", ":DEPT.DIV<1,K
0782                                                                 >  *      NEXT K
0783                                                                 >  *      ECD.ACTION=4;CALL SCRN.EDIT
0784                                                                 >  *      BEGIN CASE
0785                                                                 >  *        CASE ECD.RET.VALUE="END"
0786                                                                 >  *          GOTO 1016
0787                                                                 >  *        CASE ECD.RET.VALUE # ""

0788                                                                 >  *          MATREAD DIV.REC FROM DIVISION, CONO:ECD.RET.VALUE
0789                                                                 >  *            ERRMSG=ECD.RET.VALUE:" IS NOT ON FILE"
0790                                                                 >  *            GOSUB 91000;GOTO 1016
0791                                                                 >  *          END
0792                                                                 >  *          OPO.DVDPCC<1,1,LN1>=ECD.RET.VALUE
0793                                                                 >  *        CASE 1
0794                                                                 >  *          GOTO 1016

0795                                                                 >  *      END CASE
0796                                                                 >  *  END CASE
0797                                                                 >  *END
0798                                                                 >  * IF COA.LEVEL = 0 AND OPTION = 'C' THEN
0799                                                                 >  *   GOSUB 1999
0800                                                                 >  * END ELSE
0801                                                                 >  *  GOSUB 1033

0802                                                                 >  * END
0803                                                                 >  *  RETURN
0804 *** INPUT JOB COMMENTS                                             *** INPUT JOB COMMENTS
0805 1033 BEGIN.PAGE.3 = SLN+3                                          1033  BEGIN.PAGE.3 = SLN+3
0806 IF OPO.ITEM.COMM<1,LN1> = "" THEN                                  IF OPO.ITEM.COMM<1,LN1> = "" THEN
0807 LINES.3 = 0                                                        LINES.3 = 0
0808 LOOP                                                               LOOP

0824 GOSUB 8500                                                         GOSUB 8500
0825 END                                                                END
0826 1999 *                                                             1999 *
0827 LINES.1 = COUNT(OPO.JOB.NO,VM) + (OPO.JOB.NO # '')                 LINES.1 = COUNT(OPO.JOB.NO,VM) + (OPO.JOB.NO # '')
0828 GOSUB 1021                                                         GOSUB 1021
0829 *T25755 v                                                       |  *T23499 v
0830 *  logic added below will add a unique seq number on each line     *     logic added below will add a unique seq number on each
0831 *  is added to the record.  This number may or may not corresp     *      is added to the record.  This number may or may not c
0832 *  line number of the PO detail line.  There are two attribute     *      line number of the PO detail line.  There are two att
0833 *  OPO.PROD.SEQ which is multivalued with the job number and O     *      OPO.PROD.SEQ which is multivalued with the job number

0834 *  which is not multivalued and contains the last seq number u     *      which is not multivalued and contains the last seq nu
0835 *  PO when a new line is created the OPO.LAST.SEQ is increment  |  *      PO when a new line is created the OPO.LAST.SEQ is inc
0836 *  number created is used in the proper offset multivalue posi     *      number created is used in the proper offset multivalu
0837 *  OPO.PROD.SEQ attribute.                                         *      OPO.PROD.SEQ attribute.
0838 *                                                                  *
0839 IF OPO.PROD.SEQ<1,LN1> = "" AND OPO.PROD.LINE<1,LN1> # "" THEN     IF OPO.PROD.SEQ<1,LN1> = "" AND OPO.PROD.LINE<1,LN1> # "" TH
0840 OPO.LAST.SEQ += 1                                                  OPO.LAST.SEQ += 1
0841 OPO.PROD.SEQ<1,LN1> = OPO.LAST.SEQ                                 OPO.PROD.SEQ<1,LN1> = OPO.LAST.SEQ

0842 END                                                                END
0843 *T25755 ^                                                       |  *T23499 ^
0844 RETURN                                                             RETURN
0845 **** CALCULATE ORDERD VALUE                                        **** CALCULATE ORDERD VALUE
0846 1019 *                                                             1019 *
0847 DESC.PRICE = INT(OPO.U.PRICE<1,AA>*((OPO.DISCOUNT<1,AA>/10000)     DESC.PRICE = INT(OPO.U.PRICE<1,AA>*((OPO.DISCOUNT<1,AA>/1000
0848 DESC.PRICE = INT(OPO.U.PRICE<1,AA> - DESC.PRICE)                   DESC.PRICE = INT(OPO.U.PRICE<1,AA> - DESC.PRICE)
0849 *T23319 v                                                          *T23319 v

0850                                                                 >  *     IF OPO.UOM<1,AA> = "M" THEN
0851 BEGIN CASE                                                         BEGIN CASE
0852 CASE OPO.UOM<1,AA> = "M"                                        |  CASE OPO.UOM<1,AA> = 'M'
0853 *        ONORD.AMT = INT(((DESC.PRICE/1000)*(OPO.QTY<1,AA>/100     *         ONORD.AMT = INT(((DESC.PRICE/1000)*(OPO.QTY<1,AA>/
0854 ONORD.AMT = INT((DESC.PRICE/100)*(OPO.QTY<1,AA>/100000)+.5)        ONORD.AMT = INT((DESC.PRICE/100)*(OPO.QTY<1,AA>/100000)+.5)
0855 CASE OPO.UOM<1,AA> = "C"                                        |  CASE OPO.UOM<1,AA> = 'C'
0856 ONORD.AMT = INT((DESC.PRICE/100)*(OPO.QTY<1,AA>/10000)+.5)         ONORD.AMT = INT((DESC.PRICE/100)*(OPO.QTY<1,AA>/10000)+.5)

0857                                                                 >  *     END ELSE
0858 CASE 1                                                             CASE 1
0859 *        ONORD.AMT = INT(((DESC.PRICE) * (OPO.QTY<1,AA>/100)+.     *        ONORD.AMT = INT(((DESC.PRICE) * (OPO.QTY<1,AA>/100)
0860 *T27938 v                                                       |  ONORD.AMT = INT((DESC.PRICE/100) * (OPO.QTY<1,AA>/100)+ .5)
0861 *        ONORD.AMT = INT((DESC.PRICE/100) * (OPO.QTY<1,AA>/100  |  *     END
0862 IF DESC.PRICE LT 0 THEN                                         <  
0863 ONORD.AMT = INT((DESC.PRICE/100) * (OPO.QTY<1,AA>/100) - .5)    <  

0864 END ELSE                                                        <  
0865 ONORD.AMT = INT((DESC.PRICE/100) * (OPO.QTY<1,AA>/100) + .5)    <  
0866 END                                                             <  
0867 *T27938 ^                                                       <  
0868 END CASE                                                           END CASE
0869 *T23319 ^                                                          *T23319 ^
0870 IF ONORD.AMT > 999999999 THEN                                      IF ONORD.AMT > 999999999 THEN

0871 ERRMSG="Extended amount cannot exceed 9,999,999.99"                ERRMSG="Extended amount cannot exceed 9,999,999.99"
0872 GOSUB 91000                                                        GOSUB 91000
0873 EXT.FLAG = 1                                                       EXT.FLAG = 1
0874 END ELSE                                                           END ELSE
0875 OPO.EST.COST<1,AA> = ONORD.AMT                                     OPO.EST.COST<1,AA> = ONORD.AMT
0876 *T24555 v                                                       |  P_X  = 45 ; P_Y = SLN+1 ; P_VALUE = OCONV(ONORD.AMT, "MD2") 
0877 *     P_X  = 45 ; P_Y = SLN+1 ; P_VALUE = OCONV(ONORD.AMT, "MD  <  
0878 P_X  = 48 ; P_Y = SLN+1 ; P_VALUE = OCONV(ONORD.AMT, "MD2") "R  <  
0879 *T24555 ^                                                       <  
0880 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)

0882 *  GOSUB 1021                                                      *  GOSUB 1021
0883 END                                                                END
0884 RETURN                                                             RETURN
0885 **** CALCULATE OPEN QTY                                            **** CALCULATE OPEN QTY
0886 1020 *                                                             1020 *
0887                                                                 >  *      OPO.TOT.OPEN<1,AA> = OPO.QTY<1,AA> - OPO.QTY.RECVD<1,
0888 OPO.TOT.OPEN<1,AA> = OPO.QTY<1,AA> - OPO.QTY.RECVD<1,AA> - OPO     OPO.TOT.OPEN<1,AA> = OPO.QTY<1,AA> - OPO.QTY.RECVD<1,AA> - O
0889 IF OPO.TOT.OPEN<1,AA> < 0 THEN OPO.TOT.OPEN<1,AA> = 0              IF OPO.TOT.OPEN<1,AA> < 0 THEN OPO.TOT.OPEN<1,AA> = 0
0890 P_X  = 70 ; P_Y = SLN ; P_VALUE = OCONV(OPO.TOT.OPEN<1,AA> , "     P_X  = 70 ; P_Y = SLN ; P_VALUE = OCONV(OPO.TOT.OPEN<1,AA> ,
0891 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)

0898 FOR A = 1 TO P.CNT                                                 FOR A = 1 TO P.CNT
0899 TOT.QTY = TOT.QTY + OPO.QTY<1,A> - OPO.CANCEL.QTY<1,A>             TOT.QTY = TOT.QTY + OPO.QTY<1,A> - OPO.CANCEL.QTY<1,A>
0900 DESC.PRICE = INT(OPO.U.PRICE<1,A>*((OPO.DISCOUNT<1,A>/10000)))     DESC.PRICE = INT(OPO.U.PRICE<1,A>*((OPO.DISCOUNT<1,A>/10000)
0901 DESC.PRICE = INT(OPO.U.PRICE<1,A> - DESC.PRICE)                    DESC.PRICE = INT(OPO.U.PRICE<1,A> - DESC.PRICE)
0902 *T23319 v                                                          *T23319 v
0903                                                                 >  *        IF OPO.UOM<1,A> = "M" THEN
0904 BEGIN CASE                                                         BEGIN CASE
0905 CASE OPO.UOM<1,A> = "M"                                         |  CASE OPO.UOM<1,A> = 'M'
0906 *              ONORD.AMT.TOT = INT(((DESC.PRICE) * (OPO.QTY<1,     *    ONORD.AMT.TOT = INT(((DESC.PRICE) * (OPO.QTY<1,A>*10)+.
0907 ONORD.AMT.TOT = INT(((DESC.PRICE/100)*((OPO.QTY<1,A> - OPO.CAN     ONORD.AMT.TOT = INT(((DESC.PRICE/100)*((OPO.QTY<1,A> - OPO.C

0908 *                 ONORD.AMT.TOT = INT(((DESC.PRICE/1000)*(OPO.  |  CASE OPO.UOM<1,A> = 'C'
0909 CASE OPO.UOM<1,A> = "C"                                         <  
0910 ONORD.AMT.TOT = INT(((DESC.PRICE/100)*((OPO.QTY<1,A> - OPO.CAN     ONORD.AMT.TOT = INT(((DESC.PRICE/100)*((OPO.QTY<1,A> - OPO.C
0911                                                                 >  *     ONORD.AMT.TOT = INT(((DESC.PRICE/1000)*(OPO.QTY<1,A>))
0912                                                                 >  *        END ELSE
0913 CASE 1                                                             CASE 1
0914 ONORD.AMT.TOT = INT((DESC.PRICE/100) * ((OPO.QTY<1,A> - OPO.CA     ONORD.AMT.TOT = INT((DESC.PRICE/100) * ((OPO.QTY<1,A> - OPO.

0915 *              ONORD.AMT.TOT = INT(((DESC.PRICE) * (OPO.QTY<1,     *           ONORD.AMT.TOT = INT(((DESC.PRICE) * (OPO.QTY<1,A
0916                                                                 >  *        END
0917 END CASE                                                           END CASE
0918 *T23319 ^                                                          *T23319 ^
0919 TOT.AMT = TOT.AMT + ONORD.AMT.TOT                                  TOT.AMT = TOT.AMT + ONORD.AMT.TOT
0920 NEXT A                                                             NEXT A
0921 IF OCONV(TOT.AMT, "MD2") GT "99999999.9999" THEN                   IF OCONV(TOT.AMT, "MD2") GT "99999999.9999" THEN
0922 ERRMSG="Total Extended amount cannot exceed 99,999,999.99"         ERRMSG="Total Extended amount cannot exceed 99,999,999.99"

0946 P_X  := AM:7 ; P_Y := AM:SLN3 ; P_VALUE := AM:SPACE(42)            P_X  := AM:7 ; P_Y := AM:SLN3 ; P_VALUE := AM:SPACE(42)
0947 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
0948 CASE VALUE = "END" AND OPTION1 = "C"                               CASE VALUE = "END" AND OPTION1 = "C"
0949 P_X  = 7 ; P_Y = SLN3 ; P_VALUE = OPO.ITEM.COMM<1,LN1,LN3> "L#     P_X  = 7 ; P_Y = SLN3 ; P_VALUE = OPO.ITEM.COMM<1,LN1,LN3> "
0950 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
0951 CASE VALUE = "END" AND OPTION1 = "I"   ; *25852                 <  
0952 OPO.ITEM.COMM = DELETE(OPO.ITEM.COMM,1,LN1,LN3)                 <  
0953 LN3 -= 1                                                        <  
0954 CASE 1                                                             CASE 1
0955 OPO.ITEM.COMM<1,LN1,LN3> = VALUE                                   OPO.ITEM.COMM<1,LN1,LN3> = VALUE

0964 *        PMSG = 'Enter Comment Options (A)dd, (C)hange, (D)ele     *        PMSG = 'Enter Comment Options (A)dd, (C)hange, (D)e
0965 *        VALDAT = 'A':VM:'D':VM:'S':VM:'E':VM:'C'                  *        VALDAT = 'A':VM:'D':VM:'S':VM:'E':VM:'C'
0966 *        DEFAULT = "E"                                             *        DEFAULT = "E"
0967 *        CALL EDIT.SUB                                             *        CALL EDIT.SUB
0968 *        OPTION1 = VALUE                                           *        OPTION1 = VALUE
0969 IF POS.INQ THEN ECD.NUM = 9 ELSE ECD.NUM = 8  ; *25855          |  ECD.NUM = 8
0970 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ""                                 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ""
0971 ECD.ACTION = 4                                                     ECD.ACTION = 4
0972 CALL SCRN.EDIT                                                     CALL SCRN.EDIT
0973 OPTION1 = ECD.RET.VALUE                                            OPTION1 = ECD.RET.VALUE

1006 OLD.START.LINE.3 = 0                                               OLD.START.LINE.3 = 0
1007 END ELSE                                                           END ELSE
1008 GOSUB 8500                                                         GOSUB 8500
1009 END                                                                END
1010 GOSUB 30000                                                        GOSUB 30000
1011 CASE OPTION1 = 'I'      ; *25852                                <  
1012 GOSUB 80000                                                     <  
1013 IF LNO THEN                                                     <  
1014 LN3 = LNO                                                       <  
1015 OPO.ITEM.COMM = INSERT(OPO.ITEM.COMM,1,LN1,LN3,'')              <  

1016 GOSUB 3000                                                      <  
1017 END ELSE                                                        <  
1018 GOSUB 8500                                                      <  
1019 END                                                             <  
1020 GOSUB 30000                                                     <  
1021 CASE OPTION1 = 'S'                                                 CASE OPTION1 = 'S'
1022 LINES.3 = COUNT(OPO.ITEM.COMM<1,LN1>, SVM) + (OPO.ITEM.COMM<1,     LINES.3 = COUNT(OPO.ITEM.COMM<1,LN1>, SVM) + (OPO.ITEM.COMM<

1021 CASE OPTION1 = 'S'                                                 CASE OPTION1 = 'S'
1022 LINES.3 = COUNT(OPO.ITEM.COMM<1,LN1>, SVM) + (OPO.ITEM.COMM<1,     LINES.3 = COUNT(OPO.ITEM.COMM<1,LN1>, SVM) + (OPO.ITEM.COMM<
1023 LN3 = 1 + INT((LN3-1)/PAGE.SIZE.3) * PAGE.SIZE.3 + PAGE.SIZE.3     LN3 = 1 + INT((LN3-1)/PAGE.SIZE.3) * PAGE.SIZE.3 + PAGE.SIZE
1024 IF LN3 > LINES.3 THEN LN3 = 1                                      IF LN3 > LINES.3 THEN LN3 = 1
1025 GOSUB 30000                                                        GOSUB 30000
1026 * T25978 v                                                      <  
1027 CASE OPTION1 = 'SR'                                             <  
1028 LINES.3 = COUNT(OPO.ITEM.COMM<1,LN1>, SVM) + (OPO.ITEM.COMM<1,  <  
1029 LN3 = 1 + INT((LN3-1)/PAGE.SIZE.3) * PAGE.SIZE.3 - PAGE.SIZE.3  <  
1030 IF LN3 < 1 THEN LN3 = 1                                         <  

1031 GOSUB 30000                                                     <  
1032 CASE OPTION1 = 'ST'                                             <  
1033 LINES.3 = COUNT(OPO.ITEM.COMM<1,LN1>, SVM) + (OPO.ITEM.COMM<1,  <  
1034 LN3 = 1                                                         <  
1035 GOSUB 30000                                                     <  
1036 CASE OPTION1 = 'SB'                                             <  
1037 LINES.3 = COUNT(OPO.ITEM.COMM<1,LN1>, SVM) + (OPO.ITEM.COMM<1,  <  

1038 LN3 = LINES.3                                                   <  
1039 GOSUB 30000                                                     <  
1040 * T25978 ^                                                      <  
1041 END CASE                                                           END CASE
1042 WHILE MORE1 = 1 DO REPEAT                                          WHILE MORE1 = 1 DO REPEAT
1043 RETURN                                                             RETURN
1044 **** ENTER OPTION                                                  **** ENTER OPTION

1048 *        X = 0 ; Y = 21; TYP = 1; MAXL = 2                         *        X = 0 ; Y = 21; TYP = 1; MAXL = 2
1049 *        PMSG = 'ENTER OPTION (A)DD ,(C)HANGE ,(D)ELETE ,(S)CR     *        PMSG = 'ENTER OPTION (A)DD ,(C)HANGE ,(D)ELETE ,(S)
1050 *        VALDAT = 'A':VM:'D':VM:'S':VM:'E':VM:'C':VM:'CO'          *        VALDAT = 'A':VM:'D':VM:'S':VM:'E':VM:'C':VM:'CO'
1051 *        CALL EDIT.SUB                                             *        CALL EDIT.SUB
1052 *        OPTION = VALUE                                            *        OPTION = VALUE
1053 *24231 v                                                        |  ECD.NUM = 49
1054 IF BUFFER<1> = "R" THEN                                         <  
1055 *    USER.ID = UPCASE(@LOGNAME)                                 <  
1056 *    MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":OPO.DIV  <  
1057 *      MAT APP.REQ.REC = ""                                     <  

1058 *    END                                                        <  
1059 *decide what prompt                                             <  
1060 BEGIN CASE                                                      <  
1061 CASE OPO.APP.LEVEL = "C"                                        <  
1062 ECD.NUM = 9                                                     <  
1063 CASE OPO.APP.LEVEL < APP.PO.LEVEL  AND OPO.APP.LEVEL # ""       <  
1064 ECD.NUM = 9                                                     <  

1065 CASE 1                                                          <  
1066 IF POS.INQ THEN ECD.NUM = 52 ELSE ECD.NUM = 49 ; *25855         <  
1067 END CASE                                                        <  
1068 END ELSE                                                        <  
1069 IF POS.INQ THEN ECD.NUM = 52 ELSE ECD.NUM = 49 ; *25855         <  
1070 END                                                             <  
1071 *24231 ^                                                        <  

1093 * CSF 23174                                                        * CSF 23174
1094 IF OPO.QTY.RECVD<1,LN1> + 0 # 0 THEN                               IF OPO.QTY.RECVD<1,LN1> + 0 # 0 THEN
1095 GOSUB 1009                                                         GOSUB 1009
1096 END ELSE                                                           END ELSE
1097 *                                                                  *
1098 *T25938 v                                                       <  
1099 IF DUPLICATED.PO THEN                                           <  
1100 GOSUB 1001                                                      <  
1101 END ELSE                                                        <  
1102 *T26645 v                                                       <  

1103 MATREAD JOB.REC FROM JOB, CONO:OPO.JOB.NO<1,LN1> ELSE           <  
1104 MAT JOB.REC = ""                                                <  
1105 END                                                             <  
1106 *T26645 ^                                                       <  
1107 GOSUB 1333                                                         GOSUB 1333
1108 END                                                                END
1109 *T25938 ^                                                       <  

1110 END                                                                END
1111 END                                                             <  
1112 CASE OPTION = 'CO'                                                 CASE OPTION = 'CO'
1113 GOSUB 60000                                                        GOSUB 60000
1114 IF LNO THEN                                                        IF LNO THEN
1115 LN1 = LNO                                                          LN1 = LNO
1116 SLN = BEGIN.PAGE.1 + LINE.SPACE.1 * MOD(LN1-1,PAGE.SIZE.1)         SLN = BEGIN.PAGE.1 + LINE.SPACE.1 * MOD(LN1-1,PAGE.SIZE.1)
1117 GOSUB 8500                                                         GOSUB 8500

1120 GOSUB 60000                                                        GOSUB 60000
1121 IF LNO THEN                                                        IF LNO THEN
1122 LN1 = LNO                                                          LN1 = LNO
1123 *CSF 24813 v                                                       *CSF 24813 v
1124 IF CO.APS.O.INTRF > 2 THEN                                         IF CO.APS.O.INTRF > 2 THEN
1125 *T25755 v                                                       <  
1126 *                 VPDS.KEY = CONO:OPO.VEND.NO<1>:"!O!":OPO.NO:  <  
1127 VPDS.KEY = CONO:OPO.VEND.NO<1>:"!O!":OPO.NO:"!":OPO.JOB.NO<1,L     VPDS.KEY = CONO:OPO.VEND.NO<1>:"!O!":OPO.NO:"!":OPO.JOB.NO<1
1128 *T25755 ^                                                       <  
1129 ERR = 1                                                            ERR = 1

1146 OPO.QTY.RECVD = DELETE(OPO.QTY.RECVD,1,LN1,0)                      OPO.QTY.RECVD = DELETE(OPO.QTY.RECVD,1,LN1,0)
1147 *                 OPO.PREV.RECEVED = DELETE(OPO.PREV.RECEVED,1     *           OPO.PREV.RECEVED = DELETE(OPO.PREV.RECEVED,1,LN1
1148 OPO.CANCEL.QTY = DELETE(OPO.CANCEL.QTY,1,LN1,0)                    OPO.CANCEL.QTY = DELETE(OPO.CANCEL.QTY,1,LN1,0)
1149 OPO.ITEM.COMM = DELETE(OPO.ITEM.COMM,1,LN1,0)                      OPO.ITEM.COMM = DELETE(OPO.ITEM.COMM,1,LN1,0)
1150 OPO.INTRAL.INT = DELETE(OPO.INTRAL.INT,1,LN1,0)                    OPO.INTRAL.INT = DELETE(OPO.INTRAL.INT,1,LN1,0)
1151                                                                 >  * ADDED DLG 10-30-91 TO DELETE NEW COMMUN FIELDS *
1152 DEL OPO.TAXABLE<1,LN1>                                             DEL OPO.TAXABLE<1,LN1>
1153 DEL OPO.DVDPCC<1,1,LN1>                                            DEL OPO.DVDPCC<1,1,LN1>
1154 DEL OPO.DVDPCC<1,2,LN1>                                            DEL OPO.DVDPCC<1,2,LN1>
1155 DEL OPO.DVDPCC<1,3,LN1>                                            DEL OPO.DVDPCC<1,3,LN1>

1156 DEL OPO.PROD.LINE<1,LN1>                                           DEL OPO.PROD.LINE<1,LN1>
1157 DEL OPO.EST.COST<1,LN1>                                            DEL OPO.EST.COST<1,LN1>
1158 DEL OPO.ACCTNO<1,LN1>                                              DEL OPO.ACCTNO<1,LN1>
1159 DEL OPO.CANCEL.COST<1,LN1>                                         DEL OPO.CANCEL.COST<1,LN1>
1160 DEL OPO.EXP.DATE<1,LN1>                                            DEL OPO.EXP.DATE<1,LN1>
1161 DEL OPO.PROD.SEQ<1,LN1> ; * T25755                              |  *T23499 v
1162                                                                 >  DEL OPO.PROD.SEQ<1,LN1>
1163                                                                 >  *T23499 ^
1164 LINES.1 = COUNT(OPO.JOB.NO,VM) + (OPO.JOB.NO # '')                 LINES.1 = COUNT(OPO.JOB.NO,VM) + (OPO.JOB.NO # '')
1165 IF LN1 > 1 AND LN1 > LINES.1 THEN LN1 = LN1 - 1                    IF LN1 > 1 AND LN1 > LINES.1 THEN LN1 = LN1 - 1

1171 GOSUB 1021                                                         GOSUB 1021
1172 CASE OPTION = 'S'                                                  CASE OPTION = 'S'
1173 LN1 = LN1 + PAGE.SIZE.1                                            LN1 = LN1 + PAGE.SIZE.1
1174 IF LN1 > LINES.1 THEN LN1 = 1                                      IF LN1 > LINES.1 THEN LN1 = 1
1175 GOSUB 10000                                                        GOSUB 10000
1176 * T25978 v                                                      <  
1177 CASE OPTION = 'SR'                                              <  
1178 LN1 = LN1 - PAGE.SIZE.1                                         <  
1179 IF LN1 < 1 THEN LN1 = 1                                         <  
1180 GOSUB 10000                                                     <  

1181 CASE OPTION = 'ST'                                              <  
1182 LN1 = 1                                                         <  
1183 GOSUB 10000                                                     <  
1184 CASE OPTION = 'SB'                                              <  
1185 LN1 = LINES.1                                                   <  
1186 GOSUB 10000                                                     <  
1187 * T25978 ^                                                      <  

1194 START.LINE.1 = 1 + INT((LN1-1)/PAGE.SIZE.1) * PAGE.SIZE.1          START.LINE.1 = 1 + INT((LN1-1)/PAGE.SIZE.1) * PAGE.SIZE.1
1195 IF START.LINE.1 = OLD.START.LINE.1 THEN GOSUB 10001                IF START.LINE.1 = OLD.START.LINE.1 THEN GOSUB 10001
1196 OLD.START.LINE.1 = START.LINE.1                                    OLD.START.LINE.1 = START.LINE.1
1197 LAST.LINE.1 = START.LINE.1 + PAGE.SIZE.1 - 1                       LAST.LINE.1 = START.LINE.1 + PAGE.SIZE.1 - 1
1198 CNT = 1                                                            CNT = 1
1199                                                                 >  * FOR N = START.LINE.1 TO LAST.LINE.1 UNTIL N > LINES.1
1200 JOB.CNT = DCOUNT(OPO.JOB.NO,@VM)                                   JOB.CNT = DCOUNT(OPO.JOB.NO,@VM)
1201 *T25944   FOR N = START.LINE.1 TO LAST.LINE.1  UNTIL N > JOB.C  |  FOR N = START.LINE.1 TO LAST.LINE.1  UNTIL N > JOB.CNT
1202 FOR N = START.LINE.1 TO LAST.LINE.1                             <  
1203 SLN = BEGIN.PAGE.1 + LINE.SPACE.1 * MOD(N-1,PAGE.SIZE.1)           SLN = BEGIN.PAGE.1 + LINE.SPACE.1 * MOD(N-1,PAGE.SIZE.1)

1207 P_X  := AM:32 ; P_Y := AM:SLN ; P_VALUE := AM:OCONV(OPO.U.PRIC     P_X  := AM:32 ; P_Y := AM:SLN ; P_VALUE := AM:OCONV(OPO.U.PR
1208 P_X  := AM:44 ; P_Y := AM:SLN ; P_VALUE := AM:OPO.UOM<1,N> "R#     P_X  := AM:44 ; P_Y := AM:SLN ; P_VALUE := AM:OPO.UOM<1,N> "
1209 P_X  := AM:48 ; P_Y := AM:SLN ; P_VALUE := AM:OCONV(OPO.QTY<1,     P_X  := AM:48 ; P_Y := AM:SLN ; P_VALUE := AM:OCONV(OPO.QTY<
1210 P_X  := AM:59 ; P_Y := AM:SLN ; P_VALUE := AM:OCONV(OPO.CANCEL     P_X  := AM:59 ; P_Y := AM:SLN ; P_VALUE := AM:OCONV(OPO.CANC
1211 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1212                                                                 >  *   OPO.QTY.RECVD<1,N> = QTY.RECVD
1213 AA = N                                                             AA = N
1214 GOSUB 1019                                                         GOSUB 1019
1215 GOSUB 1020                                                         GOSUB 1020
1216 P_X  = 70 ; P_Y = SLN ; P_VALUE = OCONV(OPO.TOT.OPEN<1,N> , "M     P_X  = 70 ; P_Y = SLN ; P_VALUE = OCONV(OPO.TOT.OPEN<1,N> , 

1215 GOSUB 1020                                                         GOSUB 1020
1216 P_X  = 70 ; P_Y = SLN ; P_VALUE = OCONV(OPO.TOT.OPEN<1,N> , "M     P_X  = 70 ; P_Y = SLN ; P_VALUE = OCONV(OPO.TOT.OPEN<1,N> , 
1217 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1218 P_X  = 4 ; P_Y = SLN+1 ; P_VALUE = OPO.PROD.LINE<1,N> "L#10" ;     P_X  = 4 ; P_Y = SLN+1 ; P_VALUE = OPO.PROD.LINE<1,N> "L#10"
1219 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1220 *C42996 v                                                       |  READV CAT.DESC FROM CATEGORY.OSP,CONO:OPO.PROD.LINE<1,N>,1 E
1221 *     READV CAT.DESC FROM CATEGORY.OSP,CONO:OPO.PROD.LINE<1,N>  <  
1222 MATREAD CAOS.REC FROM CATEGORY.OSP,CONO:OPO.PROD.LINE<1,N> ELS  <  
1223 MAT CAOS.REC = ''                                               <  
1224 END                                                             <  

1225 CAT.DESC = CAOS.DESC                                            <  
1226 *C42996 ^                                                       <  
1227 P_X  = 11 ; P_Y = SLN+1 ; P_VALUE = CAT.DESC "L#22" ; P_OPT =      P_X  = 11 ; P_Y = SLN+1 ; P_VALUE = CAT.DESC "L#22" ; P_OPT 
1228 P_X  := AM:34 ; P_Y := AM:SLN+1 ; P_VALUE := AM:OCONV(OPO.DISC     P_X  := AM:34 ; P_Y := AM:SLN+1 ; P_VALUE := AM:OCONV(OPO.DI
1229 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1230 READV JOB.DESCR FROM JOB,CONO:OPO.JOB.NO<1,N>,16 ELSE JOB.DESC     READV JOB.DESCR FROM JOB,CONO:OPO.JOB.NO<1,N>,16 ELSE JOB.DE
1231 JOB.DESCR = FIELD(JOB.DESCR,CHAR(253),1)                           JOB.DESCR = FIELD(JOB.DESCR,CHAR(253),1)

1232 P_X  = 4 ; P_Y = SLN+2 ; P_VALUE = JOB.DESCR "L#25" ; P_OPT =      P_X  = 4 ; P_Y = SLN+2 ; P_VALUE = JOB.DESCR "L#25" ; P_OPT 
1233 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1234 READV DIVSN.DESC FROM DIVISION,CONO:OPO.DVDPCC<1,1,N>,1 ELSE D     READV DIVSN.DESC FROM DIVISION,CONO:OPO.DVDPCC<1,1,N>,1 ELSE
1235 READV DEPMT.DESC FROM DEPARTMENT,CONO:OPO.DVDPCC<1,2,N>,2 ELSE     READV DEPMT.DESC FROM DEPARTMENT,CONO:OPO.DVDPCC<1,2,N>,2 EL
1236 READV COSTCTR.DESC FROM COST.CNTR,CONO:OPO.DVDPCC<1,3,N>,1 ELS     READV COSTCTR.DESC FROM COST.CNTR,CONO:OPO.DVDPCC<1,3,N>,1 E
1237 *T25755 v                                                       |  *T23499 v
1238 READV OPERT.DESC FROM OPERATION,CONO:OPO.OPER.CODE<1,1,N>,1 EL     READV OPERT.DESC FROM OPERATION,CONO:OPO.OPER.CODE<1,1,N>,1 
1239 *T25755 ^                                                       |  *T23499 ^
1240                                                                 >  *         P_X  = 53 ; P_Y = SLN+2 ; P_VALUE = "Div:":OPO.DVD
1241                                                                 >  *         P_X  := AM:58 ; P_Y := AM:SLN+2 ; P_VALUE := AM:DI

1240                                                                 >  *         P_X  = 53 ; P_Y = SLN+2 ; P_VALUE = "Div:":OPO.DVD
1241                                                                 >  *         P_X  := AM:58 ; P_Y := AM:SLN+2 ; P_VALUE := AM:D
I
1242 P_X  = 59 ; P_Y = SLN+2 ; P_VALUE = OPO.DVDPCC<1,1,N>"L#4" ; P     P_X  = 59 ; P_Y = SLN+2 ; P_VALUE = OPO.DVDPCC<1,1,N>"L#4" ;
1243 P_X  := AM:63 ; P_Y := AM:SLN+2 ; P_VALUE := AM:DIVSN.DESC"L#1     P_X  := AM:63 ; P_Y := AM:SLN+2 ; P_VALUE := AM:DIVSN.DESC"L
1244 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1245                                                                 >  *         P_X  := AM:53 ; P_Y := AM:SLN+3 ; P_VALUE := AM:"D
1246 P_X  = 59 ; P_Y = SLN+3 ; P_VALUE = OPO.DVDPCC<1,2,N>"L#4" ; P     P_X  = 59 ; P_Y = SLN+3 ; P_VALUE = OPO.DVDPCC<1,2,N>"L#4" ;
1247 P_X  := AM:63 ; P_Y := AM:SLN+3 ; P_VALUE := AM:DEPMT.DESC"L#1     P_X  := AM:63 ; P_Y := AM:SLN+3 ; P_VALUE := AM:DEPMT.DESC"L
1248 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1249                                                                 >  *         P_X  := AM:59 ; P_Y := AM:SLN+4 ; P_VALUE := AM:"C

1248 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1249                                                                 >  *         P_X  := AM:59 ; P_Y := AM:SLN+4 ; P_VALUE := AM:"C
1250 P_X  = 59 ; P_Y = SLN+4 ; P_VALUE = OPO.DVDPCC<1,3,N>"L#4" ; P     P_X  = 59 ; P_Y = SLN+4 ; P_VALUE = OPO.DVDPCC<1,3,N>"L#4" ;
1251 P_X  := AM:63 ; P_Y := AM:SLN+4 ; P_VALUE := AM:COSTCTR.DESC"L     P_X  := AM:63 ; P_Y := AM:SLN+4 ; P_VALUE := AM:COSTCTR.DESC
1252 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1253 *T25755 v                                                       |  *T23499 v
1254 P_X  = 59 ; P_Y = SLN+5 ; P_VALUE = OPO.OPER.CODE<1,1,N>"L#4"      P_X  = 59 ; P_Y = SLN+5 ; P_VALUE = OPO.OPER.CODE<1,1,N>"L#4
1255 P_X  := AM:64 ; P_Y := AM:SLN+5 ; P_VALUE := AM:OPERT.DESC"L#1     P_X  := AM:64 ; P_Y := AM:SLN+5 ; P_VALUE := AM:OPERT.DESC"L
1256 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1257 *T25755 ^                                                       |  *T23499 ^

1258 CNT = CNT + 1                                                      CNT = CNT + 1
1259 LN3=1                                                              LN3=1
1260 *T25944       FOR I = 1 TO 2                                    |  FOR I = 1 TO 2
1261 FOR I = 1 TO PAGE.SIZE.3                                        <  
1262 IF OPO.ITEM.COMM<1,N,I> # "" THEN                                  IF OPO.ITEM.COMM<1,N,I> # "" THEN
1263 LINES.3=I                                                          LINES.3=I
1264 P_X  = 3 ; P_Y = SLN+I+2 ; P_VALUE = I "R#3" ; P_OPT = ""          P_X  = 3 ; P_Y = SLN+I+2 ; P_VALUE = I "R#3" ; P_OPT = ""
1265 P_X  := AM:7 ; P_Y := AM:SLN+I+2 ; P_VALUE := AM:OPO.ITEM.COMM     P_X  := AM:7 ; P_Y := AM:SLN+I+2 ; P_VALUE := AM:OPO.ITEM.CO
1266 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)

1290 P_X  = 3 ; P_Y = SLN+4 ; P_VALUE = SPACE(3) ; P_OPT = ""           P_X  = 3 ; P_Y = SLN+4 ; P_VALUE = SPACE(3) ; P_OPT = ""
1291 P_X  := AM:7 ; P_Y := AM:SLN+4 ; P_VALUE := AM:SPACE(42)           P_X  := AM:7 ; P_Y := AM:SLN+4 ; P_VALUE := AM:SPACE(42)
1292 P_X  := AM:59 ; P_Y := AM:SLN+4 ; P_VALUE := AM:SPACE(3)           P_X  := AM:59 ; P_Y := AM:SLN+4 ; P_VALUE := AM:SPACE(3)
1293 P_X  := AM:63 ; P_Y := AM:SLN+4 ; P_VALUE := AM:SPACE(15)          P_X  := AM:63 ; P_Y := AM:SLN+4 ; P_VALUE := AM:SPACE(15)
1294 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1295 *T25755 v                                                       |  *T23499 v
1296 P_X = 59 ; P_Y = SLN+5 ; P_VALUE = SPACE(4) ; P_OPT = ""           P_X = 59 ; P_Y = SLN+5 ; P_VALUE = SPACE(4) ; P_OPT = ""
1297 P_X:= AM:64 ; P_Y := AM:SLN+5 ; P_VALUE := AM:SPACE(15)            P_X:= AM:64 ; P_Y := AM:SLN+5 ; P_VALUE := AM:SPACE(15)
1298 CALL  VSI_PLINE(P_X,P_Y, P_VALUE, P_OPT)                           CALL  VSI_PLINE(P_X,P_Y, P_VALUE, P_OPT)
1299 *T25755 ^                                                       |  *T23499 ^

1316 ***** SCROLL ROUTINE FOR JOB COMMENTS                              ***** SCROLL ROUTINE FOR JOB COMMENTS
1317 30000 *                                                            30000 *
1318 BEGIN.PAGE.3 = SLN+3                                               BEGIN.PAGE.3 = SLN+3
1319 START.LINE.3 = 1 + INT((LN3-1)/PAGE.SIZE.3) * PAGE.SIZE.3          START.LINE.3 = 1 + INT((LN3-1)/PAGE.SIZE.3) * PAGE.SIZE.3
1320 LAST.LINE.3 = START.LINE.3 + PAGE.SIZE.3 - 1                       LAST.LINE.3 = START.LINE.3 + PAGE.SIZE.3 - 1
1321 * 25852 v                                                       |  IF START.LINE.3 = OLD.START.LINE.3 THEN
1322 IF (OPTION1 # 'I') AND (START.LINE.3 = OLD.START.LINE.3) THEN   <  
1323 * 25852 ^                                                       <  
1324 GOSUB 30002                                                        GOSUB 30002
1325 OLD.START.LINE.3 = START.LINE.3                                    OLD.START.LINE.3 = START.LINE.3

1344 RETURN                                                             RETURN
1345 10001 *                                                            10001 *
1346 RETURN                                                             RETURN
1347 **** ENTER LINE NUMBER                                             **** ENTER LINE NUMBER
1348 60000 *                                                            60000 *
1349 *T26213 v                                                       |  *     X = 0 ; Y = 21 ; TYP = 3
1350 *  ECD.NUM = 10                                                 |  *     PMSG = 'ENTER LINE NUMBER : '
1351 *  SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ""                           |  *     MINV = OLD.START.LINE.1
1352 *  ECD.MINV = OLD.START.LINE.1                                  <  
1353 *  IF LAST.LINE.1 < LINES.1 THEN                                   *     IF LAST.LINE.1 < LINES.1 THEN

1354 *     ECD.MAXV = LAST.LINE.1                                    |  *        MAXV = LAST.LINE.1
1355 *  END ELSE                                                        *     END ELSE
1356 *     ECD.MAXV = LINES.1                                        |  *        MAXV = LINES.1
1357 *  END                                                             *     END
1358 *  ECD.ACTION = 4                                               |  *     O.R = 'O'; MAXL = 3
1359 *  CALL SCRN.EDIT                                               |  *     CALL EDIT.SUB
1360 *  LNO = ECD.RET.VALUE                                          |  *     P_X  = 0 ; P_Y = 21 ; P_VALUE = "" ; P_OPT = "CL"

1361 LNO = START.LINE.1                                              |  *     CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1362 *T26213 ^                                                       |  *     LNO = VALUE
1363                                                                 >  ECD.NUM = 10
1364                                                                 >  SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ""
1365                                                                 >  ECD.MINV = OLD.START.LINE.1
1366                                                                 >  IF LAST.LINE.1 < LINES.1 THEN
1367                                                                 >  ECD.MAXV = LAST.LINE.1

1368                                                                 >  END ELSE
1369                                                                 >  ECD.MAXV = LINES.1
1370                                                                 >  END
1371                                                                 >  ECD.ACTION = 4
1372                                                                 >  CALL SCRN.EDIT
1373                                                                 >  LNO = ECD.RET.VALUE
1374 IF LNO = '' OR LNO = 'END' THEN LNO = 0                            IF LNO = '' OR LNO = 'END' THEN LNO = 0

1388 *     P_X  = 0 ; P_Y = 21 ; P_VALUE = "" ; P_OPT = "CL"            *     P_X  = 0 ; P_Y = 21 ; P_VALUE = "" ; P_OPT = "CL"
1389 *     CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                        *     CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1390 *     LNO = VALUE                                                  *     LNO = VALUE
1391 GOSUB 30000                                                        GOSUB 30000
1392 IF LINES.3 < 1 THEN LNO = 0; RETURN                                IF LINES.3 < 1 THEN LNO = 0; RETURN
1393 *T25852 v                                                       <  
1394 IF OPTION1 = 'I' THEN                                           <  
1395 ECD.NUM = 51                                                    <  
1396 END ELSE                                                        <  
1397 ECD.NUM = 10                                                       ECD.NUM = 10

1398 END                                                             <  
1399 *T25852 ^                                                       <  
1400 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ""                                 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ""
1401 ECD.MINV = START.LINE.3                                            ECD.MINV = START.LINE.3
1402 IF LAST.LINE.3 < LINES.3 THEN                                      IF LAST.LINE.3 < LINES.3 THEN
1403 ECD.MAXV = LAST.LINE.3                                             ECD.MAXV = LAST.LINE.3
1404 END ELSE                                                           END ELSE

1424 OPO.CANCEL.QTY = DELETE(OPO.CANCEL.QTY,1,LN1,0)                    OPO.CANCEL.QTY = DELETE(OPO.CANCEL.QTY,1,LN1,0)
1425 OPO.UOM = DELETE(OPO.UOM,1,LN1,0)                                  OPO.UOM = DELETE(OPO.UOM,1,LN1,0)
1426 OPO.DISCOUNT = DELETE(OPO.DISCOUNT,1,LN1,0)                        OPO.DISCOUNT = DELETE(OPO.DISCOUNT,1,LN1,0)
1427 OPO.ITEM.COMM = DELETE(OPO.ITEM.COMM,1,LN1,0)                      OPO.ITEM.COMM = DELETE(OPO.ITEM.COMM,1,LN1,0)
1428 OPO.ACCTNO = DELETE(OPO.ACCTNO,1,LN1,0)                            OPO.ACCTNO = DELETE(OPO.ACCTNO,1,LN1,0)
1429                                                                 >  * ADDED DLG 10-30-91 TO DELETE NEW COMMUN FIELDS *
1430 DEL OPO.TAXABLE<1,LN1>                                             DEL OPO.TAXABLE<1,LN1>
1431 DEL OPO.DVDPCC<1,1,LN1>                                            DEL OPO.DVDPCC<1,1,LN1>
1432 DEL OPO.DVDPCC<1,2,LN1>                                            DEL OPO.DVDPCC<1,2,LN1>
1433 DEL OPO.DVDPCC<1,3,LN1>                                            DEL OPO.DVDPCC<1,3,LN1>

1434 DEL OPO.PROD.LINE<1,LN1>                                           DEL OPO.PROD.LINE<1,LN1>
1435 DEL OPO.PROD.SEQ<1,LN1> ; * T25755                              |  *T23499 v
1436                                                                 >  DEL OPO.PROD.SEQ<1,LN1>
1437                                                                 >  *T23499 ^
1438 P_X  = 0 ; P_Y = SLN ; P_VALUE = "" ; P_OPT = "CL"                 P_X  = 0 ; P_Y = SLN ; P_VALUE = "" ; P_OPT = "CL"
1439 P_X  := AM:0 ; P_Y := AM:SLN ; P_VALUE := AM:LN1 "R#3"             P_X  := AM:0 ; P_Y := AM:SLN ; P_VALUE := AM:LN1 "R#3"
1440 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1441 P_X  = 0 ; P_Y = SLN+1 ; P_VALUE = "" ; P_OPT = "CL"               P_X  = 0 ; P_Y = SLN+1 ; P_VALUE = "" ; P_OPT = "CL"

1442 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1443 P_X  = 0 ; P_Y = SLN+2 ; P_VALUE = "" ; P_OPT = "CL"               P_X  = 0 ; P_Y = SLN+2 ; P_VALUE = "" ; P_OPT = "CL"
1444 ;*                                                              |  *      P_X  := AM:53 ; P_Y := AM:SLN+2 ; P_VALUE := AM:"Div:
1445 ;* C40465 *                                                     <  
1446 ;* The 3 labels below (dev/dept/cctr) were remarked out below   <  
1447 ;* not being reprinted in some cases. Unremarked them.          <  
1448 ;*                                                              <  
1449 P_X  := AM:53 ; P_Y := AM:SLN+2 ; P_VALUE := AM:"Div:" ;* WHY   <  
1450 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)

1451 P_X  = 0 ; P_Y = SLN+3 ; P_VALUE = "" ; P_OPT = "CL"               P_X  = 0 ; P_Y = SLN+3 ; P_VALUE = "" ; P_OPT = "CL"
1452 P_X  := AM:53 ; P_Y := AM:SLN+3 ; P_VALUE := AM:"Dept:" ;* WHY  |  *      P_X  := AM:53 ; P_Y := AM:SLN+3 ; P_VALUE := AM:"Dept
1453 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1454 P_X  = 0 ; P_Y = SLN+4 ; P_VALUE = "" ; P_OPT = "CL"               P_X  = 0 ; P_Y = SLN+4 ; P_VALUE = "" ; P_OPT = "CL"
1455 P_X  := AM:53 ; P_Y := AM:SLN+4 ; P_VALUE := AM:"Cctr:" ;* WHY  |  *      P_X  := AM:53 ; P_Y := AM:SLN+4 ; P_VALUE := AM:"Cctr
1456 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1457 *  GOSUB 1999                                                      *    GOSUB 1999
1458 *  LN1=LN1-1                                                       *    LN1=LN1-1


POSBP/OUTSIDE.PO.PRINT                                             /vsi/cust/rev11/cbn/CBA-CBN/CBNBP/OUTSIDE.PO.PRINT
Printed for thompson at 06/28/2006 04:48:02PM

0016 *T22579 lanny 02/09/1998 * ALIGNMENT ON 1ST PO AFTER MASK PRIN     *T22579 lanny 02/09/1998 * ALIGNMENT ON 1ST PO AFTER MASK PR
0017 *                          TOO HIGH.                               *                          TOO HIGH.
0018 *T22743 rik 04/14/1998 * ALIGNMENT WRONG AFTER 1ST PO.             *T22743 rik 04/14/1998 * ALIGNMENT WRONG AFTER 1ST PO.
0019 *C33495 diane 06/09/1999 * PRINTING TOO LOW ON LASER               *C33495 diane 06/09/1999 * PRINTING TOO LOW ON LASER
0020 *C34069 markt 08/16/1999 * Order info line prints one line too     *C34069 markt 08/16/1999 * Order info line prints one line t
0021 *T23319 alex 04/11/2000 * Use OPO.EST.COST to print amounts; c  |  *T24870 lanny 06/15/2000 * Remove JOB.DESC from printing.
0022 *                         calculation formula.                  <  
0023 *T25291 edvard 06/06/00  * Convert VM to " " in JOB.DESC to pr  <  
0024 *                                                               <  
0025 *T25941 ajibaly 06/28/2002 * Allow emailing of POs to vendor    <  

0030 *COPY>POS.CPYLIB>OUTSIDE.PO                                        *COPY>POS.CPYLIB>OUTSIDE.PO
0031 *COPY>JCS.CPYLIB>CATEGORY.OSP                                      *COPY>JCS.CPYLIB>CATEGORY.OSP
0032 *COPY>POS.CPYLIB>SPECIAL.INST                                      *COPY>POS.CPYLIB>SPECIAL.INST
0033 *COPY>CPYLIB>CHAR                                                  *COPY>CPYLIB>CHAR
0034 *COPY>CPYLIB>SYSCOM                                                *COPY>CPYLIB>SYSCOM
0035 *COPY>PMC.CPYLIB>PMC_REPORTS ;* T25941                          <  
0036 *COPY>PMC.CPYLIB>SECURITY ;* T25941                             <  
0037 ;*                                                              <  
0038 ;* INITIALIZATION                                               <  
0039 ;*                                                              <  

0038 ;* INITIALIZATION                                               <  
0039 ;*                                                              <  
0040 MODEFLAG="A"                                                       MODEFLAG="A"
0041 PROMPT""                                                           PROMPT""
0042 ENDFLG=0                                                           ENDFLG=0
0043 OPO.KEYS = ''                                                   |  **** SET UP FOR SYSCOM
0044 ;*                                                              <  
0045 ;* T25941 v                                                     <  
0046 ;* List to contain print/mailing info:                          <  
0047 ;* value loc 1 specifies print/mail/or both                     <  

0048 ;* value loc 2 specifies email addresses (comma seperated)      <  
0049 ;* value loc 3 specifies background form image to use           <  
0050 PM.LIST = ""                                                    <  
0051 USERNO = "USERNO"                                               <  
0052 CALL SYSVARS.SUB(USERNO)                                        <  
0053 LOGNAME = "LOGNAME"                                             <  
0054 CALL SYSVARS.SUB(LOGNAME)                                       <  

0055 RESTORE.PRINTER.CMD = "SETPTR ":GETPTR(0):",BRIEF"              <  
0056 NEW.PRINTER.CMD     = "SETPTR ,,,,,3,BRIEF,NOMESSAGE,NOHEAD,BA  <  
0057 ;* T25941 ^                                                     <  
0058 ;*                                                              <  
0059 ;* SET UP FOR SYSCOM                                            <  
0060 ;*                                                              <  
0061 SYS.TYPE = 1 ; CALL SYSCOM(MAT SYSCOM.REC)                         SYS.TYPE = 1 ; CALL SYSCOM(MAT SYSCOM.REC)

0062 ;*                                                              |  **** OPEN FILES
0063 ;* OPEN FILES                                                   |  OPEN "","JOB" TO JOB ELSE ERRMSG = " JOB FILE IS MISSING" ; 
0064 ;*                                                              |  OPEN "","VEND" TO VEND ELSE ERRMSG = "VEND FILE IS MISSING" 
0065 OPEN "","JOB" TO JOB ELSE                                       |  OPEN "","OUTSIDE.PO" TO OUTSIDE.PO ELSE ERRMSG = "OUTSIDE.PO
0066 ERRMSG = " JOB FILE IS MISSING" ; GOTO 93000                    |  OPEN "","CATEGORY.OSP" TO CATEGORY.OSP ELSE ERRMSG = "CATEGO
0067 END                                                             |  OPEN "","COMPANY" TO COMPANY ELSE ERRMSG = "COMPANY FILE IS 
0068 OPEN "","VEND" TO VEND ELSE                                     |  OPEN "","CONTROL" TO CONTROL ELSE ERRMSG = "CONTROL FILE IS 

0069 ERRMSG = "VEND FILE IS MISSING" ; GOTO 93000                    |  OPO.KEYS = ''
0070 END                                                             <  
0071 OPEN "","OUTSIDE.PO" TO OUTSIDE.PO ELSE                         <  
0072 ERRMSG = "OUTSIDE.PO FILE IS MISSING" ; GOTO 93000              <  
0073 END                                                             <  
0074 OPEN "","CATEGORY.OSP" TO CATEGORY.OSP ELSE                     <  
0075 ERRMSG = "CATEGORY.OSP FILE IS MISSING" ; GOTO 93000            <  

0076 END                                                             <  
0077 OPEN "","COMPANY" TO COMPANY ELSE                               <  
0078 ERRMSG = "COMPANY FILE IS MISSING" ; GOTO 93000                 <  
0079 END                                                             <  
0080 OPEN "","CONTROL" TO CONTROL ELSE                               <  
0081 ERRMSG = "CONTROL FILE IS MISSING" ; GOTO 93000                 <  
0082 END                                                             <  

0083 ;*                                                              <  
0084 ;* T25941 v                                                     <  
0085 HOLD.FILE.NAME = "_HOLD_"                                       <  
0086 OPEN "",HOLD.FILE.NAME TO HOLD.FILE ELSE                        <  
0087 ERRMSG = HOLD.FILE.NAME:" FILE IS MISSING" ; GOTO 93000         <  
0088 END                                                             <  
0089 OPEN "","PMC_REPORTS" TO PMC_REPORTS ELSE                       <  

0090 ERRMSG = "PMC_REPORTS FILE IS MISSING" ; GOTO 93000             <  
0091 END                                                             <  
0092 OPEN "","SECURITY" TO SECURITY ELSE                             <  
0093 ERRMSG = "SECURITY FILE IS MISSING" ; GOTO 93000                <  
0094 END                                                             <  
0095 ;*                                                              <  
0096 ;* Read the buffer and get the report number                    <  

0097 ;*                                                              <  
0098 PROCREAD BUFFER ELSE                                            <  
0099 ERRMSG = "MUST BE RUN FROM A PROC"                              <  
0100 GOSUB 91000; RETURN                                             <  
0101 END                                                             <  
0102 RPT.NO = BUFFER<2>                                              <  
0103 MAIL.FLAG = BUFFER<8>                                           <  

0104 MATREAD PRPT.REC FROM PMC_REPORTS, RPT.NO ELSE                  <  
0105 ERRMSG = "Cannot read the PMC_REPORTS record for this report.   <  
0106 ERRMSG:= "Make sure that Report Screen flag is 'R'."            <  
0107 GOSUB 91000; RETURN                                             <  
0108 END                                                             <  
0109 ;* T25941 ^                                                     <  
0110 ;*                                                              <  

0111 ;* GET CONO                                                     <  
0112 ;*                                                              <  
0113 READNEXT PON ELSE GOTO 900                                         READNEXT PON ELSE GOTO 900
0114 CONO=PON[1,3]                                                      CONO=PON[1,3]
0115 MATREAD COMP.REC FROM COMPANY , CONO ELSE                       <  
0116 ERRMSG = "COMPANY # (":CONO:") IS MISSING" ; GOTO 93000         <  
0117 END                                                             <  

0118 OPO.KEYS<-1> = PON                                                 OPO.KEYS<-1> = PON
0119 ;*                                                              |  ***** READ SPECIAL INST
0120 ;* T25941 v                                                     <  
0121 ;* Read the security record and get the user's email            <  
0122 ;*                                                              <  
0123 USER.EMAIL.ADDR = ''                                            <  
0124 MATREAD SEC.REC FROM SECURITY, CONO:UPCASE(LOGNAME) THEN        <  
0125 IF SEC.EMAIL # '' THEN USER.EMAIL.ADDR = ',':SEC.EMAIL          <  

0126 END                                                             <  
0127 ;* T25941 ^                                                     <  
0128 ;*                                                              <  
0129 ;*                                                              <  
0130 ;* READ SPECIAL INST                                            <  
0131 ;*                                                              <  
0132 MATREAD SI.REC FROM CONTROL , CONO:"SPEC.INST" ELSE                MATREAD SI.REC FROM CONTROL , CONO:"SPEC.INST" ELSE

0133 MAT SI.REC = ''                                                    MAT SI.REC = ''
0134 END                                                                END
0135 SPI.CNT = DCOUNT(SI.INST, VM)                                   |  SPI.CNT = COUNT(SI.INST, VM) + (SI.INST # '')
0136 ;*                                                              |  *
0137 ;* T22081 v                                                     |  MATREAD COMP.REC FROM COMPANY , CONO ELSE ERRMSG = "COMPANY 
0138 ;*                                                              |  *
0139                                                                 >  * T22081 v
0140                                                                 >  *
0141 FIRST.TIME = ''                                                    FIRST.TIME = ''

0142 LASER.FLAG = ''                                                    LASER.FLAG = ''
0143 ALIGN.PRT=''                                                       ALIGN.PRT=''
0144 IF OCONV(CONO:OCONV(@LOGNAME,'MCU'):'!LASER','TSECURITY;X;0;0'  |  IF OCONV(CONO:OCONV(@LOGNAME,'MCU'):'!LASER','TSECURITY;X;0;
0145 LASER.FLAG = 1                                                  |  *
0146 END                                                             |  * T22081 ^
0147 ;*                                                              |  *
0148 ;* T22081 ^                                                     <  
0149 ;*                                                              <  
0150 20*                                                                20*

0151 ;* T22081 v                                                     |  * T22081 v
0152 IF LASER.FLAG = '' AND MAIL.FLAG = '' THEN                      |  IF LASER.FLAG = '' THEN 
0153 CRT @(-1)                                                          CRT @(-1)
0154 CRT @(0,4): "LOAD PURCHASE ORDER FORMS IN PRINTER AND ALIGN BY     CRT @(0,4): "LOAD PURCHASE ORDER FORMS IN PRINTER AND ALIGN 
0155 CRT @(0,6): "PRINT MASK OR ORDERS (M/O/END) ?":                    CRT @(0,6): "PRINT MASK OR ORDERS (M/O/END) ?":
0156 INPUT RESPONSE                                                     INPUT RESPONSE
0157 END ELSE                                                           END ELSE

0158 RESPONSE = "O"                                                     RESPONSE = "O"
0159 END                                                                END
0160 ;*                                                              |  *
0161 ;* T22081 ^                                                     |  * T22081 ^
0162 IF RESPONSE = "END" THEN GOTO 99999                                IF RESPONSE = "END" THEN GOTO 99999
0163 IF RESPONSE # "O" AND RESPONSE # "M" THEN                       |  IF RESPONSE#"O" AND RESPONSE#"M"THEN PRINT ; GOTO 20
0164 PRINT                                                           |  IF RESPONSE="O" THEN NULL ELSE
0165 GOTO 20                                                         <  
0166 END                                                             <  

0167 IF RESPONSE # "O" THEN                                          <  
0168 PRINTER ON                                                         PRINTER ON
0169 ;*T22579 v                                                      |  *T22579 v
0170 IF ALIGN.PRT THEN                                                  IF ALIGN.PRT THEN
0171 PRINT                                                              PRINT
0172 END ELSE                                                           END ELSE
0173 ALIGN.PRT=1                                                        ALIGN.PRT=1

0174 PRINT CHAR(12)                                                     PRINT CHAR(12)
0175 END                                                                END
0176 ;*T22579 ^                                                      |  *T22579 ^
0177 PRINT "X"                                                          PRINT "X"
0178 PRINT                                                              PRINT
0179 PRINT                                                              PRINT
0180 PRINT SPACE(71):"PAGE XXXX"                                        PRINT SPACE(71):"PAGE XXXX"
0181 PRINT SPACE(21):"***XXXXXXX: XXXX XX X XXXXXXXX XXXXX XXXXXXX.     PRINT SPACE(21):"***XXXXXXX: XXXX XX X XXXXXXXX XXXXX XXXXXX
0182 PRINT SPACE(33):"XX XXX XXXXXXXXX XXX XXXXX!!!"                    PRINT SPACE(33):"XX XXX XXXXXXXXX XXX XXXXX!!!"

0204 PRINT SPACE(17):STR("X",42):SPACE(11):"9999999.99"                 PRINT SPACE(17):STR("X",42):SPACE(11):"9999999.99"
0205 PRINTER CLOSE                                                      PRINTER CLOSE
0206 PRINTER OFF                                                        PRINTER OFF
0207 GOTO 20                                                            GOTO 20
0208 END                                                                END
0209 ;*                                                              |  ** BEGIN PRINT ORDER **
0210 ;* BEGIN PRINT ORDER **                                         <  
0211 ;*                                                              <  
0212 PRINTER ON                                                         PRINTER ON
0213 GOTO 101                                                           GOTO 101

0214 100 *                                                           |  100   READNEXT PON ELSE GOTO 900
0215 READNEXT PON ELSE GOTO 900                                      <  
0216 OPO.KEYS<-1> = PON                                                 OPO.KEYS<-1> = PON
0217 101 *                                                           |  101   IF ENDFLG THEN GOTO 900
0218 IF ENDFLG THEN GOTO 900                                         <  
0219 OLDPO=PON[4,8]                                                     OLDPO=PON[4,8]
0220 MATREAD OPO.REC FROM OUTSIDE.PO , PON ELSE GOTO 100                MATREAD OPO.REC FROM OUTSIDE.PO , PON ELSE GOTO 100

0221 ;*                                                              |  140   MATREAD VEND.REC FROM VEND,CONO:OPO.VEND.NO ELSE MAT V
0222 ;* T25941 v                                                     |  142   PGNO=0
0223 ;* Save each PO in a new file                                   <  
0224 PRINTER CLOSE                                                   <  
0225 UDTEXECUTE NEW.PRINTER.CMD:"PO-":USERNO:"-":PON                 <  
0226 PO.PRINT.MAIL.ITEM = OPO.PRT.FLG<1,1>:SVM:OPO.PRT.FLG<1,2>      <  
0227 IF MAIL.FLAG # '' THEN                                          <  

0228 PO.PRINT.MAIL.ITEM = 'N' : SVM : 'Y'                            <  
0229 END                                                             <  
0230 ;*                                                              <  
0231 ;* Get the background form image for this PO                    <  
0232 ;*                                                              <  
0233 OCCUR.IDX = 1                                                   <  
0234 LOOP                                                            <  

0235 FIND CONO IN PRPT.FORM.CONO,OCCUR.IDX SETTING F,V THEN          <  
0236 ;* If an image is found for the CONO/DIV then stop looking      <  
0237 IF PRPT.FORM.DIV<1,V> = OPO.DIV.OWNER THEN                      <  
0238 PO.PRINT.MAIL.ITEM<1,2> = PRPT.FORM.PATH<1,V>                   <  
0239 EXIT                                                            <  
0240 END                                                             <  
0241 ;* Otherwise look for the next combination                      <  

0242 OCCUR.IDX = OCCUR.IDX + 1                                       <  
0243 END ELSE                                                        <  
0244 ;* If there are no more occurences of the CONO then exit        <  
0245 ;* and specify no background                                    <  
0246 PO.PRINT.MAIL.ITEM<1,2> = ''                                    <  
0247 OCCUR.IDX = 0                                                   <  
0248 END                                                             <  

0249 UNTIL OCCUR.IDX = 0 DO REPEAT                                   <  
0250 ;*                                                              <  
0251 ;* Get the company defined carbon copy emails                   <  
0252 ;*                                                              <  
0253 ADD.EMAIL.ADDR = USER.EMAIL.ADDR                                <  
0254 FCCE.ID = CONO:"_FORMS_CC_EMAILS_":OPO.DIV.OWNER:"PO"           <  
0255 READ FCCE.ADDRESSES FROM CONTROL, FCCE.ID THEN                  <  

0256 FOR FCCE.IDX = 1 TO DCOUNT(FCCE.ADDRESSES,@VM)                  <  
0257 ADD.EMAIL.ADDR:= ',':FCCE.ADDRESSES<1,FCCE.IDX>                 <  
0258 NEXT FCCE.IDX                                                   <  
0259 END                                                             <  
0260 ;* T25941 ^                                                     <  
0261 140 *                                                           <  
0262 MATREAD VEND.REC FROM VEND,CONO:OPO.VEND.NO ELSE                <  

0263 MAT VEND.REC = ""                                               <  
0264 VEND.PO.DESC= "NOT ON FILE"                                     <  
0265 END                                                             <  
0266 ;* T25941 v                                                     <  
0267 ;* Add the vendor email to value loc 3, and add the record to   <  
0268 IF VEND.EMAIL.ADDR # '' THEN                                    <  
0269 PO.PRINT.MAIL.ITEM<1,3> = VEND.EMAIL.ADDR:ADD.EMAIL.ADDR        <  

0270 END ELSE                                                        <  
0271 PO.PRINT.MAIL.ITEM<1,3> = ''                                    <  
0272 END                                                             <  
0273 PM.LIST<-1> = PO.PRINT.MAIL.ITEM                                <  
0274 ;* T25941 ^                                                     <  
0275 142 *                                                           <  
0276 PGNO=0                                                          <  

0282 IF LNNO > 30 THEN                                                  IF LNNO > 30 THEN
0283 FOR X= LNNO TO 33; PRINT ; NEXT X                                  FOR X= LNNO TO 33; PRINT ; NEXT X
0284 GOSUB 300                                                          GOSUB 300
0285 END                                                                END
0286 MATREAD JOB.REC FROM JOB,CONO:OPO.JOB.NO<1,N> ELSE GOTO  150       MATREAD JOB.REC FROM JOB,CONO:OPO.JOB.NO<1,N> ELSE GOTO  150
0287 READV CATG.DESC FROM CATEGORY.OSP,CONO:OPO.PROD.LINE<1,N>,1 EL  |  READV CATG.DESC FROM CATEGORY.OSP,CONO:OPO.PROD.LINE<1,N>,1 
0288 CATG.DESC = 'UNKNOWN'                                           |  *T21153 v
0289 END                                                             |  *   PRINT OCONV(OPO.QTY<1,N>,'MD2')"R#9":
0290 PRINT OCONV(OPO.QTY<1,N>,'MD2')"R#10":                             PRINT OCONV(OPO.QTY<1,N>,'MD2')"R#10":
0291 PRINT " ":"JOB:":OPO.JOB.NO<1,N> "L#9":                         |  *   PRINT "  ":"JOB:":OPO.JOB.NO<1,N> "L#9":OPO.PROD.LINE<1,

0292 PRINT OPO.PROD.LINE<1,N> "L#7" :CATG.DESC "L#25":               |  PRINT " ":"JOB:":OPO.JOB.NO<1,N> "L#9":OPO.PROD.LINE<1,N> "L
0293                                                                 >  *T21153 ^
0294                                                                 >  *
0295 IF OPO.DISCOUNT<1,N>+0#0 THEN                                      IF OPO.DISCOUNT<1,N>+0#0 THEN
0296                                                                 >  *      NET=OCONV(OPO.U.PRICE<1,N>,"MD4")*OCONV(OPO.DISCOUNT<
0297                                                                 >  *      NET=OCONV(OPO.U.PRICE<1,N>,"MD4")-NET
0298                                                                 >  *NET=INT(OCONV(OPO.U.PRICE<1,N>,"MD4")*(1-OCONV(OPO.DISCOUNT

0298                                                                 >  *NET=INT(OCONV(OPO.U.PRICE<1,N>,"MD4")*(1-OCONV(OPO.DISCOUNT
0299 NET = (OPO.U.PRICE<1,N>/10000)*(1-(OPO.DISCOUNT<1,N>/10000))       NET = (OPO.U.PRICE<1,N>/10000)*(1-(OPO.DISCOUNT<1,N>/10000))
0300 END ELSE NET=OCONV(OPO.U.PRICE<1,N>,"MD4")                         END ELSE NET=OCONV(OPO.U.PRICE<1,N>,"MD4")
0301 NET=ICONV(NET,"MD4")                                               NET=ICONV(NET,"MD4")
0302 PRINT OCONV(NET,"MD4") "R#12":                                     PRINT OCONV(NET,"MD4") "R#12":
0303 EXT = OPO.EST.COST<1,N> - OPO.CANCEL.COST<1,N>                  |  EXT=OCONV(NET,"MD4")*OCONV(OPO.QTY<1,N>,'MD2')
0304                                                                 >  IF OPO.UOM<1,N> = "M" THEN
0305                                                                 >  EXT=EXT/1000
0306                                                                 >  EXT=ICONV(EXT,"MD2")
0307                                                                 >  END ELSE

0308                                                                 >  EXT=ICONV(EXT,"MD2")
0309                                                                 >  END
0310 PRINT OCONV(EXT,"MD2") "R#11"                                      PRINT OCONV(EXT,"MD2") "R#11"
0311 TOT = TOT+EXT                                                      TOT = TOT+EXT
0312 *                                                                  *
0313 PRINT OPO.UOM<1,N>"R#9":                                        |  *T24870  PRINT OPO.UOM<1,N>"R#9":
0314 PRINT " " "L#2":CONVERT(VM," ",JOB.DESC) "L#45"                 |  PRINT OPO.UOM<1,N>"R#9"

0315                                                                 >  *C33754         PRINT " " "L#2":JOB.DESC "L#45"
0316                                                                 >  *T24870  PRINT " " "L#2":JOB.DESC<1,1> "L#45"      ;*C33754
0317 PRINT SPACE(11):OCONV(OPO.EXP.DATE<1,N>,"D2/")"L#8"                PRINT SPACE(11):OCONV(OPO.EXP.DATE<1,N>,"D2/")"L#8"
0318 PRINT                                                              PRINT
0319 LNNO=LNNO+4                                                        LNNO=LNNO+4
0320 CNT = DCOUNT(OPO.ITEM.COMM<1,N>,SVM)                               CNT = DCOUNT(OPO.ITEM.COMM<1,N>,SVM)
0321 IF CNT > 0 THEN                                                    IF CNT > 0 THEN

0377 PRINT SPACE(30):"SEE P.O. DETAIL" "L#39":OCONV(TOT,"MD2") "R#1     PRINT SPACE(30):"SEE P.O. DETAIL" "L#39":OCONV(TOT,"MD2") "R
0378 GOTO 100                                                           GOTO 100
0379 300 PRINT SPACE(30):"SEE P.O. DETAIL" "L#41":"CONTINUED"           300   PRINT SPACE(30):"SEE P.O. DETAIL" "L#41":"CONTINUED"
0380 LNNO=0                                                             LNNO=0
0381 310 PGNO=PGNO+1                                                    310   PGNO=PGNO+1
0382                                                                 >  * T22081 v
0383                                                                 >  *  PRINT CHAR(12)
0384                                                                 >  *T22579 v
0385                                                                 >  * IF FIRST.TIME # '' THEN PRINT CHAR(12)
0386 IF FIRST.TIME THEN                                                 IF FIRST.TIME THEN

0385                                                                 >  * IF FIRST.TIME # '' THEN PRINT CHAR(12)
0386 IF FIRST.TIME THEN                                                 IF FIRST.TIME THEN
0387 PRINT CHAR(12)                                                     PRINT CHAR(12)
0388 END ELSE                                                           END ELSE
0389 PRINT  ;*T22743                                                    PRINT  ;*T22743
0390                                                                 >  *T22743   IF ALIGN.PRT THEN PRINT
0391 END                                                                END
0392 ;* T25941 v                                                     |  *T22579 ^
0393 ;* OPO.PRT.FLG is now multivalued (PRINT-FLAG:@VM:MAIL-FLAG)    |  * T22081 ^
0394 ;* If either flag is a copy then both are considered copies     |  IF OPO.PRT.FLG = "C" THEN

0395 ;* IF OPO.PRT.FLG = "C" THEN                                    <  
0396 IF OPO.PRT.FLG<1,1> = "C" OR OPO.PRT.FLG<1,2> = "C" THEN        <  
0397 ;* T25941 ^                                                     <  
0398 PRINT                                                              PRINT
0399 PRINT SPACE(19):"***CAUTION: THIS IS A PURCHASE ORDER REPRINT.     PRINT SPACE(19):"***CAUTION: THIS IS A PURCHASE ORDER REPRIN
0400 PRINT SPACE(25):"DO NOT DUPLICATE THE ORDER!!!"                    PRINT SPACE(25):"DO NOT DUPLICATE THE ORDER!!!"
0401 END ELSE                                                           END ELSE

0402 PRINT;PRINT;PRINT                                                  PRINT;PRINT;PRINT
0403 END                                                                END
0404                                                                 >  *C33495      IF LASER.FLAG # '' THEN PRINT   ;*T22081 <
0405 PRINT SPACE(71):"PAGE ":PGNO "L#4"                                 PRINT SPACE(71):"PAGE ":PGNO "L#4"
0406                                                                 >  *T22081 v  PRINT
0407 IF LASER.FLAG = '' THEN PRINT                                      IF LASER.FLAG = '' THEN PRINT
0408                                                                 >  *T22081 ^
0409 PRINT                                                              PRINT
0410 PRINT                                                              PRINT

0415 ADDZIP=VEND.PO.CT.ST:" ":VEND.PO.ZIP                               ADDZIP=VEND.PO.CT.ST:" ":VEND.PO.ZIP
0416 PRINT SPACE(5):ADDZIP "L#42":OPO.SHIP.ADDR3 "L#33"                 PRINT SPACE(5):ADDZIP "L#42":OPO.SHIP.ADDR3 "L#33"
0417 PRINT SPACE(5):SPACE(42):OPO.SHIP.ADDR4 "L#33"                     PRINT SPACE(5):SPACE(42):OPO.SHIP.ADDR4 "L#33"
0418 PRINT                                                              PRINT
0419 PRINT                                                              PRINT
0420 PRINT                                                           |  *C33716      PRINT     ;*C33495
0421                                                                 >  *C33754      PRINT
0422                                                                 >  PRINT ;* C34069
0423                                                                 >  * T22081 v
0424 IF LASER.FLAG = '' THEN                                            IF LASER.FLAG = '' THEN

0426 PRINT OPO.ORD.BY "L#19": OPO.VEND.NO "L#11": "SEE BELOW" "R#20     PRINT OPO.ORD.BY "L#19": OPO.VEND.NO "L#11": "SEE BELOW" "R#
0427 END ELSE                                                           END ELSE
0428 PRINT OCONV(OPO.DATE,"D2/") "L#10":OLDPO "L#10":                   PRINT OCONV(OPO.DATE,"D2/") "L#10":OLDPO "L#10":
0429 PRINT OPO.ORD.BY "L#19":SPACE(1): OPO.VEND.NO "L#11": "SEE BEL     PRINT OPO.ORD.BY "L#19":SPACE(1): OPO.VEND.NO "L#11": "SEE B
0430 END                                                                END
0431 PRINT                                                           |  * T22081 ^
0432 PRINT                                                           |  *C33495      PRINT;PRINT
0433                                                                 >  *C34069      PRINT    ;*C33495
0434                                                                 >  PRINT    ;*C33716
0435                                                                 >  PRINT     ;*C33754

0436                                                                 >  * T22081 v
0437 FIRST.TIME = 1                                                     FIRST.TIME = 1
0438                                                                 >  * T22081 ^
0439 RETURN                                                             RETURN
0440 *                                                               <  
0441 900 *                                                              900 *
0442 *                                                               <  

0443 PRINTER CLOSE                                                      PRINTER CLOSE
0444 PRINTER OFF                                                        PRINTER OFF
0445 ;* T25941 v                                                     <  
0446 ;* Restore original printer settings, and output saved reports  <  
0447 UDTEXECUTE RESTORE.PRINTER.CMD                                  <  
0448 CALL DOC.PRINT.MAIL(HOLD.FILE,OPO.KEYS,PM.LIST,MAT COMP.REC,"O  <  
0449 *   IF MAIL.FLAG # '' THEN RETURN                               <  
0450 IF  MAIL.FLAG # "" THEN GOTO 1100                               <  
0451 ;* T25941 ^                                                     <  

0452 CRT @(-1)                                                          CRT @(-1)
0453 CRT @(4,2):"PRINTING COMPLETE."                                    CRT @(4,2):"PRINTING COMPLETE."
0454 901 *                                                           |  901   CRT @(9,6):"HAVE PURCHASE ORDERS PRINTED CORRECTLY ? (
0455 CRT @(9,6):"HAVE PURCHASE ORDERS PRINTED CORRECTLY ? (Y/N)":    <  
0456 INPUT OPTION:                                                      INPUT OPTION:
0457 IF OPTION = "Y" THEN GOTO 1100                                     IF OPTION = "Y" THEN GOTO 1100
0458 IF OPTION = "N" THEN GOTO 1200                                     IF OPTION = "N" THEN GOTO 1200
0459 PRINT ;GOTO 901                                                    PRINT ;GOTO 901
0460 *                                                               <  

0461 1100 *                                                             1100 *
0462 *                                                               |  OPO.CNT=COUNT(OPO.KEYS,AM) + (OPO.KEYS # "")
0463 OPO.CNT = DCOUNT(OPO.KEYS,AM)                                   <  
0464 FOR OPO.PTR=1 TO OPO.CNT                                           FOR OPO.PTR=1 TO OPO.CNT
0465 OPO.KEY=OPO.KEYS<OPO.PTR>                                          OPO.KEY=OPO.KEYS<OPO.PTR>
0466 MATREADU OPO.REC FROM OUTSIDE.PO,OPO.KEY ELSE                      MATREADU OPO.REC FROM OUTSIDE.PO,OPO.KEY ELSE
0467 RELEASE OUTSIDE.PO,OPO.KEY                                         RELEASE OUTSIDE.PO,OPO.KEY
0468 GOTO 1199                                                          GOTO 1199

0469 END                                                                END
0470 ;* T25941 v                                                     |  OPO.PRT.FLG="P"
0471 ;* OPO.PRT.FLG="P"                                              <  
0472 ;* Use multivalued flag for mail and print                      <  
0473 IF OPO.PRT.FLG<1,1> = 'Y' OR OPO.PRT.FLG<1,1> = 'C' THEN        <  
0474 OPO.PRT.FLG<1,1> = 'P'                                          <  
0475 END                                                             <  
0476 IF OPO.PRT.FLG<1,2> = 'Y' OR OPO.PRT.FLG<1,2> = 'C' THEN        <  

0477 OPO.PRT.FLG<1,2> = 'M'                                          <  
0478 END                                                             <  
0479 ;* T25941 ^                                                     <  
0480 MATWRITE OPO.REC ON OUTSIDE.PO,OPO.KEY                             MATWRITE OPO.REC ON OUTSIDE.PO,OPO.KEY
0481 1199                                                            |  1199  NEXT OPO.PTR
0482 NEXT OPO.PTR                                                    <  
0483 1200 *                                                             1200 *

0484 GOTO 99999                                                         GOTO 99999
0485 RETURN                                                             RETURN
0486 *                                                               <  
0487 ***** CALLS FOR SYSCOM                                             ***** CALLS FOR SYSCOM
0488 *                                                               |  91000 ERR.TYPE = 1 ; CALL SYSCOM(MAT SYSCOM.REC)
0489 91000 *                                                         <  
0490 ERR.TYPE = 1 ; CALL SYSCOM(MAT SYSCOM.REC)                      <  
0491 RETURN                                                             RETURN
0492 92000 *                                                         |  92000 ERR.TYPE = 2 ; CALL SYSCOM(MAT SYSCOM.REC)

0493 ERR.TYPE = 2 ; CALL SYSCOM(MAT SYSCOM.REC)                      <  
0494 RETURN                                                             RETURN
0495 93000 *                                                         |  93000 ERR.TYPE = 3 ; CALL SYSCOM(MAT SYSCOM.REC)
0496 ERR.TYPE = 3 ; CALL SYSCOM(MAT SYSCOM.REC)                      <  
0497 99999 *                                                            99999 *
0498 * T22081 v                                                         * T22081 v
0499 IF LASER.FLAG # '' THEN                                            IF LASER.FLAG # '' THEN

0503 END                                                                END
0504 END                                                                END
0505 END                                                                END
0506 * T22081 ^                                                         * T22081 ^
0507 END                                                                END
0508                                                                 >  
0509 


POSBP/PO.MAINT                                                     /vsi/cust/rev11/cbn/CBA-CBN/CBNBP/PO.MAINT
Printed for thompson at 06/28/2006 04:48:03PM

0001 SUBROUTINE PO.MAINT                                             <  
0002 *COPY>CPYLIB>COM1                                                  *COPY>CPYLIB>COM1
0003 *COPY>POS.CPYLIB>COM.PO                                            *COPY>POS.CPYLIB>COM.PO
0004 *COPY>POS.CPYLIB>COM.PO.INTRF                                      *COPY>POS.CPYLIB>COM.PO.INTRF
0005 **************************************************************     ************************************************************
0006 * REVISION- [08.2]                                              |  * REVISION    - [08.2]
0007 * Copyright 1982 by Computer Business Associates (Vercom Softw     * Copyright 1982 by Computer Business Associates (Vercom Sof

0008 * SYSTEM- PRIMAC                                                |  * SYSTEM      - PRIMAC
0009 * PROGRAM - PO.MAINT                                               * PROGRAM     - PO.MAINT
0010 * BY- JIHAD YAMOUT , C.B.A                                      |  * BY          - JIHAD YAMOUT , C.B.A
0011 * DATE- 02/22/84                                                |  * DATE        - 02/22/84
0012 * DESCRIPTION                                                      * DESCRIPTION
0013 * This program is used to create and maintain Regular P/O's.       * This program is used to create and maintain Regular P/O's.
0014 *                                                                  *

0015 * -------- UPDATEON 08/02/90 BY SCOTT MCHARGUE ---------------  |  * -------- UPDATE  ON 08/02/90 BY SCOTT MCHARGUE -----------
0016 * 01/25/94 TASK 17919 DOUG S ADD NEW FIELD FOR ACCRUE              * 01/25/94 TASK 17919 DOUG S ADD NEW FIELD FOR ACCRUE
0017 * 10/20/95 TASK 19404 CT6, POS DIVISIONALIZATION                   * 10/20/95 TASK 19404 CT6, POS DIVISIONALIZATION
0018 * 5/96 CLS - ADD VENDOR PHONE AND FAX TO HEADER SCREEN             * 5/96 CLS - ADD VENDOR PHONE AND FAX TO HEADER SCREEN
0019 *T23082 gat 07/20/1998 * FIX PO GUI PROBLEM                        *T23082 gat 07/20/1998 * FIX PO GUI PROBLEM
0020 *T23278 markt 10/21/1998 * Add check for divisional security    |  *T23225 bassem 09/10/1998 * Default Accrue field to 'Y' - do
0021 *T24231 edvard 08/16/1999 * PO requisition logic                |  *                           user.

0022 *T24622 edvard 12/01/99 * Merge all fixes of the bugs found wh  |  *T22746 cm 03/08/1999 * UPGRADE TO REV 11B
0023 * testing LITHO version of the requisitions.                    <  
0024 *T24953 edvard 03/20/00 * Added additional logic for POR.       <  
0025 *T24955 edvard 03/25/00 * Modified for requisition inquiry pro  <  
0026 *NOTE :                                                         <  
0027 *THIS PROGRAM IS ACTUALY A MAIN PROGRAM EXCEPT IF IT IS CALLED  <  
0028 *REQUISITION MENU.                                              <  

0029 *IF MAKING ANY CHANGES TO THIS PROGRAM MAKE SURE THAT YOU DO N  <  
0030 *BUFFER VALUES FOR IT IS VERY CRITICAL FOR PROPER FUNCITOIN OF  <  
0031 *BUFFER<1> CONTAINS EITHER "R" OR A "P" DEPENDING FROM WHAT ME  <  
0032 *COMMING FROM (PURCHASE ORDERS OR REQUISITION)                  <  
0033 *BUFFER<2> IS POPULATED IN A PROGRAM AND CAN BE "REQ" OR "PO"   <  
0034 *WHAT IS THIS A PO OR A REQUISITION.                            <  
0035 *BUFFER<3> IS POPULATED IN REQ.INQ PROGRAM PRIOR TO CALLING TH  <  

0036 *AND HAS A VALUE OF "INQ".                                      <  
0037 *BUFFER<4> IS ALSO POPULATED IN REQ.INQ AND HAS AN REQ NUMBER.  <  
0038 *ALSO CHECK A NOTE IN A PROGRAM ABOUT CHANGING AND REFILING TH  <  
0039 *LOOK FOR password KEYWORD.                                     <  
0040 *T25260 edvard 09/27/2000 * CHANGE THE FUNCITIONALITY OF DOLLA  <  
0041 * THAT LIMIT CONTROLS ROUTING OF THE REQ.                       <  
0042 *T25854 cm 06/13/2001 * Add duplicate function to program.      <  

0043 *T25858 edwin 06/14/2001 * Added requestor field.               <  
0044 *T25855 edwin 06/15/2001 * Add PO inquiry function.             <  
0045 *T25942 ajibaly 07/10/2001 * Change options to:                 <  
0046 * F- release for approval, H- put it on hold                    <  
0047 *T25740 edvard 07/23/2001 * REV12                               <  
0048 *T25740 edvard 07/23/2001 * Modify for rev12 data file structu  <  
0049 *T26152 alex 10/29/2001 * Set validation rule for the Accrue f  <  

0050 *                         based on the company POS setup.       <  
0051 *T25938 cmykleb 02/20/2002 * Add a duplicate function to PO en  <  
0052 *T26126 adelgado 02/26/2002 * Implement the LOCKED clause for   <  
0053 *T26471 lross 03/11/2002 * Default new Vendor terms if Vend No  <  
0054 *                          REQS.                                <  
0055 *T25740 lhelms 05/07/2002 * When answer yes to create barcodes  <  
0056 *                           PO.RSKI.XREF and add to if needed.  <  

0057 *T25740 thompson 05/08/2002 * Add for prod sched needs.         <  
0058 *T25740 epitka 06/14/2002 * if duplicated and job remove data   <  
0059 *                           then PO.JB.OPEN = PO.JB.ONRD and t  <  
0060 *                           PO.JB.RECEVED = ''                  <  
0061 *T25940 cmykleb 07/03/2002 * Correct problem with creation of   <  
0062 *T25941 ajibaly 06/25/2002 * Add email capability for POs       <  
0063 *C40479 ajibaly 08/02/2002 * Make sure REQ -> PO process gets   <  

0064 *                            flag.                              <  
0065 *T27398 thompson 04/25/2003 * When change of shipto warehouse,  <  
0066 *                             detail for valid warehouse.       <  
0067 *T27552 cmykleb 07/11/2003 * Correct error message problem.     <  
0068 *T27701 lross 09/11/2003 * Add SHIP.VIA XREF.                   <  
0069 *T27701 wyamout 10/01/2003 * REMOVE THE SHIP.VIA XREF FROM THE  <  
0070 *                            IT IS HANDLED BY THE SCREEN        <  

0071 *T27701 wyamout 10/01/2003 * ADD THE SHIP.VIA DEFAULT FROM THE  <  
0072 *                            CCP REV12 PROBLEM 15               <  
0073 *T27798 cmykleb 11/25/2003 * If a purchase requisition is on h  <  
0074 *                            the approver is a level 1 then al  <  
0075 *                            access to the requisition.         <  
0076 *T28244 lross 09/09/2004 * Do not delete requisition until PO   <  
0077 *                          created.                             <  

0078 *T28462 lross 03/02/2005 * Do not load "R" type serials into P  <  
0079 **************************************************************     ************************************************************
0080 **** INSERT FILES EQUATES                                          **** INSERT FILES EQUATES
0081 *COPY>PMC.CPYLIB>PO ; *T25858                                   |  *COPY>PMC.CPYLIB>PO
0082 *COPY>ICS.CPYLIB>INVENTORY                                         *COPY>ICS.CPYLIB>INVENTORY
0083 *COPY>ICS.CPYLIB>INV.STATS                                         *COPY>ICS.CPYLIB>INV.STATS
0084 *COPY>ICS.CPYLIB>WAREHOUSE                                         *COPY>ICS.CPYLIB>WAREHOUSE

0094 *COPY>PMC.CPYLIB>COMPANY                                           *COPY>PMC.CPYLIB>COMPANY
0095 *COPY>CPYLIB>EDIT.COM                                              *COPY>CPYLIB>EDIT.COM
0096 *COPY>CPYLIB>EDIT.COM.DRIVER                                       *COPY>CPYLIB>EDIT.COM.DRIVER
0097 *COPY>CPYLIB>FILE.VARS                                             *COPY>CPYLIB>FILE.VARS
0098 *COPY>APS.CPYLIB>APS.FILE.VARS                                     *COPY>APS.CPYLIB>APS.FILE.VARS
0099 *COPY>CPYLIB>GEN.XREF.SUB ; * 25260                             |  *COPY>CPYLIB>GEN.XREF
0100 *COPY>CPYLIB>SYSCOM                                                *COPY>CPYLIB>SYSCOM
0101 *COPY>CPYLIB>CHAR                                                  *COPY>CPYLIB>CHAR
0102 *COPY>ICS.CPYLIB>PO.RSKI.XREF                                      *COPY>ICS.CPYLIB>PO.RSKI.XREF
0103 *COPY>ICS.CPYLIB>INV_SERIAL                                     |  *COPY>ICS.CPYLIB>ROLL.SKID.INFO

0104 *COPY>PMC.CPYLIB>SECURITY                                       <  
0105 *COPY>ICS.CPYLIB>INV.CNV                                        <  
0106 *COPY>POS.CPYLIB>APP.REQ                                        <  
0107 *                                                               <  
0108 DEFFUN GET.SERIAL.SEQ(CONO,CONTROL.FILE,INV_SERIAL.FILE)        <  
0109 *                                                               <  
0110 DIM HOLD.APP.REQ.REC(20)                                        <  

0111 MAT APP.REQ.REC = ""                                            <  
0112 MAT HOLD.APP.REQ.REC = ""                                       <  
0113 DIM PROD.DEL(5)                                                    DIM PROD.DEL(5)
0114 **** SETUP FOR SYSTEM ERRMSGS                                      **** SETUP FOR SYSTEM ERRMSGS
0115 SYS.TYPE = 1                                                       SYS.TYPE = 1
0116 CALL SYSCOM(MAT SYSCOM.REC)                                        CALL SYSCOM(MAT SYSCOM.REC)
0117 PROCREAD BUFFER ELSE                                            <  

0118 ERRMSG = "MUST BE RUN FROM PROC"                                <  
0119 GOSUB 93000                                                     <  
0120 END                                                             <  
0121 IF BUFFER<1> = 'PI' THEN                                        <  
0122 BUFFER<1> = 'P'                                                 <  
0123 BUFFER<5> = 'I'                                                 <  
0124 PROCWRITE BUFFER                                                <  

0125 POS.INQ = 1                                                     <  
0126 END ELSE                                                        <  
0127 POS.INQ = 0                                                     <  
0128 END                                                             <  
0129 **** OPEN FILES                                                    **** OPEN FILES
0130 OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = 'COMPANY FILE IS MI  <  
0131 OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE IS MI  <  

0132 MAT COMP.REC = ''                                               <  
0133 CONO = ''                                                       <  
0134 CALL GET.CONO(CONO,MAT COMP.REC)                                <  
0135 IF CONO = 'END' THEN GOTO 99999                                 <  
0136 IF BUFFER<1> = "R" AND CO.PO.REQ.FLAG # "Y" THEN                <  
0137 ERRMSG = "Requisition system is not activated."                 <  
0138 GOSUB 91000                                                     <  

0139 GOTO 99999                                                      <  
0140 END                                                             <  
0141 * T25740                                                        <  
0142 IF CO.PSS = "Y" THEN BUFFER<6> = "Y"                            <  
0143 PROCWRITE BUFFER                                                <  
0144 * T25740                                                        <  
0145 OPEN '','INVENTORY' TO INVENTORY ELSE ERRMSG = 'INVENTORY FILE     OPEN '','INVENTORY' TO INVENTORY ELSE ERRMSG = 'INVENTORY FI

0152 OPEN '','INV.JOB.STATS' TO INV.JOB.STATS ELSE ERRMSG = 'INV.JO     OPEN '','INV.JOB.STATS' TO INV.JOB.STATS ELSE ERRMSG = 'INV.
0153 OPEN '','WAREHOUSE' TO WAREHOUSE ELSE ERRMSG = 'WAREHOUSE FILE     OPEN '','WAREHOUSE' TO WAREHOUSE ELSE ERRMSG = 'WAREHOUSE FI
0154 OPEN '','INV.WHSE' TO INV.WHSE ELSE ERRMSG = 'INV.WHSE IS MISS     OPEN '','INV.WHSE' TO INV.WHSE ELSE ERRMSG = 'INV.WHSE IS MI
0155 OPEN '','SHIP.VIA' TO SHIP.VIA ELSE ERRMSG = 'SHIP.VIA FILE IS     OPEN '','SHIP.VIA' TO SHIP.VIA ELSE ERRMSG = 'SHIP.VIA FILE 
0156 OPEN '','CATEGORY' TO CATEGORY ELSE ERRMSG = 'CATEGORY FILE IS     OPEN '','CATEGORY' TO CATEGORY ELSE ERRMSG = 'CATEGORY FILE 
0157                                                                 >  OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = 'COMPANY FILE IS 
0158 OPEN '','VEND' TO VEND ELSE ERRMSG = 'VENDOR FILE IS MISSING';     OPEN '','VEND' TO VEND ELSE ERRMSG = 'VENDOR FILE IS MISSING
0159 OPEN '','POS.SCREENS' TO M.SCREENS ELSE ERRMSG = 'POS.SCREENS      OPEN '','POS.SCREENS' TO M.SCREENS ELSE ERRMSG = 'POS.SCREEN
0160                                                                 >  OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE IS 
0161 OPEN '','VENDOR.XREF' TO VENDOR.XREF ELSE ERRMSG = 'VENDOR.XRE     OPEN '','VENDOR.XREF' TO VENDOR.XREF ELSE ERRMSG = 'VENDOR.X

0162 OPEN '','XREF.DATA' TO XREF.DATA ELSE ERRMSG = 'XREF.DATA FILE  <  
0163 OPEN '','PREFIX' TO PREFIX ELSE ERRMSG = 'PREFIX FILE IS MISSI     OPEN '','PREFIX' TO PREFIX ELSE ERRMSG = 'PREFIX FILE IS MIS
0164 OPEN '','INV_SERIAL' TO INV_SERIAL ELSE ERRMSG = 'INV_SERIAL F  |  OPEN '','ROLL.SKID.INFO' TO ROLL.SKID.INFO ELSE ERRMSG = 'RO
0165 OPEN '','INV_SERIAL_DELETED' TO INV_SERIAL_DELETED ELSE ERRMSG  <  
0166 OPEN '','PO.RSKI.XREF' TO PO.RSKI.XREF ELSE ERRMSG = 'PO.RSKI.     OPEN '','PO.RSKI.XREF' TO PO.RSKI.XREF ELSE ERRMSG = 'PO.RSK
0167 OPEN '','SLIT.TRANS' TO SLIT.TRANS ELSE ERRMSG = 'SLIT.TRANS F     OPEN '','SLIT.TRANS' TO SLIT.TRANS ELSE ERRMSG = 'SLIT.TRANS
0168                                                                 >  *** TASK 19404

0169 OPEN '','DIVISION' TO DIVISION ELSE ERRMSG = 'DIVISION FILE IS     OPEN '','DIVISION' TO DIVISION ELSE ERRMSG = 'DIVISION FILE 
0170 *T25740                                                         |  ***
0171 OPEN '','DEPARTMENT' TO DEPARTMENT ELSE ERRMSG = 'DEPARTMENT F  |  *
0172 OPEN '','COST.CNTR' TO COST.CNTR ELSE ERRMSG = 'COST.CNTR FILE  |  ***** GET COMPANY NAME
0173 * T25740                                                        |  *
0174                                                                 >  MAT COMP.REC = ''
0175                                                                 >  CONO = ''
0176                                                                 >  CALL GET.CONO(CONO,MAT COMP.REC)

0177                                                                 >  IF CONO = 'END' THEN GOTO 99999
0178 IF CO.APS.R.INTRF > 2 THEN                                         IF CO.APS.R.INTRF > 2 THEN
0179 OPEN '','VEND.STATS' TO VEND.STATS ELSE                            OPEN '','VEND.STATS' TO VEND.STATS ELSE
0180 ERRMSG = "VEND.STATS FILE IS MISSING"; GOTO 93000                  ERRMSG = "VEND.STATS FILE IS MISSING"; GOTO 93000
0181 END                                                                END
0182 OPEN '','VEND.PO.STATS' TO VEND.PO.STATS ELSE                      OPEN '','VEND.PO.STATS' TO VEND.PO.STATS ELSE
0183 ERRMSG = "VEND.PO.STATS FILE IS MISSING"; GOTO 93000               ERRMSG = "VEND.PO.STATS FILE IS MISSING"; GOTO 93000

0184 END                                                                END
0185 OPEN '','VEND.PROD.STATS' TO VEND.PROD.STATS ELSE                  OPEN '','VEND.PROD.STATS' TO VEND.PROD.STATS ELSE
0186 ERRMSG = "VEND.PROD.STATS FILE IS MISSING"; GOTO 93000             ERRMSG = "VEND.PROD.STATS FILE IS MISSING"; GOTO 93000
0187 END                                                                END
0188 END                                                                END
0189 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0190 OPEN '','REG.REQ' TO REG.REQ ELSE ERRMSG = 'REG.REQ FILE IS MI  <  
0191 OPEN '','APP.REQ' TO APP.REQ ELSE ERRMSG = 'APP.REQ FILE IS MI  <  
0192 OPEN '','SECURITY' TO SECURITY ELSE ERRMSG = 'SECURITY FILE IS  <  
0193 USER.ID = UPCASE(@LOGNAME)                                      <  

0194 END                                                             <  
0195 IF POS.INQ THEN OPEN '','REG.REQ' TO REG.REQ ELSE               <  
0196 ERRMSG = 'REG.REQ FILE IS MISSING' ; GOTO 93000                 <  
0197 END                                                             <  
0198 ITEM.LIST = ""                                                  <  
0199 ITEM.LIST2 = ""                                                 <  
0200 TOT.ORD.AMT = ""                                                <  

0201 TOT.QTY = ""                                                    <  
0202 MAT INV.CNV.REC = ""                                            <  
0203 DIFF.UM = ""                                                    <  
0204 APPROVER.LIMIT = 99999999999                                    <  
0205 DIV = ""; *24953                                                <  
0206 *                                                                  *
0207 **** SET UP GEN.XREF.REC                                           **** SET UP GEN.XREF.REC

0206 *                                                                  *
0207 **** SET UP GEN.XREF.REC                                           **** SET UP GEN.XREF.REC
0208 *                                                                  *
0209 MAT GEN.XREF.REC = ''                                              MAT GEN.XREF.REC = ''
0210 GXR.CO = CONO                                                      GXR.CO = CONO
0211 *                                                               |  GXR.HEADING<1,2> = 'DESCRIPTION'
0212                                                                 >  GXR.ATT<1,1> = 0
0213                                                                 >  GXR.ATT<1,2> = 1
0214                                                                 >  GXR.LEN<1,1> = 10
0215                                                                 >  GXR.LEN<1,2> = 30

0216 ***** MAIN PROCESSING                                              ***** MAIN PROCESSING
0217 *                                                               |  MAT RSKI.REC = ''
0218 MAT ISTK.REC = ''                                               <  
0219 MAT EDIT.COM.DRIVER = ''                                           MAT EDIT.COM.DRIVER = ''
0220 ECD.SCRN.CNT = 6                                                |  ECD.SCRN.CNT = 3
0221 ECD.SCRN.NAME<1> = 'PO.MAINT'                                      ECD.SCRN.NAME<1> = 'PO.MAINT'
0222 ECD.SCRN.NAME<2> = 'PO.IN.MAINT'                                   ECD.SCRN.NAME<2> = 'PO.IN.MAINT'
0223 ECD.SCRN.NAME<3> = 'PO.DET.MAINT'                                  ECD.SCRN.NAME<3> = 'PO.DET.MAINT'

0224 ECD.SCRN.NAME<4> = 'PO.REQ.LOG.INQ'                             |  * T23082
0225 ECD.SCRN.NAME<5> = "REQ.MAINT"                                  |  ECD.SCRN.NO = 1
0226 ECD.SCRN.NAME<6> = 'PO.INQUIRY'                                 |  * T23082
0227 IF BUFFER<1> = "R" THEN                                         <  
0228 SCRN.NO = 5                                                     <  
0229 MENU.FLAG = "R"                                                 <  
0230 END ELSE                                                        <  

0231 IF POS.INQ THEN SCRN.NO = 6 ELSE SCRN.NO = 1                    <  
0232 MENU.FLAG = "P"                                                 <  
0233 END                                                             <  
0234 ECD.SCRN.NO = SCRN.NO                                           <  
0235 IF BUFFER<3> # "INQ" THEN ; * 24955 v                           <  
0236 ECD.ACTION=1;CALL SCRN.EDIT                                        ECD.ACTION=1;CALL SCRN.EDIT
0237 END ; * 24955 ^                                                 <  

0238 **** PRINT SCREEN                                                  **** PRINT SCREEN
0239 1*                                                                 1*
0240 ECD.SCRN.NO = SCRN.NO ; * 24231                                 |  ECD.SCRN.NO = 1
0241 IF BUFFER<3> # "INQ" THEN; * 24955 v                            <  
0242 MAT SCV.REC = ""                                                   MAT SCV.REC = ""
0243 END; * 24955 ^                                                  |  ECD.ACTION=6;CALL SCRN.EDIT
0244 ECD.ACTION=2;CALL SCRN.EDIT                                     <  
0245 ***** ENTER PO NUMBER                                              ***** ENTER PO NUMBER
0246 5*                                                                 5*

0247 DUPLICATED.PO = 0 ; *T25938                                     <  
0248 NEW = 0                                                            NEW = 0
0249 FIRST.TIME = 0      ;* T26152                                   <  
0250 PORDER = 0                                                      <  
0251 REQ = 0                                                         <  
0252 MAT PO.REC = ''                                                    MAT PO.REC = ''
0253 MAT PROD.DEL = ""                                                  MAT PROD.DEL = ""

0254 PREV.PO.VEND=""                                                    PREV.PO.VEND=""
0255 OPTION = ""                                                        OPTION = ""
0256 IF BUFFER<4># "" THEN                                           <  
0257 ECD.RET.VALUE = BUFFER<4>                                       <  
0258 BUFFER<4> = ""                                                  <  
0259 END ELSE                                                        <  
0260 IF NOT(POS.INQ) THEN ECD.DEFAULT = 'N'; * 25855                 <  
0261 ECD.NUM = 5                                                        ECD.NUM = 5
0262 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT

0263 END ; *24955                                                    <  
0264 BEGIN CASE                                                         BEGIN CASE
0265 CASE ECD.RET.VALUE = 'END'                                         CASE ECD.RET.VALUE = 'END'
0266 GOTO 99999                                                         GOTO 99999
0267 CASE MENU.FLAG="R" AND ECD.RET.VALUE="D" AND NOT(POS.INQ) ;*25  |  CASE ECD.RET.VALUE = "N"
0268 GOTO DUPE.SUB                                                   <  
0269 CASE ECD.RET.VALUE = "N" AND NOT(POS.INQ) ; * 25855             <  

0270 NEW = 1                                                            NEW = 1
0271 PO.CODE = ECD.RET.VALUE                                            PO.CODE = ECD.RET.VALUE
0272 IF MENU.FLAG = "R" THEN                                         |  CASE ECD.RET.VALUE # ""
0273 PO.STATUS<1,-1> = "Entered"                                     <  
0274 PO.ST.DATE<1,-1> = DATE()                                       <  
0275 PO.PREV.APP<1,-1> = USER.ID                                     <  
0276 SCV.REC(44)<ECD.SCRN.NO,1> = PO.STATUS                          <  
0277 ECD.NUM = 44 ; ECD.ACTION = 5 ; CALL SCRN.EDIT                  <  
0278 SCV.REC(47)<ECD.SCRN.NO,1> = OCONV(PO.ST.DATE,"D2/")            <  

0279 ECD.NUM = 47 ; ECD.SCRN = 5 ; CALL SCRN.EDIT                    <  
0280 END                                                             <  
0281 *T25938 v                                                       <  
0282 CASE MENU.FLAG = "P" AND ECD.RET.VALUE = "D" AND NOT(POS.INQ)   <  
0283 ECD.NUM=49;ECD.ACTION=4;CALL SCRN.EDIT                          <  
0284 IF ECD.RET.VALUE = "END" OR ECD.RET.VALUE = "" THEN GOTO 5      <  
0285 DUP.PONO = ECD.RET.VALUE                                        <  

0286 MATREAD PO.REC FROM PO, CONO:DUP.PONO ELSE                      <  
0287 ERRMSG = "Regular PO # entered not on file"                     <  
0288 GOSUB 91000                                                     <  
0289 GOTO 5                                                          <  
0290 END                                                             <  
0291 ECD.NUM=50;ECD.ACTION=4;CALL SCRN.EDIT                          <  
0292 PO.CODE = ECD.RET.VALUE                                            PO.CODE = ECD.RET.VALUE

0293 BEGIN CASE                                                      |  MATREADU PO.REC FROM PO, CONO:PO.CODE ELSE
0294 CASE PO.CODE = "END" OR PO.CODE = ""                            |  READU REC FROM SLIT.TRANS, CONO:PO.CODE THEN
0295 GOTO 5                                                          |  ERRMSG='SLIT TRANSACTION ALREADY EXISTS WITH THIS NUMBER'
0296 CASE PO.CODE = "N"                                              |  GOSUB 91000; RELEASE SLIT.TRANS, REC; GOTO 5
0297 SCV.REC(5)<1> = PO.CODE; ECD.NUM = 5; ECD.ACTION = 5; CALL SCR  <  
0298 CASE PO.CODE # ""                                               <  
0299 SCV.REC(5)<1> = PO.CODE; ECD.NUM = 5; ECD.ACTION = 5; CALL SCR  <  

0300 READ REC FROM PO, CONO:PO.CODE THEN                             <  
0301 ERRMSG = "Regular PO # already exists on file"                  <  
0302 GOSUB 91000                                                     <  
0303 GOTO 5                                                          <  
0304 END                                                                END
0305 MATBUILD SAVE.REC FROM PO.REC                                   <  
0306 END CASE                                                        <  

0307 ECD.NUM=51;ECD.ACTION=4;CALL SCRN.EDIT                          <  
0308 JOB.CLEAR = ECD.RET.VALUE                                       <  
0309 DUPLICATED.PO = 1                                               <  
0310 PO.DATE = DATE()                                                <  
0311 PO.ST.DATE = DATE()                                             <  
0312 PO.DEL.DATE = ""                                                <  
0313 PO.DUE.DATE = ""                                                <  

0314 PO.TOT.RECEVED = ""                                             <  
0315 PO.PRT.FLG = "Y"                                                <  
0316 IF JOB.CLEAR = "Y" THEN                                         <  
0317 PO.JOB.NO = ""                                                  <  
0318 PO.JB.UNITS = ""                                                <  
0319 PO.JB.ONORD = ""                                                <  
0320 PO.JB.RECEVED = ""                                              <  

0321 PO.JB.OPEN = ""                                                 <  
0322 END ELSE                                                        <  
0323 PO.JB.OPEN=PO.JB.ONORD                                          <  
0324 PO.JB.RECEVED=''                                                <  
0325 END                                                             <  
0326 *T25938 ^                                                       <  
0327 CASE ECD.RET.VALUE # "" AND NOT(POS.INQ) ; * 25855              <  

0328 PO.CODE = ECD.RET.VALUE                                         <  
0329 * T26126 v                                                      <  
0330 MATREADU PO.REC FROM PO, CONO:PO.CODE LOCKED                    <  
0331 ERRMSG = 'P/O record is locked by user - ':GETUSERNAME(STATUS(  <  
0332 GOSUB 91000;GOTO 5                                              <  
0333 END THEN                                                        <  
0334 * T26126 ^                                                      <  

0335 IF MENU.FLAG = "R" THEN                                         <  
0336 ERRMSG = "PO with number ":PO.CODE: " already exists"           <  
0337 GOSUB 91000; RELEASE PO,CONO:PO.CODE                            <  
0338 GOTO 5                                                          <  
0339 END                                                             <  
0340 PORDER = 1; * this is a purchase order since found in PO file   <  
0341 END ELSE                                                        <  

0342 READ REC FROM SLIT.TRANS, CONO:PO.CODE THEN                     <  
0343 ERRMSG='Slit transaction already exists with this number'       <  
0344 GOSUB 91000; RELEASE SLIT.TRANS, CONO:PO.CODE                   <  
0345 END ELSE                                                        <  
0346 RELEASE SLIT.TRANS, CONO:PO.CODE                                <  
0347 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0348 MATREAD PO.REC FROM REG.REQ, CONO:PO.CODE THEN                  <  

0349 IF MENU.FLAG = "P" THEN                                         <  
0350 ERRMSG = "Requisition with number ":PO.CODE:" already exists"   <  
0351 GOSUB 91000 ; RELEASE REG.REQ,CONO:PO.CODE ; GOTO 5             <  
0352 END                                                             <  
0353 REQ = 1 ; * this is still requisition                           <  
0354 END                                                             <  
0355 END                                                             <  

0356 END                                                             <  
0357 IF INDEX(PO.CODE,"S",1) THEN                                       IF INDEX(PO.CODE,"S",1) THEN
0358 LENPO = LEN(PO.CODE)                                               LENPO = LEN(PO.CODE)
0359 NPOCODE = PO.CODE[1,LENPO-1]                                       NPOCODE = PO.CODE[1,LENPO-1]
0360 IF NPOCODE # "" AND NUM(NPOCODE) THEN                              IF NPOCODE # "" AND NUM(NPOCODE) THEN
0361 ERRMSG=PO.CODE:" is not allowed.Could be a Slit Trans Key."     |  * this key is not allowed could be a slit.trans key.
0362                                                                 >  ERRMSG=PO.CODE:" is not allowed.  Could be a Slit Trans Key.

0361 ERRMSG=PO.CODE:" is not allowed.Could be a Slit Trans Key."     |  * this key is not allowed could be a slit.trans key.
0362                                                                 >  ERRMSG=PO.CODE:" is not allowed.  Could be a Slit Trans Key.
0363 GOSUB 91000 ; GOTO 5                                               GOSUB 91000 ; GOTO 5
0364 END                                                                END
0365 END                                                                END
0366 IF REQ THEN                                                     <  
0367 IF BUFFER<3> = 'INQ' THEN                                       <  
0368 MATREAD PO.REC FROM REG.REQ, CONO:PO.CODE ELSE MAT PO.REC = ''  <  
0369 END ELSE                                                        <  
0370 * T26126 v                                                      <  

0371 MATREADU PO.REC FROM REG.REQ, CONO:PO.CODE LOCKED               <  
0372 ERRMSG = 'P/O record is locked by user - ':GETUSERNAME(STATUS(  <  
0373 GOSUB 91000;GOTO 5                                              <  
0374 END ELSE                                                        <  
0375 MAT PO.REC = ''                                                 <  
0376 END                                                             <  
0377 * T26126 ^                                                      <  

0378 END                                                             <  
0379 END ELSE                                                        <  
0380 * T26126 v                                                      <  
0381 MATREADU PO.REC FROM PO, CONO:PO.CODE LOCKED                    <  
0382 ERRMSG = 'P/O record is locked by user - ':GETUSERNAME(STATUS(  <  
0383 GOSUB 91000;GOTO 5                                              <  
0384 END ELSE                                                        <  

0385 MAT PO.REC = ''                                                 <  
0386 END                                                             <  
0387 * T26126 ^                                                      <  
0388 END                                                             <  
0389 IF PO.APP.LEVEL = "C" THEN                                      <  
0390 IF (REQ) THEN                                                   <  
0391 ERRMSG = "Requisition: ":PO.CODE:" was cancelled. Cannot make   <  

0392 GOSUB 91000                                                     <  
0393 END ELSE                                                        <  
0394 ERRMSG = "PO ":PO:" was cancelled. You cannot make any changes  <  
0395 GOSUB 91000                                                     <  
0396 END                                                             <  
0397 END                                                             <  
0398 IF NOT(PORDER) AND NOT(REQ) THEN                                <  

0399 X = 0; Y = 21; TYP = 8; MAXL = 1                                   X = 0; Y = 21; TYP = 8; MAXL = 1
0400 IF MENU.FLAG = "R" THEN Y = 22 ; * T26556                       <  
0401 PMSG = PO.CODE:" IS NOT ON FILE. DO YOU WANT TO ADD (Y/N)"         PMSG = PO.CODE:" IS NOT ON FILE. DO YOU WANT TO ADD (Y/N)"
0402 CALL EDIT.SUB                                                      CALL EDIT.SUB
0403 P_X= 0 ; P_Y = 21 ; P_VALUE = "" ; P_OPT = "CL"                 |  P_X  = 0 ; P_Y = 21 ; P_VALUE = "" ; P_OPT = "CL"
0404 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
0405 IF VALUE = "Y" THEN                                                IF VALUE = "Y" THEN
0406 NEW = 1                                                            NEW = 1

0407 IF MENU.FLAG = "R" THEN                                         <  
0408 REQ = 1                                                         <  
0409 END ELSE                                                           END ELSE
0410 PORDER = 1                                                      <  
0411 END                                                             <  
0412 END ELSE                                                        <  
0413 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  

0414 RELEASE REG.REQ, CONO:PO.CODE                                   <  
0415 END                                                             <  
0416 RELEASE PO, CONO:PO.CODE                                           RELEASE PO, CONO:PO.CODE
0417 GOTO 5                                                             GOTO 5
0418 END                                                                END
0419 END                                                                END
0420 END                                                             <  

0421 IF NOT (NEW) THEN                                               <  
0422 DIV.CODE = PO.DIV.OWNER; USER.ID = UPCASE(@LOGNAME); ERRMSG =   <  
0423 CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)               <  
0424 IF ERRMSG # '' THEN                                             <  
0425 GOSUB 91000; SCV.REC(5)<1,1> = ''; GOTO 5                       <  
0426 END                                                             <  
0427 IF MENU.FLAG = "R" THEN                                         <  

0428 USER= USER.ID; DIV.OWNER = PO.DIV.OWNER; APP.REQ.ID = ""        <  
0429 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  
0430 VALID = RET.FLAG                                                <  
0431 IF NOT(VALID) THEN                                              <  
0432 ERRMSG = "Profile for user ":USER.ID:" is either missing or is  <  
0433 GOSUB 91000                                                     <  
0434 GOTO 5                                                          <  

0435 END                                                             <  
0436 END                                                             <  
0437 END                                                             <  
0438 CASE POS.INQ ; * 25855                                          <  
0439 PO.CODE = ECD.RET.VALUE                                         <  
0440 MATREAD PO.REC FROM PO, CONO:PO.CODE ELSE                       <  
0441 MATREAD PO.REC FROM REG.REQ, CONO:PO.CODE ELSE                  <  

0442 ERRMSG = "PO with number ":PO.CODE:" not found"                 <  
0443 GOSUB 91000; GOTO 5                                             <  
0444 END                                                             <  
0445 END                                                             <  
0446 DIV.CODE=PO.DIV.OWNER ; USER.ID=UPCASE(@LOGNAME) ; ERRMSG=""    <  
0447 CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)               <  
0448 IF ERRMSG # '' THEN GOSUB 91000 ; SCV.REC(5)<1,1> = '' ; GOTO   <  

0449 END CASE                                                           END CASE
0450 IF NEW THEN                                                        IF NEW THEN
0451 FIRST.TIME = 1     ;* T26152                                    <  
0452 IF MENU.FLAG = "R" THEN                                         <  
0453 REQ = 1                                                         <  
0454 FOR S = 1 TO 13 UNTIL ECD.RET.VALUE = "END" ;*25260             <  
0455 ON S GOSUB 50,70,100,120,200,275,300,350,400,450,500,600,700 ;  <  
0456 NEXT S                                                          <  
0457 END ELSE                                                        <  

0458 PORDER = 1                                                      <  
0459 FOR S = 1 TO 13 UNTIL ECD.RET.VALUE = "END"                        FOR S = 1 TO 13 UNTIL ECD.RET.VALUE = "END"
0460 ON S GOSUB 50,70,100,120,200,250,300,350,400,450,500,600,700       ON S GOSUB 50,70,100,120,200,250,300,350,400,450,500,600,700
0461 NEXT S                                                             NEXT S
0462 END                                                             <  
0463 FIRST.TIME = 0     ;* T26152                                    <  
0464 IF ECD.RET.VALUE = "END" THEN                                      IF ECD.RET.VALUE = "END" THEN

0465 IF PO.CODE # "N" THEN                                           |  IF PO.CODE # "N" THEN RELEASE PO, CONO:PO.CODE
0466 RELEASE PO, CONO:PO.CODE                                        <  
0467 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0468 RELEASE REG.REQ, CONO:PO.CODE                                   <  
0469 END                                                             <  
0470 END                                                             <  
0471 IF BUFFER<3> = 'INQ' THEN                                       <  

0472 GOTO 99999                                                      <  
0473 END ELSE                                                        <  
0474 GOTO 1                                                             GOTO 1
0475 END ; * 24955                                                   <  
0476 END                                                                END
0477 END ELSE                                                           END ELSE
0478 GOSUB 1000                                                         GOSUB 1000

0477 END ELSE                                                           END ELSE
0478 GOSUB 1000                                                         GOSUB 1000
0479 ECD.ACTION = 3; CALL SCRN.EDIT                                     ECD.ACTION = 3; CALL SCRN.EDIT
0480 END                                                                END
0481 ***** ENTER OPTIONS                                                ***** ENTER OPTIONS
0482 *                                                               <  
0483 90 * ; * T25854                                                 <  
0484 IF NOT(NEW) AND MENU.FLAG = "R" THEN                            <  
0485 INQ.MODE = 0                                                    <  
0486 IF USER.ID # PO.APPROVER THEN                                   <  

0487 BEGIN CASE                                                      <  
0488 CASE APP.PO.LEVEL > 1                                           <  
0489 LOCATE USER.ID IN PO.PREV.APP<1> SETTING POS ELSE               <  
0490 INQ.MODE = 1                                                    <  
0491 PROMPT.NBR =52                                                  <  
0492 END                                                             <  
0493 *T27798     CASE APP.PO.LEVEL = 1                               <  

0494 *T27798        IF PO.LEVEL.STATUS='H' AND PO.APP.LEVEL#1 THEN   <  
0495 *T27798           INQ.MODE=1                                    <  
0496 *T27798           PROMPT.NBR = 52                               <  
0497 *T27798        END                                              <  
0498 END CASE                                                        <  
0499 END                                                             <  
0500 IF NOT(INQ.MODE) THEN                                           <  

0501 IF PO.APP.LEVEL < APP.PO.LEVEL OR PO.APP.LEVEL = "C" THEN       <  
0502 IF APP.PO.LEVEL = 1 AND PO.APP.LEVEL # "C" THEN                 <  
0503 PROMPT.NBR = 50; * #,N,L,F,C,R,E                                <  
0504 END ELSE                                                        <  
0505 PROMPT.NBR = 52 ; * only inquiry N,L,F,C,E                      <  
0506 END                                                             <  
0507 END ELSE                                                        <  

0508 BEGIN CASE                                                      <  
0509 CASE USER.ID=PO.APPROVER OR APP.PO.LEVEL=1 OR PO.APPROVER=''    <  
0510 PROMPT.NBR = 50 ;* #,N,L,F,C,R,P,E                              <  
0511 CASE 1                                                          <  
0512 PROMPT.NBR = 49                                                 <  
0513 END CASE                                                        <  
0514 END                                                             <  

0515 END                                                             <  
0516 END                                                             <  
0517 IF (NEW)OR MENU.FLAG = "P" THEN                                 <  
0518 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0519 IF APP.PO.LEVEL = 1 THEN                                        <  
0520 PROMPT.NBR = 50                                                 <  
0521 END ELSE                                                        <  

0522 IF POS.INQ THEN PROMPT.NBR = 47 ELSE PROMPT.NBR = 31 ; *25855   <  
0523 END                                                             <  
0524 END ELSE                                                        <  
0525 PROMPT.NBR = 46                                                 <  
0526 END                                                             <  
0527 END                                                             <  
0528 MORE = 1                                                           MORE = 1

0529 LOOP                                                               LOOP
0530 ECD.NUM = PROMPT.NBR                                            |  ECD.NUM = 31
0531 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
0532 OPTION = ECD.RET.VALUE                                             OPTION = ECD.RET.VALUE
0533 BEGIN CASE                                                         BEGIN CASE
0534 CASE OPTION = 'END' OR OPTION = 'E'                                CASE OPTION = 'END' OR OPTION = 'E'
0535 IF PO.CODE # "N" THEN                                           |  IF PO.CODE # "N" THEN RELEASE PO, CONO:PO.CODE
0536 RELEASE PO, CONO:PO.CODE                                        <  

0537 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0538 RELEASE REG.REQ, CONO:PO.CODE                                   <  
0539 END                                                             <  
0540 END                                                             <  
0541 MORE = 0                                                           MORE = 0
0542                                                                 >  * CASE NUM(OPTION) AND OPTION > 0 AND PO.PRT.FLG # "N"
0543 CASE NUM(OPTION) AND OPTION > 0                                    CASE NUM(OPTION) AND OPTION > 0

0544 IF REQ THEN                                                     <  
0545 ON OPTION GOSUB 70,100,120,200,275,250,300,350,400,450,500,600  <  
0546 END ELSE                                                        <  
0547 ON OPTION GOSUB 70,100,120,200,250,300,350,400,450,500,600,700     ON OPTION GOSUB 70,100,120,200,250,300,350,400,450,500,600,7
0548 END                                                             <  
0549 CASE OPTION = 'N'                                                  CASE OPTION = 'N'
0550 CALL PO.IN.MAINT(CONO,PO.CODE,MAT PROD.DEL,DUPLICATED.PO)       |  CALL PO.IN.MAINT(CONO,PO.CODE,MAT PROD.DEL)

0551 CALL CALC.REG.PO.TOT(CONO,TOT.ORD.AMT,XXX,YYY,ZZZ) ;*25260      |  ECD.SCRN.NO = 1
0552 ECD.SCRN.NO = SCRN.NO ; * 24231                                 <  
0553 IF MENU.FLAG # "R" THEN                                         <  
0554 SCV.REC(45)<ECD.SCRN.NO,1> = OCONV(TOT.ORD.AMT,"MD2")           <  
0555 END                                                             <  
0556 ECD.ACTION=2;CALL SCRN.EDIT                                        ECD.ACTION=2;CALL SCRN.EDIT
0557 ECD.ACTION=3;CALL SCRN.EDIT                                        ECD.ACTION=3;CALL SCRN.EDIT

0561 IF PO.DEL.DATE<1,PD> > LAST.DATE THEN LAST.DATE = PO.DEL.DATE<     IF PO.DEL.DATE<1,PD> > LAST.DATE THEN LAST.DATE = PO.DEL.DAT
0562 NEXT PD                                                            NEXT PD
0563 PO.DUE.DATE = LAST.DATE                                            PO.DUE.DATE = LAST.DATE
0564 SCV.REC(19)<ECD.SCRN.NO,1> = PO.DUE.DATE                           SCV.REC(19)<ECD.SCRN.NO,1> = PO.DUE.DATE
0565 ECD.NUM = 19;ECD.ACTION = 5;CALL SCRN.EDIT                         ECD.NUM = 19;ECD.ACTION = 5;CALL SCRN.EDIT
0566 CASE OPTION = "CA"                                              |  CASE OPTION = 'F'
0567 GOSUB CHOOSE.APPROVER ; * 25260                                 <  
0568 CASE OPTION = "L"                                               <  
0569 ECD.SCRN.NO = 4                                                 <  
0570 STATUS = PO.STATUS                                              <  

0571 ST.DATE = PO.ST.DATE                                            <  
0572 USER = PO.PREV.APP                                              <  
0573 CALL PO.REQ.LOG.INQ(STATUS, ST.DATE, USER)                      <  
0574 ECD.SCRN.NO = SCRN.NO                                           <  
0575 ECD.ACTION=2;CALL SCRN.EDIT                                     <  
0576 ECD.ACTION=3;CALL SCRN.EDIT                                     <  
0577 CASE OPTION = "C"                                               <  

0578 X = 0; Y = 22; TYP = 18; MAXL = 1; O.R = "R"                    <  
0579 PMSG = "Do you really want to cancel this requisition (Y/N) ?"  <  
0580 CALL EDIT.SUB                                                   <  
0581 P_X= 0 ; P_Y = 22 ; P_VALUE = "" ; P_OPT = "CL"                 <  
0582 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                           <  
0583 IF VALUE = "Y" THEN                                             <  
0584 PO.STATUS<1,-1> = "Cancelled"                                   <  

0585 PO.ST.DATE<1,-1> = DATE()                                       <  
0586 PO.PREV.APP<1,-1> = USER.ID                                     <  
0587 PO.APPROVER = ""                                                <  
0588 PO.APP.LEVEL = "C"                                              <  
0589 MATWRITE PO.REC ON REG.REQ,CONO:PO.CODE                         <  
0590 MORE = 0                                                        <  
0591 END                                                             <  

0592 CASE OPTION = 'F' OR OPTION = 'H'                               <  
0593 *T25938 v                                                       <  
0594 IF MENU.FLAG = "P" THEN                                         <  
0595 PCNT = DCOUNT(PO.PROD.NUM<1>,VM)                                <  
0596 PFLAG = ""                                                      <  
0597 FOR P = 1 TO PCNT                                               <  
0598 IF PO.DEL.DATE<1,P> = "" THEN PFLAG = 1                         <  

0599 NEXT P                                                          <  
0600 IF PFLAG THEN                                                   <  
0601 ERRMSG = "Some Delivery/Exp dates have not been entered on the  <  
0602 GOSUB 91000                                                     <  
0603 GOTO 90                                                         <  
0604 END                                                             <  
0605 END                                                             <  

0606 *T25938 ^                                                       <  
0607 GO.BACK = 0                                                     <  
0608 IF (MENU.FLAG = "R") THEN                                       <  
0609 IF OPTION= "F" THEN                                             <  
0610 IF DCOUNT(PO.PROD.NUM,VM) > 0 THEN                              <  
0611 IF APP.PO.LEVEL # 1 THEN                                        <  
0612 IF APP.PO.LEVEL # CO.PO.APP.LEVELS THEN                         <  

0613 GOSUB ENT.APP.CODE                                              <  
0614 IF (CODE.OK) THEN                                               <  
0615 GOSUB CHOOSE.APPROVER                                           <  
0616 IF (SKIP.RELEASE) THEN                                          <  
0617 GO.BACK = 1                                                     <  
0618 END ELSE                                                        <  
0619 GOSUB SET.RELEASED                                              <  

0620 END                                                             <  
0621 END ELSE                                                        <  
0622 GO.BACK = 1                                                     <  
0623 END                                                             <  
0624 END ELSE                                                        <  
0625 GOSUB CHOOSE.APPROVER                                           <  
0626 IF (SKIP.RELEASE) THEN                                          <  

0627 GO.BACK = 1                                                     <  
0628 END ELSE                                                        <  
0629 GOSUB SET.RELEASED                                              <  
0630 END                                                             <  
0631 END                                                             <  
0632 END ELSE                                                        <  
0633 GOSUB ENT.APP.CODE                                              <  

0634 IF (CODE.OK) THEN                                               <  
0635 REQ = 0; * * this is not requisition any more                   <  
0636 GOSUB SET.RELEASED                                              <  
0637 END ELSE                                                        <  
0638 GO.BACK = 1                                                     <  
0639 END                                                             <  
0640 END                                                             <  

0641 END ELSE                                                        <  
0642 ERRMSG = "Cannot release requisition that does not have any pr  <  
0643 GOSUB 91000                                                     <  
0644 GO.BACK = 1                                                     <  
0645 END                                                             <  
0646 END ELSE                                                        <  
0647 IF APP.PO.LEVEL#CO.PO.APP.LEVELS THEN                           <  

0648 GOSUB ENT.APP.CODE                                              <  
0649 IF CODE.OK THEN                                                 <  
0650 GOSUB SET.ON.HOLD                                               <  
0651 END ELSE                                                        <  
0652 GO.BACK =1                                                      <  
0653 END                                                             <  
0654 END ELSE                                                        <  

0655 GOSUB SET.ON.HOLD                                               <  
0656 END                                                             <  
0657 END                                                             <  
0658 END                                                             <  
0659 2000*                                                              2000*
0660 IF NOT(GO.BACK) THEN                                            <  
0661 IF PO.CODE = "N" THEN                                              IF PO.CODE = "N" THEN

0663 READU PO.SEQ FROM CONTROL, CONO:"POCODE" ELSE PO.SEQ = 10000       READU PO.SEQ FROM CONTROL, CONO:"POCODE" ELSE PO.SEQ = 10000
0664 LOOP                                                               LOOP
0665 WHILE FND DO                                                       WHILE FND DO
0666 PO.CODE = PO.SEQ                                                   PO.CODE = PO.SEQ
0667 PO.SEQ = PO.CODE + 1                                               PO.SEQ = PO.CODE + 1
0668 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0669 READU REC FROM REG.REQ, CONO:PO.CODE ELSE                       <  
0670 READU REC FROM PO, CONO:PO.CODE ELSE                               READU REC FROM PO, CONO:PO.CODE ELSE
0671 READU REC FROM PO, CONO:PO.CODE ELSE FND = 0                       READU REC FROM PO, CONO:PO.CODE ELSE FND = 0
0672 END                                                                END

0673 END                                                             <  
0674 END ELSE                                                        <  
0675 READU REC FROM PO, CONO:PO.CODE ELSE                            <  
0676 READU REC FROM PO, CONO:PO.CODE ELSE FND = 0                    <  
0677 END                                                             <  
0678 END                                                             <  
0679 REC = ""                                                           REC = ""

0680 IF FND THEN                                                     |  IF FND THEN RELEASE PO, CONO:PO.CODE
0681 RELEASE PO, CONO:PO.CODE                                        <  
0682 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  
0683 RELEASE REG.REQ, CONO:PO.CODE                                   <  
0684 END                                                             <  
0685 END                                                             <  
0686 REPEAT                                                             REPEAT

0685 END                                                             <  
0686 REPEAT                                                             REPEAT
0687 WRITE PO.SEQ ON CONTROL, CONO:"POCODE"                             WRITE PO.SEQ ON CONTROL, CONO:"POCODE"
0688 ECD.NUM = 5; SCV.REC(5)<ECD.SCRN.NO> = PO.CODE                     ECD.NUM = 5; SCV.REC(5)<ECD.SCRN.NO> = PO.CODE
0689 ECD.ACTION = 5; CALL SCRN.EDIT                                     ECD.ACTION = 5; CALL SCRN.EDIT
0690 IF MENU.FLAG = "R" THEN                                         |  ERRMSG = "Note new PO number"; GOSUB 91000
0691 IF REQ THEN                                                     <  
0692 ERRMSG = "Note new requisition number"                          <  
0693 GOSUB 91000 ; * T27552                                          <  
0694 END                                                                END

0695 END ELSE                                                        <  
0696 ERRMSG = "Note new PO number"                                   <  
0697 GOSUB 91000 ; * T27552                                          <  
0698 END                                                             <  
0699 *T27552           GOSUB 91000                                   <  
0700 END ELSE                                                        <  
0701 IF OPTION = "F" AND MENU.FLAG = "R" THEN                        <  

0702 IF APP.PO.LEVEL # "1" THEN                                      <  
0703 ERRMSG = "Requisition forwarded to ":PO.APPROVER                <  
0704 GOSUB 91000                                                     <  
0705 END                                                             <  
0706 END                                                             <  
0707 END                                                             <  
0708 IF MENU.FLAG = "R" THEN                                         <  

0709 STATUS.CNT = DCOUNT(PO.STATUS,VM)                               <  
0710 IF PO.STATUS<1,STATUS.CNT> = "On-Hold" THEN                     <  
0711 ERRMSG = "Requsition has been placed on On-Hold status."        <  
0712 GOSUB 91000                                                     <  
0713 END                                                             <  
0714 END                                                             <  
0715 PD.CNT = 0;LAST.DATE = ""                                          PD.CNT = 0;LAST.DATE = ""

0716 PD.CNT = COUNT(PO.DEL.DATE,VM) + (PO.DEL.DATE # "")                PD.CNT = COUNT(PO.DEL.DATE,VM) + (PO.DEL.DATE # "")
0717 FOR PD = 1 TO PD.CNT                                               FOR PD = 1 TO PD.CNT
0718 IF PO.DEL.DATE<1,PD> > LAST.DATE THEN LAST.DATE = PO.DEL.DATE<     IF PO.DEL.DATE<1,PD> > LAST.DATE THEN LAST.DATE = PO.DEL.DAT
0719 NEXT PD                                                            NEXT PD
0720 PO.DUE.DATE = LAST.DATE                                            PO.DUE.DATE = LAST.DATE
0721 IF (NEW) THEN                                                   <  
0722 PO.APP.LEVEL = APP.PO.LEVEL                                     <  
0723 END                                                             <  
0724 IF MENU.FLAG = "R" THEN                                         <  
0725 IF (REQ) THEN                                                   <  

0726 BUFFER<2> = "REQ"                                               <  
0727 END ELSE                                                        <  
0728 IF APP.PO.LEVEL = 1 THEN                                        <  
0729 *T28244 v                                                       <  
0730 *                       CMD = 'DELETE REG.REQ ':'"':CONO:PO.CO  <  
0731 *                       UDTEXECUTE CMD CAPTURING MSG            <  
0732 *                       ERRMSG = "New PO number " :PO.CODE:" h  <  

0733 *                       GOSUB 91000                             <  
0734 *T28244 ^                                                       <  
0735 BUFFER<2> = "PO"                                                <  
0736 END                                                             <  
0737 END                                                             <  
0738 END                                                             <  
0739 IF MENU.FLAG = "P" THEN                                         <  

0740 BUFFER<2> = "PO"                                                <  
0741 END                                                             <  
0742 PROCWRITE BUFFER                                                <  
0743 ;* C40479 v                                                     <  
0744 ;* Get accrue field if this PO doesnt have one                  <  
0745 ;* As in the case of coming from POR                            <  
0746 ;*                                                              <  

0747 LOOP WHILE NOT(REQ) AND PO.ACCRUE = '' DO                       <  
0748 GOSUB 600                                                       <  
0749 REPEAT                                                          <  
0750 ;* C40479 ^                                                     <  
0751 CALL PO.UPDATE(PO.CODE,CONO,MAT PROD.DEL)                          CALL PO.UPDATE(PO.CODE,CONO,MAT PROD.DEL)
0752 IF OPTION = "F" AND MENU.FLAG = "R" THEN                        <  
0753 GOSUB SEND.MAIL ; * notify approver                             <  

0754 END                                                             <  
0755 IF NOT(REQ) THEN                                                <  
0756 IF CO.APS.R.INTRF > 2 THEN                                         IF CO.APS.R.INTRF > 2 THEN
0757 CALL VEND.STAT.UPDATE(CONO,PO.CODE,"R")                            CALL VEND.STAT.UPDATE(CONO,PO.CODE,"R")
0758 END                                                                END
0759 GOSUB 20000 ;* GENERATE BAR CODE LABEL INFO                        GOSUB 20000         ;* GENERATE BAR CODE LABEL INFO
0760 END                                                             <  

0761 *T28244 v                                                       <  
0762 IF MENU.FLAG = "R" THEN                                         <  
0763 IF NOT(REQ) THEN                                                <  
0764 IF APP.PO.LEVEL = 1 THEN                                        <  
0765 CMD = 'DELETE REG.REQ ':'"':CONO:PO.CODE:'"'                    <  
0766 UDTEXECUTE CMD CAPTURING MSG                                    <  
0767 ERRMSG = "New PO number " :PO.CODE:" has been created."         <  

0768 GOSUB 91000                                                     <  
0769 END                                                             <  
0770 END                                                             <  
0771 END                                                             <  
0772 *T28244 ^                                                       <  
0773 MORE = 0                                                           MORE = 0
0774 RELEASE                                                         <  

0775 END                                                             <  
0776 END CASE                                                           END CASE
0777 WHILE MORE DO REPEAT                                               WHILE MORE DO REPEAT
0778 IF BUFFER<3> = 'INQ' THEN                                       <  
0779 GOTO 99999                                                      <  
0780 END ELSE                                                        <  
0781 GOTO 1                                                             GOTO 1

0782 END; * 24955                                                    <  
0783 *                                                                  *
0784 *** ENTER OWNING DIVISION NUMBER; * TASK 19404                     *** ENTER OWNING DIVISION NUMBER; * TASK 19404
0785 *                                                                  *
0786 50*                                                                50*
0787 *                                                               <  
0788 ECD.NUM=41; ECD.ACTION=4                                           ECD.NUM=41; ECD.ACTION=4

0787 *                                                               <  
0788 ECD.NUM=41; ECD.ACTION=4                                           ECD.NUM=41; ECD.ACTION=4
0789 CALL SCRN.EDIT                                                     CALL SCRN.EDIT
0790 IF ECD.RET.VALUE # "END" THEN                                      IF ECD.RET.VALUE # "END" THEN
0791 PO.DIV.OWNER = ECD.RET.VALUE                                       PO.DIV.OWNER = ECD.RET.VALUE
0792 DIV = ECD.RET.VALUE                                             <  
0793 INVALID = 0                                                     <  
0794 IF PO.DIV.OWNER # "00" THEN                                        IF PO.DIV.OWNER # "00" THEN
0795 MATREAD DIV.REC FROM DIVISION,CONO:PO.DIV.OWNER ELSE               MATREAD DIV.REC FROM DIVISION,CONO:PO.DIV.OWNER ELSE
0796 INVALID = 1                                                     <  

0797 END                                                             <  
0798 END ELSE                                                        <  
0799 DIV = "ALL"                                                     <  
0800 END                                                             <  
0801 IF NOT(INVALID) THEN                                            <  
0802 IF MENU.FLAG = "R" THEN                                         <  
0803 VALID = 1                                                       <  

0804 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!ALL" THEN       <  
0805 IF APP.STATUS = "Y" THEN                                        <  
0806 SCV.REC(21)<ECD.SCRN.NO,1> = APP.NAME<1>                        <  
0807 ECD.NUM = 21                                                    <  
0808 ECD.ACTION= 5 ; CALL SCRN.EDIT                                  <  
0809 END ELSE                                                        <  
0810 IF DIV # "ALL" THEN                                             <  

0811 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":DIV THEN      <  
0812 IF APP.STATUS = "Y" THEN                                        <  
0813 SCV.REC(21)<ECD.SCRN.NO,1> = APP.NAME<1>                        <  
0814 ECD.NUM = 21                                                    <  
0815 ECD.ACTION= 5 ; CALL SCRN.EDIT                                  <  
0816 END ELSE                                                        <  
0817 ERRMSG = "User profile is inactive for division ":DIV           <  

0818 GOSUB 91000                                                     <  
0819 GOTO 50                                                         <  
0820 END                                                             <  
0821 END ELSE                                                        <  
0822 ERRMSG = "You are not allowed to enter requisitions for divisi  <  
0823 GOSUB 91000                                                     <  
0824 GOTO 50                                                         <  

0825 END                                                             <  
0826 END ELSE                                                        <  
0827 ERRMSG = "User profile is inactive for division ":DIV           <  
0828 GOSUB 91000                                                     <  
0829 GOTO 50                                                         <  
0830 END                                                             <  
0831 END                                                             <  

0832 END ELSE                                                        <  
0833 IF DIV # "ALL" THEN                                             <  
0834 MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":DIV THEN      <  
0835 IF APP.STATUS = "Y" THEN                                        <  
0836 SCV.REC(21)<ECD.SCRN.NO,1> = APP.NAME<1>                        <  
0837 ECD.NUM = 21                                                    <  
0838 ECD.ACTION= 5 ; CALL SCRN.EDIT                                  <  

0839 END ELSE                                                        <  
0840 ERRMSG = "User profile is inactive for division ":DIV           <  
0841 GOSUB 91000                                                     <  
0842 GOTO 50                                                         <  
0843 END                                                             <  
0844 END ELSE                                                        <  
0845 ERRMSG = "You are not allowed to enter requisitions for divisi  <  

0846 GOSUB 91000                                                     <  
0847 GOTO 50                                                         <  
0848 END                                                             <  
0849 END ELSE                                                        <  
0850 ERRMSG = "You are not allowed to enter requisitions for divisi  <  
0851 GOSUB 91000                                                     <  
0852 GOTO 50                                                         <  

0853 END                                                             <  
0854 END                                                             <  
0855 IF (NEW) THEN                                                   <  
0856 PO.WRIT.BY = APP.NAME<1>                                        <  
0857 END                                                             <  
0858 END                                                             <  
0859 END ELSE                                                        <  

0858 END                                                             <  
0859 END ELSE                                                        <  
0860 ERRMSG = "Invalid division number used for PO owning division"     ERRMSG = "Invalid division number used for PO owning divisio
0861 GOSUB 91000; PO.DIV.OWNER = ""; GOTO 50                            GOSUB 91000; PO.DIV.OWNER = ""; GOTO 50
0862 END                                                                END
0863 DIV.CODE = PO.DIV.OWNER; USER.ID = UPCASE(@LOGNAME); ERRMSG =   <  
0864 CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)               <  
0865 IF ERRMSG # '' THEN                                             <  
0866 GOSUB 91000; SCV.REC(41)<1,1> = ''; GOTO 50                     <  
0867 END                                                                END

0874 ECD.NUM = 40;ECD.ACTION = 4; CALL SCRN.EDIT                        ECD.NUM = 40;ECD.ACTION = 4; CALL SCRN.EDIT
0875 IF ECD.RET.VALUE # "END" THEN                                      IF ECD.RET.VALUE # "END" THEN
0876 PO.DATE = ECD.RET.VALUE                                            PO.DATE = ECD.RET.VALUE
0877 END                                                                END
0878 RETURN                                                             RETURN
0879 *                                                               <  
0880 *** ENTER VEND CODE AND PRINT VEND INFORMATION                     *** ENTER VEND CODE AND PRINT VEND INFORMATION
0881 100*                                                               100*
0882 *T25938 v                                                       |  IF NOT(NEW) THEN
0883 *  IF NOT(NEW) THEN                                             <  

0884 IF NOT(NEW) AND NOT(DUPLICATED.PO) THEN                         <  
0885 *T25938 ^                                                       <  
0886 IF MENU.FLAG # "R" THEN                                         <  
0887 ERRMSG = "CANNOT MODIFY VENDOR INFORMATION ON EXISTING PURCHAS     ERRMSG = "CANNOT MODIFY VENDOR INFORMATION ON EXISTING PURCH
0888 GOSUB 91000                                                        GOSUB 91000
0889 RETURN                                                             RETURN
0890 END ; *24953                                                    <  

0914 SCV.REC(13)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)           SCV.REC(13)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)
0915 SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)           SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)
0916 SCV.REC(15)<ECD.SCRN.NO,1> = VEND.PO.ZIP                           SCV.REC(15)<ECD.SCRN.NO,1> = VEND.PO.ZIP
0917 SCV.REC(42)<ECD.SCRN.NO,1> = VEND.PHONE                            SCV.REC(42)<ECD.SCRN.NO,1> = VEND.PHONE
0918 SCV.REC(43)<ECD.SCRN.NO,1> = VEND.FAX                              SCV.REC(43)<ECD.SCRN.NO,1> = VEND.FAX
0919 *T26471 v                                                       <  
0920 SCV.REC(27)<ECD.SCRN.NO,1> = VEND.TERMS<1,2>                    <  
0921 PO.TERMS.DESC = VEND.TERMS<1,2>                                 <  
0922 SCV.REC(28)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[1,4]               <  
0923 PO.TERMS.DIS = VEND.TERMS<1,1>[1,4]                             <  

0924 IF PO.TERMS.DESC[1,1] = 'P' THEN                                <  
0925 SCV.REC(29)<ECD.SCRN.NO,1> = ''                                 <  
0926 END ELSE                                                        <  
0927 SCV.REC(29)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[5,2]               <  
0928 END                                                             <  
0929 PO.TERMS.DATE = SCV.REC(29)<ECD.SCRN.NO,1>                      <  
0930 *T26471 ^                                                       <  

0931 ECD.ACTION=3;CALL SCRN.EDIT                                        ECD.ACTION=3;CALL SCRN.EDIT
0932 CASE ECD.RET.VALUE = ''                                            CASE ECD.RET.VALUE = ''
0933 ECD.NUM = 10                                                       ECD.NUM = 10
0934 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
0935 IF ECD.RET.VALUE = '' OR ECD.RET.VALUE = 'END' THEN GOTO 100       IF ECD.RET.VALUE = '' OR ECD.RET.VALUE = 'END' THEN GOTO 100
0936 GXR.NAME = "VENDOR"                                             <  
0937 GXR.XREF = VENDOR.XREF                                             GXR.XREF = VENDOR.XREF
0938 GXR.FILE = VEND                                                    GXR.FILE = VEND
0939                                                                 >  GXR.LOC = 1
0940                                                                 >  GXR.TOP.LINE = 'VEND XREF SEARCH'

0941                                                                 >  GXR.HEADING<1,1> = 'VEND NO'
0942 GXR.ID = ''                                                        GXR.ID = ''
0943 GXR.SRCH.ID = ECD.RET.VALUE                                        GXR.SRCH.ID = ECD.RET.VALUE
0944 CALL GEN.XREF.SUB(MAT GEN.XREF.REC, PREFIX, XREF.DATA)          |  CALL GEN.XREF(MAT GEN.XREF.REC,PREFIX)
0945 ECD.ACTION=2;CALL SCRN.EDIT                                        ECD.ACTION=2;CALL SCRN.EDIT
0946 IF GXR.ID = '' THEN                                                IF GXR.ID = '' THEN
0947 SCV.REC(10)<1> = ''                                                SCV.REC(10)<1> = ''

0962 SCV.REC(13)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)           SCV.REC(13)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",1)
0963 SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)           SCV.REC(14)<ECD.SCRN.NO,1> = FIELD(VEND.PO.CT.ST, ",",2)
0964 SCV.REC(15)<ECD.SCRN.NO,1> = VEND.PO.ZIP                           SCV.REC(15)<ECD.SCRN.NO,1> = VEND.PO.ZIP
0965 SCV.REC(42)<ECD.SCRN.NO,1> = VEND.PHONE                            SCV.REC(42)<ECD.SCRN.NO,1> = VEND.PHONE
0966 SCV.REC(43)<ECD.SCRN.NO,1> = VEND.FAX                              SCV.REC(43)<ECD.SCRN.NO,1> = VEND.FAX
0967 *T26471 v                                                       <  
0968 SCV.REC(27)<ECD.SCRN.NO,1> = VEND.TERMS<1,2>                    <  
0969 PO.TERMS.DESC = VEND.TERMS<1,2>                                 <  
0970 SCV.REC(28)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[1,4]               <  
0971 PO.TERMS.DIS = VEND.TERMS<1,1>[1,4]                             <  

0972 IF PO.TERMS.DESC[1,1] = 'P' THEN                                <  
0973 SCV.REC(29)<ECD.SCRN.NO,1> = ''                                 <  
0974 END ELSE                                                        <  
0975 SCV.REC(29)<ECD.SCRN.NO,1> = VEND.TERMS<1,1>[5,2]               <  
0976 END                                                             <  
0977 PO.TERMS.DATE = SCV.REC(29)<ECD.SCRN.NO,1>                      <  
0978 *T26471 ^                                                       <  

0981 END CASE                                                           END CASE
0982 110*                                                               110*
0983 PREV.PO.VEND = PO.VEND.NO                                          PREV.PO.VEND = PO.VEND.NO
0984 RETURN                                                             RETURN
0985 **** ENTER SHIP TO INFORMATION                                     **** ENTER SHIP TO INFORMATION
0986 IF @LOGNAME = 'thompson' THEN DEBUG                             <  
0987 120*                                                               120*
0988 SAVE.WHSE = PO.SHIP.WHSE ; *T27398                              <  
0989 ECD.NUM = 32                                                       ECD.NUM = 32
0990 ECD.VALDAT.CODE = 2                                                ECD.VALDAT.CODE = 2

0992 ECD.PREFIX.ID = CONO                                               ECD.PREFIX.ID = CONO
0993 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
0994 PO.SHIP.WHSE = ECD.RET.VALUE                                       PO.SHIP.WHSE = ECD.RET.VALUE
0995 BEGIN CASE                                                         BEGIN CASE
0996 CASE ECD.RET.VALUE = 'END'                                         CASE ECD.RET.VALUE = 'END'
0997 PO.SHIP.WHSE = SAVE.WHSE ; *T27398                              <  
0998 GOTO 130                                                           GOTO 130
0999 CASE ECD.RET.VALUE # '' AND ECD.VALDAT.ITEM # ''                   CASE ECD.RET.VALUE # '' AND ECD.VALDAT.ITEM # ''
1000 FOR V = 1 TO WHSE.REC.SIZE                                         FOR V = 1 TO WHSE.REC.SIZE
1001 WHSE.REC(V) = ECD.VALDAT.ITEM<V>                                   WHSE.REC(V) = ECD.VALDAT.ITEM<V>

1002 NEXT V                                                             NEXT V
1003                                                                 >  *TASK 19404 vvv
1004 IF WHS.DIV # PO.DIV.OWNER AND PO.DIV.OWNER # "00" THEN             IF WHS.DIV # PO.DIV.OWNER AND PO.DIV.OWNER # "00" THEN
1005 ERRMSG = "Warehouse Division does not match the Owning Divisio     ERRMSG = "Warehouse Division does not match the Owning Divis
1006 GOSUB 91000                                                        GOSUB 91000
1007 GOTO 120                                                           GOTO 120
1008 END                                                                END
1009 * T27398                                                        |  *TASK 19404 ^^

1010 IF SAVE.WHSE # PO.SHIP.WHSE THEN                                <  
1011 WCNT = DCOUNT(PO.WHSE,VM)                                       <  
1012 FOR W = 1 TO WCNT                                               <  
1013 READ DUMMY.REC FROM INV.WHSE, CONO:PO.PROD.NUM<1,W>:"!":PO.SHI  <  
1014 ERRMSG = "WHSE ":PO.SHIP.WHSE:" INVALID FOR PROD ":PO.PROD.NUM  <  
1015 ERRMSG = ERRMSG:" CHECK INVENTORY"                              <  
1016 GOSUB 91000                                                     <  

1017 PO.SHIP.WHSE = SAVE.WHSE                                        <  
1018 ECD.NUM = 32; ECD.DEFAULT = PO.SHIP.WHSE                        <  
1019 GOTO 120                                                        <  
1020 END                                                             <  
1021 PO.WHSE<1,W> = PO.SHIP.WHSE                                     <  
1022 NEXT W                                                          <  
1023 END                                                             <  

1024 * T27398                                                        <  
1025 SCV.REC(33)<ECD.SCRN.NO,1> = WHS.DESC                              SCV.REC(33)<ECD.SCRN.NO,1> = WHS.DESC
1026 SCV.REC(34)<ECD.SCRN.NO,1> = WHS.ADDR1                             SCV.REC(34)<ECD.SCRN.NO,1> = WHS.ADDR1
1027 SCV.REC(35)<ECD.SCRN.NO,1> = WHS.ADDR2                             SCV.REC(35)<ECD.SCRN.NO,1> = WHS.ADDR2
1028 SCV.REC(36)<ECD.SCRN.NO,1> = WHS.CITY                              SCV.REC(36)<ECD.SCRN.NO,1> = WHS.CITY
1029 SCV.REC(37)<ECD.SCRN.NO,1> = WHS.STATE                             SCV.REC(37)<ECD.SCRN.NO,1> = WHS.STATE
1030 SCV.REC(38)<ECD.SCRN.NO,1> = WHS.ZIP                               SCV.REC(38)<ECD.SCRN.NO,1> = WHS.ZIP

1045 PO.VDR.ORD = ECD.RET.VALUE                                         PO.VDR.ORD = ECD.RET.VALUE
1046 END                                                                END
1047 RETURN                                                             RETURN
1048 **** ENTER WRITTEN BY                                              **** ENTER WRITTEN BY
1049 250*                                                               250*
1050 IF (REQ) THEN                                                   <  
1051 ERRMSG = "You cannot change Written By while using requsition   <  
1052 GOSUB 91000                                                     <  
1053 END ELSE                                                        <  
1054 ECD.NUM = 21                                                       ECD.NUM = 21

1054 ECD.NUM = 21                                                       ECD.NUM = 21
1055 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1056 IF ECD.RET.VALUE # 'END' THEN                                      IF ECD.RET.VALUE # 'END' THEN
1057 PO.WRIT.BY = ECD.RET.VALUE                                         PO.WRIT.BY = ECD.RET.VALUE
1058 END                                                                END
1059 END                                                             <  
1060 RETURN                                                             RETURN
1061 **** ENTER REQUESTOR ; *T25858                                  <  
1062 275*                                                            <  
1063 ECD.NUM = 53                                                    <  

1064 ECD.ACTION=4;CALL SCRN.EDIT                                     <  
1065 IF ECD.RET.VALUE # 'END' THEN                                   <  
1066 PO.REQUESTOR = ECD.RET.VALUE                                    <  
1067 END                                                             <  
1068 RETURN                                                          <  
1069 **** ENTER CONTACT                                                 **** ENTER CONTACT
1070 300*                                                               300*

1075 END                                                                END
1076 RETURN                                                             RETURN
1077 **** ENTER SHIP VIA                                                **** ENTER SHIP VIA
1078 350*                                                               350*
1079 ECD.NUM = 23                                                       ECD.NUM = 23
1080 *T27701 v                                                       <  
1081 IF PO.SHIP.VIA = "" THEN                                        <  
1082 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = VEND.SHIP.VIA                   <  
1083 END                                                             <  
1084 *T27701 ^                                                       <  

1084 *T27701 ^                                                       <  
1085 ECD.VALDAT.CODE = '2'                                              ECD.VALDAT.CODE = '2'
1086 ECD.VALDAT.FILE = SHIP.VIA                                         ECD.VALDAT.FILE = SHIP.VIA
1087 ECD.PREFIX.ID = CONO                                               ECD.PREFIX.ID = CONO
1088 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1089 *T27701 v                                                       <  
1090 *  IF ECD.RET.VALUE # 'END' THEN                                <  
1091 *    BEGIN CASE                                                 <  
1092 *    CASE ECD.RET.VALUE # '' AND ECD.VALDAT.ITEM # ''           <  
1093 *     FOR SV = 1 TO SHIP.VIA.REC.SIZE                           <  

1094 *        SHIP.VIA.REC(SV) = ECD.VALDAT.ITEM<SV>                 <  
1095 *     NEXT SV                                                   <  
1096 *    CASE ECD.RET.VALUE = ''                                    <  
1097 *     GXR.NAME = 'SHIP.VIA'                                     <  
1098 *     GXR.FILE = SHIP.VIA                                       <  
1099 *     ECD.SRCH.ID = ECD.RET.VALUE                               <  
1100 *     GXR.ID = ''                                               <  

1101 *     CALL GEN.XREF.SUB(MAT GEN.XREF.REC, PREFIX, XREF.DATA)    <  
1102 *     ECD.ACTION=2; CALL SCRN.EDIT                              <  
1103 *     IF GXR.ID # '' THEN                                       <  
1104 *       MATREAD SHIP.VIA.REC FROM SHIP.VIA,CONO:GXR.ID THEN     <  
1105 *         ECD.RET.VALUE = GXR.ID                                <  
1106 *       END                                                     <  
1107 *       SCV.REC(23)<ECD.SCRN.NO,1>=ECD.RET.VALUE; ECD.ACTION=3  <  

1108 *     END                                                       <  
1109 *    END CASE                                                   <  
1110 *  END                                                          <  
1111 IF ECD.RET.VALUE # 'END' THEN                                      IF ECD.RET.VALUE # 'END' THEN
1112 FOR SV = 1 TO SHIP.VIA.REC.SIZE                                    FOR SV = 1 TO SHIP.VIA.REC.SIZE
1113 SHIP.VIA.REC(SV) = ECD.VALDAT.ITEM<SV>                             SHIP.VIA.REC(SV) = ECD.VALDAT.ITEM<SV>
1114 NEXT SV                                                            NEXT SV

1116 PO.VIA.DESC = SHPV.DESC                                            PO.VIA.DESC = SHPV.DESC
1117 SCV.REC(24)<ECD.SCRN.NO,1> = PO.VIA.DESC                           SCV.REC(24)<ECD.SCRN.NO,1> = PO.VIA.DESC
1118 ECD.NUM = 24                                                       ECD.NUM = 24
1119 ECD.ACTION=5;CALL SCRN.EDIT                                        ECD.ACTION=5;CALL SCRN.EDIT
1120 END                                                                END
1121 *T27701 ^                                                       <  
1122 RETURN                                                             RETURN
1123 **** ENTER FOB                                                     **** ENTER FOB
1124 400*                                                               400*
1125 ECD.NUM = 25                                                       ECD.NUM = 25

1142 ECD.DEFAULT = VEND.TERMS<1,2>                                      ECD.DEFAULT = VEND.TERMS<1,2>
1143 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1144 IF ECD.RET.VALUE = 'END' THEN GOTO 501                             IF ECD.RET.VALUE = 'END' THEN GOTO 501
1145 IF NOT(ECD.RET.VALUE MATCH "3N") AND NOT(ECD.RET.VALUE MATCH "     IF NOT(ECD.RET.VALUE MATCH "3N") AND NOT(ECD.RET.VALUE MATCH
1146 PO.TERMS.DESC = ECD.RET.VALUE                                      PO.TERMS.DESC = ECD.RET.VALUE
1147                                                                 >  *
1148 ECD.NUM = 28                                                       ECD.NUM = 28
1149 ECD.DEFAULT = VEND.TERMS<1,1>[1,4]                                 ECD.DEFAULT = VEND.TERMS<1,1>[1,4]
1150 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1151 IF ECD.RET.VALUE = "END" THEN GOTO 501                             IF ECD.RET.VALUE = "END" THEN GOTO 501

1153 PO.TERMS.DIS = ECD.RET.VALUE                                       PO.TERMS.DIS = ECD.RET.VALUE
1154 IF PO.TERMS.DESC[1,1] = "P" THEN                                   IF PO.TERMS.DESC[1,1] = "P" THEN
1155 ECD.NUM = 29;SCV.REC(29)<1> = "";ECD.ACTION=5;CALL SCRN.EDIT       ECD.NUM = 29;SCV.REC(29)<1> = "";ECD.ACTION=5;CALL SCRN.EDIT
1156 GOTO 501                                                           GOTO 501
1157 END                                                                END
1158                                                                 >  *
1159 ECD.NUM = 29                                                       ECD.NUM = 29
1160 ECD.DEFAULT = VEND.TERMS<1,1>[5,2]                                 ECD.DEFAULT = VEND.TERMS<1,1>[5,2]
1161 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT
1162 IF ECD.RET.VALUE = "END" THEN GOTO 500                             IF ECD.RET.VALUE = "END" THEN GOTO 500

1164 *                                                                  *
1165 501*                                                               501*
1166 RETURN                                                             RETURN
1167 *** INPUT ACCRUE FLAG                                              *** INPUT ACCRUE FLAG
1168 600*                                                               600*
1169 IF APP.PO.LEVEL = 1 OR MENU.FLAG = "P" THEN ; * 24953           <  
1170 IF SUM(PO.TOT.RECEVED) = 0 THEN                                    IF SUM(PO.TOT.RECEVED) = 0 THEN
1171 * T26152 v                                                      <  
1172 IF CO.PO.ACCRUE.FLAG<1,1> = '' OR CO.PO.ACCRUE.MAINT<1,1> = 'Y  <  
1173 IF CO.PO.ACCRUE.FLAG<1,1> # '' AND FIRST.TIME = 1 THEN          <  

1174 PO.ACCRUE = CO.PO.ACCRUE.FLAG<1,1>                              <  
1175 ECD.NUM = 16                                                       ECD.NUM = 16
1176 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = PO.ACCRUE                       |  *T23225      ECD.ACTION=4;CALL SCRN.EDIT
1177 ECD.ACTION = 5 ; CALL SCRN.EDIT                                 |  ECD.DEFAULT = "Y"; ECD.ACTION = 5; SCV.REC(ECD.NUM)="Y"; CAL
1178 END ELSE                                                        |  *T23225      IF ECD.RET.VALUE # 'END' THEN
1179 * T26152 ^                                                      |  *T23225         PO.ACCRUE = ECD.RET.VALUE
1180 ECD.NUM = 16                                                    |  PO.ACCRUE = "Y";* T23225

1181 ECD.DEFAULT = CO.PO.ACCRUE.FLAG<1,1> ;* C40479                  |  *T23225      END
1182 ECD.ACTION=4;CALL SCRN.EDIT                                     <  
1183 IF ECD.RET.VALUE # 'END' THEN                                   <  
1184 PO.ACCRUE = ECD.RET.VALUE                                       <  
1185 END                                                                END
1186 * T26152 v                                                      <  
1187 END                                                             <  

1188 END ELSE                                                        <  
1189 IF PO.ACCRUE = '' THEN                                          <  
1190 PO.ACCRUE = CO.PO.ACCRUE.FLAG<1,1>                              <  
1191 ECD.NUM = 16                                                    <  
1192 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = PO.ACCRUE                       <  
1193 ECD.ACTION = 5 ; CALL SCRN.EDIT                                 <  
1194 END                                                             <  

1195 END                                                             <  
1196 * T26152 ^                                                      <  
1197 END                                                             <  
1198 END ; * 24953                                                   <  
1199 RETURN                                                             RETURN
1200 *                                                               |  *** INPUT PRINT FLG
1201 *** INPUT PRINT FLG (REWROTE: TASK 25941)                       <  

1202 *                                                               <  
1203 700*                                                               700*
1204 ECD.NUM = 39                                                       ECD.NUM = 39
1205 ECD.DEFAULT = PO.PRT.FLG<1,1>                                   |  IF PO.PRT.FLG = "P" THEN
1206 IF SCV.REC(ECD.NUM)<ECD.SCRN.NO> = '' AND VEND.EMAIL.ADDR # ''  |  ECD.VALDAT = "Y,C"
1207 ECD.DEFAULT = 'N'                                               |  END ELSE
1208                                                                 >  ECD.VALDAT = "Y,N"

1209                                                                 >  ECD.O.R = "O"
1210                                                                 >  ECD.DEFAULT = "Y"
1211 END                                                                END
1212 IF PO.PRT.FLG<1,1> = 'P' THEN ECD.VALDAT = 'Y,N,P,C'            <  
1213 IF PO.PRT.FLG<1,1> = 'C' THEN ECD.VALDAT = 'Y,N,C'              <  
1214 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ''                              <  
1215 ECD.ACTION=4;CALL SCRN.EDIT                                        ECD.ACTION=4;CALL SCRN.EDIT

1216 IF ECD.RET.VALUE = 'END' THEN                                   |  IF ECD.RET.VALUE # 'END' THEN
1217 GOSUB SHOW.PRINT.MAIL.FLAGS                                     |  PO.PRT.FLG = ECD.RET.VALUE
1218 RETURN                                                          <  
1219 END                                                                END
1220 PO.PRT.FLG<1,1> = ECD.RET.VALUE                                 <  
1221 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
1222 ;*                                                              <  

1223 ;* Input Mail flag if Vendor has an email address               <  
1224 ;*                                                              <  
1225 IF VEND.EMAIL.ADDR = '' THEN RETURN                             <  
1226 ECD.NUM = 6                                                     <  
1227 ECD.DEFAULT = PO.PRT.FLG<1,2>                                   <  
1228 IF PO.PRT.FLG<1,2> = 'M' THEN ECD.VALDAT = 'Y,N,M,C'            <  
1229 IF PO.PRT.FLG<1,2> = 'C' THEN ECD.VALDAT = 'Y,N,C'              <  

1230 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = ''                              <  
1231 ECD.ACTION=4; CALL SCRN.EDIT                                    <  
1232 IF ECD.RET.VALUE = 'END' THEN                                   <  
1233 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
1234 RETURN                                                             RETURN
1235 END                                                             <  
1236 PO.PRT.FLG<1,2> = ECD.RET.VALUE                                 <  

1237 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
1238 RETURN                                                          <  
1239 *                                                               <  
1240 SHOW.PRINT.MAIL.FLAGS:                                          <  
1241 ;* Show print flag                                              <  
1242 ECD.NUM = 39                                                    <  
1243 BEGIN CASE                                                      <  

1244 CASE PO.PRT.FLG<1,1> = 'Y'                                      <  
1245 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Yes"                           <  
1246 CASE PO.PRT.FLG<1,1> = 'P'                                      <  
1247 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Print"                         <  
1248 CASE PO.PRT.FLG<1,1> = 'C'                                      <  
1249 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Copy"                          <  
1250 CASE 1                                                          <  

1251 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "No"                            <  
1252 END CASE                                                        <  
1253 ECD.ACTION = 5; CALL SCRN.EDIT                                  <  
1254 ;* Show mail flag                                               <  
1255 ECD.NUM = 6                                                     <  
1256 BEGIN CASE                                                      <  
1257 CASE PO.PRT.FLG<1,2> = 'Y'                                      <  

1258 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Yes"                           <  
1259 CASE PO.PRT.FLG<1,2> = 'M'                                      <  
1260 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Sent"                          <  
1261 CASE PO.PRT.FLG<1,2> = 'C'                                      <  
1262 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "Copy"                          <  
1263 CASE 1                                                          <  
1264 SCV.REC(ECD.NUM)<ECD.SCRN.NO> = "No"                            <  

1265 END CASE                                                        <  
1266 ECD.ACTION = 5; CALL SCRN.EDIT                                  <  
1267 RETURN                                                          <  
1268 *                                                               <  
1269 ***** GET ALL VALUES FROM FILE                                     ***** GET ALL VALUES FROM FILE
1270 1000*                                                              1000*
1271 VEND.KEY = CONO:PO.VEND.NO                                         VEND.KEY = CONO:PO.VEND.NO

1270 1000*                                                              1000*
1271 VEND.KEY = CONO:PO.VEND.NO                                         VEND.KEY = CONO:PO.VEND.NO
1272 MATREAD VEND.REC FROM VEND , VEND.KEY ELSE                         MATREAD VEND.REC FROM VEND , VEND.KEY ELSE
1273 MAT VEND.REC = "????????????????"                                  MAT VEND.REC = "????????????????"
1274 END                                                                END
1275 SCV.REC(5)<ECD.SCRN.NO,1> = PO.CODE                             <  
1276 SCV.REC(9)<ECD.SCRN.NO,1> = PO.VEND.NO                             SCV.REC(9)<ECD.SCRN.NO,1> = PO.VEND.NO
1277 SCV.REC(10)<ECD.SCRN.NO,1> = VEND.PO.DESC                          SCV.REC(10)<ECD.SCRN.NO,1> = VEND.PO.DESC
1278 SCV.REC(11)<ECD.SCRN.NO,1> = VEND.PO.ADDR1                         SCV.REC(11)<ECD.SCRN.NO,1> = VEND.PO.ADDR1
1279 SCV.REC(12)<ECD.SCRN.NO,1> = VEND.PO.ADDR2                         SCV.REC(12)<ECD.SCRN.NO,1> = VEND.PO.ADDR2

1283 SCV.REC(42)<ECD.SCRN.NO,1> = VEND.PHONE                            SCV.REC(42)<ECD.SCRN.NO,1> = VEND.PHONE
1284 SCV.REC(43)<ECD.SCRN.NO,1> = VEND.FAX                              SCV.REC(43)<ECD.SCRN.NO,1> = VEND.FAX
1285 SCV.REC(16)<ECD.SCRN.NO,1> = PO.ACCRUE                             SCV.REC(16)<ECD.SCRN.NO,1> = PO.ACCRUE
1286 SCV.REC(19)<ECD.SCRN.NO,1> = PO.DUE.DATE                           SCV.REC(19)<ECD.SCRN.NO,1> = PO.DUE.DATE
1287 SCV.REC(20)<ECD.SCRN.NO,1> = PO.VDR.ORD                            SCV.REC(20)<ECD.SCRN.NO,1> = PO.VDR.ORD
1288                                                                 >  SCV.REC(21)<ECD.SCRN.NO,1> = PO.WRIT.BY
1289 SCV.REC(22)<ECD.SCRN.NO,1> = PO.CONTACT                            SCV.REC(22)<ECD.SCRN.NO,1> = PO.CONTACT
1290 SCV.REC(23)<ECD.SCRN.NO,1> = PO.SHIP.VIA                           SCV.REC(23)<ECD.SCRN.NO,1> = PO.SHIP.VIA
1291 SCV.REC(24)<ECD.SCRN.NO,1> = PO.VIA.DESC                           SCV.REC(24)<ECD.SCRN.NO,1> = PO.VIA.DESC
1292 SCV.REC(25)<ECD.SCRN.NO,1> = PO.FOB                                SCV.REC(25)<ECD.SCRN.NO,1> = PO.FOB

1299 SCV.REC(34)<ECD.SCRN.NO,1> = PO.SHIP.ADD1                          SCV.REC(34)<ECD.SCRN.NO,1> = PO.SHIP.ADD1
1300 SCV.REC(35)<ECD.SCRN.NO,1> = PO.SHIP.ADD2                          SCV.REC(35)<ECD.SCRN.NO,1> = PO.SHIP.ADD2
1301 SCV.REC(36)<ECD.SCRN.NO,1> = FIELD(PO.SHIP.ADD3, ",",1)            SCV.REC(36)<ECD.SCRN.NO,1> = FIELD(PO.SHIP.ADD3, ",",1)
1302 SCV.REC(37)<ECD.SCRN.NO,1> = FIELD(PO.SHIP.ADD3, ",",2)            SCV.REC(37)<ECD.SCRN.NO,1> = FIELD(PO.SHIP.ADD3, ",",2)
1303 SCV.REC(38)<ECD.SCRN.NO,1> = PO.SHIP.ADD4                          SCV.REC(38)<ECD.SCRN.NO,1> = PO.SHIP.ADD4
1304 ;* T25941 v                                                     |  SCV.REC(39)<ECD.SCRN.NO,1> = PO.PRT.FLG
1305 ;* SCV.REC(39)<ECD.SCRN.NO,1> = PO.PRT.FLG                      <  
1306 GOSUB SHOW.PRINT.MAIL.FLAGS                                     <  
1307 ;* T25941 ^                                                     <  
1308 SCV.REC(40)<ECD.SCRN.NO,1> = PO.DATE                               SCV.REC(40)<ECD.SCRN.NO,1> = PO.DATE

1309 SCV.REC(41)<ECD.SCRN.NO,1> = PO.DIV.OWNER ;* TASK 19404            SCV.REC(41)<ECD.SCRN.NO,1> = PO.DIV.OWNER ;* TASK 19404
1310 SCV.REC(21)<ECD.SCRN.NO,1> = PO.WRIT.BY; * 24953                <  
1311 CALL CALC.REG.PO.TOT(CONO,TOT.ORD.AMT,XXX,YYY,ZZZ)              <  
1312 IF MENU.FLAG # "R" THEN                                         <  
1313 SCV.REC(45)<ECD.SCRN.NO,1> = OCONV(TOT.ORD.AMT,"MD2")           <  
1314 END                                                             <  
1315 IF MENU.FLAG = "R" THEN                                         <  
1316 LAST.POS = DCOUNT(PO.STATUS<1>,VM)                              <  

1317 SCV.REC(44)<ECD.SCRN.NO,1> = PO.STATUS<1,LAST.POS>              <  
1318 SCV.REC(46)<ECD.SCRN.NO,1> = PO.APPROVER                        <  
1319 SCV.REC(47)<ECD.SCRN.NO,1> = PO.ST.DATE<1,LAST.POS>             <  
1320 SCV.REC(53)<ECD.SCRN.NO,1> = PO.REQUESTOR ; *T25858             <  
1321 END                                                             <  
1322 IF MENU.FLAG # 'R' THEN                                         <  
1323 IF POS.INQ THEN                                                 <  

1324 SCV.REC(49)<ECD.SCRN.NO,1> = PO.REQUESTOR                       <  
1325 END ELSE                                                        <  
1326 SCV.REC(48)<ECD.SCRN.NO,1> = PO.REQUESTOR                       <  
1327 END                                                             <  
1328 END                                                             <  
1329 RETURN                                                             RETURN
1330 *                                                                  *

1329 RETURN                                                             RETURN
1330 *                                                                  *
1331 *---- GENERATE BARCODE LABEL DATA                                  *---- GENERATE BARCODE LABEL DATA
1332 *                                                                  *
1333 20000*                                                             20000*
1334                                                                 >  READ RL.SK.CONTROL FROM CONTROL,CONO:"RL.SK.CONTROL" ELSE
1335                                                                 >  RL.SK.CONTROL = ""
1336                                                                 >  END
1337 VALUE = "N"                                                        VALUE = "N"
1338                                                                 >  LOCATE "Y" IN RL.SK.CONTROL SETTING POS THEN

1339 PO.LINE.CNT = DCOUNT(PO.PROD.NUM,VM)                               PO.LINE.CNT = DCOUNT(PO.PROD.NUM,VM)
1340 BCFLAG=0                                                        |  GENERAL.ROLL.SKID = "Y"
1341 FOR PO.LINE.PTR=1 TO PO.LINE.CNT WHILE BCFLAG=0                 |  FOR PO.LINE.PTR = 1 TO PO.LINE.CNT WHILE GENERAL.ROLL.SKID="
1342 MATREAD INV.REC FROM INVENTORY, CONO:PO.PROD.NUM<1,PO.LINE.PTR     MATREAD INV.REC FROM INVENTORY, CONO:PO.PROD.NUM<1,PO.LINE.P
1343 MATREAD CATG.REC FROM CATEGORY,CONO:INV.LINE ELSE MAT CATG.REC  |  *           IF (INV.PAP.TYPE = 'ROLL' AND RL.SK.CONTROL<1> =
1344 IF CATG.TRK.LVL='S' AND CATG.BARCODE='Y' THEN                   |  BCFLAG = 0
1345 BCFLAG=1                                                        |  IF RL.SK.CONTROL<1>="Y" AND (INV.PAP.TYPE="ROLL" OR INV.PAP.
1346                                                                 >  IF RL.SK.CONTROL<2>="Y" AND INV.PAP.TYPE="SHEET" THEN BCFLAG

1347                                                                 >  IF BCFLAG THEN
1348                                                                 >  MATREAD CATG.REC FROM CATEGORY, CONO:INV.LINE ELSE MAT CATG.
1349                                                                 >  IF CATG.R.S.ID = "N" THEN GENERAL.ROLL.SKID="N"
1350 END                                                                END
1351 NEXT PO.LINE.PTR                                                   NEXT PO.LINE.PTR
1352 IF BCFLAG THEN                                                  |  IF GENERAL.ROLL.SKID = "N" THEN
1353 *T27552 v                                                       <  

1354 *     X=0;Y=21;TYP=8;MAXL=1;PMSG='Create BARCODE label informa  <  
1355 IF MENU.FLAG = 'R' THEN                                         <  
1356 X=0;Y=22;TYP=8;MAXL=1;PMSG='Create BARCODE label information (  <  
1357 END ELSE                                                        <  
1358 X=0;Y=21;TYP=8;MAXL=1;PMSG='Create BARCODE label information (     X=0;Y=21;TYP=8;MAXL=1;PMSG='Create BARCODE label information
1359 END                                                             <  
1360 *T27552 ^                                                       <  

1361 CALL EDIT.SUB                                                      CALL EDIT.SUB
1362 P_X= 0 ; P_Y = 21 ; P_VALUE = "" ; P_OPT = "CL"                 |  P_X  = 0 ; P_Y = 21 ; P_VALUE = "" ; P_OPT = "CL"
1363 CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)                              CALL VSI_PLINE(P_X,P_Y,P_VALUE,P_OPT)
1364 END                                                                END
1365                                                                 >  END
1366 IF VALUE = 'Y' THEN                                                IF VALUE = 'Y' THEN
1367 * 25740                                                         <  
1368 *     MATREADU RSXRF.REC FROM PO.RSKI.XREF, CONO:PO.CODE ELSE   <  

1369 MAT RSXRF.REC = ""                                                 MAT RSXRF.REC = ""
1370 *     END                                                       <  
1371 PO.LINE.CNT = DCOUNT(PO.PROD.NUM,VM)                               PO.LINE.CNT = DCOUNT(PO.PROD.NUM,VM)
1372 CNT = 0 ;* 25740                                                |  CNT = 0
1373 *     CNT = DCOUNT(RSXRF.RS.NO,VM)                              <  
1374 FOR PO.LINE.PTR = 1 TO PO.LINE.CNT                                 FOR PO.LINE.PTR = 1 TO PO.LINE.CNT
1375 LINE.CNT = 0                                                       LINE.CNT = 0
1376 MATREAD INV.REC FROM INVENTORY, CONO:PO.PROD.NUM<1,PO.LINE.PTR     MATREAD INV.REC FROM INVENTORY, CONO:PO.PROD.NUM<1,PO.LINE.P

1377 ERRMSG = "NO INVENTORY RECORD FOR PRODUCT " PO.PROD.NUM<1,PO.L     ERRMSG = "NO INVENTORY RECORD FOR PRODUCT " PO.PROD.NUM<1,PO
1378 GOSUB 91000                                                        GOSUB 91000
1379 RETURN                                                             RETURN
1380 END                                                                END
1381 MATREAD CATG.REC FROM CATEGORY, CONO:INV.LINE ELSE MAT CATG.RE     MATREAD CATG.REC FROM CATEGORY, CONO:INV.LINE ELSE MAT CATG.
1382 IF CATG.TRK.LVL='S' AND CATG.BARCODE='Y' THEN                   |  IF CATG.R.S.ID # "Y" THEN
1383 *T25940 v                                                       |  *              IF (INV.PAP.TYPE = 'ROLL' AND RL.SK.CONTROL<1
1384 *           CMD='SSELECT INV_SERIAL WITH CONO="':CONO:'" AND W  |  BCFLAG = 0
1385 *           PERFORM CMD RTNLIST ITEM.LIST CAPTURING ITEMS.MSG   |  IF RL.SK.CONTROL<1>="Y" AND (INV.PAP.TYPE="ROLL" OR INV.PAP.
1386 *** CHECK INV_SERIAL_DELETED FIRST ***                          |  IF RL.SK.CONTROL<2>="Y" AND INV.PAP.TYPE="SHEET" THEN BCFLAG

1387 SELKEY = CONO:PO.CODE:"!":PO.LINE.PTR                           |  IF BCFLAG THEN
1388 IDX = "PO_POLN_IDX"                                             |  TASK = 'SSELECT ROLL.SKID.INFO WITH CONO = "':CONO:'" AND WI
1389 SELECTINDEX IDX, SELKEY FROM INV_SERIAL_DELETED TO ITEM.LIST    |  PERFORM TASK RTNLIST ITEM.LIST CAPTURING ITEMS.MSG
1390 DONE = 0                                                           DONE = 0
1391 LOOP                                                               LOOP
1392 READNEXT KEY FROM ITEM.LIST ELSE DONE = 1                          READNEXT KEY FROM ITEM.LIST ELSE DONE = 1
1393 UNTIL DONE DO                                                      UNTIL DONE DO

1394 MATREADU ISTK.REC FROM INV_SERIAL_DELETED,KEY ELSE              |  MATREADU RSKI.REC FROM ROLL.SKID.INFO, KEY ELSE
1395 ERRMSG = 'CANNOT FIND INV_SERIAL_DELETED INFORMATION RECORD'    |  ERRMSG = 'CANNOT FIND ROLL SKID INFORMATION RECORD'
1396 GOTO 93000                                                         GOTO 93000
1397 END                                                                END
1398 *T28462 v                                                       |  GOSUB 20050
1399 IF KEY[4,1] # 'R' THEN                                          |  MATWRITE RSKI.REC ON ROLL.SKID.INFO, KEY
1400 CNT = CNT + 1                                                   <  

1401 LINE.CNT = LINE.CNT + 1                                         <  
1402 RSXRF.RS.NO<1,CNT> = KEY[4,99]                                     RSXRF.RS.NO<1,CNT> = KEY[4,99]
1403 RSXRF.LN.NO<1,CNT> = PO.LINE.PTR                                <  
1404 END                                                             <  
1405 *T28462 ^                                                       <  
1406 REPEAT                                                             REPEAT
1407 *** CHECK INV_SERIAL NEXT ***                                   |  MAT RSKI.REC = ""

1408 SELECTINDEX IDX, SELKEY FROM INV_SERIAL TO ITEM.LIST2           |  LOOP WHILE LINE.CNT < PO.NO.OF.ROLLS<1,PO.LINE.PTR> DO
1409 *T25940 ^                                                       |  READU BARCODE FROM CONTROL, CONO:"BARCODE.SEQ" ELSE BARCODE 
1410 DONE = 0                                                        |  BOK = 0
1411 LOOP                                                               LOOP
1412 READNEXT KEY FROM ITEM.LIST2 ELSE DONE = 1                      |  BARCODE = BARCODE + 1
1413 UNTIL DONE DO                                                   |  IF BARCODE > 9999999 THEN BARCODE = 1
1414 MATREADU ISTK.REC FROM INV_SERIAL,KEY ELSE                      |  BARCODE = STR("0",7-LEN(BARCODE)):BARCODE

1415 ERRMSG = 'CANNOT FIND SERIAL INFORMATION RECORD'                |  CALL CHECK.DIGIT ("C",BARCODE,"10RL",CKDIG,VALID)
1416 GOTO 93000                                                      |  IF VALID THEN
1417                                                                 >  READVU CHKREC FROM ROLL.SKID.INFO, CONO:BARCODE:CKDIG,1 ELS
E
1418 END                                                                END
1419 *T28462 v                                                       |  UNTIL BOK DO
1420 IF KEY[4,1] # 'R' THEN                                          |  RELEASE ROLL.SKID.INFO, CONO:BARCODE:CKDIG
1421 GOSUB 20050                                                     <  

1422 MATWRITE ISTK.REC ON INV_SERIAL,KEY                             <  
1423 RSXRF.RS.NO<1,CNT> = KEY[4,99]                                  <  
1424 RSXRF.LN.NO<1,CNT>=PO.LINE.PTR                                  <  
1425 END                                                             <  
1426 *T28462 ^                                                       <  
1427 REPEAT                                                             REPEAT
1428 MAT ISTK.REC=''                                                 |  WRITE BARCODE ON CONTROL, CONO:"BARCODE.SEQ"

1429 LOOP WHILE LINE.CNT < PO.NO.OF.ROLLS<1,PO.LINE.PTR> DO          <  
1430 ISTK.SEQ=GET.SERIAL.SEQ(CONO,CONTROL,INV_SERIAL)                <  
1431 ISTK.ID=CONO:ISTK.SEQ                                           <  
1432 GOSUB 20050                                                        GOSUB 20050
1433 ISTK.PRINT.DATE=''                                              |  RSKI.PRINT.DATE = ''
1434 MATWRITE ISTK.REC ON INV_SERIAL,ISTK.ID                         |  MATWRITE RSKI.REC ON ROLL.SKID.INFO, CONO:BARCODE:CKDIG
1435 RSXRF.RS.NO<1,CNT>= ISTK.SEQ                                    |  RSXRF.RS.NO<1,CNT> = BARCODE:CKDIG

1436 RSXRF.LN.NO<1,CNT>=PO.LINE.PTR                                  <  
1437 REPEAT                                                             REPEAT
1438 END                                                                END
1439                                                                 >  END
1440 NEXT PO.LINE.PTR                                                   NEXT PO.LINE.PTR
1441 IF RSXRF.RS.NO # "" THEN                                           IF RSXRF.RS.NO # "" THEN
1442 MATWRITE RSXRF.REC ON PO.RSKI.XREF, CONO:PO.CODE                   MATWRITE RSXRF.REC ON PO.RSKI.XREF, CONO:PO.CODE

1445 RETURN                                                             RETURN
1446 *                                                                  *
1447 *------------------ WRITE ROLL SKID INFO RECORD --------------     *------------------ WRITE ROLL SKID INFO RECORD ------------
1448 *                                                                  *
1449 20050*                                                             20050*
1450 IF ISTK.LOC = "" THEN                                           |  RSKI.PO.NO=PO.CODE
1451 ISTK.PO.NO=PO.CODE                                              |  RSKI.PO.LINE=PO.LINE.PTR
1452 ISTK.PO.LINE=PO.LINE.PTR                                        |  RSKI.INV.NO=PO.PROD.NUM<1,PO.LINE.PTR>
1453 ISTK.PROD=PO.PROD.NUM<1,PO.LINE.PTR>                            |  RSKI.WHSE = PO.WHSE<1,PO.LINE.PTR>
1454 ISTK.WHSE = PO.WHSE<1,PO.LINE.PTR>                              |  RSKI.UNIT = PO.UNIT.FLG<1,PO.LINE.PTR>

1455 ISTK.UOM = PO.UNIT.FLG<1,PO.LINE.PTR>                           <  
1456 ISTK.UNIT.PRICE=PO.GROS.PRICE<1,PO.LINE.PTR>                    <  
1457 END                                                             <  
1458 CNT= CNT + 1                                                       CNT= CNT + 1
1459 LINE.CNT = LINE.CNT + 1                                            LINE.CNT = LINE.CNT + 1
1460 RETURN                                                             RETURN
1461 *                                                                  *

1462 **************                                                  <  
1463 SEND.MAIL:                                                      <  
1464 **************                                                  <  
1465 *                                                               <  
1466 IF PO.APP.LEVEL # "C" THEN                                      <  
1467 SUBJECT = "Regular PO requisition ":PO.CODE :" is ready for ap  <  
1468 END ELSE                                                        <  

1469 SUBJECT = "Regular PO requisition " :PO.CODE:" has been cancel  <  
1470 END                                                             <  
1471 MATREAD SEC.REC FROM SECURITY,CONO:PO.APPROVER THEN             <  
1472 IF SEC.EMAIL # "" THEN                                          <  
1473 CMD = "!touch ":USER.ID                                         <  
1474 UDTEXECUTE CMD CAPTURING MSG                                    <  
1475 CMD = '!mail -s ':'"':SUBJECT:'" ':SEC.EMAIL:' < ':USER.ID      <  

1476 IF APP.PO.LEVEL # 1 THEN                                        <  
1477 UDTEXECUTE CMD CAPTURING MSG                                    <  
1478 END                                                             <  
1479 END                                                             <  
1480 END                                                             <  
1481 CMD ="!rm ":USER.ID                                             <  
1482 UDTEXECUTE CMD CAPTURING MSG                                    <  

1483 RETURN                                                          <  
1484 *                                                               <  
1485 *************                                                   <  
1486 SET.RELEASED:                                                   <  
1487 *************                                                   <  
1488 *                                                               <  
1489 PO.LEVEL.STATUS = "R"                                           <  

1490 PO.STATUS<1,-1> = "Released"                                    <  
1491 PO.ST.DATE<1,-1> = DATE()                                       <  
1492 PO.PREV.APP<1,-1> = USER.ID                                     <  
1493 RETURN                                                          <  
1494 *                                                               <  
1495 *************                                                   <  
1496 SET.ON.HOLD:                                                    <  

1497 *************                                                   <  
1498 *                                                               <  
1499 PO.LEVEL.STATUS = "H"                                           <  
1500 PO.STATUS<1,-1> ="On-Hold"                                      <  
1501 PO.ST.DATE<1,-1> = DATE()                                       <  
1502 PO.PREV.APP<1,-1> = USER.ID                                     <  
1503 RETURN                                                          <  

1504 *                                                               <  
1505 ****************                                                <  
1506 CHOOSE.APPROVER:                                                <  
1507 ****************                                                <  
1508 *                                                               <  
1509 IF APP.PO.LEVEL # 1 THEN                                        <  
1510 APP.ARR= '' ;*array of valid approvers                          <  

1511 SKIP.RELEASE = 0                                                <  
1512 IF OCONV(TOT.ORD.AMT,"MD2") <= APP.PO.LIMIT<1,1> OR APP.PO.LIM  <  
1513 ;* since order amt. is <= then requestor limit                  <  
1514 ;* it can be released to level 1 approver.                      <  
1515 LEVEL =1 ; ORD.TOT = OCONV(TOT.ORD.AMT,"MD2") ; APP.ARR = ""    <  
1516 USER= USER.ID ; DIV.OWNER = PO.DIV.OWNER;TYPE = 1               <  
1517 CALL FIND.APPROVERS (CONO,USER,DIV.OWNER,TYPE,LEVEL,ORD.TOT,AP  <  

1518 END ELSE                                                        <  
1519 ;*check to see if default approver is active                    <  
1520 ;*if not then look for the approver that can send req.          <  
1521 ;*directly to level 1 and make it first in the list.            <  
1522 MAT HOLD.APP.REQ.REC = MAT APP.REQ.REC                          <  
1523 USER = APP.PO.ID<1,1,1>;DIV.OWNER=PO.DIV.OWNER                  <  
1524 APP.REQ.ID = ""                                                 <  

1525 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  
1526 MAT APP.REQ.REC = MAT HOLD.APP.REQ.REC                          <  
1527 ACTIVE = RET.FLAG                                               <  
1528 IF NOT(ACTIVE) THEN                                             <  
1529 LEVEL= APP.PO.LEVEL-1;ORD.TOT=OCONV(TOT.ORD.AMT,"MD2");APP.ARR  <  
1530 USER = USER.ID ; DIV.OWNER = PO.DIV.OWNER;TYPE = 1              <  
1531 CALL FIND.APPROVERS (CONO,USER,DIV.OWNER,TYPE,LEVEL,ORD.TOT,AP  <  

1532 END                                                             <  
1533 END                                                             <  
1534 ;*now that we have a default approver get all                   <  
1535 ;*active approvers for the user and add them to the list.       <  
1536 NBR.IDS = DCOUNT(APP.PO.ID<1,1>,SVM)                            <  
1537 FOR LL =1 TO NBR.IDS                                            <  
1538 MAT HOLD.APP.REQ.REC = MAT APP.REQ.REC                          <  

1539 USER = APP.PO.ID<1,1,LL>                                        <  
1540 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  
1541 MAT APP.REQ.REC = MAT HOLD.APP.REQ.REC                          <  
1542 IF RET.FLAG = 1 THEN                                            <  
1543 LOCATE APP.REQ.ID IN APP.ARR<1>,1 SETTING JUNK ELSE             <  
1544 APP.ARR<1,-1> = APP.REQ.ID                                      <  
1545 END                                                             <  

1546 END                                                             <  
1547 NEXT LL                                                         <  
1548 ;*set default and valid approvers values                        <  
1549 ECD.DEFAULT = OCONV(APP.ARR<1,1>[4,99],"G!1")                   <  
1550 NBR.IDS = DCOUNT(APP.ARR,VM)                                    <  
1551 VALID.INPUT = ""                                                <  
1552 FOR LL = 1 TO NBR.IDS                                           <  

1553 VALID.INPUT<1,-1>=OCONV(APP.ARR<1,LL>[4,99],"G!1")              <  
1554 NEXT LL                                                         <  
1555 ;*check to see if there are any approvers active                <  
1556 IF VALID.INPUT # "" THEN                                        <  
1557 ;*locate current approver to see if change is needed            <  
1558 CHANGE.NEEDED = 0                                               <  
1559 IF PO.APPROVER # VALID.INPUT[1,1] THEN                          <  

1560 CHANGE.NEEDED = 1                                               <  
1561 END                                                             <  
1562 IF (CHANGE.NEEDED) OR OPTION = "CA" THEN                        <  
1563 VALID.INPUT = CONVERT(@VM,",",VALID.INPUT<1>)                   <  
1564 VALID.INPUT :=",???,END"                                        <  
1565 *                                                               <  
1566 EOI = 0                                                         <  

1567 LOOP                                                            <  
1568 ECD.NUM = 46                                                    <  
1569 ECD.VALDAT = VALID.INPUT                                        <  
1570 SCV.REC(46)<ECD.SCRN.NO,1> = ""                                 <  
1571 ECD.DEFAULT = OCONV(APP.ARR<1,1>[4,99],"G!1")                   <  
1572 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  
1573 BEGIN CASE                                                      <  

1574 CASE ECD.RET.VALUE = "END"                                      <  
1575 SKIP.RELEASE = 1                                                <  
1576 EOI = 1                                                         <  
1577 CASE ECD.RET.VALUE = "???"                                      <  
1578 MAT GEN.XREF.REC = ""                                           <  
1579 GXR.NAME = "APPROVER"                                           <  
1580 GXR.FILE = APP.REQ                                              <  

1581 GXR.IDLIST = APP.ARR                                            <  
1582 CALL GEN.XREF.SUB(MAT GEN.XREF.REC,PREFIX,XREF.DATA)            <  
1583 ECD.ACTION = 2 ; CALL SCRN.EDIT                                 <  
1584 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
1585 IF GXR.ID # "" THEN                                             <  
1586 GXR.ID = GXR.ID[4,99]                                           <  
1587 PO.APPROVER = OCONV(GXR.ID,"G!1")                               <  

1588 SCV.REC(46)<ECD.SCRN.NO,1>= PO.APPROVER                         <  
1589 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
1590 EOI = 1                                                         <  
1591 END                                                             <  
1592 CASE ECD.RET.VALUE # ""                                         <  
1593 EOI = 1                                                         <  
1594 PO.APPROVER = ECD.RET.VALUE                                     <  

1595 APPROVER.LIMIT = APP.PO.LIMIT<1,1>                              <  
1596 END CASE                                                        <  
1597 UNTIL (EOI) DO REPEAT                                           <  
1598 END                                                             <  
1599 END ELSE                                                        <  
1600 SKIP.RELEASE = 1                                                <  
1601 ERRMSG="No approvers available at this time. You can only file  <  

1602 GOSUB 91000                                                     <  
1603 END                                                             <  
1604 END                                                             <  
1605 RETURN                                                          <  
1606 *                                                               <  
1607 ***************                                                 <  
1608 ENT.APP.CODE:                                                   <  

1609 ***************                                                 <  
1610 *                                                               <  
1611 *T36138 v                                                       <  
1612 * IF YOU ARE MAKING CHANGES TO THE FORM YOU HAVE TO MANUALLY A  <  
1613 * password AND TURN IT OFF SETTING VALUE TO 0                   <  
1614 * TO DO THIS EDIT PMCFORMS {record name} AND LOCATE THE FIELD   <  
1615 * AND ADD IT TO THE END OF THE ATTRIBUTE. FOR PROMPT IT IS FIE  <  

1616 * IT SHOULD LOOK SOMETHING LIKE THIS                            <  
1617 * 1ÝÝ_pmc70                                                     <  
1618 * x_lenÝchar_colÝchar_rowÝchar_lengthÝhelp_stringÝcursorÝuser_  <  
1619 * riableÝ13n9n27n1551ÝÝ8Ý0Ý21Ý8ÝÝ_IBEAM.CURÝÝ0                  <  
1620 *                                                               <  
1621 *                                                               <  
1622 P_FIELDS ="_pmc70"                                              <  

1623 P_ATTRS = "password"                                            <  
1624 P_VALUES = 1                                                    <  
1625 ERROR = ""                                                      <  
1626 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
1627 IF ERROR THEN                                                   <  
1628 ERRMSG = ERROR                                                  <  
1629 GOSUB 91000                                                     <  

1630 END                                                             <  
1631 ECD.NUM = 48 ; ECD.ACTION = 4 ; CALL SCRN.EDIT                  <  
1632 CODE.OK = 1                                                     <  
1633 IF ECD.RET.VALUE = APP.CODE THEN                                <  
1634 IF APP.PO.LEVEL = 1 AND OPTION='R' THEN                         <  
1635 PO.STATUS<1,-1> = "Approved"                                    <  
1636 PO.APP.LEVEL = APP.PO.LEVEL                                     <  

1637 PO.APPROVER = ""                                                <  
1638 PO.PREV.APP<1,-1> = USER.ID                                     <  
1639 PO.ST.DATE<1,-1> = DATE()                                       <  
1640 GOSUB 1000                                                      <  
1641 ECD.ACTION = 6 ; CALL SCRN.EDIT                                 <  
1642 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
1643 P_FIELDS = "_pmc70"                                             <  

1644 P_ATTRS = "password"                                            <  
1645 P_VALUES = 0                                                    <  
1646 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
1647 IF ERROR THEN                                                   <  
1648 ERRMSG = ERROR                                                  <  
1649 GOSUB 91000                                                     <  
1650 END                                                             <  

1651 GOSUB 600                                                       <  
1652 PROMPT.NBR = 50                                                 <  
1653 END ELSE                                                        <  
1654 PO.APP.LEVEL = APP.PO.LEVEL                                     <  
1655 GOSUB 1000                                                      <  
1656 ECD.ACTION = 6 ; CALL SCRN.EDIT                                 <  
1657 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  

1658 P_FIELDS = "_pmc70"                                             <  
1659 P_ATTRS = "password"                                            <  
1660 P_VALUES = 0                                                    <  
1661 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
1662 IF ERROR THEN                                                   <  
1663 ERRMSG = ERROR                                                  <  
1664 GOSUB 91000                                                     <  

1665 END                                                             <  
1666 PROMPT.NBR = 49                                                 <  
1667 END                                                             <  
1668 END ELSE                                                        <  
1669 CODE.OK = 0                                                     <  
1670 ERRMSG = "Invalid Approval Code. "                              <  
1671 GOSUB 91000                                                     <  

1672 P_FIELDS = "_pmc70"                                             <  
1673 P_ATTRS = "password"                                            <  
1674 P_VALUES = 0                                                    <  
1675 CALL VSI_SETATTR(P_FIELDS,P_ATTRS,P_VALUES,ERROR)               <  
1676 IF ERROR THEN                                                   <  
1677 ERRMSG = ERROR                                                  <  
1678 GOSUB 91000                                                     <  

1679 END                                                             <  
1680 END                                                             <  
1681 RETURN                                                          <  
1682 *                                                               <  
1683 *                                                               <  
1684 DUPE.SUB:                                                       <  
1685 *                                                               <  

1686 ECD.NUM = 54                                                    <  
1687 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  
1688 IF ECD.RET.VALUE = "" OR ECD.RET.VALUE = "END" THEN GOTO 1      <  
1689 MATREAD PO.REC FROM REG.REQ, CONO:ECD.RET.VALUE ELSE            <  
1690 ERRMSG = 'Requisition # entered not on file'                    <  
1691 GOSUB 91000                                                     <  
1692 GOTO DUPE.SUB                                                   <  

1693 END                                                             <  
1694 USER= USER.ID; DIV.OWNER = PO.DIV.OWNER; APP.REQ.ID = ""        <  
1695 CALL CHECK.ACTIVE.STATUS (CONO,USER,DIV.OWNER,RET.FLAG,MAT APP  <  
1696 *T25854 v                                                       <  
1697 ECD.NUM = 55                                                    <  
1698 ECD.ACTION = 4 ; CALL SCRN.EDIT                                 <  
1699 PO.CODE = ECD.RET.VALUE                                         <  

1700 MATREAD PO.REC FROM PO, CONO:PO.CODE THEN                       <  
1701 IF MENU.FLAG = "R" THEN                                         <  
1702 ERRMSG = "PO with number ":PO.CODE: " already exists"           <  
1703 GOSUB 91000; RELEASE PO,CONO:PO.CODE                            <  
1704 GOTO DUPE.SUB                                                   <  
1705 END                                                             <  
1706 PORDER = 1; * this is a purchase order since found in PO file   <  

1707 END ELSE                                                        <  
1708 READ REC FROM SLIT.TRANS, CONO:PO.CODE THEN                     <  
1709 ERRMSG='Slit transaction already exists with this number'       <  
1710 GOSUB 91000; RELEASE SLIT.TRANS, CONO:PO.CODE                   <  
1711 END ELSE                                                        <  
1712 RELEASE SLIT.TRANS, CONO:PO.CODE                                <  
1713 IF CO.PO.REQ.FLAG = "Y" THEN                                    <  

1714 MATREAD PO.REC FROM REG.REQ, CONO:PO.CODE THEN                  <  
1715 IF MENU.FLAG = "P" THEN                                         <  
1716 ERRMSG = "Requisition with number ":PO.CODE:" already exists"   <  
1717 GOSUB 91000                                                     <  
1718 RELEASE REG.REQ,CONO:PO.CODE                                    <  
1719 GOTO DUPE.SUB                                                   <  
1720 END                                                             <  

1721 REQ = 1 ; * this is still requisition                           <  
1722 END                                                             <  
1723 END                                                             <  
1724 END                                                             <  
1725 IF INDEX(PO.CODE,"S",1) THEN                                    <  
1726 LENPO = LEN(PO.CODE)                                            <  
1727 NPOCODE = PO.CODE[1,LENPO-1]                                    <  

1728 IF NPOCODE # "" AND NUM(NPOCODE) THEN                           <  
1729 ERRMSG=PO.CODE:" is not allowed. Could be a Slit Trans Key."    <  
1730 GOSUB 91000 ; GOTO DUPE.SUB                                     <  
1731 END                                                             <  
1732 END                                                             <  
1733 IF REQ THEN                                                     <  
1734 MATREAD PO.REC FROM REG.REQ, CONO:PO.CODE THEN                  <  

1735 ERRMSG='Requisition with number ':PO.CODE:' already exists'     <  
1736 GOSUB 91000                                                     <  
1737 GOTO DUPE.SUB                                                   <  
1738 END                                                             <  
1739 END                                                             <  
1740 END                                                             <  
1741 IF PO.CODE = 'N' THEN                                           <  

1742 PO.STATUS = 'Entered'                                           <  
1743 END ELSE                                                        <  
1744 PO.STATUS = ''                                                  <  
1745 END                                                             <  
1746 *T25854 ^                                                       <  
1747 PO.ST.DATE = DATE()                                             <  
1748 PO.PREV.APP = USER.ID                                           <  

1749 PO.WRIT.BY = APP.NAME<1>                                        <  
1750 PO.DATE = DATE()                                                <  
1751 PO.APPROVER = ''                                                <  
1752 PO.APP.LEVEL = ''                                               <  
1753 PO.PREV.APP = ''                                                <  
1754 PO.LEVEL.STATUS = ''                                            <  
1755 IF PO.CODE = 'N' THEN NEW = 1                                   <  

1756 REQ = 1                                                         <  
1757 GOSUB 1000                                                      <  
1758 ECD.ACTION = 3 ; CALL SCRN.EDIT                                 <  
1759 GOTO 90                                                         <  
1760 **** CALLS FOR SYSCOM                                              **** CALLS FOR SYSCOM
1761 *                                                                  *
1762 91000 ERR.TYPE = 1; CALL SYSCOM(MAT SYSCOM.REC)                    91000 ERR.TYPE = 1; CALL SYSCOM(MAT SYSCOM.REC)

1763 RETURN                                                             RETURN
1764 92000 ERR.TYPE = 2; CALL SYSCOM(MAT SYSCOM.REC)                    92000 ERR.TYPE = 2; CALL SYSCOM(MAT SYSCOM.REC)
1765 RETURN                                                             RETURN
1766 93000 ERR.TYPE = 3; CALL SYSCOM(MAT SYSCOM.REC)                    93000 ERR.TYPE = 3; CALL SYSCOM(MAT SYSCOM.REC)
1767 99999 * PRINT * @(-1) * :                                          99999 * PRINT * @(-1) * :
1768 ECD.ACTION = 99; CALL SCRN.EDIT                                 <  
1769 RELEASE                                                            RELEASE
1770 RETURN                                                          |  END
1771 


POSBP/PURGE.OUTSIDE.PO                                             /vsi/cust/rev11/cbn/CBA-CBN/CBNBP/PURGE.OUTSIDE.PO
Printed for thompson at 06/28/2006 04:48:04PM

0007 * BY          - JIHAD YAMOUT , CBA                                 * BY          - JIHAD YAMOUT , CBA
0008 * DATE        - 08/22/84                                           * DATE        - 08/22/84
0009 * DESCRIPTION - THIS PROGRAM RUN FROM A PROC THAT SELECT PO FI     * DESCRIPTION - THIS PROGRAM RUN FROM A PROC THAT SELECT PO 
0010 *               THEN DELETE ALL ITEMS SELECTED.                    *               THEN DELETE ALL ITEMS SELECTED.
0011 * MOD         - TASK14974 RWW 2.14.90 PER CK                       * MOD         - TASK14974 RWW 2.14.90 PER CK
0012 *T25755 cm 04/19/2001 * Modify pgm to make sure OPO.PROD.SEQ i  |  *T23499 rick 08/23/1999 * Modify pgm to make sure OPO.PROD.S
0013 *                       when matching up detail lines              *                         when matching up detail lines
0014 *ENDDOC                                                            *ENDDOC
0015 **************************************************************     ************************************************************
0016 *** INSERT FILES EQUETES                                           *** INSERT FILES EQUETES

0049 FND = 0                                                            FND = 0
0050 PTR = 1                                                            PTR = 1
0051 LOOP                                                               LOOP
0052 LOCATE PO.NO IN JSTAT.OPO.NO<1>,PTR SETTING FND ELSE FND = 0       LOCATE PO.NO IN JSTAT.OPO.NO<1>,PTR SETTING FND ELSE FND = 0
0053 IF FND THEN                                                        IF FND THEN
0054 *T25755 v                                                       <  
0055 *              IF JSTAT.PROD.LINE<1,FND> # OPO.PROD.LINE<1,J>   <  
0056 IF JSTAT.PROD.LINE<1,FND> # OPO.PROD.LINE<1,J>:"@":OPO.PROD.SE     IF JSTAT.PROD.LINE<1,FND> # OPO.PROD.LINE<1,J>:"@":OPO.PROD.
0057 *T25755 ^                                                       <  
0058 PTR = FND + 1                                                      PTR = FND + 1


