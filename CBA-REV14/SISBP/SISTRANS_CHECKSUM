*COPY>SIS.CPYLIB>SIS_TRANS
*COPY>SIS.CPYLIB>SISMSG
*COPY>CPYLIB>CHAR
   OPEN '','SIS_TRANS' TO SIS_TRANS ELSE STOP
   OPEN '','SIS_INPUT' TO SIS_INPUT ELSE STOP
   OPEN '','SIS_CONTROL' TO SIS_CONTROL ELSE STOP
*
   READU TREC FROM SIS_CONTROL, "MSG_LOCK" THEN
      KILL_PROCESS = 0
   END LOCKED
      KILL_PROCESS = 1
   END ELSE
      KILL_PROCESS = 0
   END
   IF KILL_PROCESS THEN
      CRT @(0,10) : CL : "SIS_CONTROL (MSG_LOCK) record is Locked"
      STOP
   END
*
   PRINTER ON
   SELECT SIS_INPUT
100*
   READNEXT ID ELSE
      RELEASE SIS_CONTROL, "MSG_LOCK"
      PRINTER OFF
      STOP
   END
   MATREADU SISMSG_REC FROM SIS_INPUT, ID THEN
      SKIP_TRN = 0
      BEGIN CASE
         CASE SISMSG_MESSAGE # "Test"
            SKIP_TRN = 1
         CASE SISMSG_FILE # "SIS_Trans"
            SKIP_TRN = 1
         CASE SISMSG_ITEM = ""
            SKIP_TRN = 1
         CASE 1
      END CASE
      IF SKIP_TRN THEN
         RELEASE SIS_INPUT, ID
         GOTO 100
      END
   END LOCKED
      CRT ID :", SIS_INPUT is locked"
      GOTO 100
   END ELSE
      RELEASE SIS_INPUT, ID
      CRT ID :", SIS_INPUT is missing"
      GOTO 100
   END
*
   MATREADU SISTRN_REC FROM SIS_TRANS, ID THEN
      SKIP_TRN = 0
      BEGIN CASE
         CASE SISMSG_CONO # SISTRN_CONO
            SKIP_TRN = 1
         CASE SISMSG_SERVER # SISTRN_SERVER
            SKIP_TRN = 1
         CASE SISMSG_CLIENT # SISTRN_CLIENT
            SKIP_TRN = 1
         CASE SISMSG_ITEM # SISTRN_TRANSID
            SKIP_TRN = 1
         CASE 1
      END CASE
      IF SKIP_TRN THEN
         CRT ID :", SIS_INPUT/SIS_TRANS mismatch"
         RELEASE SIS_INPUT, ID
         RELEASE SIS_TRANS, ID
         GOTO 100
      END
      TOT_CHKSUM = 0
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_TRANSID)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_TIMESTMP)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_TTYPE)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_DIV)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_DEPT)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_CCTR)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_JOB)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_EMP)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_SHIFT)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_OPER)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_UNITS)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_COMPLETE)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_SPOILAGE)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_CLASS)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_TCODE)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_OT_CODE)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_BARCODE)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_PROD)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_WHSE)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_LOC)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_SKID)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_QTYPE)
      BEGIN CASE
         CASE SISTRN_QTY = ""
            TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_QTY)
         CASE ("X":SISTRN_QTY) = "X0"
            TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_QTY)
         CASE (SISTRN_QTY/1000) = INT(SISTRN_QTY/1000)
            TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(OCONV((SISTRN_QTY/10), "MD2"))
         CASE (SISTRN_QTY/10) = INT(SISTRN_QTY/10)
            TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(OCONV((SISTRN_QTY/10), "MD2"))
         CASE 1
            TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_QTY/1000)
      END CASE
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_COMMENTS)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_UPLOAD)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_CONO)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_SERVER)
      TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_CLIENT)
      JCNT = DCOUNT(SISTRN_MJ_JOB,VM)
      FOR JP = 1 TO JCNT
         TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_MJ_JOB<1,JP>)
      NEXT JP
      MCNT = DCOUNT(SISTRN_MP_PROD,VM)
      SCNT = DCOUNT(SISTRN_MP_SKID,VM)
      IF SCNT > MCNT THEN MCNT = SCNT
      FOR MP = 1 TO MCNT
         TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_MP_PROD<1,MP>)
         TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_MP_WHSE<1,MP>)
         TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_MP_LOC<1,MP>)
         TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_MP_SKID<1,MP>)
         TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_MP_QTYPE<1,MP>)
*        TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_MP_QTY<1,MP>/1000)
         BEGIN CASE
            CASE SISTRN_MP_QTY<1,MP> = ""
               TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_MP_QTY<1,MP>)
            CASE ("X":SISTRN_MP_QTY<1,MP>) = "X0"
               TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_MP_QTY<1,MP>)
            CASE (SISTRN_MP_QTY<1,MP>/1000) = INT(SISTRN_MP_QTY<1,MP>/1000)
               TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(OCONV((SISTRN_MP_QTY<1,MP>/10), "MD2"))
            CASE (SISTRN_MP_QTY<1,MP>/10) = INT(SISTRN_MP_QTY<1,MP>/10)
               TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(OCONV((SISTRN_MP_QTY<1,MP>/10), "MD2"))
            CASE 1
               TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_MP_QTY<1,MP>/1000)
         END CASE
      NEXT MP
      PCNT = DCOUNT(SISTRN_PRMPT.CODE,VM)
      FOR PP = 1 TO PCNT
         TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_PRMPT.CODE<1,PP>)
         TOT_CHKSUM = TOT_CHKSUM + CHECKSUM(SISTRN_PRMPT.RESP<1,PP>)
      NEXT PP
      TOT_CHKSUM = MOD(TOT_CHKSUM,32767);* INTEGER MAX NUMBER IS 32767
      IF SISMSG_CHECKSUM # TOT_CHKSUM THEN
         CRT ID :", ": SISMSG_CHECKSUM :", ": TOT_CHKSUM
*
         PRINT NEW.PAGE
         PRINT ID :", ": SISMSG_CHECKSUM :", ": TOT_CHKSUM
         PRINT
         PRINT "TRANSID" "L#30 " : CHECKSUM(SISTRN_TRANSID)
         PRINT "TIMESTMP" "L#30 " : CHECKSUM(SISTRN_TIMESTMP)
         PRINT "TTYPE" "L#30 " : CHECKSUM(SISTRN_TTYPE)
         PRINT "DIV" "L#30 " : CHECKSUM(SISTRN_DIV)
         PRINT "DEPT" "L#30 " : CHECKSUM(SISTRN_DEPT)
         PRINT "CCTR" "L#30 " : CHECKSUM(SISTRN_CCTR)
         PRINT "JOB" "L#30 " : CHECKSUM(SISTRN_JOB)
         PRINT "EMP" "L#30 " : CHECKSUM(SISTRN_EMP)
         PRINT "SHIFT" "L#30 " : CHECKSUM(SISTRN_SHIFT)
         PRINT "OPER" "L#30 " : CHECKSUM(SISTRN_OPER)
         PRINT "UNITS" "L#30 " : CHECKSUM(SISTRN_UNITS)
         PRINT "COMPLETE" "L#30 " : CHECKSUM(SISTRN_COMPLETE)
         PRINT "SPOILAGE" "L#30 " : CHECKSUM(SISTRN_SPOILAGE)
         PRINT "CLASS" "L#30 " : CHECKSUM(SISTRN_CLASS)
         PRINT "TCODE" "L#30 " : CHECKSUM(SISTRN_TCODE)
         PRINT "OT_CODE" "L#30 " : CHECKSUM(SISTRN_OT_CODE)
         PRINT "BARCODE" "L#30 " : CHECKSUM(SISTRN_BARCODE)
         PRINT "PROD" "L#30 " : CHECKSUM(SISTRN_PROD)
         PRINT "WHSE" "L#30 " : CHECKSUM(SISTRN_WHSE)
         PRINT "LOC" "L#30 " : CHECKSUM(SISTRN_LOC)
         PRINT "SKID" "L#30 " : CHECKSUM(SISTRN_SKID)
         PRINT "QTYPE" "L#30 " : CHECKSUM(SISTRN_QTYPE)
         PRINT "QTY" "L#30 " : CHECKSUM(SISTRN_QTY/1000)
         PRINT "COMMENTS" "L#30 " : CHECKSUM(SISTRN_COMMENTS)
         PRINT "UPLOAD" "L#30 " : CHECKSUM(SISTRN_UPLOAD)
         PRINT "CONO" "L#30 " : CHECKSUM(SISTRN_CONO)
         PRINT "SERVER" "L#30 " : CHECKSUM(SISTRN_SERVER)
         PRINT "CLIENT" "L#30 " : CHECKSUM(SISTRN_CLIENT)
         JCNT = DCOUNT(SISTRN_MJ_JOB,VM)
         FOR JP = 1 TO JCNT
            IF JP = 1 THEN
               PRINT "Multi Jobs"
            END
            VLINE = JP "R#3 "
            VLINE = VLINE : CHECKSUM(SISTRN_MJ_JOB<1,JP>)
            PRINT VLINE
         NEXT JP
         MCNT = DCOUNT(SISTRN_MP_PROD,VM)
         SCNT = DCOUNT(SISTRN_MP_SKID,VM)
         IF SCNT > MCNT THEN MCNT = SCNT
         FOR MP = 1 TO MCNT
            IF MP = 1 THEN
               PRINT "Multi Products"
            END
            VLINE = MP "R#3 "
            VLINE = VLINE : CHECKSUM(SISTRN_MP_PROD<1,MP>) "L#5 "
            VLINE = VLINE : CHECKSUM(SISTRN_MP_WHSE<1,MP>) "L#5 "
            VLINE = VLINE : CHECKSUM(SISTRN_MP_LOC<1,MP>) "L#5 "
            VLINE = VLINE : CHECKSUM(SISTRN_MP_SKID<1,MP>) "L#5 "
            VLINE = VLINE : CHECKSUM(SISTRN_MP_QTYPE<1,MP>) "L#5 "
            IF (SISTRN_MP_QTY<1,MP>/1000) = INT(SISTRN_MP_QTY<1,MP>/1000) THEN
               VLINE = VLINE : CHECKSUM(OCONV((SISTRN_MP_QTY<1,MP>/10), "MD2"))
            END ELSE
               VLINE = VLINE : CHECKSUM(SISTRN_MP_QTY<1,MP>/1000)
            END
            PRINT VLINE
         NEXT MP
         PCNT = DCOUNT(SISTRN_PRMPT.CODE,VM)
         FOR PP = 1 TO PCNT
            IF PP = 1 THEN
               PRINT "Multi Prompts"
            END
            VLINE = PP "R#3 "
            VLINE = VLINE : CHECKSUM(SISTRN_PRMPT.CODE<1,PP>) "L#5 "
            VLINE = VLINE : CHECKSUM(SISTRN_PRMPT.RESP<1,PP>)
            PRINT VLINE
         NEXT PP
      END ELSE
         CRT ID :", ": TOT_CHKSUM
      END
   END LOCKED
      CRT ID :", SIS_TRANS is locked"
   END ELSE
      CRT ID :", SIS_TRANS is missing"
   END
   RELEASE SIS_TRANS, ID
   RELEASE SIS_INPUT, ID
   GOTO 100
END
