INCLUDE INCS GLOBAL.EQUATES
PRINT "Enter First File  :":
INPUT FN1
PRINT "Enter First Item  :":
INPUT IT1
PRINT "Enter Second File :":
INPUT FN2
PRINT "Enter First Item  :":
INPUT IT2
*-----
GET.FLAG:
*-----
PRINT "List (M)atches or (D)ifferences?:":
INPUT DIFF.FLAG
IF DIFF.FLAG # 'D' AND DIFF.FLAG # 'M' THEN
  PRINT BELL:"Invalid Response"
  GOTO GET.FLAG
END
IF DIFF.FLAG = 'D' THEN DIFF.FLAG = TRUE ELSE DIFF.FLAG = FALSE
OPEN FN1 TO F1 ELSE
  PRINT BELL:"Unable to Open ":FN1
  STOP
END
OPEN FN2 TO F2 ELSE
  PRINT BELL:"Unable to Open ":FN2
  STOP
END
SELECT F1
DONE = FALSE
REC.COUNT = 0
REC.COUNT = 0
HIT.LIST = ''
HIT.COUNT = 0
DONE = FALSE
LOOP
  READNEXT ID ELSE DONE = TRUE
UNTIL DONE DO
  IF REM(REC.COUNT,100) = 0 THEN PRINT @(0,20):@(-3):REC.COUNT"R#7":" Records, ":HIT.COUNT"R#7":" Hits"
  REC.COUNT = REC.COUNT + 1
  READ REC1 FROM F1, IT1 ELSE REC1 = ''
  READ REC2 FROM F2, IT2 ELSE REC2 = ''
  IF REC1 # REC2 THEN
    DIFF = TRUE
S.ATTR = 1
    IF DIFF = DIFF.FLAG THEN GOSUB FIND.DIFF.ATTRS
  END ELSE
    DIFF = FALSE
  END
  IF DIFF = DIFF.FLAG THEN
    HIT.LIST<-1> = ID
    HIT.COUNT = HIT.COUNT + 1
  END
REPEAT
PRINT "Compare Complete -- "
PRINT REC.COUNT"R#7":" Records,"
PRINT HIT.COUNT"R#7":" Mismatches"
WRITE HIT.LIST ON F1, "@@@ID@@@"
EXECUTE "QSELECT ":FN1:" @@@ID@@@"
EXECUTE "SAVE-LIST COMP@":FN1:"@":FN2
DELETE F1, "@@@ID@@@"
STOP
*----
FIND.DIFF.ATTRS:
*----
NUM.ATTRS = DCOUNT(REC1, AM)
FOR I = S.ATTR TO S.ATTR+20 UNTIL I > NUM.ATTRS
  PRINT I"R#3":" ":REC1<I>"L#35":" ! ":REC2<I>"L#35"
NEXT I
INPUT WAIT
BEGIN CASE
  CASE WAIT = 'N'
    S.ATTR = S.ATTR + 20
  CASE WAIT = 'P'
    S.ATTR =S.ATTR - 20
    IF S.ATTR < 1 THEN S.ATTR = 1
  CASE TRUE
END CASE
GOTO FIND.DIFF.ATTRS
RETURN
