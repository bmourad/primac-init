INCLUDE INCS GLOBAL.EQUATES
*
*-----
GET.FNAME:
*-----
PRINT "Enter File to Search:":
INPUT FNAME
IF FNAME = '^' THEN STOP
IF FIELD(FNAME, ',', 2) # '' THEN DD = 'DATA' ELSE DD = ''
OPEN DD, FNAME TO FILEVAR ELSE
  PRINT BELL:"File not found"
  STOP
END
PRINT "Enter Search String :":
INPUT STRING
IF STRING = '^' THEN GOTO GET.FNAME
SRCH.LIST = ''
NUM.SRCH = DCOUNT(STRING, '\')
FOR I = 1 TO NUM.SRCH
  TT = FIELD(STRING,'\',I)
  IF TT[1,2] = '0x' THEN
    TT = CHAR(TT[3,99])
  END
  SRCH.LIST<-1> = TT
NEXT I
*
SELECT FILEVAR
REC.COUNT = 0
HIT.LIST = ''
HIT.COUNT = 0
DONE = FALSE
LOOP
  READNEXT ID ELSE DONE = TRUE
UNTIL DONE DO
  IF REM(REC.COUNT,100) = 0 THEN PRINT @(0,20):@(-3):REC.COUNT"R#7":" Records, ":HIT.COUNT"R#7":" Hits"
  REC.COUNT = REC.COUNT + 1
  READ REC FROM FILEVAR, ID THEN
    HIT = TRUE
    FOR I = 1 TO NUM.SRCH
      TT = INDEX(REC, SRCH.LIST<I>, 1)
      IF TT = 0 THEN HIT = FALSE
    NEXT I
    IF HIT THEN
      HIT.LIST<-1> = ID
      HIT.COUNT = HIT.COUNT + 1
    END
  END
REPEAT
PRINT "Search Complete -- "
PRINT REC.COUNT"R#7":" Records,"
PRINT HIT.COUNT"R#7":" Hits"
IF HIT.LIST # '' THEN
  WRITE HIT.LIST ON FILEVAR, "@@@ID@@@"
  EXECUTE "QSELECT ":FNAME:" @@@ID@@@"
  EXECUTE "SAVE-LIST SEARCH@":FNAME
  DELETE FILEVAR, "@@@ID@@@"
  CHAIN "GET-LIST SEARCH@":FNAME
END
