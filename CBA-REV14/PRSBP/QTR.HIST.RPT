*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - PRSBP
* PROGRAM     - QTR.HIST.RPT
* BY          - WALID YAMOUT, CBA
* DATE        - 06/11/85
* DESCRIPTION - Prints the Quarterly History Report
* MOD         - CSF11265 RWW 12.27.89
*********************************************************************
*ENDDOC
*COPY>PMC.CPYLIB>EMPLOYEE
*COPY>PRS.CPYLIB>QHR
*COPY>CPYLIB>CHAR
      PROCREAD X ELSE PRINT "CANNOT READ INPUT BUFFER";INPUT X;STOP
      CONO=X<1>
      CO.NAME=X<2>
      OPTION=X<3>
      OPEN "EMPLOYEE" TO EMPLOYEE ELSE PRINT "CAN'T OPEN EMPLOYEE":;INPUT R;STOP
      OPEN "QHR" TO QHR ELSE PRINT "CAN'T OPEN QHR":;INPUT R;STOP
      HOLD=""
*
*---- HEADING ROUTINE
*
      POS1 = 51 - INT(LEN(CO.NAME)/2)
      POS2 = 26 + INT(LEN(CO.NAME)/2)
      HEAD1 = "DATE - " : OCONV(DATE(), "D2/") "L#8" :SPACE(POS1): CO.NAME "L#30" :SPACE(POS2): "PAGE - 'PL'"
      DIM T(15),TOT(30,2)
      IF OPTION = "C" THEN
         HEAD2 = SPACE(45):"P A Y R O L L   H I S T O R Y    R E P O R T (CLEAR)'LL'"
      END ELSE
         HEAD2 = SPACE(45):"P A Y R O L L   H I S T O R Y    R E P O R T'LL'"
      END
      S2="PERIOD   TOT GROSS":SPACE(6):"FWHT":SPACE(4):"FICA":SPACE(3):"DIAB":SPACE(3):"STATE"
      S2=S2:"  AMOUNT CD  AMOUNT CD  AMOUNT CD  AMOUNT CD  AMOUNT CD"
      S2=S2:SPACE(5):"NET   RG HRS  OT HRS"
*     S2=S2:SPACE(5):"EIC     TOT DED      NET PAY    REG HR   OT HR"
      PRINTER ON
      HEADING HEAD1 : HEAD2
      EOJ = ""
      MAT TOT=""
      FIRST = 1
      FLAG = 0
      COUNT = 0
300*
      READNEXT ID ELSE
         IF FIRST THEN STOP
         EOJ = "YES"
         GOTO 2000
      END
      IF ID[1,3] # CONO THEN GOTO 300
      MAT QHR.REC = ""
      MATREAD QHR.REC FROM QHR,ID ELSE GOTO 300
      EMP.NO = ID[4,4]
      IF FIRST THEN GOTO 2100
      IF HOLD#EMP.NO THEN GOTO 2000
500*
      NET=QHR.GROSS-QHR.TOTDED-QHR.EIC
      NET = NET - QHR.FWHT
      NET = NET - QHR.FICA
      NET = NET - QHR.SUI
      NET = NET - QHR.STATE
      NET = NET - QHR.CITY
*CSF11265
      NET=NET-SUM(QHR.MISC.AMT)
*
      IF QHR.PER.END#"" THEN NULL ELSE PRINT QHR.PERIOD"R##":"      ":;GOTO 123
      PRINT QHR.PERIOD"R##":" ":OCONV(QHR.PER.END,"D2/ýT1,5"):
123*
      PRINT OCONV(QHR.GROSS,"MD2,")"R#10":"  ":OCONV(QHR.FWHT,"MD2,")"R#8":" ":OCONV(QHR.FICA,"MD2")"R#7":
      PRINT " ":OCONV(QHR.SUI,"MD2")"R#6":" ":OCONV(QHR.STATE,"MD2")"R#7":
*     PRINT OCONV(QHR.EIC,"MD2")"R#8":
*     PRINT "   ":OCONV(QHR.TOTDED,"MD2,")"R#8":" ":OCONV(NET,"MD2,")"R#9":" ":
      COL="1";CODE="";XX="1"
*
*---- TEST FOR OLD PAYROLL
*
      IF QHR.CITY="" THEN GOTO 156;* CITY TAX
      CD="CT";CC=QHR.CITY
      FLAG="1";GOSUB 126;FLAG="0"
156*
      IF QHR.EIC="" THEN GOTO 166;* EARNED INCOME CREDIT
      IF QHR.EIC="0" THEN GOTO 166
      CD="EI";CC=QHR.EIC
      FLAG="1";GOSUB 126;FLAG="0"
166*
      IF QHR.TOTDED="" THEN GOTO 678;* TOTAL DEDUCTIONS
      IF QHR.TOTDED="0" THEN GOTO 678
      CD="TM";CC=QHR.TOTDED
      FLAG="1";GOSUB 126;FLAG="0";OLD="1"
678*
      CD=QHR.MISC.CODE<1,XX>
      IF CD="" THEN GOTO 681
126*
      IF LEN(CD)="1" THEN CD=CD:" "
      IF COL="6" THEN
         COL="1";PRINT;PRINT SPACE(51):
      END
      IF FLAG=1 THEN GOTO 121
      CC=QHR.MISC.AMT<1,XX>
121*
      PRINT OCONV(CC,"MD2")"R#8":" ":CD:
      COL=COL+1
*
*---- LOCATE SAME OR NEW MISC DED TOTAL AREA
*
      BB=1
122*
      DD=TOT(BB,1)
      IF DD = "" OR DD=CD THEN GOTO 133
      BB=BB+1
      IF BB>30 THEN
         PRINT;PRINT"DEDUCTION NOT ADDED":;GOTO 777
      END
      GOTO 122
133*
      TOT(BB,1)=CD
      TOT(BB,2)=TOT(BB,2)+CC
777*
      IF FLAG=1 THEN RETURN
      XX=XX+1; GOTO 678
681*
      YY=COL*10;YY=YY-10;YY=56-YY;YY=YY-COL
      PRINT SPACE(YY):
      PRINT OCONV(NET,"MD2")"R#9":
      PRINT OCONV(QHR.REG.HRS,"MD2")"R#8":OCONV(QHR.OTDT.HRS,"MD2")"R#8"
*
*---- MANUAL FLAG
*
      T(1)=T(1)+QHR.GROSS;T(2)=T(2)+QHR.FWHT;T(3)=T(3)+QHR.FICA;T(4)=T(4)+QHR.SUI
      T(5)=T(5)+QHR.STATE;T(6)=T(6)+QHR.CITY;T(7)=T(7)+QHR.TOTDED;T(8)=T(8)+NET
      T(9)=T(9)+QHR.REG.HRS;T(10)=T(10)+QHR.OTDT.HRS
      T(11)=T(11)+QHR.EIC
      GOTO 300
*
*---- EMPLOYEE BREAK
2000*
      PRINT
      PRINT "TOTALS:":OCONV(T(1),"MD2,")"R#11":" ":OCONV(T(2),"MD2,")"R#9":
      PRINT OCONV(T(3),"MD2")"R#8":OCONV(T(4),"MD2")"R#7":OCONV(T(5),"MD2")"R#8":
*     PRINT OCONV(T(11),"MD2")"R#8":"  ":OCONV(T(7),"MD2")"R#8":OCONV(T(8),"MD2")"R#9":
      PRINT SPACE(55):
      PRINT OCONV(T(8),"MD2")"R#9":
      PRINT OCONV(T(9),"MD2")"R#8":OCONV(T(10),"MD2")"R#8"
      PRINT
      WW=1;NUMB=1
      PRINT "MISC DED    ":
155*
      IF TOT(WW,2)="" THEN GOTO 144
*     PRINT TOT(WW,2)"R2#8":" ":TOT(WW,1):" ":
      QQ=TOT(WW,2)
      QQ=QQ/100
      PRINT QQ"R2#8":" ":TOT(WW,1):" ":
      WW=WW+1
      IF WW>30 THEN GOTO 144
      NUMB=NUMB+1
      IF NUMB>11 THEN
         PRINT;PRINT SPACE(12):
         NUMB=1
      END
      GOTO 155
144*
      PRINT
      MAT TOT=""
      IF EOJ = "YES" THEN STOP
      PRINT;PRINT;PRINT;PRINT
      COUNT=COUNT+1
*     IF COUNT>=2 THEN PAGE;COUNT=0
      IF COUNT>=1 THEN PAGE;COUNT=0
2100*
      MAT T = 0; HOLD = EMP.NO; FIRST = 0
      MATREAD EMP.REC FROM EMPLOYEE, CONO:EMP.NO ELSE MAT EMP.REC = ""
      NAME = EMP.FRST.NAME :" ": EMP.LAST.NAME
      PRINT "  EMPLOYEE NO: ":EMP.NO"R#4":"  SOC. SEC NO. ":EMP.SOC.SEC"L#11":"     NAME: ":NAME
      PRINT SPACE(53):"** M I S C E L L A N E O U S     D E D U C T I O N S **   "
      PRINT S2;PRINT
      GOTO 500
   END
