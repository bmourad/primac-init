*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM     - PRIMAC
* SOURCE     - PRSBP
* PROGRAM    - BOND.RPT
* BY         - WALID YAMOUT , C.B.A
* DATE       - 06/11/85
* DESCRIPTION-
*T22547 stefanie 03/17/1998 * Change text from Monthly to Period.
*ENDDOC
*********************************************************************
*
*--- INSERT FILES EQUETES
*
*COPY>PMC.CPYLIB>EMPLOYEE
*COPY>PRS.CPYLIB>MDS
*COPY>CPYLIB>CHAR
      PROCREAD X ELSE PRINT "CANNOT READ INPUT BUFFER";INPUT X;STOP
      CONO=EXTRACT(X,1,0,0)
      CO.NAME = EXTRACT(X,2,0,0)
      OPEN "","PAYTYPE" TO PAYTYPE ELSE PRINT "CAN'T OPEN PAYTYPE";STOP
      OPEN "","MDS" TO MDS ELSE PRINT "CAN'T OPEN MDS";STOP
      OPEN "","EMPLOYEE" TO EMPLOYEE ELSE PRINT "CAN'T OPEN EMPLOYEE";STOP
      DIM T(15),BOND.REC(10)
      EQUATE T1 TO T(1),T2 TO T(2),T3 TO T(3),T4 TO T(4),T5 TO T(5),T6 TO T(6),T7 TO T(7),T8 TO T(8),T9 TO T(9),T10 TO T(10),T11 TO T(11)
      MATREAD BOND.REC FROM PAYTYPE, CONO:"BONDS" ELSE PRINT "CAN'T READ PAYTYPE";STOP
*****
** HEADING ROUTINE
      POS1 = 51 - INT(LEN(CO.NAME)/2)
      POS2 = 26 + INT(LEN(CO.NAME)/2)
      HEAD1 = "DATE - " : OCONV(DATE(), "D2/") "L#8" :SPACE(POS1): CO.NAME "L#30" :SPACE(POS2): "PAGE - 'PL'"
*T22547 >       HEAD2 = SPACE(47):"M O N T H L Y   B O N D   R E P O R T'LL'"
      HEAD2 = SPACE(47):" P E R I O D   B O N D   R E P O R T'LL'"
      HEAD3 = SPACE(37):"BOND   PRIOR     CURR     NEW":SPACE(55):"AMT OF'L'EMPLOYEE NUMBER & NAME"
      HEAD3 = HEAD3 :SPACE(15): "TYPE  BALANCE   DEDUCT  BALANCE"
      FOR Y = 1 TO 7
        TEMP = OCONV(BOND.REC(Y), "MD2")
        HEAD3 = HEAD3 :" ": STR(" ",6-LEN(TEMP)) : TEMP
      NEXT Y
      HEAD3 = HEAD3 : "  PURCHASE'L'"
      PRINTER ON
      HEADING HEAD1 : HEAD2 : HEAD3
      MAT T = ""
*****
300*
      READNEXT ID ELSE GOTO 4000
      IF ID[1,3] # CONO THEN GOTO 300
      EMP.NO = ID[4,4]
      MAT EMP.REC = ""
      MATREAD EMP.REC FROM EMPLOYEE,ID ELSE GOTO 300
      MATREAD MDS.REC FROM MDS, CONO : EMP.NO : EMP.DIV : EMP.DEPT :"!": EMP.COST.CNTR ELSE MAT MDS.REC = ""
      NAME=EMP.FRST.NAME:" ":EMP.LAST.NAME;L=0;PUR=0
      PRIORXX=EMP.BONDS<1,2>-MDS.BONDS
      IF EMP.BONDS<1,3> > EMP.BONDS<1,2> THEN GOTO 520
510   L=L+1
      EMP.BONDS<1,2>=EMP.BONDS<1,2>-EMP.BONDS<1,3>;PUR=PUR+EMP.BONDS<1,3>
      IF EMP.BONDS<1,2>>=EMP.BONDS<1,3> THEN GOTO 510
520   IF EMP.BONDS<1,3>=0 AND PUR=0 THEN GOTO 300
      PRINT EMP.NO"R#4":" ":NAME"L#27":"  ":OCONV(EMP.BONDS<1,3>,"MD2")"R#7":"  ":
      PRINT OCONV(PRIORXX,"MD2")"R#7":"  ":OCONV(MDS.BONDS,"MD2")"R#7":"  ":
      PRINT OCONV(EMP.BONDS<1,2>,"MD2")"R#6":SPACE(5):
      FOR Y=1TO 7
         IF EMP.BONDS<1,3>=BOND.REC(Y) THEN
            T(Y+3)=T(Y+3)+L
            PRINT SPACE(7*Y-7):L"R##":SPACE(46-(7*Y-7)):OCONV(PUR,"MD2")"R#7":
            GOTO 540
         END
      NEXT Y
540   T1=T1+PRIORXX;T2=T2+MDS.BONDS;T3=T3+EMP.BONDS<1,2>;T11=T11+PUR
      PRINT
      GOTO 300
*****
** COMPANY BREAK
*****
4000  PRINT;PRINT
      PRINT SPACE(34):"TOTALS: ":OCONV(T1,"MD2")"R#8":" ":
      PRINT OCONV(T2,"MD2")"R#8":" ":OCONV(T3,"MD2")"R#7":" ":
      PRINT SPACE(4):T4"R##":SPACE(5):T5"R##":SPACE(5):T6"R##":
      PRINT SPACE(5):T7"R##":SPACE(5):T8"R##":SPACE(5):T9"R##":
      PRINT SPACE(5):T10"R##":"   ":OCONV(T11,"MD2")"R#8"
      PRINTER CLOSE
      PRINTER OFF
   END
