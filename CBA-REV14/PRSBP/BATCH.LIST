**************************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM     - PRIMAC
* SOURCE     - PRSBP
* PROGRAM    - BATCH.LIST
* BY         - WALID YAMOUT , C.B.A
* DATE       - 06/11/85
* DESCRIPTION-
* LAST COMPILE - 231
*ENDDOC
**************************************************************************
*
*--- INSERT FILES EQUETES
*
*COPY>PRS.CPYLIB>PAYROLL.HOURS
*COPY>PMC.CPYLIB>EMPLOYEE
*COPY>PRS.CPYLIB>PAYREG
*COPY>CPYLIB>CHAR
********
     OPEN "","EMPLOYEE" TO EMPLOYEE ELSE PRINT "CAN'T OPEN EMPLOYEE";STOP
     OPEN "","PAYREG" TO PAYREG ELSE PRINT "CAN'T OPEN PAYREG";STOP
     OPEN "","CONTROL" TO CONTROL ELSE PRINT "CAN'T OPEN CONTROL";STOP
     PROCREAD X ELSE PRINT "MUST COME FROM PROC  -  HIT RETURN":;INPUT X;STOP
    CONO=X<1>
    CO.NAME = X<2>
    MATREAD HRS.REC FROM CONTROL, CONO:"PAYROLL.HOURS" ELSE PRINT "PAYROLL.HOURS NOT ON CONTROL"; STOP
    HRS.CNT = COUNT(HRS.DESC,VM) + (HRS.DESC # "")
    IF HRS.CNT < 1 OR HRS.CNT > 11 THEN
      PRINT "ERROR IN PAYROLL.HOURS ON CONTROL"
      STOP
    END
DIM D(15),T(15),TOT(15),RTOT(15)
*     ARRAY 'TOT' DEFINED BUT NOT REFERENCED!!
*     ARRAY 'RTOT' DEFINED BUT NOT REFERENCED!!
MAT EMP.REC="";MAT RTOT="";MAT PAY.REC="";MAT D="";MAT T="";MAT TOT=""
     LAST=0;TOTHRS=0;TOTERN=0;BATHOLD=""
**HEADING
     SP1 = SPACE(1)
     SP2 = SPACE(2)
     DASH3 = STR("-",3)
     DASH4 = STR("-",4)
     DASH7 = STR("-",7)
     POS1 = 51 - INT(LEN(CO.NAME)/2)
     POS2 = 26 + INT(LEN(CO.NAME)/2)
     HEAD1 = "DATE - " : OCONV(DATE(), "D2/") "L#8"
     HEAD1 = HEAD1 : SPACE(POS1) : CO.NAME "L#30"
     HEAD1 = HEAD1 : SPACE(POS2) : "PAGE : 'P'":"'L'"
     HEAD2 = SPACE(36): "W E E K L Y   B A T C H   L I S T I N G":"'LL'"
     HEAD3 = "EMP#" :SP2: "SALARY/RATE" :SP2: "SHIFT" :SP1
     HEAD4 = DASH4 :SP2: DASH4:DASH7 :SP2: "-----" :SP1
     FOR H = 1 TO HRS.CNT
       NAME = STR(" ",INT((7-LEN(HRS.SHORT<1,H>))/2)):HRS.SHORT<1,H>
       HEAD3 = HEAD3 :SP1: NAME "L#7"
       HEAD4 = HEAD4 :SP1: DASH7
     NEXT H
     HEAD3 = HEAD3 :SP2: "OTH-INCOME" :"'L'"
     HEAD4 = HEAD4 :SP2: DASH7:DASH3 :"'L'"
     PRINTER ON
100  READNEXT ID ELSE LAST=1;GOTO 8500
     MAT PAY.REC=""
     MATREAD PAY.REC FROM PAYREG,ID ELSE GOTO 100
     MATREAD EMP.REC FROM EMPLOYEE,ID[1,7] ELSE GOTO 100
     IF BATHOLD="" THEN 
        BATHOLD = PAY.BATCH.NO
        HEADING HEAD1:"BATCH - ":BATHOLD "R#3": HEAD2:HEAD3:HEAD4
     END
     IF BATHOLD#PAY.BATCH.NO THEN GOTO 8500
600*
     NAME = EMP.FRST.NAME :", ": EMP.LAST.NAME
     PRINT ID[4,4] :SP2: NAME "L#40"
     IF EMP.STATUS="H" THEN DC="MD4" ELSE DC="MD2"
     FOR Y = 1 TO PAY.RECORDS
       V.LINE = SP2:SP2:SP2 : OCONV(PAY.RATE<1,Y>, DC) "R#11"
       V.LINE = V.LINE :SP2: PAY.SHIFT<1,Y> "R#5" :SP1
       FOR H = 1 TO HRS.CNT
         VAL = HRS.SMV<1,H>
         HOURS = PAY.HOURS<1,Y,VAL>
         V.LINE = V.LINE :SP1: OCONV(HOURS, "MD2") "R#7"
         RTOT(VAL) = RTOT(VAL) + HOURS
         TOTHRS = TOTHRS + HOURS
         D(VAL + 1) = D(VAL + 1) + HOURS
         T(VAL + 1) = T(VAL + 1) + HOURS
       NEXT H
       TOTERN = TOTERN + PAY.OTH.INC<1,Y>
       V.LINE = V.LINE :SP2: OCONV(PAY.OTH.INC<1,Y>, "MD2") "R#10"
       PRINT V.LINE
     NEXT Y
**TOTALS ROUTINE
     D(1) = D(1) + TOTERN
     T(1) = T(1) + TOTERN
**PRINT TOTALS
     PRINT
     V.LINE = SP2:SP2:SP2: "TOTALS" "L#19"
     FOR H = 1 TO HRS.CNT
       HOURS = RTOT(HRS.SMV<1,H>)
       V.LINE = V.LINE :SP1: OCONV(HOURS, "MD2") "R#7"
     NEXT H
     PRINT V.LINE
     PRINT
     V.LINE = SP2:SP2:SP2: "TOTAL HOURS -  ":OCONV(TOTHRS, "MD2") "R#8"
     V.LINE = V.LINE :SP2:SP2:SP2: "TOTAL OTHER INCOME -  ":OCONV(TOTERN, "MD2") "R#11"
     PRINT V.LINE
     PRINT STR("=",132)
     PRINT
     TOTERN=0;TOTHRS=0;MAT RTOT=""
      GOTO 100
8500 HEAD5="                                                    B A T C H   T O T A L S   ":"'LL'"
     HEADING HEAD1:SPACE(11):HEAD2:HEAD5
     PRINT;PRINT;PRINT;PRINT;PRINT;PRINT SPACE(47):"BATCH#: ":BATHOLD"R#4"
     PRINT SPACE(58):"HOURS"
    PRINT SPACE(58):"====="
     PRINT
     FOR H = 1 TO HRS.CNT
       VAL = HRS.SMV<1,H>
      PRINT SPACE(50): HRS.SHORT<1,H> "L#7":SPACE(10): OCONV(D(VAL+1), "MD2") "R#9"
     NEXT H
    PRINT
    PRINT SPACE(56):"OTHER EARNINGS"
    PRINT SPACE(56):"===== ========"
    PRINT
    PRINT SPACE(50):"TOTAL" "L#7":SPACE(10): OCONV(D(1), "MD2") "R#9"
    IF NOT(LAST) THEN 
      BATHOLD=PAY.BATCH.NO;MAT D=0
      HEADING HEAD1:"BATCH - ":BATHOLD "R#3": HEAD2:HEAD3:HEAD4
      GOTO 600
   END
9000 HEAD5="                                                B A T C H   G R A N D   T O T A L S                    ":"'LL'"
    HEADING HEAD1:SPACE(11):HEAD2: HEAD5
     PRINT SPACE(58):"HOURS"
    PRINT SPACE(58):"====="
     PRINT
     FOR H = 1 TO HRS.CNT
       VAL = HRS.SMV<1,H>
      PRINT SPACE(50): HRS.SHORT<1,H> "L#7":SPACE(10): OCONV(T(VAL+1), "MD2") "R#9"
     NEXT H
    PRINT
    PRINT SPACE(56):"OTHER EARNINGS"
    PRINT SPACE(56):"===== ========"
    PRINT
    PRINT SPACE(50):"TOTAL" "L#7":SPACE(10): OCONV(T(1), "MD2") "R#9"
END
