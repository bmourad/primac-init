*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - PRSBP
* PROGRAM     - MOT.DT.RPT
* BY          - WALID YAMOUT , C.B.A
* DATE        - 06/11/85
* DESCRIPTION -
*ENDDOC
*********************************************************************
*
*--- INSERT FILES EQUETES
*
*COPY>PMC.CPYLIB>EMPLOYEE
*COPY>PMC.CPYLIB>DIVISION
*COPY>PMC.CPYLIB>DEPARTMENT
*COPY>PMC.CPYLIB>COST.CNTR
*COPY>PRS.CPYLIB>MPAYREG
*COPY>CPYLIB>CHAR
      CLEAR
      PROMPT ""
      PROCREAD ID ELSE PRINT "MUST RUN FROM PROC";STOP
      CONO = ID<1>
      CO.NAME = ID<2>
      TYPE = ID<3>
      BRK = ID<4>
      CBRK = ID<5>
      OPEN "","MPAYREG" TO MPAYREG ELSE PRINT "CAN'T OPEN MPAYREG";STOP
      OPEN "","EMPLOYEE" TO EMPLOYEE ELSE PRINT "CAN'T OPEN EMPLOYEE";STOP
      OPEN "","DIVISION" TO DIVISION ELSE PRINT "CAN'T OPEN DIVISION";STOP
      OPEN "","DEPT" TO DEPARTMENT ELSE PRINT "CAN'T OPEN DEPT";STOP
      OPEN "","COST.CNTR" TO COST.CNTR ELSE PRINT "CAN'T OPEN COST.CNTR";STOP
      CC.HOLD = ""; DP.HOLD = ""; DV.HOLD = ""
      DIM TOT.CCTR(10),TOT.DEPT(10),TOT.DIV(10),TOT.COMP(10)
      DSH = STR('-',25)
*****
** HEADING ROUTINE
      POS1 = 51 - INT(LEN(CO.NAME)/2)
      POS2 = 26 + INT(LEN(CO.NAME)/2)
      HEAD1 = "DATE - " : OCONV(DATE(), "D2/") "L#8" :SPACE(POS1): CO.NAME "L#30" :SPACE(POS2): "PAGE - 'PL'"
     HEAD2=SPACE(40):"M O N T H L Y   O / T   A N D   D / T   R E P O R T'LL'"
     HEAD3=SPACE(43):"R E G U L A R     O V E R T I M E    D B L T I M E      OTHER  'L'"
     IF TYPE="D" THEN HEAD3=HEAD3:"EMPLOYEE NUMBER & NAME":SPACE(5)
     IF TYPE="D" THEN HEAD4=DSH:"  "
     IF TYPE="S" THEN HEAD3=HEAD3:SPACE(27)
     IF TYPE="S" THEN HEAD4=SPACE(27)
     HEAD3=HEAD3:"   GROSS       HOURS  EARNINGS    HOURS  EARNINGS   HOURS   EARNINGS   EARNINGS     O/T+D/T   REG+O/T+D/T'L'"
     HEAD4=HEAD4:DSH[1,10]:"    ":DSH[1,6]:" ":DSH[1,10]:"  ":DSH[1,6]:" ":DSH[1,10]:"  ":DSH[1,6]:" ":DSH[1,10]:" ":DSH[1,10]:"  ":DSH[1,10]:"  ":DSH[1,11]:"'L'"
     PRINTER ON
     HEADING HEAD1:HEAD2:HEAD3:HEAD4
*****
     FIRST = 1
     MAT TOT.CCTR = ""; MAT TOT.DEPT = ""; MAT TOT.DIV = ""; MAT TOT.COMP = ""
300*
     READNEXT ID ELSE
        IF CBRK = "Y" THEN GOSUB 1000
        GOSUB 2000
        GOSUB 3000
        GOTO 4000
     END
     IF ID[1,3] # CONO THEN GOTO 300
     MAT MPR.REC = ""
     MATREAD MPR.REC FROM MPAYREG,ID ELSE GOTO 300
     KEY = FIELD(ID,"!",1)
     EMP.NO = KEY[4,4]
     DIV.NO = KEY[8,2]
     DEPT.NO = KEY[10,5]
     CCTR.NO = FIELD(ID,"!",2)
     IF FIRST THEN
       DV.HOLD = DIV.NO
       DP.HOLD = DEPT.NO
       CC.HOLD = CCTR.NO
       FIRST = 0
     END
     BEGIN CASE
     CASE BRK = "Y" AND DIV.NO # DV.HOLD
        IF CBRK = "Y" THEN GOSUB 1000
        GOSUB 2000
        GOSUB 3000
     CASE DEPT.NO # DP.HOLD
        IF CBRK = "Y" THEN GOSUB 1000
        GOSUB 2000
     CASE CBRK = "Y" AND CCTR.NO # CC.HOLD
        GOSUB 1000
     END CASE
     MATREAD EMP.REC FROM EMPLOYEE, CONO:EMP.NO ELSE MAT EMP.REC = ""
     NAME = EMP.FRST.NAME :" ": EMP.LAST.NAME
     IF TYPE="D" THEN
      PRINT EMP.NO"R#4":" ":NAME"L#20":"  ":
      PRINT OCONV(MPR.GROSS,"MD2")"R#10":"    ":OCONV(MPR.REG.HRS,"MD2")"R#6":" ":OCONV(MPR.REG.ERN,"MD2")"R#10":
      PRINT "  ":OCONV(MPR.OT.HRS,"MD2")"R#6":" ":OCONV(MPR.OT.ERN,"MD2")"R#10":"  ":OCONV(MPR.DT.HRS,"MD2")"R#6":" ":
      PRINT OCONV(MPR.DT.ERN,"MD2")"R#10":" ":
      PRINT OCONV(MPR.GROSS-MPR.REG.ERN-MPR.OT.ERN-MPR.DT.ERN,"MD2")"R#10":"  ":
      PRINT OCONV(MPR.OT.ERN+MPR.DT.ERN,"MD2")"R#10":"  ":OCONV(MPR.REG.ERN+MPR.OT.ERN+MPR.DT.ERN,"MD2")"R#11"
     END
     IF CBRK = "Y" THEN
        TOT.CCTR(1)=TOT.CCTR(1)+MPR.GROSS;TOT.CCTR(2)=TOT.CCTR(2)+MPR.REG.HRS;TOT.CCTR(3)=TOT.CCTR(3)+MPR.REG.ERN;TOT.CCTR(4)=TOT.CCTR(4)+MPR.OT.HRS
        TOT.CCTR(5)=TOT.CCTR(5)+MPR.OT.ERN;TOT.CCTR(6)=TOT.CCTR(6)+MPR.DT.HRS;TOT.CCTR(7)=TOT.CCTR(7)+MPR.DT.ERN
        TOT.CCTR(8)=TOT.CCTR(8)+MPR.GROSS-MPR.REG.ERN-MPR.OT.ERN-MPR.DT.ERN
     END ELSE
        TOT.DEPT(1)=TOT.DEPT(1)+MPR.GROSS;TOT.DEPT(2)=TOT.DEPT(2)+MPR.REG.HRS;TOT.DEPT(3)=TOT.DEPT(3)+MPR.REG.ERN;TOT.DEPT(4)=TOT.DEPT(4)+MPR.OT.HRS
        TOT.DEPT(5)=TOT.DEPT(5)+MPR.OT.ERN;TOT.DEPT(6)=TOT.DEPT(6)+MPR.DT.HRS;TOT.DEPT(7)=TOT.DEPT(7)+MPR.DT.ERN
        TOT.DEPT(8)=TOT.DEPT(8)+MPR.GROSS-MPR.REG.ERN-MPR.OT.ERN-MPR.DT.ERN
     END
     GOTO 300
*
*--- COST CENTER BRK
*
1000*
    IF CC.HOLD = "000" THEN
       MAT CCTR.REC = ""
       CCTR.DESC = "GENERAL COST CENTER"
    END ELSE
        MATREAD CCTR.REC FROM COST.CNTR, CONO:CC.HOLD ELSE
           MAT CCTR.REC = ""
           CCTR.DESC = CC.HOLD:" NOT ON FILE"
        END
     END
     IF CBRK = "Y" THEN
        IF TYPE = "D" THEN PRINT SPACE(27):DSH[1,10]:"    ":DSH[1,6]:" ":DSH[1,10]:"  ":DSH[1,6]:" ":DSH[1,10]:"  ":DSH[1,6]:" ":DSH[1,10]:" ":DSH[1,10]:"  ":DSH[1,10]:"  ":DSH[1,11]
        PRINT "CTR- ":CCTR.DESC"L#21":" ":OCONV(TOT.CCTR(1),"MD2")"R#10":"  ":
        PRINT OCONV(TOT.CCTR(2),"MD2")"R#8":" ":OCONV(TOT.CCTR(3),"MD2")"R#10":
        PRINT OCONV(TOT.CCTR(4),"MD2")"R#8":" ":OCONV(TOT.CCTR(5),"MD2")"R#10":
        PRINT OCONV(TOT.CCTR(6),"MD2")"R#8":" ":OCONV(TOT.CCTR(7),"MD2")"R#10":" ":
        PRINT OCONV(TOT.CCTR(8),"MD2")"R#10":"  ":
        PRINT OCONV(TOT.CCTR(5)+TOT.CCTR(7),"MD2")"R#10":"  ":OCONV(TOT.CCTR(3)+TOT.CCTR(5)+TOT.CCTR(7),"MD2")"R#11"
        PRINT;*PRINT
     END
     FOR YY=1 TO 8;TOT.DEPT(YY)=TOT.DEPT(YY)+TOT.CCTR(YY);NEXT YY
     MAT TOT.CCTR = 0; CC.HOLD = CCTR.NO
     RETURN
*
*--- DEPT BRK
*
2000 MATREAD DEPT.REC FROM DEPARTMENT, CONO:DP.HOLD ELSE
       MAT DEPT.REC = ""
       DEPT.DESC = DP.HOLD:" NOT ON FILE"
     END
     IF TYPE = 'D' THEN PRINT SPACE(27):DSH[1,10]:"    ":DSH[1,6]:" ":DSH[1,10]:"  ":DSH[1,6]:" ":DSH[1,10]:"  ":DSH[1,6]:" ":DSH[1,10]:" ":DSH[1,10]:"  ":DSH[1,10]:"  ":DSH[1,11]
     PRINT "DEP- ":DEPT.DESC"L#21":" ":OCONV(TOT.DEPT(1),"MD2")"R#10":"  ":
     PRINT OCONV(TOT.DEPT(2),"MD2")"R#8":" ":OCONV(TOT.DEPT(3),"MD2")"R#10":
     PRINT OCONV(TOT.DEPT(4),"MD2")"R#8":" ":OCONV(TOT.DEPT(5),"MD2")"R#10":
     PRINT OCONV(TOT.DEPT(6),"MD2")"R#8":" ":OCONV(TOT.DEPT(7),"MD2")"R#10":" ":
     PRINT OCONV(TOT.DEPT(8),"MD2")"R#10":"  ":
     PRINT OCONV(TOT.DEPT(5)+TOT.DEPT(7),"MD2")"R#10":"  ":OCONV(TOT.DEPT(3)+TOT.DEPT(5)+TOT.DEPT(7),"MD2")"R#11"
     PRINT;*PRINT
     IF BRK = "Y" THEN
        FOR YY=1TO 8;TOT.DIV(YY)=TOT.DIV(YY)+TOT.DEPT(YY);NEXT YY
     END ELSE
        FOR YY=1TO 8;TOT.COMP(YY)=TOT.COMP(YY)+TOT.DEPT(YY);NEXT YY
     END
     MAT TOT.DEPT = 0; DP.HOLD = DEPT.NO
RETURN
*
*--- DIV BRK
*
3000*
     IF BRK = "Y" THEN
        MATREAD DIV.REC FROM DIVISION, CONO:DV.HOLD ELSE
          MAT DIV.REC = ""
          DIV.DESC = DV.HOLD:" NOT ON FILE"
        END
        IF TYPE = 'D' THEN PRINT SPACE(27):DSH[1,10]:"    ":DSH[1,6]:" ":DSH[1,10]:"  ":DSH[1,6]:" ":DSH[1,10]:"  ":DSH[1,6]:" ":DSH[1,10]:" ":DSH[1,10]:"   ":DSH[1,10]:"  ":DSH[1,11]
        PRINT "DIV- ":DIV.DESC"L#21":" ":OCONV(TOT.DIV(1),"MD2")"R#10":" ":
        PRINT OCONV(TOT.DIV(2),"MD2")"R#9":" ":OCONV(TOT.DIV(3),"MD2")"R#10":
        PRINT OCONV(TOT.DIV(4),"MD2")"R#8":" ":OCONV(TOT.DIV(5),"MD2")"R#10":
        PRINT OCONV(TOT.DIV(6),"MD2")"R#8":" ":OCONV(TOT.DIV(7),"MD2")"R#10":" ":
        PRINT OCONV(TOT.DIV(8),"MD2")"R#10":"  ":
        PRINT OCONV(TOT.DIV(5)+TOT.DIV(7),"MD2")"R#10":"  ":OCONV(TOT.DIV(3)+TOT.DIV(5)+TOT.DIV(7),"MD2")"R#11"
        FOR YY=1TO 8;TOT.COMP(YY)=TOT.COMP(YY)+TOT.DIV(YY);NEXT YY
        PRINT;*PRINT
     END
     MAT TOT.DIV = 0; DV.HOLD = DIV.NO
RETURN
*
*--- COMPANY BRK
*
4000 PRINT
     PRINT SPACE(10):"COMPANY TOTALS : ":OCONV(TOT.COMP(1),"MD2")"R#10":" ":
     PRINT OCONV(TOT.COMP(2),"MD2")"R#9":" ":OCONV(TOT.COMP(3),"MD2")"R#10":
     PRINT OCONV(TOT.COMP(4),"MD2")"R#8":" ":OCONV(TOT.COMP(5),"MD2")"R#10":
     PRINT OCONV(TOT.COMP(6),"MD2")"R#8":" ":OCONV(TOT.COMP(7),"MD2")"R#10":" ":
     PRINT OCONV(TOT.COMP(8),"MD2")"R#10":"  ":
     PRINT OCONV(TOT.COMP(5)+TOT.COMP(7),"MD2")"R#10":"  ":
     PRINT OCONV(TOT.COMP(3)+TOT.COMP(5)+TOT.COMP(7),"MD2")"R#11"
     PRINTER OFF
END
