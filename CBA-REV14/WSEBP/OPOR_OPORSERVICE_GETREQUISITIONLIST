SUBROUTINE OPOR_OPORSERVICE_GETREQUISITIONLIST(CONO,FILE.TYP,STRXML,ERRMSG,SCHEMA.ONLY)
*T111209 BY YAKUB ON 11/12/09 TO GET THE REQUISITION DIVISION
SCHEMA.ONLY = 1
$INCLUDE POS.CPYLIB OUTSIDE.PO
$INCLUDE PMC.CPYLIB COMPANY
* OPEN FILES
*
OPEN "","COMPANY" TO COMPANY ELSE
           ERRMSG = "CANNOT OPEN COMPANY FILE"
           GOTO 99999
END
IF FILE.TYP = "OPOR" THEN
	OPEN "","OUT.REQ" TO OUT.REQ ELSE
		   ERRMSG = "CANNOT OPEN OUT.REQ FILE"
		   GOTO 99999
	END
END ELSE
	OPEN "","OUTSIDE.PO" TO OUTSIDE.PO ELSE
		   ERRMSG = "CANNOT OPEN OUTSIDE.PO FILE"
		   GOTO 99999
	END
END
OPEN "","CONTROL" TO CONTROL ELSE
           ERRMSG = "CANNOT OPEN CONTROL FILE"
           GOTO 99999
END
*
* INITIALIZE  VARIABLES
*
ERRMSG=""
CONO_ID = ""
REQUISITIONIDS = ""
REQ.DIV = "";*T111209
*
* MAIN PROCESSING
*
****REQUISITION LIST
FLAG = 0
IF INDEX(CONO,"XML",1) THEN
  IF CONO[1,1] = "*" THEN CONO = CONO[1,1] ELSE CONO = CONO[1,3]
  *CONO = CONO[1,3]
  FLAG = 1
END
MATREAD COMP.REC FROM COMPANY,CONO ELSE
SCHEMA.ONLY = 0
ERRMSG="Company number ":CONO : " does not exist"
GOTO 99999
END
CNT = 0
IF FILE.TYP = "OPOR" THEN WORK.FILE = "OUT.REQ" ELSE WORK.FILE = "OUTSIDE.PO"
IF FILE.TYP = "OPOR" THEN
  CMD= "SSELECT OUT.REQ WITH @ID LIKE '":CONO:"...'"
END ELSE
  CMD= "SSELECT OUTSIDE.PO WITH @ID LIKE '":CONO:"...'"
END
UDTEXECUTE CMD CAPTURING JUNG
DATA=1
LOOP
  READNEXT ID ELSE DATA=0
  WHILE DATA DO
    SCHEMA.ONLY = 0
    IF FILE.TYP = "OPOR" THEN 
      MATREAD OPO.REC FROM OUT.REQ, ID ELSE CONTINUE
    END ELSE
      MATREAD OPO.REC FROM OUTSIDE.PO, ID ELSE CONTINUE
    END
    *MATREAD OPO.REC FROM OUT.REQ, ID THEN
    CNT = CNT + 1
      IF FLAG THEN
        REQUISITIONIDS<1,CNT> = ID[4,99]
	REQ.DIV<1,CNT> = OPO.DIV.OWNER;*T111209
      END ELSE
        IF FILE.TYP = "OPOR" THEN
          STRXML:='<Requisition><ReqId>'  : ID[4,99] : '</ReqId></Requisition>'
	  STRXML:='<Requisition><ReqDiv>'  : OPO.DIV.OWNER : '</ReqDiv></Requisition>';*T111209
	END ELSE
          STRXML:='<OPO><PONo>'  : ID[4,99] : '</PONo></OPO>'
	  STRXML:='<OPO><PODiv>'  : OPO.DIV.OWNER : '</PODiv></OPO>';*T111209
	END
      END
   * END
REPEAT
IF FLAG THEN
  IF FILE.TYP = "OPOR" THEN
    STRXML='<Requisition><ReqId>'  : REQUISITIONIDS  : '</ReqId></Requisition>'
    STRXML:='<Requisition><ReqDiv>'  : REQ.DIV : '</ReqDiv></Requisition>';*T111209
  END ELSE
    STRXML:='<OPO><PONo>'  : REQUISITIONIDS : '</PONo></OPO>'
    STRXML:='<OPO><PODiv>'  : REQ.DIV : '</PODiv></OPO>';*T111209
  END
END
UDTEXECUTE "CLEARSELECT"
RETURN
*
* WRITE ERROR MESSAGE
*
99999*
IF ERRMSG <> "" THEN
     IF FILE.TYP = "OPOR" THEN
        STRXML:='<Requisition><ErrorStack>'  : ERRMSG : '</ErrorStack></Requisition>'
     END ELSE
        STRXML:='<OPO><ErrorStack>'  : ERRMSG : '</ErrorStack></OPO>'
     END
      ERRMSG = "GetRequisitionList ----> OPOR_OPORSERVICE_GETREQUISITIONLIST --->": ERRMSG
      CALL WRITELOG(ERRMSG)
END
RETURN
