SUBROUTINE JCS_GETCUSTOMERLIST(CONO,OUTPUTXML,ERRSTR)
*************************************************
$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE PMC.CPYLIB COMPANY
OPEN "COMPANY" TO COMPANY ELSE ERRMSG="CANNOT OPEN COMPANY FILE";GOTO 99999
OPEN 'CUSTOMER' TO CUSTOMER ELSE ERRMSG="CANNOT OPEN CUSTOMER FILE" ; GOTO 99999
OPEN "CONTROL" TO CONTROL ELSE STOP
CNT = 1
FLAG = 0
OUTPUTXML = '<Customers>'
ERRMSG = '<Rejects>'
    MATREAD COMP.REC FROM COMPANY,CONO ELSE
       ERRMSG := '<Reject>'
       ERRMSG := '<RejectCode>':"CSGCL001":'</RejectCode>'
       ERRMSG := '<RejectDescreption>' :"COMPANYNO ":CONO:" DOES NOT EXIST!" :'</RejectDescreption>'
       ERRMSG := '</Reject>'
       FLAG = 1
    END
CMD= "SSELECT CUSTOMER WITH @ID LIKE '" : CONO : "...'"
UDTEXECUTE CMD
DATA=1
LOOP
 READNEXT ID ELSE DATA=0
WHILE DATA DO
  MATREAD CUST.REC FROM CUSTOMER,ID THEN
     OUTPUTXML :=  '<Customer>'
     OUTPUTXML := '<Cono>' : ID[1,3] : '</Cono>'
     OUTPUTXML := '<CustomerNo>' :ID[4,99]: '</CustomerNo>'
     OUTPUTXML := '<CustomerName>' :CUST.NAME: '</CustomerName>'
     OUTPUTXML := '<SortName>' :CUST.SORT.NAME: '</SortName>'
     OUTPUTXML:= '</Customer>'
  END
REPEAT
     IF FLAG # 1 THEN
         OUTPUTXML := '</Customers>'
     END ELSE
         ERRMSG := '</Rejects>'
	 ERRSTR = ERRMSG
     END
CLEARSELECT
RETURN
99999*
IF ERRMSG <> "" THEN
 ERRMSG ="GetCustomerList ----> JCS_GETCUSTOMERLIST --->": ERRMSG
     CALL WRITELOG(ERRMSG)
END
RETURN
