SUBROUTINE JES_GETEST_DEPT(CONO,EST.ID, SCHEMA.ONLY, ERRMSG, STRXML)
STRXML := '<EstimateDepartment><Dept></Dept><DeptDescription></DeptDescription><Component><ComponentNo></ComponentNo><Quantity></Quantity><Labor></Labor><Material></Material><Purchase></Purchase><Ship></Ship><Misc></Misc><Total></Total></Component></EstimateDepartment>'
 $INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE PMC.CPYLIB COMPANY
OPEN '','ESTIMATE' TO ESTIMATE ELSE
ERRMSG = 'CANNOT OPEN ESTIMATE FILE'
 GOTO 99999
RETURN
END
OPEN '','COMPANY' TO COMPANY ELSE
ERRMSG ='CANNOT OPEN COMPANY FILE'
GOTO 99999
END
SCHEMA.ONLY="1"
 MATREAD COMP.REC FROM COMPANY,CONO ELSE
    ERRMSG=CONO:"- THIS COMPANY NUMBER DOES NOT EXIST"
    GOTO 99999
  END
MATREAD EST.REC FROM ESTIMATE, CONO:EST.ID THEN
 STRMXL=''
SCHEMA.ONLY ="0"
CNT = DCOUNT(EST.DEPT,@VM)
FOR I = 1 TO CNT
STRXML := '<EstimateDepartment>'
   STRXML := '<Dept>' : EST.DEPT<1,I> : '</Dept>'
  STRXML := '<DeptDescription>' : EST.DEPT.DESC<1,I> : '</DeptDescription>'
 STRXML := '<Component>'
 STRXML := '<ComponentNo>' : EST.DEPT.COMP : '</ComponentNo>'
 STRXML := '<Quantity>' : EST.QTY : '</Quantity>'
 STRXML := '<Labor>' : EST.MARKUP : '</Labor>'
STRXML := '<Material>' :EST.MARKUP : '</Material>'
STRXML := '<Purchase>' :EST.MARKUP : '</Purchase>'
STRXML := '<Ship>' :EST.MARKUP : '</Ship>'
STRXML := '<Misc>' :EST.MARKUP : '</Misc>'
STRXML := '<Total>' :EST.MARKUP : '</Total>'
 STRXML := '</Component>'
STRXML := '</EstimateDepartment>'
NEXT I
END
99999*
IF ERRMSG <> "" THEN
ERRMSG = "GetEstimateDepartment  ---> JES_GETESTIMATEDEPT ---> " : ERRMSG
*CALL WRITELOG(ERRMSG)
RETURN
END
