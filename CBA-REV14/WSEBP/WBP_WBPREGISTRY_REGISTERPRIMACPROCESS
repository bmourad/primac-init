SUBROUTINE WBP_WBPREGISTRY_REGISTERPRIMACPROCESS(CONO,WFNAME,PROCESSNAME,INSTANCEID,KEYID,OUTPUTXML)
$INCLUDE PMC.CPYLIB COMPANY
* OPEN FILES
*
OPEN "","COMPANY" TO COMPANY ELSE ERRMSG = "CANNOT OPEN THE COMPANY FILE"
OPEN "","WBPREGISTRY" TO WBPREGISTRY ELSE
    ERRMSG="WBPREGISTRY FILE IS MISSING"; GOTO 99999
END
*
* INITIALIZE  VARIABLES
*
   ERRSTR = '<Rejects>'
   ERRFLAG = 0
*
* MAIN PROCESSING
*
IF CONO = "" THEN
   FIELDNAME = "COMPANYNAME"
   GOSUB 1000
END ELSE
   MATREAD COMP.REC FROM COMPANY,CONO ELSE 
      ERRFLAG = 1
      ERRSTR := '<Reject>'
      ERRSTR := '<RejectCode>RPPRA002</RejectCode>' 
      ERRSTR := '<RejectDescription>':"THIS COMPANY NUMBER ":CONO:" DOES NOT EXIST!":'</RejectDescription>'
      ERRSTR := '</Reject>'
   END
END
IF WFNAME = "" THEN
   FIELDNAME = "WORKFLOWNAME"
   GOSUB 1000
END
IF PROCESSNAME = "" THEN
   FIELDNAME = "PROCESSNAME"
   GOSUB 1000
END
IF INSTANCEID = "" THEN
   FIELDNAME = "INSTANCEID"
   GOSUB 1000
END
IF KEYID = "" THEN 
   FIELDNAME = "KEYID"
   GOSUB 1000
END
*KEYFIELD = CONO:WFNAME:"!":PROCESSNAME:"!":INSTANCEID:"!":KEYID
KEYFIELD = CONO:PROCESSNAME:"!":KEYID:"!":WFNAME:"!":INSTANCEID
*STR = WFNAME:@AM:PROCESSNAME:@AM:INSTANCEID:@AM:KEYID
STR = PROCESSNAME:@AM:KEYID:@AM:WFNAME:@AM:INSTANCEID
IF ERRFLAG # 1 THEN
   WRITE STR ON WBPREGISTRY,KEYFIELD
   OUTPUTXML := '<Payload>'
   OUTPUTXML := '<Results>'
   OUTPUTXML := '<Result>':"Activity Registered":'</Result>'
   OUTPUTXML := '</Results>'
   OUTPUTXML := '</Payload>'
END ELSE
   ERRSTR := '</Rejects>'
   OUTPUTXML = ERRSTR
END
RETURN
1000*
      ERRFLAG = 1
      ERRSTR := '<Reject>'
      ERRSTR := '<RejectCode>RPPRA001</RejectCode>' 
      ERRSTR := '<RejectDescription>':FIELDNAME:' IS REQUIRED!</RejectDescription>'
      ERRSTR := '</Reject>'
RETURN
*
* WRITE ERROR MESSAGE
*
99999*
IF ERRMSG <> "" THEN
      ERRMSG = "RegisterPrimacProcess ----> WBP_WBPREGISTRY_REGISTERPRIMACPROCESS --->": ERRMSG
      CALL WRITELOG(ERRMSG)
END
RETURN
