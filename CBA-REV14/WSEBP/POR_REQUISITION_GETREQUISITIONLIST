SUBROUTINE POR_REQUISITION_GETREQUISITIONLIST(CONO,STRXML,ERRMSG,SCHEMA.ONLY)
*T111209 BY YAKUB ON 11/12/09 TO GET THE REQUISITION DIVISION
SCHEMA.ONLY = 1
$INCLUDE PMC.CPYLIB PO
$INCLUDE PMC.CPYLIB COMPANY
* OPEN FILES
*
OPEN "","COMPANY" TO COMPANY ELSE
           ERRMSG = "CANNOT OPEN COMPANY FILE"
           GOTO 99999
END
OPEN "","REG.REQ" TO REG.REQ ELSE
           ERRMSG = "CANNOT OPEN REG.REQ FILE"
           GOTO 99999
END
OPEN "","CONTROL" TO CONTROL ELSE
           ERRMSG = "CANNOT OPEN CONTROL FILE"
           GOTO 99999
END
*
* INITIALIZE  VARIABLES
*
ERRMSG=""
CONO_ID = ""
REQUISITIONIDS = ""
REQ.DIV = "";*T111209
*
* MAIN PROCESSING
*
****REQUISITION LIST
FLAG = 0
IF INDEX(CONO,"XML",1) THEN
  IF CONO[1,1] = "*" THEN CONO = CONO[1,1] ELSE CONO = CONO[1,3]
  *CONO = CONO[1,3]
  FLAG = 1
END
MATREAD COMP.REC FROM COMPANY,CONO ELSE
SCHEMA.ONLY = 0
ERRMSG="Company number ":CONO : " does not exist"
GOTO 99999
END
CNT = 0
CMD= "SSELECT REG.REQ WITH @ID LIKE '":CONO:"...'"
UDTEXECUTE CMD CAPTURING JUNG
DATA=1
LOOP
  READNEXT ID ELSE DATA=0
  WHILE DATA DO
    SCHEMA.ONLY = 0
    MATREAD PO.REC FROM REG.REQ, ID THEN
    CNT = CNT + 1
      IF FLAG THEN
        REQUISITIONIDS<1,CNT> = ID[4,99]
	REQ.DIV<1,CNT> = PO.DIV.OWNER;*T111209
      END ELSE
      STRXML:='<Requisition><ReqId>'  : ID[4,99] : '</ReqId></Requisition>'
      STRXML:='<Requisition><ReqDiv>'  : PO.DIV.OWNER : '</ReqDiv></Requisition>';*T111209
      END
    END
REPEAT
IF FLAG THEN
STRXML='<Requisition><ReqId>'  : REQUISITIONIDS  : '</ReqId></Requisition>'
STRXML:='<Requisition><ReqDiv>'  : REQ.DIV : '</ReqDiv></Requisition>';*T111209
END
UDTEXECUTE "CLEARSELECT"
RETURN
*
* WRITE ERROR MESSAGE
*
99999*
IF ERRMSG <> "" THEN
      STRXML:='<Requisition><ErrorStack>'  : ERRMSG : '</ErrorStack></Requisition>'
      ERRMSG = "GetApprovalList ----> POR_REQUISITION_GETREQUISITIONLIST --->": ERRMSG
      CALL WRITELOG(ERRMSG)
END
RETURN
