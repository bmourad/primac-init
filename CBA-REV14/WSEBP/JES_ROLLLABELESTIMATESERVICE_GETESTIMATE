SUBROUTINE JES_ROLLLABELESTIMATESERVICE_GETESTIMATE(CONO, EST.ID, SCHEMA.ONLY, ERRMSG, STRXML)
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE PMC.CPYLIB DIVISION
*SQL SELECT EST.EST_CUST_ADDR1  AddressLine1, EST.EST_CUST_ADDR2 AddressLine2, EST.EST_CUST_ADDR3 AddressLine3, EST.EST_CUST_ATTN AttentionName, EST.EST_BASE_QTY BaseQuantity, EST.EST_BIND_BIND_UP BinderyNUp, EST.EST_BIND_TP_LENGTH BindPageSizeLength, EST.EST_BIND_TP_WIDTH BindPageSizeWidth, EST.EST_BIND_STYLE BinderyStyle, DECODE( EST.EST_BIND_STYLE, 'P', 'Perfect Bound', 'S', 'Sewn', 'N', 'Notch', 'SAD', 'Saddlewire', 'FO', 'Fold Only', 'T3S', 'Trim 3 Side', 'T4S', 'Trim 4 Side', 'SP', 'Spiral', 'PC', 'Plastic Comb', EST.EST_BIND_STYLE) BinderyStyleDesc, EST.EST_BIND_US_LENGTH BindUntrimLength, EST.EST_BIND_US_WIDTH BindUntrimWidth, EST.EST_BINDER_CCTR BinderyWorkCenter, EST.EST_BOOK_QTY BookedQuantity, EST.EST_CASE_BACK_STYLE CaseBackStyle, EST.EST_CASE_ENDLF CaseEndLeaf, EST.EST_CASE_ENDLF_PRICE CaseEndLeafPrice, EST.EST_CASE_ENDLF_SIZE CaseEndleafSize, EST.EST_CASE_ENDLF_SPEC CaseEndLeafSpec, EST.EST_CASEMAKER_CCTR CaseMakerCostCenter, EST.EST_CASEIN_CCTR CaseinCostCenter, EST.EST_CASE_PIECES CasePieces, EST.EST_CASE_SHOW_SIZE CaseShowSize, EST.EST_CASE_SPOIL CaseSpoilage, EST.EST_CATG_DESC CategoryDesc, EST.EST_CUST_ADDR4 CityStateZip,  EST.EST_CASESTAMP_CCTR CaseStampCostCenter, EST.EST_CASESTAMP_HITS CaseStampNumHits, EST.EST_COMMENTS_1 CommentLine1, EST.EST_COMMENT_TYPE CommentType, EST.EST_COMPONENT_CNT ComponentCount, EST.EST_BIND_COVER_STYLE CoverStyle, EST.EST_CUST CustomerId, EST.EST_CUST_NAME CustomerName, EST.EST_CSR CustomerServiceRep, EST.EST_DIV Division, EST.EST_BIND_EDGE_TYPE EdgeType, SUBSTRING(OCONV(EST.EST_DATE_ENTERED ,'mm dd yy'),1,10) EntryDate, EST.EST_ID EstimateId, EST.EST_NUMBER EstimateNo, EST.EST_CATG EstimateCategory, EST.EST_TYPE EstimateType, DECODE(EST.EST_TYPE, 'R', 'Regular', 'C', 'Customer Change Order', 'S', 'Spoilage', EST.EST_TYPE) EstimateTypeDescription, EST.EST_ESTIMATOR Estimator, EST.EST_ESTIMATOR_NAME EstimatorName, EST.EST_BIND_GATHER_UP GathererNUp, EST.EST_GATHERER_CCTR GathererWorkCenter, EST.EST_JOB JobNo, SUBSTRING(OCONV(EST.EST_JOB_PURGE_DATE ,'mm dd yy'),1,10) JobPurgeDate, EST.EST_MARKUP_LABOR MarkupLabor, EST.EST_MARKUP_OP MarkupOutsidePurchases, EST.EST_MARKUP_REG MarkupRegular, EST.EST_MARKUP_SHIPPING MarkupShipping, EST.EST_MARKUP_STOCK MarkupStock, EST.EST_MASTER Master, EST.EST_MARKUP_MISC MarkupMiscellaneous, EST.EST_ORDER OrderNo, EST.EST_BIND_LBS_PER_BOX PoundsPerBox, EST.EST_PDEF_TYPE ProductDefinitionType, EST.EST_PURGE_TYPE PurgeType, SUBSTRING(OCONV(EST.EST_DATE_REQUIRED ,'mm dd yy'),1,10) RequiredDate, EST.EST_SALES_CODE SalesCode, EST.EST_SALESMAN SalesRepCode, EST.EST_SLSREP_NAME SalesRepName, EST_STATUS Status, EST.EST_BIND_STITCH_UP StitcherNUp, EST.EST_STITCHER_CCTR StitcherWorkCenter, EST.EST_TRIMMER_CCTR TrimmerWorkCenter FROM EST EST where  EST.EST_ID = '0011165-01'
OPEN "","ESTIMATE" TO ESTIMATE ELSE ERRMSG="ESTIMATE FILE IS MISSING"; RETURN
OPEN "","DIVISION" TO DIVISION ELSE ERRMSG="DIVISION FILE IS MISSING"; RETURN
*INITIALIZE THE DATASET VALUES, AND ADD A NEW VARIABLE <Comments> FOR CLUBBING TWO DATASETS INTO ONE
STRXML = '<Estimate><AddressLine1></AddressLine1><AddressLine2></AddressLine2><AddressLine3>'
STRXML := '</AddressLine3><AttentionName></AttentionName><BaseQuantity></BaseQuantity>'
STRXML := '<CategoryDesc></CategoryDesc>'
STRXML := '<CityStateZip></CityStateZip>'
STRXML := '<CommentLine1></CommentLine1><CommentType></CommentType><ComponentCount>'
STRXML := '</ComponentCount><CustomerId></CustomerId><CustomerName></CustomerName>'
STRXML := '<CustomerServiceRep></CustomerServiceRep><Division></Division><EdgeType></EdgeType><EntryDate>'
STRXML := '</EntryDate><EstimateId></EstimateId><EstimateNo></EstimateNo><EstimateCategory></EstimateCategory>'
STRXML := '<EstimateType></EstimateType><EstimateTypeDescription></EstimateTypeDescription><Estimator></Estimator>'
STRXML := '<EstimatorName></EstimatorName><JobNo>'
STRXML := '</JobNo><JobPurgeDate></JobPurgeDate>'
STRXML := '<Master></Master><OrderNo></OrderNo>'
STRXML := '<ProductDefinitionType></ProductDefinitionType><PurgeType></PurgeType><RequiredDate>'
STRXML := '</RequiredDate><SalesCode></SalesCode><SalesRepCode></SalesRepCode><SalesRepName></SalesRepName><Status>'
STRXML := '</Status>'
STRXML := '<Comments></Comments></Estimate>' 
MATREAD EST.REC FROM ESTIMATE, CONO:EST.ID THEN
  SCHEMA.ONLY = 0
  STRXML = '<Estimate>'
  STRXML := '<AddressLine1>' : EST.CUST.ADDR1 : '</AddressLine1>'
  STRXML := '<AddressLine2>' : EST.CUST.ADDR2 : '</AddressLine2>'
  STRXML := '<AddressLine3>' : EST.CUST.ADDR3 : '</AddressLine3>'
  STRXML := '<AttentionName>' : EST.CUST.ATTN : '</AttentionName>'
  STRXML := '<BaseQuantity>' : EST.BASE.QTY : '</BaseQuantity>'
  STRXML := '<Quantity>' : EST.QTY : '</Quantity>'
  STRXML := '<CategoryDesc>' : OCONV(CONO:EST.CATG,"TJOB.CATEGORY;X;1;1") : '</CategoryDesc>'
  STRXML := '<CityStateZip>' : EST.CUST.ADDR4 : '</CityStateZip>'
  STRXML := '<CommentLine1>' : EST.COMMENTS<1,1> : '</CommentLine1>'
  STRXML := '<CommentType>' : CHANGE(EST.COMMENT.TYPE,@VM,' ') : '</CommentType>'
  STRXML := '<ComponentCount>' : EST.COMPONENT.CNT : '</ComponentCount>'
  STRXML := '<CustomerId>' : EST.CUST : '</CustomerId>'
  STRXML := '<CustomerName>' : EST.CUST.NAME : '</CustomerName>'
  STRXML := '<CustomerServiceRep>' : EST.CSR : '</CustomerServiceRep>'
  STRXML := '<Division>' : EST.DIV : '</Division>'
  READV DIV.DESC FROM DIVISION, CONO:EST.DIV,1 THEN
  STRXML := '<DivisionDesc>' : DIV.DESC : '</DivisionDesc>'
END
  STRXML := '<EdgeType>' : EST.BIND.EDGE.TYPE : '</EdgeType>'
  STRXML := '<EntryDate>' : OCONV(EST.DATE.ENTERED,'D2/') : '</EntryDate>'
  STRXML := '<EstimateId>' : CONO:EST.ID : '</EstimateId>' ;*DOUBTFUL
  STRXML := '<EstimateNo>' : EST.ID : '</EstimateNo>' ;*DOUBTFUL
  STRXML := '<EstimateCategory>' : EST.CATG : '</EstimateCategory>'
  STRXML := '<EstimateType>' : EST.TYPE : '</EstimateType>'
  EST.TYPE.DESC = ''
  BEGIN CASE
    CASE EST.TYPE = 'R'
      EST.TYPE.DESC = 'Regular'
    CASE EST.TYPE = 'C'
      EST.TYPE.DESC = 'Customer Change Order'
    CASE EST.TYPE = 'S'
      EST.TYPE.DESC = 'Spoilage'
  END CASE
  STRXML := '<EstimateTypeDescription>' : EST.TYPE.DESC : '</EstimateTypeDescription>'
  STRXML := '<Estimator>' : EST.ESTIMATOR : '</Estimator>'
  STRXML := '<EstimatorName>' : OCONV(CONO:EST.ESTIMATOR,"TESTIMATOR;X;1;1") : '</EstimatorName>'
  STRXML := '<JobNo>' :EST.JOB : '</JobNo>'
  STRXML := '<JobPurgeDate>' : OCONV(EST.JOB.PURGE.DATE ,'mm dd yy') : '</JobPurgeDate>'
  STRXML := '<Master>' : EST.MASTER : '</Master>'
  STRXML := '<OrderNo>' : EST.ORDER : '</OrderNo>'
  STRXML := '<ReqOrderNo>' : EST.CUST.PO : '</ReqOrderNo>'
  STRXML := '<ProductDefinitionType>' : EST.PDEF.TYPE : '</ProductDefinitionType>'
  STRXML := '<PurgeType>' : EST.PURGE.TYPE : '</PurgeType>'
  STRXML := '<RequiredDate>' : OCONV(EST.DATE.REQUIRED,'D2/') : '</RequiredDate>'
  STRXML := '<SalesCode>' : EST.SALES.CODE  : '</SalesCode>'
  STRXML := '<SalesRepCode>' : EST.SALESMAN  : '</SalesRepCode>'
  STRXML := '<SalesRepName>' : OCONV(CONO:EST.SALESMAN,"TSALESMAN;X;1;1")  : '</SalesRepName>'
  STRXML := '<Status>' : EST.STATUS  : '</Status>'
  STRXML := '<Comments>' : CHANGE(EST.COMMENTS,@VM,'\n')  : '</Comments>'
  STRXML := '</Estimate>'
END
