SUBROUTINE JCS_GETESTIMATECNTR(CONO, ESTIMATEID, ERRMSG, OUT_PARAM_ESTIMATECNTR,SCHEMA.ONLY)
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB COST.CNTR
$INCLUDE JES.CPYLIB ESTIMATE.RES
$INCLUDE JES.CPYLIB ESTIMATE
OUT_PARAM_ESTIMATECNTR ='<EstimateCostCenterData><EstimateCostCenter><CostCenter></CostCenter><Description></Description><EmbossingFlag></EmbossingFlag><FoilSpeedFlag></FoilSpeedFlag><FoilStampingFlag></FoilStampingFlag><NumberColorChanges></NumberColorChanges><NumberColorsMixes></NumberColorsMixes><NumberColorsAdhesive></NumberColorsAdhesive><NumberColorsGravure></NumberColorsGravure><NumberColorsSide1></NumberColorsSide1><NumberColorsSide2></NumberColorsSide2><NumberColorsSilkScreen></NumberColorsSilkScreen><OverLaminateFlag></OverLaminateFlag><NumberPlateChanges></NumberPlateChanges><SprocketPunchFlag></SprocketPunchFlag><VarnishFullSpot></VarnishFullSpot><EST_RL_PRESS_CCTR_SC></EST_RL_PRESS_CCTR_SC></EstimateCostCenter></EstimateCostCenterData>'
SCHEMA.ONLY = 1
*
* OPEN FILES
*
OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = "CANNOT OPEN COMPANY FILE" ;GOTO 99999
OPEN '','ESTIMATE.RES' TO ESTIMATE.RES ELSE ERRMSG = "CANNOT OPEN ESTIMATE.RES" ;GOTO 99999
OPEN '','ESTIMATE' TO ESTIMATE ELSE ERRMSG = "CANNOT OPEN ESTIMATE FILE" ;GOTO 99999
OPEN '','COST.CNTR' TO COST.CNTR ELSE ERRMSG = "CANNOT OPEN COST.CNTR FILE" ;GOTO 99999
*
* INITIALIZE VARIABLES
*
ERRMSG=''
*
* READ THE COMPANY CODE
*
MATREAD COMP.REC FROM COMPANY,CONO ELSE
      ERRMSG=CONO:"- THIS COMPANY NUMBER DOES NOT EXIST"
      GOTO 99999
END
MATREAD EST.RL.REC FROM ESTIMATE.RES, CONO:ESTIMATEID THEN
READV EST.PROD.COLORS.1 FROM ESTIMATE,CONO:ESTIMATEID, 103 ELSE EST.PROD.COLORS.1=''
 IF EST.RL.PRESS.CCTR # '' THEN
  CNT=DCOUNT(EST.RL.PRESS.CCTR,@SVM)
  IF CNT > 0 THEN
     OUT_PARAM_ESTIMATECNTR = '<EstimateCostCenterData>'
     SCHEMA.ONLY = 0
     P = 1
     S=1
  FOR I=1 TO CNT
     OUT_PARAM_ESTIMATECNTR := '<EstimateCostCenter>'
     OUT_PARAM_ESTIMATECNTR := '<CostCenter>' : EST.RL.PRESS.CCTR<1,P,I> : '</CostCenter>'
     READV CCTR.DESC FROM COST.CNTR,CONO:EST.RL.PRESS.CCTR<1,P,I>,1 ELSE CCTR.DESC=''
     OUT_PARAM_ESTIMATECNTR := '<Description>' : CCTR.DESC : '</Description>'
     OUT_PARAM_ESTIMATECNTR := '<EmbossingFlag>' : EST.RL.EMBOSS<1,P,I> : '</EmbossingFlag>'
     OUT_PARAM_ESTIMATECNTR := '<FoilSpeedFlag>' : EST.RL.FOIL.SPEED<1,P,I> : '</FoilSpeedFlag>'
     OUT_PARAM_ESTIMATECNTR := '<FoilStampingFlag>' : EST.RL.FOIL<1,P,I> : '</FoilStampingFlag>'
     OUT_PARAM_ESTIMATECNTR := '<NumberColorChanges>' : EST.RL.COLOR.CHANGES<1,P,I> : '</NumberColorChanges>'
     OUT_PARAM_ESTIMATECNTR := '<NumberColorsMixes>' : EST.RL.COL.MIX<1,P,I> : '</NumberColorsMixes>'
     OUT_PARAM_ESTIMATECNTR := '<NumberColorsAdhesive>' : EST.RL.ADHESIVE<1,P,I> : '</NumberColorsAdhesive>'
     OUT_PARAM_ESTIMATECNTR := '<NumberColorsGravure>' : EST.RL.GRAVURE<1,P,I> : '</NumberColorsGravure>'
     OUT_PARAM_ESTIMATECNTR := '<NumberColorsSide1>' : EST.PROD.COLORS.1<1,P,I> : '</NumberColorsSide1>'
     OUT_PARAM_ESTIMATECNTR := '<NumberColorsSide2>' : EST.RL.BACKPRINT<1,P,I> : '</NumberColorsSide2>'
     OUT_PARAM_ESTIMATECNTR := '<NumberColorsSilkScreen>' : EST.RL.SSCREEN<1,P,I> : '</NumberColorsSilkScreen>'
     OUT_PARAM_ESTIMATECNTR := '<OverLaminateFlag>' : EST.RL.OVERLAM<1,P,I> : '</OverLaminateFlag>'
     OUT_PARAM_ESTIMATECNTR := '<NumberPlateChanges>' : EST.RL.PLATE.CHANGES<1,P,I> : '</NumberPlateChanges>'
     OUT_PARAM_ESTIMATECNTR := '<SprocketPunchFlag>' : EST.RL.SPROCKET<1,P,I> : '</SprocketPunchFlag>'
     OUT_PARAM_ESTIMATECNTR := '<VarnishFullSpot>' : EST.RL.FULL.SPOT<1,P,I> : '</VarnishFullSpot>'
     OUT_PARAM_ESTIMATECNTR := '<EST_RL_PRESS_CCTR_SC>' : S : '</EST_RL_PRESS_CCTR_SC>'
     OUT_PARAM_ESTIMATECNTR := '</EstimateCostCenter>' 
     S = S + 1
  NEXT I
  OUT_PARAM_ESTIMATECNTR := '</EstimateCostCenterData>'
  END
 END
END 
RETURN
*
*
99999*
 IF ERRMSG <> "" THEN
 ERRMSG = "GetEstimateCostCenter ---> JCS_GETESTIMATECNTR ---> " : ERRMSG
      CALL WRITELOG(ERRMSG)
 END
 RETURN
