SUBROUTINE JES_GETESTIMATEROLLLABEL(CONO, EST.ID, SCHEMA.ONLY, ERRMSG, STRXML)
$INCLUDE JES.CPYLIB ESTIMATE.RES
*SELECT  DECODE(ER.EST_RL_APPLY, 'M', 'Machine', 'H', 'Hand', 'P', 'Pharmaceutical', ER.EST_RL_APPLY) AppliedDescription, ER.EST_RL_GAP AGap, ER.EST_RL_CPY_DIR1 CopyDirectionFront, ER.EST_RL_CPY_DIR2 CopyDirectionBack, ER.EST_RL_CORE CoreRequired, ER.EST_RL_CORE_SIZE CoreSize, ER.EST_RL_DIE_SHAPE DieShape, ER.EST_RL_DISP_PACK DisplayPack, ER.EST_RL_FANFOLD Fanfold, ER.EST_RL_NO_PER_FOLD FanfoldPerPackage, DECODE(ER.EST_RL_JOB_TYPE, 'N', 'New', 'RR', 'ReRun', 'RC', 'Rerun With Change', ER.EST_RL_JOB_TYPE) JobTypeDescription, ER.EST_RL_LAB_ACR LabelsAcross, ER.EST_RL_LINEAL_SLIT LinealSlits, ER.EST_RL_JOB_TYPE JobType, ER.EST_RL_NO_PER_ROLL LabelsPerRoll, ER.EST_RL_MAX_OD MaxOD, ER.EST_RL_DIE_GAP_CALC MGap, ER.EST_RL_NO_SLITS NumberSlits, ER.EST_RL_PKG_LABELS PackageLabel, ER.EST_RL_NO_PER_FOLD QuantityPerFanFold, ER.EST_RL_PREV_EST PreviousEstimate, ER.EST_RL_ROLLS Rolls, ER.EST_RL_SHEETS Sheeted, ER.EST_RL_NO_PER_PKG SheetsPerPackage, ER.EST_RL_SHRK_WRP ShringWrap, ER.EST_RL_SET1 Set1, ER.EST_RL_SET2 Set2, ER.EST_RL_DIM_AC SizeAcross, ER.EST_RL_DIM_AR SizeAround, ER.EST_RL_TYPE_CHG TypeChange FROM EST_RES ER where  ER.ID = '[!EstimateDataSet.Estimate.EstimateId]'
OPEN "","ESTIMATE.RES" TO ESTIMATE.RES ELSE ERRMSG="ESTIMATE.RES FILE IS MISSING"; RETURN
STRXML = '<Estimate><AppliedDescription></AppliedDescription><AGap></AGap><CopyDirectionFront></CopyDirectionFront>'
STRXML := '<CopyDirectionBack></CopyDirectionBack><CoreRequired></CoreRequired><CoreSize></CoreSize>'
STRXML := '<DieShape></DieShape><DisplayPack></DisplayPack><Fanfold></Fanfold><FanfoldPerPackage></FanfoldPerPackage>'
STRXML := '<JobTypeDescription></JobTypeDescription><LabelsAcross></LabelsAcross><LinealSlits></LinealSlits>'
STRXML := '<JobType></JobType><LabelsPerRoll></LabelsPerRoll><MaxOD></MaxOD><MGap></MGap><NumberSlits></NumberSlits>'
STRXML := '<PackageLabel></PackageLabel><QuantityPerFanFold></QuantityPerFanFold><PreviousEstimate></PreviousEstimate>'
STRXML := '<Rolls></Rolls><Sheeted></Sheeted><SheetsPerPackage></SheetsPerPackage><ShringWrap></ShringWrap>'
STRXML := '<Set1></Set1><Set2></Set2><SizeAcross></SizeAcross><SizeAround></SizeAround><TypeChange></TypeChange></Estimate>'
 
MATREAD EST.RL.REC FROM ESTIMATE.RES, CONO:EST.ID THEN
  SCHEMA.ONLY = 0
  STRXML = '<Estimate>'
  EST.RL.APPLY.DESCRIPTION = ''
  BEGIN CASE
    CASE EST.RL.APPLY = 'M'
      EST.RL.APPLY.DESCRIPTION = 'Machine'
    CASE EST.RL.APPLY = 'H'
      EST.RL.APPLY.DESCRIPTION = 'Hand'
    CASE EST.RL.APPLY = 'P'
      EST.RL.APPLY.DESCRIPTION = 'Pharmaceutical'
  END CASE
  STRXML := '<AppliedDescription>' : EST.RL.APPLY.DESCRIPTION : '</AppliedDescription>'
  STRXML := '<AGap>' : OCONV(EST.RL.GAP,'MD4') : '</AGap>'
  *FIELD(EST_RL_CPY_DIR,@SM,1)
  STRXML := '<CopyDirectionFront>' : EST.RL.CPY.DIR<1,1,1> : '</CopyDirectionFront>'
  *FIELD(EST_RL_CPY_DIR,@SM,2)
  STRXML := '<CopyDirectionBack>' : EST.RL.CPY.DIR<1,1,2> : '</CopyDirectionBack>'
  STRXML := '<CoreRequired>' : EST.RL.CORE : '</CoreRequired>'
  STRXML := '<CoreSize>' : OCONV(EST.RL.CORE.SIZE,'MD4') : '</CoreSize>'
  STRXML := '<DieShape>' : EST.RL.DIE.SHAPE : '</DieShape>'
  STRXML := '<DisplayPack>' : EST.RL.DISP.PACK : '</DisplayPack>'
  STRXML := '<Fanfold>' : EST.RL.FANFOLD : '</Fanfold>'
  STRXML := '<FanfoldPerPackage>' : EST.RL.NO.PER.FOLD : '</FanfoldPerPackage>'
  *DECODE(ER.EST_RL_JOB_TYPE, 'N', 'New', 'RR', 'ReRun', 'RC', 'Rerun With Change', ER.EST_RL_JOB_TYPE) 
  EST.RL.JOB.TYPE.DESCRIPTION = ''
  BEGIN CASE
    CASE EST.RL.JOB.TYPE = 'N'
      EST.RL.JOB.TYPE.DESCRIPTION = 'New'
    CASE EST.RL.JOB.TYPE = 'RR'
      EST.RL.JOB.TYPE.DESCRIPTION = 'ReRun'
    CASE EST.RL.JOB.TYPE = 'RC'
      EST.RL.JOB.TYPE.DESCRIPTION = 'Rerun With Change'
  END CASE
  STRXML := '<JobTypeDescription>' : EST.RL.JOB.TYPE.DESCRIPTION : '</JobTypeDescription>'
  STRXML := '<LabelsAcross>' : EST.RL.LAB.ACR : '</LabelsAcross>'
  STRXML := '<LinealSlits>' : EST.RL.LINEAL.SLIT : '</LinealSlits>'
  STRXML := '<JobType>' : EST.RL.JOB.TYPE : '</JobType>'
  STRXML := '<LabelsPerRoll>' : EST.RL.NO.PER.ROLL : '</LabelsPerRoll>'
  STRXML := '<MaxOD>' : OCONV(EST.RL.MAX.OD,'MD4') : '</MaxOD>'
  STRXML := '<MGap>' : OCONV(EST.RL.GAP.CALC,'MD4') : '</MGap>'
  STRXML := '<NumberSlits>' : EST.RL.NO.SLITS : '</NumberSlits>'
  STRXML := '<PackageLabel>' : EST.RL.PKG.LABELS : '</PackageLabel>'
  STRXML := '<QuantityPerFanFold>' : EST.RL.NO.PER.FOLD : '</QuantityPerFanFold>'
  STRXML := '<PreviousEstimate>' : EST.RL.PREV.EST : '</PreviousEstimate>'
  STRXML := '<Rolls>' : EST.RL.ROLLS : '</Rolls>'
  STRXML := '<Sheeted>' : EST.RL.SHEETS : '</Sheeted>'
  STRXML := '<SheetsPerPackage>' : EST.RL.NO.PER.PKG : '</SheetsPerPackage>'
  STRXML := '<ShringWrap>' : EST.RL.SHRK.WRP : '</ShringWrap>'
  *FIELD(EST_RL_SETS,@SM,1)
  STRXML := '<Set1>' : EST.RL.SETS<1,1,1> : '</Set1>'
  *FIELD(EST_RL_SETS,@SM,2)
  STRXML := '<Set2>' : EST.RL.SETS<1,1,2> : '</Set2>'
  STRXML := '<SizeAcross>' : OCONV(EST.RL.DIM.AC,'MD4') : '</SizeAcross>'
  STRXML := '<SizeAround>' : OCONV(EST.RL.DIM.AR,'MD4') : '</SizeAround>'
  STRXML := '<TypeChange>' : EST.RL.TYPE.CHG : '</TypeChange>'
  STRXML := '</Estimate>'
END
RETURN
