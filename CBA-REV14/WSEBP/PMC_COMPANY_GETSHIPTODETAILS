SUBROUTINE PMC_COMPANY_GETSHIPTODETAILS(CONO,DIVNO,SHPTO,STRXML,ERRMSG,SCHEMA.ONLY)
SCHEMA.ONLY = 1
$INCLUDE JCS.CPYLIB SHIPTO.DETAIL
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE ICS.CPYLIB WAREHOUSE
* OPEN FILES
*
OPEN "","COMPANY" TO COMPANY ELSE
           ERRMSG = "CANNOT OPEN COMPANY FILE"
           GOTO 99999
END
OPEN "","SHIPTO.DETAIL" TO SHIPTO.DETAIL ELSE
           ERRMSG = "CANNOT OPEN SHIPTO.DETAIL FILE"
           GOTO 99999
END
OPEN "","WAREHOUSE" TO WAREHOUSE ELSE
           ERRMSG = "CANNOT OPEN WAREHOUSE FILE"
           GOTO 99999
END
*
* INITIALIZE  VARIABLES
*
ERRMSG=""
*
* MAIN PROCESSING
*
****VEND
*DUPE.SUB: 
**
*   ECD.NUM = 54
*   ECD.ACTION = 4 ; CALL SCRN.EDIT
*   IF ECD.RET.VALUE = "" OR ECD.RET.VALUE = "END" THEN GOTO 1
*   MATREAD PO.REC FROM REG.REQ, CONO:ECD.RET.VALUE ELSE
*      ERRMSG = 'Requisition # entered not on file'
*      GOSUB 91000
*      GOTO DUPE.SUB
*   END
PO.DIV.OWNER = DIVNO
PO.SHIP.WHSE = SHPTO
MATREAD COMP.REC FROM COMPANY,CONO ELSE
ERRMSG="COMPANY NUMBER ":CONO : " DOES NOT EXIST"
GOTO 99999
END
*MATREAD SPT.REC FROM SHIP.TO, CONO:SHPTO THEN
MATREAD WHSE.REC FROM WAREHOUSE, CONO:SHPTO THEN
  SCHEMA.ONLY = 0
  *SAVE.WHSE = PO.SHIP.WHSE
  IF WHS.DIV # PO.DIV.OWNER AND PO.DIV.OWNER # "00" THEN
    ERRMSG = "Warehouse Division does not match the Owning Division"
    GOTO 99999
  END
* IF SAVE.WHSE # PO.SHIP.WHSE THEN
*    WCNT = DCOUNT(PO.WHSE,VM)
*    FOR W = 1 TO WCNT
*       READ DUMMY.REC FROM INV.WHSE, CONO:PO.PROD.NUM<1,W>:"!":PO.SHIP.WHSE ELSE
*	  ERRMSG = "WHSE ":PO.SHIP.WHSE:" INVALID FOR PROD ":PO.PROD.NUM<1,W>
*	  ERRMSG = ERRMSG:" CHECK INVENTORY"
*	  GOSUB 91000
*	  PO.SHIP.WHSE = SAVE.WHSE
*	  ECD.NUM = 32; ECD.DEFAULT = PO.SHIP.WHSE
*	  GOTO 120
*       END
*       PO.WHSE<1,W> = PO.SHIP.WHSE
*    NEXT W
* END
* T27398
STRXML:='<ShipTo><ShipToDesc>'  : WHS.DESC : '</ShipToDesc><ShipToAdd1>'  : WHS.ADDR1 : '</ShipToAdd1>'
STRXML:='<ShipToAdd2>'  : WHS.ADDR2 : '</ShipToAdd2><ShipToCity>'  : WHS.CITY : '</ShipToCity><ShipToState>'  : WHS.STATE : '</ShipToState>'
STRXML:='<ShipToZip>'  : WHS.ZIP : '</ShipToZip></ShipTo>'
END ELSE
  SCHEMA.ONLY = 0
  ERRMSG=SHPTO:" IS NOT ON FILE TRY AGAIN !"
  GOTO 99999
END
RETURN
*
* WRITE ERROR MESSAGE
*
99999*
IF ERRMSG <> "" THEN
      STRXML='<ShipTo><ErrorStack>' :ERRMSG : '</ErrorStack></ShipTo>'
      ERRMSG = "GetShiptoDetails ----> PMC_COMPANY_GETSHIPTODETAILS --->": ERRMSG
      CALL WRITELOG(ERRMSG)
END
RETURN
