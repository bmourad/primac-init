SUBROUTINE OPOR_OPORSERVICE_GETVALIDOPORLIST(CONO,VALUE,FILENAME,STRXML,ERRMSG,SCHEMA.ONLY)
SCHEMA.ONLY = 0
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE JCS.CPYLIB JOB
$INCLUDE PMC.CPYLIB DIVISION
$INCLUDE POS.CPYLIB OUTSIDE.PO
$INCLUDE CPYLIB CHAR
* OPEN FILES
*
OPEN "","COMPANY" TO COMPANY ELSE
           ERRMSG = "CANNOT OPEN COMPANY FILE"
           GOTO 99999
END
IF FILENAME = "OPOR" THEN
	OPEN "","OUT.REQ" TO DATFILE ELSE
		   ERRMSG = "CANNOT OPEN OUT.REQ FILE"
		   GOTO 99999
	END
END ELSE
	OPEN "","OUTSIDE.PO" TO DATFILE ELSE
		   ERRMSG = "CANNOT OPEN OUTSIDE.PO FILE"
		   GOTO 99999
	END
END
	OPEN "","JOB" TO JOB ELSE
		   ERRMSG = "CANNOT OPEN JOB FILE"
		   GOTO 99999
	END
	OPEN "","DIVISION" TO DIVISION ELSE
		   ERRMSG = "CANNOT OPEN DIVISION FILE"
		   GOTO 99999
	END
OPEN "","CONTROL" TO CONTROL ELSE
           ERRMSG = "CANNOT OPEN CONTROL FILE"
           GOTO 99999
END
*
* INITIALIZE  VARIABLES
*
XMLLIST = ""
LML = ""
IF FILENAME = "OPOR" THEN
  DATAFILE = "OUT.REQ"
END ELSE
  DATAFILE = "OUTSIDE.PO"
END
*
*
* MAIN PROCESSING
*
****REQUISITION LIST
MATREAD COMP.REC FROM COMPANY,CONO ELSE
SCHEMA.ONLY = 0
ERRMSG="Company number ":CONO : " does not exist"
GOTO 99999
END
 JOBNO =   VALUE
 MATREAD JOB.REC FROM JOB, CONO:JOBNO ELSE
    MAT JOB.REC = ""
    ERRMSG="Job number ":JOBNO : " does not exist"
    GOTO 99999
 END
CNT = 1
  CMD= "SSELECT ":DATAFILE:" WITH @ID LIKE '":CONO:"...'"
UDTEXECUTE CMD CAPTURING JUNG
DATA=1
LOOP
  READNEXT ID ELSE DATA=0
  WHILE DATA DO
    SCHEMA.ONLY = 0
*    IF CNT < 0 THEN CNT = 0
*    CNT = CNT + 1
 *  MATREAD OPO.REC FROM OUT.REQ, ID ELSE
   MATREAD OPO.REC FROM DATFILE, ID ELSE
*      CNT = CNT - 1
      CONTINUE
   END
   IF OPO.DIV.OWNER # "" AND JOB.DIV # "" AND OPO.DIV.OWNER # JOB.DIV THEN 
*      CNT = CNT - 1
      CONTINUE       
   END
    XMLLIST<1,CNT> = ID[4,99]
    CNT = CNT + 1
111
REPEAT
STRXML = "<ReqList>":XMLLIST:"</ReqList>"
UDTEXECUTE "CLEARSELECT"
RETURN
*
* WRITE ERROR MESSAGE
*
99999*
IF ERRMSG <> "" THEN
        STRXML:='<ErrorStack>'  : ERRMSG : '</ErrorStack>'
      ERRMSG = "GetOPORValidRequisitionList ----> OPOR_OPORSERVICE_GETVALIDOPORLIST --->": ERRMSG
      CALL WRITELOG(ERRMSG)
END
END
