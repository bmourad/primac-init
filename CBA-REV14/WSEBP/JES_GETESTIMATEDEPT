SUBROUTINE JES_GETESTIMATEDEPT(CONO, EST.ID, SCHEMA.ONLY, ERRMSG, STRXML)
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE PMC.CPYLIB COMPANY
STRXML := '<EstimateDepartment><Department></Department><DepartmentDescription></DepartmentDescription><DepartmentType></DepartmentType></EstimateDepartment>'
OPEN '','ESTIMATE' TO ESTIMATE ELSE ERRMSG = "CANNOT OPEN ESTIMATE FILE" ;GOTO 99999
OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = "CANNOT OPEN COMPANY FILE" ;GOTO 99999
* READ THE COMPANY CODE
SCHEMA.ONLY="1"
MATREAD COMP.REC FROM COMPANY,CONO ELSE
      ERRMSG=CONO:"- THIS COMPANY NUMBER DOES NOT EXIST"
      GOTO 99999      
END
MATREAD EST.REC FROM ESTIMATE, CONO:EST.ID THEN
  ECNT=DCOUNT(EST.DEPT,@VM)
  IF ECNT # "0" THEN
     STRXML=''
     SCHEMA.ONLY="0"
  END
  FOR J=1 TO ECNT     
     STRXML := '<EstimateDepartment>'
     STRXML := '<Department>' :  EST.DEPT<1,J> : '</Department>'
     STRXML := '<DepartmentDescription>' : EST.DEPT.DESC<1,J>  : '</DepartmentDescription>'
     DEPTTYPE=""
     ESTDEPTTYPE=EST.DEPT.TYPE<1,J>
       BEGIN CASE
         CASE ESTDEPTTYPE="A"
            DEPTTYPE:="Art"	   
         CASE ESTDEPTTYPE="B"
            DEPTTYPE:="Bindery"	    
         CASE ESTDEPTTYPE="M"
            DEPTTYPE:="Miscellaneous"	   
         CASE ESTDEPTTYPE="P"
            DEPTTYPE:="Press"	   
         CASE ESTDEPTTYPE="R"
            DEPTTYPE:="Prep"	   
         CASE ESTDEPTTYPE="S"
            DEPTTYPE:="Shipping"	   
         CASE 1
            DEPTTYPE:= ESTDEPTTYPE	   
       END CASE        
     STRXML := '<DepartmentType>' : DEPTTYPE  : '</DepartmentType>'     
     STRXML := '</EstimateDepartment>'
  NEXT J
END  
RETURN
*
99999*
 IF ERRMSG <> "" THEN
 ERRMSG = "GetEstimateDepartment  ---> JES_GETESTIMATEDEPT ---> " : ERRMSG
      CALL WRITELOG(ERRMSG)
 END
 RETURN
 END
