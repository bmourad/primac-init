SUBROUTINE JCS_GETCUSTOMERLIST(CONO,OUTPUTXML,SCHEMA.ONLY)
*************************************************
*OUTPUTXML='<Customer><CustomerId></CustomerId><CustomerName></CustomerName><Attention></Attention><Telephone></Telephone></Customer>'
*OUTPUTXML='<Customer><Cono></Cono><CustomerId></CustomerId><CustomerName></CustomerName><Attention></Attention><Telephone></Telephone></Customer>'
SCHEMA.ONLY = 1
ERRMSG=""
CNT = 1
$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE PMC.CPYLIB COMPANY
OPEN "COMPANY" TO COMPANY ELSE ERRMSG="CANNOT OPEN COMPANY FILE";GOTO 99999
OPEN 'CUSTOMER' TO CUSTOMER ELSE ERRMSG="CANNOT OPEN CUSTOMER FILE" ; GOTO 99999
OPEN "CONTROL" TO CONTROL ELSE STOP
*MATREAD COMP.REC FROM COMPANY,CONO ELSE
*      ERRMSG=CONO:"- THIS COMPANY NUMBER DOES NOT EXIST"
*      GOTO 99999
*END
IF CONO = "*" THEN
CMD= "SSELECT CUSTOMER"
END ELSE
MATREAD COMP.REC FROM COMPANY,CONO ELSE
ERRMSG=CONO:"- THIS COMPANY NUMBER DOES NOT EXIST"
GOTO 99999
END
CMD= "SSELECT CUSTOMER WITH @ID LIKE '" : CONO : "...'"
END
UDTEXECUTE CMD
WRITE "CONO IS " :CONO ON CONTROL,"JAM"
DATA=1
*OUTPUTXML := "<Cono>" : CONO : "</Cono>"
LOOP
 READNEXT ID ELSE DATA=0
WHILE DATA DO
  MATREAD CUST.REC FROM CUSTOMER,ID THEN
     SCHEMA.ONLY = 0
*     IF CNT = 1 THEN 
*     OUTPUTXML="<Customer>"
*     END ELSE
     OUTPUTXML:="<Customer>"
*     END
     OUTPUTXML := "<Cono>" : ID[1,3] : "</Cono>"
     OUTPUTXML:="<CustomerId>":ID[4,99]:"</CustomerId>"
     OUTPUTXML:="<CustomerName>":CUST.NAME:"</CustomerName>"
     OUTPUTXML:="<Attention>":CUST.ATTENTION:"</Attention>"
     OUTPUTXML:="<Telephone>":CUST.PHONE:"</Telephone>"  
     OUTPUTXML:="</Customer>"
     CNT = CNT + 1
  END
REPEAT
CLEARSELECT
RETURN
99999*
IF ERRMSG <> "" THEN
 ERRMSG ="GetCustomerList ----> JCS_GETCUSTOMERLIST --->": ERRMSG
     CALL WRITELOG(ERRMSG)
END
RETURN
