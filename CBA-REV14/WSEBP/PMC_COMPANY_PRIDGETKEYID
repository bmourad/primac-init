SUBROUTINE PMC_COMPANY_PRIDGETKEYID(CONO,PROCESS,STRXML,ERRMSG,SCHEMA.ONLY)
SCHEMA.ONLY = 1
$INCLUDE PMC.CPYLIB PO
$INCLUDE PMC.CPYLIB COMPANY
*
* INITIALIZE  VARIABLES
*
ERRMSG=""
IDS = ""
*
BEGIN CASE
CASE PROCESS = "RPOR"
 FILE = "REG.REQ"
CASE PROCESS = "RPO"
  FILE = "PO"
CASE PROCESS = "OPOR"
  FILE = "OUT.REQ"
CASE PROCESS = "OPO"
  FILE = "OUTSIDE.PO"
CASE 1 
  FILE = ""
  ERRMSG = "PROCESS CANNOT BE EMPTY"
  GOTO 99999
END CASE
*
* OPEN FILES
*
OPEN "","COMPANY" TO COMPANY ELSE
           ERRMSG = "CANNOT OPEN COMPANY FILE"
           GOTO 99999
END
OPEN "",FILE TO OPEN.FILE ELSE
           ERRMSG = "CANNOT OPEN ":FILE:" FILE"
           GOTO 99999
END
OPEN "","CONTROL" TO CONTROL ELSE
           ERRMSG = "CANNOT OPEN CONTROL FILE"
           GOTO 99999
END
* MAIN PROCESSING
*
****REQUISITION LIST
CNT = 0
IF CONO = "*" THEN
    CMD= "SSELECT ":FILE:" WITH @ID NE ''"
END ELSE
   MATREAD COMP.REC FROM COMPANY,CONO ELSE
     SCHEMA.ONLY = 0
     ERRMSG="Company number ":CONO : " does not exist"
     GOTO 99999
  END
  CMD= "SSELECT ":FILE:" WITH @ID LIKE '":CONO:"...'"
END
UDTEXECUTE CMD CAPTURING JUNG
DATA=1
LOOP
  READNEXT ID ELSE DATA=0
  WHILE DATA DO
    SCHEMA.ONLY = 0
   * MATREAD PO.REC FROM OPEN.FILE, ID THEN
    CNT = CNT + 1
      IF CONO = "*" THEN
	IDS<1,CNT> = ID
      END ELSE
        IDS<1,CNT> = ID[4,99]
      END
    *END
REPEAT
STRXML='<Pridget><IDS>'  : IDS  : '</IDS></Pridget>'
UDTEXECUTE "CLEARSELECT"
RETURN
*
* WRITE ERROR MESSAGE
*
99999*
IF ERRMSG <> "" THEN
      STRXML:='<Pridget><ErrorStack>'  : ERRMSG : '</ErrorStack></Pridget>'
      ERRMSG = "PridgetKeyIds ----> PMC_COMPANY_PRIDGETKEYID --->": ERRMSG
      CALL WRITELOG(ERRMSG)
END
RETURN
