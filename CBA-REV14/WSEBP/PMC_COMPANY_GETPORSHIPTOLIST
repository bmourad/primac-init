SUBROUTINE PMC_COMPANY_GETPORSHIPTOLIST(CONO,DIVNO,STRXML,ERRMSG,SCHEMA.ONLY)
SCHEMA.ONLY = 1
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE ICS.CPYLIB WAREHOUSE
* OPEN FILES
*
OPEN "","COMPANY" TO COMPANY ELSE
           ERRMSG = "CANNOT OPEN COMPANY FILE"
           GOTO 99999
END
OPEN "","WAREHOUSE" TO WAREHOUSE ELSE
           ERRMSG = "CANNOT OPEN WAREHOUSE FILE"
           GOTO 99999
END
*
* INITIALIZE  VARIABLES
*
ERRMSG=""
CONO_ID = ""
SHIPTO_ID = ""
SHIPTO_DESC = ""
SHIPTOID_DESC = ""
PO.DIV.OWNER = DIVNO
*PO.SHIP.WHSE = ID[4,99]
*
* MAIN PROCESSING
*
****SHIPTO
MATREAD COMP.REC FROM COMPANY,CONO ELSE
  ERRMSG="COMPANY NUMBER ":CONO : " DOES NOT EXIST"
  GOTO 99999
END
CNT = 0
CMD= "SSELECT WAREHOUSE WITH @ID LIKE '" : CONO : "...'"
UDTEXECUTE CMD
DATA=1
LOOP
  READNEXT ID ELSE DATA=0
  WHILE DATA DO
    SCHEMA.ONLY = 0
   MATREAD WHSE.REC FROM WAREHOUSE, ID THEN
     IF WHS.DIV # PO.DIV.OWNER AND PO.DIV.OWNER # "00" THEN
        ERRMSG = "Warehouse Division does not match the Owning Division"
        CONTINUE
     END
     CNT = CNT + 1
     CONO_ID<1,CNT> = ID[1,3]
     SHIPTO_ID<1,CNT> = ID[4,99]
     SHIPTO_DESC<1,CNT> = WHS.DESC
     SHIPTOID_DESC<1,CNT> = ID[4,99]:"-":WHS.DESC
    END
REPEAT
STRXML:='<ShipTo><Cono>' : CONO_ID : '</Cono><ShipToId>'  : SHIPTO_ID : '</ShipToId><ShipToDesc>' : SHIPTO_DESC: '</ShipToDesc>'
STRXML:='<ShipToIdDesc>' : SHIPTOID_DESC: '</ShipToIdDesc></ShipTo>'
UDTEXECUTE "CLEARSELECT"
RETURN
*
* WRITE ERROR MESSAGE
*
99999*
IF ERRMSG <> "" THEN
      ERRMSG = "GetPORShiptoList ----> PMC_COMPANY_GETPORSHIPTOLIST --->": ERRMSG
      CALL WRITELOG(ERRMSG)
END
RETURN
