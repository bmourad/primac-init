SUBROUTINE JCS_DEPARTMENTDIVISION(CONO,OUTPUTXML,SCHEMA.ONLY)
SCHEMA.ONLY = 1
 ERRMSG=""
 CNT = 1
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB DEPARTMENT
$INCLUDE PMC.CPYLIB DIVISION
OPEN "COMPANY" TO COMPANY ELSE ERRMSG="CANNOT OPEN COMPANY FILE";GOTO 99999
 OPEN 'DEPARTMENT' TO DEPARTMENT ELSE ERRMSG="CANNOT OPEN DEPARTMENT FILE" ;GOTO 99999
OPEN "DIVISION" TO DIVISION ELSE ERRMSG="CANNOT OPEN DIVISION FILE"; GOTO 99999
IF CONO = "*" THEN
 CMD= "SSELECT DEPARTMENT"
 END ELSE
MATREAD COMP.REC FROM COMPANY,CONO ELSE
ERRMSG=CONO:"- THIS COMPANY NUMBER DOES NOT EXIST"
GOTO 99999
END
CMD= "SSELECT DEPARTMENT WITH @ID LIKE '" : CONO : "...'"
END
UDTEXECUTE CMD
 DATA=1
LOOP
READNEXT ID ELSE DATA=0
WHILE DATA DO
 SCHEMA.ONLY = 0
DEPT.ACCT=''
MATREAD DEPT.REC FROM DEPARTMENT, ID ELSE
ERRMSG = "DEPARTMENT NOT FOUND"
GOTO 99999
RETURN
END
 OUTPUTXML:="<Department>"
OUTPUTXML:="<Cono>" : ID[1,3] : "</Cono>"
OUTPUTXML:= "<DepartmentID>" : ID[4,99] : "</DepartmentID>"
DIV.CNT=DCOUNT(DEPT.DIV,@VM)
FOR Y = 1 TO DIV.CNT
OUTPUTXML:= "<Division>" : DEPT.DIV<1,Y> : "</Division>"
NEXT Y
OUTPUTXML:="</Department>"
CNT = CNT + 1
REPEAT
CLEARSELECT
RETURN
99999*
 IF ERRMSG <> "" THEN
 ERRMSG = "GetDivisionList ----> JCS_GETDIVISIONLIST --->": ERRMSG
CALL WRITELOG(ERRMSG)
END 
RETURN
