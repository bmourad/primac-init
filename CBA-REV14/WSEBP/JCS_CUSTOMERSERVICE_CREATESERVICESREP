SUBROUTINE JCS_CUSTOMERSERVICE_CREATESERVICESREP(PAYLOAD,ERRMSG,STRXML)
$INCLUDE PMC.CPYLIB CSR.CODE
$INCLUDE CPYLIB CHAR
*
*---- OPEN FILES
*
ERRFLAG = 1
ERRMSG = "<Payload><Rejects>"
STRXML="<Payload><ServiceRepData>"
OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = 'COMPANY FILE MISSING';GOTO 93000
OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE MISSING';GOTO 93000
OPEN '','CSR.CODE' TO CSR.CODE ELSE ERRMSG = 'CSR.CODE FILE MISSING';GOTO 93000
OPEN "SECURITY" TO SECURITY ELSE ERRMSG="SECURITY FILE MISSING" ; GOTO 93000
MODE = PAYLOAD<1>
CONO = PAYLOAD<2>
CSR_KEY = PAYLOAD<3>
CSR_DESC = PAYLOAD<4>
CSR_USER = PAYLOAD<5>
CSR_EMAIL = PAYLOAD<6>
*********
MAT CSR.REC = ""
CSR.KEY =   CSR_KEY
READ COMP.REC FROM COMPANY, CONO ELSE
  ERRMSG="CONO # ":CONO:" DOES NOT EXIST"
  GOTO 91000
END
     IF CSR_KEY # "" AND LEN(CSR_KEY) GT 3 THEN
	 ERRFLAG = 0
	 ERRMSG := '<Reject>'
	 ERRMSG := '<RejectCode>JCSRJ001</RejectCode>' 
	 ERRMSG := '<RejectDescription>SERVICEREP # SHOULD NOT EXCEED 3 CHARACTERS</RejectDescription>'
	 ERRMSG := '</Reject>'
      END 
      IF CSR_DESC # "" AND LEN(CSR_DESC) GT 30 THEN
	 ERRFLAG = 0
	 ERRMSG := '<Reject>'
	 ERRMSG := '<RejectCode>JCSRJ002</RejectCode>' 
	 ERRMSG := '<RejectDescription>SERVICEREP DESC SHOULD NOT EXCEED 30 CHARACTERS</RejectDescription>'
	 ERRMSG := '</Reject>'
      END 
     IF CSR_USER # "" AND LEN(CSR_USER) GT 8 THEN
	 ERRFLAG = 0
	 ERRMSG := '<Reject>'
	 ERRMSG := '<RejectCode>JCSRJ003</RejectCode>' 
	 ERRMSG := '<RejectDescription>USERID SHOULD NOT EXCEED 8 CHARACTERS</RejectDescription>'
	 ERRMSG := '</Reject>'
      END 
     IF CSR_EMAIL # "" AND LEN(CSR_EMAIL) GT 30 THEN
	 ERRFLAG = 0
	 ERRMSG := '<Reject>'
	 ERRMSG := '<RejectCode>JCSRJ003</RejectCode>' 
	 ERRMSG := '<RejectDescription>EMAIL NAME SHOULD NOT EXCEED 30 CHARACTERS</RejectDescription>'
	 ERRMSG := '</Reject>'
      END 
BEGIN CASE
CASE MODE = "U"
 READ CSRREC FROM CSR.CODE,CONO:CSR_KEY ELSE
	 ERRFLAG = 0
	 ERRMSG := '<Reject>'
	 ERRMSG := '<RejectCode>JCSRJ030</RejectCode>' 
	 ERRMSG := '<RejectDescription>SERVICEREP # ':CSR_KEY:' DOES NOT EXIST,YOU CANNOT UPDATE</RejectDescription>'
	 ERRMSG := '</Reject>'
 END 
CASE MODE = "C" 
 READ CSRREC FROM CSR.CODE,CONO:CSR_KEY THEN
	 ERRFLAG = 0
	 ERRMSG := '<Reject>'
	 ERRMSG := '<RejectCode>JCSRJ031</RejectCode>' 
	 ERRMSG := '<RejectDescription>SERVICEREP # ':CSR_KEY:' ALREADY EXIST,YOU CANNOT CREATE</RejectDescription>'
	 ERRMSG := '</Reject>'
 END 
 CASE 1
	 ERRFLAG = 0
	 ERRMSG := '<Reject>'
	 ERRMSG := '<RejectCode>JCSRJ050</RejectCode>' 
	 ERRMSG := '<RejectDescription>ERROR LOADING SUBROUTINE WFBP_WFBPSERVICE_CREATESERVICESREP</RejectDescription>'
	 ERRMSG := '</Reject>'
END CASE
IF CSR_USER # '' THEN
  READ XX FROM SECURITY, CONO:CSR_USER ELSE
	 ERRFLAG = 0
	 ERRMSG := '<Reject>'
	 ERRMSG := '<RejectCode>JCSRJ032</RejectCode>' 
	 ERRMSG := '<RejectDescription>':CSR_USER:' IS NOT A VALID USER</RejectDescription>'
	 ERRMSG := '</Reject>'
  END
END
 IF ERRFLAG THEN
 STRXML:="<CompanyNo>":CONO:"</CompanyNo>"
	MATREAD CSR.REC FROM CSR.CODE, CONO:CSR_KEY THEN
	   *STRXML:="<ServiceRepId>":CSR.KEY:" Updated Successfully</ServiceRepId>"
	   STRXML:="<ServiceRepId>":CSR.KEY:"</ServiceRepId>"
	END ELSE
	   *STRXML:="<ServiceRepId>":CSR.KEY:" Created Successfully</ServiceRepId>"
	   STRXML:="<ServiceRepId>":CSR.KEY:"</ServiceRepId>"
	END
	CSR.DESC = CSR_DESC
	CSR.USER = CSR_USER
	CSR.EMAIL = CSR_EMAIL
	*STRXML:="<ServiceRepId>":CSR.KEY:"</ServiceRepId>"
	STRXML:="<ServiceRepDesc>":CSR.DESC:"</ServiceRepDesc>"
	STRXML:="<UserId>":CSR.USER:"</UserId>"
	STRXML:="<EmailName>":CSR.EMAIL:"</EmailName>"
MATWRITE CSR.REC ON CSR.CODE , CONO:CSR.KEY
STRXML:="</ServiceRepData></Payload>"
END ELSE
   ERRMSG := "</Rejects></Payload>"
   STRXML = ERRMSG
END
RETURN
********
91000*
93000*
********
  STRXML = '<Payload><Rejects><Reject><RejectCode>JCSRJ000</RejectCode>'
  STRXML :='<RejectDescription>':ERRMSG:'</RejectDescription>'
  STRXML :='</<Reject></Rejects></Payload>'
  CALL WRITELOG(ERRMSG)
RETURN
