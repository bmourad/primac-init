SUBROUTINE PMC_COMPANY_GETSHIPTOLIST(CONO,STRXML,ERRMSG,SCHEMA.ONLY)
SCHEMA.ONLY = 1
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE ICS.CPYLIB WAREHOUSE
* OPEN FILES
*
OPEN "","COMPANY" TO COMPANY ELSE
           ERRMSG = "CANNOT OPEN COMPANY FILE"
           GOTO 99999
END
OPEN "","WAREHOUSE" TO WAREHOUSE ELSE
           ERRMSG = "CANNOT OPEN WAREHOUSE FILE"
           GOTO 99999
END
*
* INITIALIZE  VARIABLES
*
ERRMSG=""
CONO_ID = ""
SHIPTO_ID = ""
SHIPTO_DESC = ""
SHIPTOID_DESC = ""
*
* MAIN PROCESSING
*
****SHIPTO
FLAG = 0
IF INDEX(CONO,"XML",1) THEN
  IF CONO[1,1] = "*" THEN CONO = CONO[1,1] ELSE CONO = CONO[1,3]
  FLAG = 1
END
IF CONO = "*" THEN
CMD= "SSELECT WAREHOUSE"
END ELSE
MATREAD COMP.REC FROM COMPANY,CONO ELSE
ERRMSG="COMPANY NUMBER ":CONO : " DOES NOT EXIST"
GOTO 99999
END
CNT = 0
CMD= "SSELECT WAREHOUSE WITH @ID LIKE '" : CONO : "...'"
END
UDTEXECUTE CMD
DATA=1
LOOP
  READNEXT ID ELSE DATA=0
  WHILE DATA DO
    SCHEMA.ONLY = 0
   MATREAD WHSE.REC FROM WAREHOUSE, ID THEN
   CNT = CNT + 1
      IF FLAG THEN
         CONO_ID<1,CNT> = ID[1,3]
         SHIPTO_ID<1,CNT> = ID[4,99]
         SHIPTO_DESC<1,CNT> = WHS.DESC
	 SHIPTOID_DESC<1,CNT> = ID[4,99]:"-":WHS.DESC
      END ELSE
STRXML:='<ShipTo><Cono>' : ID[1,3] : '</Cono><ShipToId>'  : ID[4,99] : '</ShipToId><ShipToDesc>' : WHS.DESC: '</ShipToDesc>'
STRXML:='<ShipToIdDesc>' : ID[4,99]:"-":WHS.DESC: '</ShipToIdDesc></ShipTo>'
      END
    END
REPEAT
IF FLAG THEN
STRXML:='<ShipTo><Cono>' : CONO_ID : '</Cono><ShipToId>'  : SHIPTO_ID : '</ShipToId><ShipToDesc>' : SHIPTO_DESC: '</ShipToDesc>'
STRXML:='<ShipToIdDesc>' : SHIPTOID_DESC: '</ShipToIdDesc></ShipTo>'
END
UDTEXECUTE "CLEARSELECT"
RETURN
*
* WRITE ERROR MESSAGE
*
99999*
IF ERRMSG <> "" THEN
      ERRMSG = "GetShiptoList ----> PMC_COMPANY_GETSHIPTOLIST --->": ERRMSG
      CALL WRITELOG(ERRMSG)
END
RETURN
