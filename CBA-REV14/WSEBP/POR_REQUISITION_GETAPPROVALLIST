SUBROUTINE POR_REQUISITION_GETAPPROVALLIST(CONO,USRID,STRXML,ERRMSG,SCHEMA.ONLY)
SCHEMA.ONLY = 1
$INCLUDE POS.CPYLIB APP.REQ
$INCLUDE PMC.CPYLIB COMPANY
* OPEN FILES
*
OPEN "","COMPANY" TO COMPANY ELSE
           ERRMSG = "CANNOT OPEN COMPANY FILE"
           GOTO 99999
END
OPEN "","APP.REQ" TO APP.REQ ELSE
           ERRMSG = "CANNOT OPEN APP.REQ FILE"
           GOTO 99999
END
OPEN "","CONTROL" TO CONTROL ELSE
           ERRMSG = "CANNOT OPEN CONTROL FILE"
           GOTO 99999
END
OPEN '','SECURITY' TO SECURITY ELSE 
   ERRMSG="CANNOT OPEN SECURITY FILE"
   GOTO 99999
END
*
* INITIALIZE  VARIABLES
*
ERRMSG=""
CONO_ID = ""
USR_ID = ""
DIV_ID = ""
*
* MAIN PROCESSING
*
****APPROVAL LIST
FLAG = 0
IF INDEX(CONO,"XML",1) THEN
  IF CONO[1,1] = "*" THEN CONO = CONO[1,1] ELSE CONO = CONO[1,3]
  *CONO = CONO[1,3]
  FLAG = 1
END
MATREAD COMP.REC FROM COMPANY,CONO ELSE
SCHEMA.ONLY = 0
ERRMSG="Company number ":CONO : " does not exist"
GOTO 99999
END
READ SEC.REC FROM SECURITY, CONO:USRID ELSE
  SCHEMA.ONLY = 0
  ERRMSG = "User ":USRID:" is not a valid user"
  GOTO 99999
END
CNT = 0
*CMD= "SSELECT APP.REQ WITH @ID LIKE '...":USRID:"...'"
CMD= "SSELECT APP.REQ WITH @ID LIKE '":CONO:USRID:"...'"
UDTEXECUTE CMD CAPTURING JUNG
DATA=1
LOOP
  READNEXT ID ELSE DATA=0
  WHILE DATA DO
    SCHEMA.ONLY = 0
    MATREAD APP.REQ.REC FROM APP.REQ, ID THEN
    CNT = CNT + 1
    USRID = FIELD(ID[4,99],"!",1)
    DIV = FIELD(ID[4,99],"!",2)
      IF FLAG THEN
        USR_ID<1,CNT> = USRID
        DIV_ID<1,CNT> = DIV 
      END ELSE
*STRXML:='<Approval><Cono>': ID[1,3] :'</Cono><ApprovalUserId>'  : USRID : '</ApprovalUserId><ApprovalDivison>'  : DIV : '</ApprovalDivison></Approval>'
STRXML:='<Approval><ApprovalUserId>'  : USRID : '</ApprovalUserId><ApprovalDivison>'  : DIV : '</ApprovalDivison></Approval>'
      END
    END
REPEAT
IF FLAG THEN
STRXML:='<Approval><ApprovalUserId>'  : USR_ID : '</ApprovalUserId><ApprovalDivison>'  : DIV_ID : '</ApprovalDivison></Approval>'
END
UDTEXECUTE "CLEARSELECT"
RETURN
*
* WRITE ERROR MESSAGE
*
99999*
IF ERRMSG <> "" THEN
      STRXML:='<Approval><ErrorStack>'  : ERRMSG : '</ErrorStack></Approval>'
      ERRMSG = "GetApprovalList ----> POR_REQUISITION_GETAPPROVALLIST --->": ERRMSG
      CALL WRITELOG(ERRMSG)
END
RETURN
