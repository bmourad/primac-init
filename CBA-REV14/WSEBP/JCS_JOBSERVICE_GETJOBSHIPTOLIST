SUBROUTINE JCS_GETJOBSHIPTOLIST(CONO, JOBID, ERRMSG, OUT_PARAM_SHIPTOLIST,SCHEMA.ONLY)
OUT_PARAM_SHIPTOLIST ='<JobShipTo><Customer></Customer><CustomerName></CustomerName><DestinationName></DestinationName><JobDescription></JobDescription><JobNumber></JobNumber><ShipToName></ShipToName><ShipToNo></ShipToNo><Store></Store></JobShipTo>'
SCHEMA.ONLY = 1
CNTR = 1
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE JCS.CPYLIB CUST.TEMPLATE.LIST
$INCLUDE JCS.CPYLIB SHIPTO.MASTER
$INCLUDE JCS.CPYLIB JOB
**OUT_PARAM_SHIPTOLIST=''
ERRMSG=''
OPEN '','SHIPTO.MASTER' TO SHIPTO.MASTER ELSE ERRMSG = "CANNOT OPEN SHIPTO.MASTER FILE" ;GOTO 99999
OPEN '','CUST.TEMPLATE.LIST' TO CUST.TEMPLATE.LIST ELSE ERRMSG = "CANNOT OPEN CUST.TEMPLATE.LIST FILE" ;GOTO 99999
OPEN '','JOB' TO JOB ELSE ERRMSG = "CANNOT OPEN JOB FILE" ;GOTO 99999
OPEN '','CUSTOMER' TO CUSTOMER ELSE ERRMSG = "CANNOT OPEN CUSTOMER FILE" ;GOTO 99999
OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = "CANNOT OPEN COMPANY FILE" ;GOTO 99999
* READ THE COMPANY CODE
MATREAD COMP.REC FROM COMPANY,CONO ELSE
      ERRMSG=CONO:"- THIS COMPANY NUMBER DOES NOT EXIST"
      GOTO 99999
END
MATREAD JOB.REC FROM JOB, CONO:JOBID THEN
MATREAD CTL.REC FROM CUST.TEMPLATE.LIST,CONO:JOB.CUST:"!":JOBID:"!":"001" ELSE MAT CTL.REC=''
READV CUST.NAME FROM CUSTOMER,CONO:JOB.CUST, 1 ELSE CUST.NAME=''
CNT=DCOUNT(CTL.SHIPS,@VM)
 IF CNT > 0 THEN
**  OUT_PARAM_SHIPTOLIST = '<JobShipToData>'
  FOR I=1 TO CNT 
  MATREAD SHM.REC FROM SHIPTO.MASTER, '001':CTL.SHIPS<1,I> ELSE MAT SHM.REC=''
  SCHEMA.ONLY = 0
  IF CNTR = 1 THEN
  OUT_PARAM_SHIPTOLIST = '<JobShipTo>'
  END ELSE
  OUT_PARAM_SHIPTOLIST := '<JobShipTo>'
  END
  OUT_PARAM_SHIPTOLIST := '<Customer>' : JOB.CUST : '</Customer>'
  OUT_PARAM_SHIPTOLIST := '<CustomerName>' : CUST.NAME : '</CustomerName>'
  OUT_PARAM_SHIPTOLIST := '<DestinationName>' : SHM.DT.NAME : '</DestinationName>'
  OUT_PARAM_SHIPTOLIST := '<JobDescription>' : JOB.DESC<1,1> : '</JobDescription>'
  OUT_PARAM_SHIPTOLIST := '<JobNumber>' : JOBID : '</JobNumber>'
  OUT_PARAM_SHIPTOLIST := '<ShipToName>' : SHM.SP.NAME : '</ShipToName>'
  OUT_PARAM_SHIPTOLIST := '<ShipToNo>' : CTL.SHIPS<1,I> : '</ShipToNo>'
  OUT_PARAM_SHIPTOLIST := '<Store>' : SHM.SP.STORE : '</Store>'
  OUT_PARAM_SHIPTOLIST := '</JobShipTo>' 
  CNTR = CNTR + 1
  NEXT I
**  OUT_PARAM_SHIPTOLIST := OUT_PARAM_SHIPTOLIST
**  OUT_PARAM_SHIPTOLIST := '</JobShipToData>'
 END 
END
RETURN
*
*
99999*
 IF ERRMSG <> "" THEN
 ERRMSG = "GetJobShipToList ---> JCS_GETJOBSHIPTOLIST ---> " : ERRMSG
      CALL WRITELOG(ERRMSG)
 END
 RETURN
 END
