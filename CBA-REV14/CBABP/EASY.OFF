********************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* DATE        - 10/11/83
* BY          - EVAN E. PRICE  ,  C.B.A
* DESCRIPTION - CLEARS THE LOGON USER-ID FROM 
*               THE EASY.MENUS FILE BASED ON THE PORT NUMBER.
* ENDDOC
********************************************************
*
     EQU AM TO CHAR(254)
*     PORT.ACCT = OCONV(0,"U50BB")
*     PORT.NO = FIELD(PORT.ACCT," ",1)
*     ACCT.NM = FIELD(PORT.ACCT," ",2)
*     PORT.NO = SYSTEM(18)
      PORT.NO = 'TTY'
      CALL SYSVARS.SUB(PORT.NO)
*     IND.POS = INDEX(PORT.NO,'/',1)
*     IF IND.POS = 0 THEN
*        PORT.NO = PORT.NO[4,(LEN(PORT.NO)-3)]
*     END ELSE
*        PORT.NO = PORT.NO[4,IND.POS-4]
*     END
*      ACCT.NM = SYSTEM(19)
       ACCT.NM = @WHO
     CH.KEY = STR("0",2-LEN(PORT.NO)):PORT.NO
     DV.KEY = "PORT*":STR("0",3-LEN(PORT.NO)):PORT.NO
*
     PW.REC = ""
     PORTS.ID = ""
*
     OPEN '','EASY.MENUS' TO MENUS ELSE
        STOP 'EASY.MENUS MISSING'
     END
     OPEN 'DICT','CHANNEL' TO D.CHNL ELSE
        STOP 'DICT CHANNEL MISSING'
     END
     OPEN "","DEVICES" TO DEVICES ELSE
        STOP 'DEVICES MISSING'
     END
     OPEN "","CONTROL" TO CONTROL ELSE
        STOP 'CONTROL MISSING'
     END
*
     READ PW.REC FROM MENUS, "R.":PORT.NO ELSE
        GOTO 9999
     END
     READ PORTS.ID FROM CONTROL , "PORT.INT" ELSE
       PORTS.ID<PORT.NO+1> = "UNKNOWN"
     END
     IF PW.REC<3> # "SUPP" THEN
        DELETE MENUS, "R.":PORT.NO
        PORT.NA = PORTS.ID<PORT.NO+1>
        WRITEV PORT.NA ON D.CHNL, CH.KEY,1
        WRITEV PORT.NA ON DEVICES, DV.KEY,1
     END ELSE
        PW.REC<3> = ""
        WRITE PW.REC ON MENUS, "R.":PORT.NO
        PORT.NA = PORTS.ID<PORT.NO+1>
        WRITEV PORT.NA ON D.CHNL, CH.KEY,1
        WRITEV PORT.NA ON DEVICES, DV.KEY,1
     END
*
*  END JOB
*
9999*
     END
