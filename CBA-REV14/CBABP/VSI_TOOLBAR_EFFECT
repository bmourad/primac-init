   SUBROUTINE VSI_TOOLBAR_EFFECT (ERRMSG, BARHNDL, FILENAME, ID, VALDAT)
*COPY>CPYLIB>CHAR
*
   ERRMSG = ""
   TBAR_TYP = 1
   TBAR_VAL = 2
   TBAR_BIT = 3
   TBAR_HLP = 4
*
   OPEN '','PMCBARS' TO PMCBARS ELSE
      ERRMSG = "PMCBARS FILE IS MISSING"
      GOTO 999999
   END
   READ MBAR_REC FROM PMCBARS, "MAIN" ELSE
      ERRMSG = "MAIN TOOLBAR RECORD IS MISSING"
      GOTO 999999
   END
*
   IF FILENAME = "PMCBARS" THEN
      READ BAR_REC FROM PMCBARS, ID ELSE
         ERRMSG = ID : " TOOLBAR RECORD IS MISSING"
         GOTO 999999
      END
   END ELSE
      OPEN '',FILENAME TO BARFILE ELSE
         ERRMSG = FILENAME : " FILE IS MISSING"
         GOTO 999999
      END
      READ BAR_REC FROM BARFILE, ID ELSE
         ERRMSG = ID : " TOOLBAR RECORD IS MISSING"
         GOTO 999999
      END
   END
*
OPEN "","TCC" TO TCC THEN
   TU_VERNO_ID = "T_":@LOGNAME
   READ TU_VERNO FROM TCC, TU_VERNO_ID ELSE TU_VERNO = ""
END ELSE
   TU_VERNO = ""
END
*
   TEBUTTON = ""
   TEEFFECT = ""
   TEVALDAT = CHANGE(VALDAT,",",VM)
   MCNT = DCOUNT(MBAR_REC<2>,VM)
   BCNT = DCOUNT(BAR_REC<2>,VM)
   FOR BB = 1 TO BCNT
      TEBUTTON<1,BB> = BB
      TEEFFECT<1,BB> = "ENABLED"
      IF BB > MCNT THEN
         CHK_VAL = BAR_REC<2,BB,TBAR_VAL>
         LOCATE CHK_VAL IN TEVALDAT<1>,1 SETTING TEFND ELSE
            TEEFFECT<1,BB> = "DISABLED"
         END
      END
   NEXT BB
   TU_FUNC = "TU.TOOLBAR.EFFECT":TU_VERNO
   CALL @TU_FUNC(BARHNDL,TEBUTTON,TEEFFECT,ERROR)
999999*
   RETURN
END
