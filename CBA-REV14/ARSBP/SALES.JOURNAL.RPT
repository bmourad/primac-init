*************************************************************
*
* REVISION      - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
*
* PROGRAM       - SALES.JOURNAL.RPT
*
* SYSTEM        - ARSBP
*
* BY            - RHONDA PERRIN, COMPUTER BUSINESS ASSOCIATES
*
* DATE          - 04/05/85
*
* DESCRIPTION   -
* This program produces a Sales Journal report.
* TASK 20011 JR ADD DIVISION
* TASK 20532 JR EXPAND INVOICE AMOUNT FIELDS TO 8.2
*
*T25901 cmykleb 02/20/2002 * Replace "Report No : XXXX" in heading to
*                            "Requested By : " User id.
*T27646 thompson 08/18/2003 * ALLOW FOR MULTI PLATFORM USE
*ENDDOC
*************************************************************
*
*---- FILE EQUATES
*
*COPY>CPYLIB>SYSCOM
*COPY>CPYLIB>CHAR
*COPY>CPYLIB>FILE.VARS
*COPY>PMC.CPYLIB>COMPANY
*COPY>PMC.CPYLIB>SALESMAN
*COPY>ARS.CPYLIB>SALES.JOURNAL.TEMP
*
*---- SETUP FOR SYSTEM ERROR MESSAGES
*
   SYS.TYPE=1
   CALL SYSCOM(MAT SYSCOM.REC)
*
*---- PROCREAD
*
   PROCREAD XX ELSE
      ERRMSG="MUST BE RUN FROM A PROC"
      GOSUB 91000
      GOTO 99999
   END
   CONO = XX<1>
   CO.NAME = XX<2>
   PER=XX<3>
   DET.FLAG = XX<4>
   FILE.FLAG = XX<6>
   DIV.BREAK = XX<7>
   DIV.OWNER = XX<8>; * TASK 20011
   PERIOD = PER[5,2]:"/":PER[1,4]
   LOGNAME = 'LOGNAME'; CALL SYSVARS.SUB(LOGNAME); *T27646
   USER.ID = UPCASE(LOGNAME) ; * T26901
* TASK 20011
*    BEGIN CASE
*       CASE FILE.FLAG = "J"
*          HLINE3 = SPACE(59):"BY JOB INVOICE" : SPACE(42)
*       CASE FILE.FLAG = "O"
*          HLINE3 = SPACE(58):"BY ORDER INVOICE" : SPACE(41)
*       CASE FILE.FLAG = "M"
*          HLINE3 = SPACE(57):"BY MANUAL INVOICE" : SPACE(41)
*       CASE FILE.FLAG = "A"
*          HLINE3 = SPACE(56):"BY ALL INVOICE TYPES" : SPACE(39)
*       CASE 1
*          ERRMSG = "INVALID REQUEST PASSED FROM PROC TO PROGRAM"
*          GOTO 93000
*    END CASE
   BEGIN CASE
      CASE FILE.FLAG = "J"
         HLINE3 = "BY JOB INVOICE"  
      CASE FILE.FLAG = "O"
         HLINE3 = "BY ORDER INVOICE"  
      CASE FILE.FLAG = "M"
         HLINE3 = "BY MANUAL INVOICE"  
      CASE FILE.FLAG = "A"
         HLINE3 = "BY ALL INVOICE TYPES"  
      CASE 1
         ERRMSG = "INVALID REQUEST PASSED FROM PROC TO PROGRAM"
         GOTO 93000
   END CASE
   HLINE3.1 = "DIVISION : ":DIV.OWNER
   SSP = INT(((132 - LEN(HLINE3))/2) - LEN(HLINE3.1) + .5)
*T25901 v
*  HLINE3 = HLINE3.1:SPACE(SSP):HLINE3
   HLINE3 = HLINE3.1:SPACE(SSP + 8):HLINE3
*T25901 ^
   HLINE3 = HLINE3"L#132":"'L'"
   HLINE3A = SPACE(66): "PERIOD : " : PERIOD : " 'LL'"
   SP = SPACE(1); SP2 = SPACE(2)
*T25901 v
*  HLINE1 = "REPORT NO: XXXX" : SPACE(26)
*  N=SPACE((50 - LEN(CO.NAME)) / 2)
*  HLINE1 = HLINE1 : N : CO.NAME : N
*  HLINE1 = HLINE1 : SPACE(10) : " 'TL'"
*  HLINE2 = SPACE(46) : "S A L E S   J O U R N A L   R E P O R T" :SPACE(32)
*  HLINE2 = HLINE2 : "PAGE : 'PL'"
   CO.NAME = ""
   REPORT.NAME = ""
   REPORT.NUMBER = XX<2>
   HLINE1 = "" ; HLINE2 = ""
   CALL GET.PROG.HEAD(CONO,CO.NAME,REPORT.NAME,REPORT.NUMBER,"",HLINE1,HLINE2)
   HLINE1 = HLINE1 : " 'PL'"
*T25901 ^
   IF DET.FLAG = "D" THEN
      HLINE4 = "SLSREP CUST "
      HLINE5 = "----- ------"
   END ELSE
      HLINE4 = "  SALESREP  "
      HLINE5 = "------------"
   END
   HLINE4 = HLINE4 : " JB&OD/INV      WEB         SHEET        OTHER    "
   HLINE4 = HLINE4 : "NET PRINTING   AGENCY    FREIGHT   GROSS TOTAL  SALES TAX GRAND TOTAL"
   HLINE4 = HLINE4 : "'L'"
   HLINE5 = HLINE5 : SP : STR('-',9) : SP : STR('-',12) : SP : STR('-',12)
   HLINE5 = HLINE5 : SP : STR('-',12) : SP : STR('-',12) : SP : STR('-',10) : SP
   HLINE5 = HLINE5 : STR('-',9) : SP : STR('-',12) : SP : STR('-',10) : SP
   HLINE5 = HLINE5 : STR('-',12) 
*---- DIMENTION VARIABLES
*
   DIM SLSM(11)
   DIM SUB(11)
   DIM DIV(11)
   DIM TOT(11)
*
*---- OPEN FILES
*
   OPEN '','COMPANY' TO COMPANY ELSE ERRMSG='COMPANY FILE MISSING';GOTO 93000
   OPEN '','SALESMAN' TO SALESMAN ELSE ERRMSG='SALESMAN FILE MISSING';GOTO 93000
   OPEN '','SALES.JOURNAL.TEMP' TO SALES.JOURNAL.TEMP ELSE ERRMSG='SALES.JOURNAL.TEMP FILE MISSING';GOTO 93000
*
*---- INITIALIZATION
*
   READNEXT SJT.ID ELSE GOTO 99999
   MATREAD SJT.REC FROM SALES.JOURNAL.TEMP, SJT.ID ELSE GOTO 99999
   INV.FLG = FIELD(SJT.ID,'*',2)
   MAT SLSM = 0
   MAT SUB = 0
   MAT DIV = 0
   MAT TOT = 0
   SLINE = SPACE(13) : STR('-',9) : SP : STR('-',12) : SP  : STR('-',12) : SP
   SLINE = SLINE : STR('-',12) : SP : STR('-',12) : SP : STR('-',10) : SP
   SLINE = SLINE : STR('-',9) : SP : STR('-',12) : SP : STR('-',10) : SP
   SLINE = SLINE : STR('-',12)
   GLINE = SPACE(13) : STR('=',9) : SP : STR('=',12) : SP : STR('=',12) : SP
   GLINE = GLINE : STR('=',12) : SP : STR('=',12) : SP : STR('=',10) : SP
   GLINE = GLINE : STR('=',9) : SP : STR('=',12) : SP : STR('=',10) : SP
   GLINE = GLINE : STR('=',12)
   PRINTER ON
   HEADING HLINE1 : HLINE2 : HLINE3 : HLINE3A : HLINE4 : HLINE5
*
*---- MAIN PROCESSING
*
   PREV.JOB = SJT.JOB
   IF INV.FLG # "M" THEN SLSM(1) = 1
   PREV.DIV = SJT.DIV
   PREV.SLSM = SJT.SLSM
   PREV.SSLSM = SJT.SSLSM
   MATREAD SALESMAN.REC FROM SALESMAN, CONO : PREV.SLSM ELSE
      SALS.NAME = 'UNKNOWN'
   END
   PRINT SALS.NAME
   DATA = 1
   LOOP
      BEGIN CASE
         CASE DIV.BREAK = "Y" AND PREV.DIV <> SJT.DIV
            GOSUB 1000
            GOSUB 1500
            GOSUB 2000
            MATREAD SALESMAN.REC FROM SALESMAN, CONO : PREV.SLSM ELSE
               SALS.NAME = 'UNKNOWN'
            END
            PRINT SALS.NAME
         CASE PREV.SSLSM <> SJT.SSLSM
            GOSUB 1000
            GOSUB 1500
            PRINT
            MATREAD SALESMAN.REC FROM SALESMAN, CONO : PREV.SLSM ELSE
               SALS.NAME = 'UNKNOWN'
            END
            PRINT SALS.NAME
         CASE PREV.SLSM <> SJT.SLSM
            GOSUB 1000
            IF DET.FLAG = "D" THEN PRINT
            MATREAD SALESMAN.REC FROM SALESMAN, CONO : PREV.SLSM ELSE
               SALS.NAME = 'UNKNOWN'
            END
            PRINT SALS.NAME
      END CASE
      IF DET.FLAG = 'D' THEN
         PLINE = SPACE(6) : SJT.CUST "L#6"
         PLINE = PLINE : SP : SJT.JOB "L#9"
* T20532
*           PLINE = PLINE : SP : OCONV(SJT.WEB,"MD2,") "R#12"
*           PLINE = PLINE : SP : OCONV(SJT.SHEET,"MD2,") "R#12"
*           PLINE = PLINE : SP : OCONV(SJT.OTHER,"MD2,") "R#12"
*           PLINE = PLINE : SP : OCONV(SJT.NET,"MD2,") "R#12"
*           PLINE = PLINE : SP : OCONV(SJT.AGENCY,"MD2,") "R#10"
*           PLINE = PLINE : SP : OCONV(SJT.POSTAGE,"MD2,") "R#9"
*           PLINE = PLINE : SP : OCONV(SJT.GROSS,"MD2,") "R#12"
*           PLINE = PLINE : SP : OCONV(SJT.TAX,"MD2,") "R#10"
*           PLINE = PLINE : SP : OCONV(SJT.GRAND,"MD2,") "R#12"
         PLINE = PLINE : SP : OCONV(SJT.WEB,"MD2") "R#12"
         PLINE = PLINE : SP : OCONV(SJT.SHEET,"MD2") "R#12"
         PLINE = PLINE : SP : OCONV(SJT.OTHER,"MD2") "R#12"
         PLINE = PLINE : SP : OCONV(SJT.NET,"MD2") "R#12"
         PLINE = PLINE : SP : OCONV(SJT.AGENCY,"MD2") "R#10"
         PLINE = PLINE : SP : OCONV(SJT.POSTAGE,"MD2") "R#9"
         PLINE = PLINE : SP : OCONV(SJT.GROSS,"MD2") "R#12"
         PLINE = PLINE : SP : OCONV(SJT.TAX,"MD2") "R#10"
         PLINE = PLINE : SP : OCONV(SJT.GRAND,"MD2") "R#12"
* T20532           
         PRINT PLINE
      END
      IF INV.FLG # "M" THEN
         IF PREV.JOB <> SJT.JOB THEN
            SLSM(1) = SLSM(1) + 1
            PREV.JOB = SJT.JOB
         END
      END
      SLSM(2) = SLSM(2) + 1
      SLSM(3) = SLSM(3) + SJT.WEB
      SLSM(4) = SLSM(4) + SJT.SHEET
      SLSM(5) = SLSM(5) + SJT.OTHER
      SLSM(6) = SLSM(6) + SJT.NET
      SLSM(7) = SLSM(7) + SJT.AGENCY
      SLSM(8) = SLSM(8) + SJT.POSTAGE
      SLSM(9) = SLSM(9) + SJT.GROSS
      SLSM(10) = SLSM(10) + SJT.TAX
      SLSM(11) = SLSM(11) + SJT.GRAND
      READNEXT SJT.ID ELSE DATA = 0
   WHILE DATA DO
      MATREAD SJT.REC FROM SALES.JOURNAL.TEMP, SJT.ID ELSE
         MAT SJT.REC = ''
      END
      INV.FLG = FIELD(SJT.ID,'*',2)
   REPEAT
   MAT SJT.REC = ''
   GOSUB 1000
   GOSUB 1500
   IF DIV.BREAK = "Y" THEN
      GOSUB 2000
   END ELSE
      GOSUB 2100
   END
   PRINT GLINE
   PNAME = "* CO - " : CONO : " *"
   PLINE = PNAME "L#12" : SP : TOT(1) "R#4" : "/" : TOT(2) "L#4"
* T20532
*     PLINE = PLINE : SP : OCONV(TOT(3),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(TOT(4),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(TOT(5),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(TOT(6),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(TOT(7),"MD2,") "R#10"
*     PLINE = PLINE : SP : OCONV(TOT(8),"MD2,") "R#9"
*     PLINE = PLINE : SP : OCONV(TOT(9),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(TOT(10),"MD2,") "R#10"
*     PLINE = PLINE : SP : OCONV(TOT(11),"MD2,") "R#12"
   PLINE = PLINE : SP : OCONV(TOT(3),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(TOT(4),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(TOT(5),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(TOT(6),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(TOT(7),"MD2") "R#10"
   PLINE = PLINE : SP : OCONV(TOT(8),"MD2") "R#9"
   PLINE = PLINE : SP : OCONV(TOT(9),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(TOT(10),"MD2") "R#10"
   PLINE = PLINE : SP : OCONV(TOT(11),"MD2") "R#12"
* T20532
   PRINT PLINE
   GOTO 99999
1000 IF DET.FLAG = "D" THEN
      PRINT SLINE
   END
   PLINE = PREV.SLSM "L#12" : SP : SLSM(1) "R#4" : "/" : SLSM(2) "L#4"
* T20532
*     PLINE = PLINE : SP : OCONV(SLSM(3),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(SLSM(4),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(SLSM(5),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(SLSM(6),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(SLSM(7),"MD2,") "R#10"
*     PLINE = PLINE : SP : OCONV(SLSM(8),"MD2,") "R#9"
*     PLINE = PLINE : SP : OCONV(SLSM(9),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(SLSM(10),"MD2,") "R#10"
*     PLINE = PLINE : SP : OCONV(SLSM(11),"MD2,") "R#12"
   PLINE = PLINE : SP : OCONV(SLSM(3),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(SLSM(4),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(SLSM(5),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(SLSM(6),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(SLSM(7),"MD2") "R#10"
   PLINE = PLINE : SP : OCONV(SLSM(8),"MD2") "R#9"
   PLINE = PLINE : SP : OCONV(SLSM(9),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(SLSM(10),"MD2") "R#10"
   PLINE = PLINE : SP : OCONV(SLSM(11),"MD2") "R#12"
   PRINT PLINE
   FOR I = 1 TO 11
      SUB(I) = SUB(I) + SLSM(I)
      SLSM(I) = 0
   NEXT I
   PREV.SLSM = SJT.SLSM
   RETURN
1500 PRINT SLINE
   PNAME = "* SUBTOTAL *"
   PLINE = PNAME "L#12" : SP : SUB(1) "R#4" : "/" : SUB(2) "L#4"
* T02532
*     PLINE = PLINE : SP : OCONV(SUB(3),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(SUB(4),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(SUB(5),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(SUB(6),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(SUB(7),"MD2,") "R#10"
*     PLINE = PLINE : SP : OCONV(SUB(8),"MD2,") "R#9"
*     PLINE = PLINE : SP : OCONV(SUB(9),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(SUB(10),"MD2,") "R#10"
*     PLINE = PLINE : SP : OCONV(SUB(11),"MD2,") "R#12"
   PLINE = PLINE : SP : OCONV(SUB(3),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(SUB(4),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(SUB(5),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(SUB(6),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(SUB(7),"MD2") "R#10"
   PLINE = PLINE : SP : OCONV(SUB(8),"MD2") "R#9"
   PLINE = PLINE : SP : OCONV(SUB(9),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(SUB(10),"MD2") "R#10"
   PLINE = PLINE : SP : OCONV(SUB(11),"MD2") "R#12"
* T20532
   PRINT PLINE
   FOR I = 1 TO 11
      DIV(I) = DIV(I) + SUB(I)
      SUB(I) = 0
   NEXT I
   PREV.SSLSM = SJT.SSLSM
   RETURN
2000 *
   PRINT SLINE
   PNAME = "* DIV - " : PREV.DIV : " *"
   PLINE = PNAME "L#12" : SP : DIV(1) "R#4" : "/" : DIV(2) "L#4"
* T20532
*     PLINE = PLINE : SP : OCONV(DIV(3),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(DIV(4),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(DIV(5),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(DIV(6),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(DIV(7),"MD2,") "R#10"
*     PLINE = PLINE : SP : OCONV(DIV(8),"MD2,") "R#9"
*     PLINE = PLINE : SP : OCONV(DIV(9),"MD2,") "R#12"
*     PLINE = PLINE : SP : OCONV(DIV(10),"MD2,") "R#10"
*     PLINE = PLINE : SP : OCONV(DIV(11),"MD2,") "R#12"
   PLINE = PLINE : SP : OCONV(DIV(3),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(DIV(4),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(DIV(5),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(DIV(6),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(DIV(7),"MD2") "R#10"
   PLINE = PLINE : SP : OCONV(DIV(8),"MD2") "R#9"
   PLINE = PLINE : SP : OCONV(DIV(9),"MD2") "R#12"
   PLINE = PLINE : SP : OCONV(DIV(10),"MD2") "R#10"
   PLINE = PLINE : SP : OCONV(DIV(11),"MD2") "R#12"
* T20532
   PRINT PLINE
   PRINT
2100 FOR I = 1 TO 11 
      TOT(I) = TOT(I) + DIV(I)
      DIV(I) = 0
   NEXT I
   PREV.DIV = SJT.DIV
   RETURN
*
*---- CALLS FOR SYSCOM
*
91000*
   ERR.TYPE=1
   CALL SYSCOM(MAT SYSCOM.REC)
   RETURN
93000*
   PRINTER OFF
   PRINTER CLOSE
   ERR.TYPE=3
   CALL SYSCOM(MAT SYSCOM.REC)
99999*
   PRINTER OFF
   PRINTER CLOSE
END
