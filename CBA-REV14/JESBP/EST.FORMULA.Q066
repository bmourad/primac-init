   SUBROUTINE EST.FORMULA.Q066 (CONO, ACTION, EQTY, DEPT, COMP)
***************************************************************************
*
* REVISION - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
*
* PROGRAM  - EST.FORMULA.Q066
*
* AUTHOR   - NICK AMENDOLA, COMPUTER BUSINESS ASSOCIATES
*
* DATE     - 12/08/86
*
* DESCRIPTION
*
* This formula is used to calculate the number of sheets or yards of side
* cloth required for casebound book.
*
*T27924 cmykleb 03/12/2004 * Move estimate qty to the component level.
***************************************************************************
*
*---- COPY STATEMENTS
*
*COPY>JES.CPYLIB>SCOMMON.ESTIMATE
*COPY>JES.CPYLIB>ESTIMATE
*COPY>JES.CPYLIB>ESTIMATE.MATL
*COPY>JES.CPYLIB>ESTIMATE.TEMP
*COPY>JES.CPYLIB>ESTIMATE.BIND.SPOIL
*COPY>JES.CPYLIB>JES.FILE.VARS
*COPY>CPYLIB>EDIT.COM
*COPY>CPYLIB>CHAR
*
*---- INITIALIZATION
*
   TEMP.QTY = ""
   TYP = 0
   LOCATE EQTY IN EST.QTY<1>,1 SETTING QPTR ELSE RETURN
*T27924 v
   CQTY = EST.COMP.QTY<1,COMP,QPTR>
   BEGIN CASE
      CASE CQTY=""
         COMPQTY = EQTY
      CASE (CQTY[1,1]="+" OR CQTY[1,1]="-") AND CQTY[LEN(CQTY),1]="%"
         COMPQTY = INT(EQTY * (1 + (CQTY[1,LEN(CQTY)-1]/100)) + 0.5)
      CASE CQTY[1,1]="+" OR CQTY[1,1]="-"
         COMPQTY = EQTY + CQTY
      CASE 1
         COMPQTY = CQTY
   END CASE
   IF COMPQTY < 0 THEN COMPQTY = 0
*T27924 ^
   IF TEMP.TYPE[1,1] = "M" THEN
      LOCATE TEMP.OPV IN ESTM.PROD<1>,1 SETTING MP ELSE RETURN
   END
*T27924 v
*  CLOTH.WIDTH = EST.CASE.SIDE.CL.CUT.SIZE<1,1> / 10000
*  CLOTH.LENGTH = EST.CASE.SIDE.CL.CUT.SIZE<1,2> / 10000
*  NO.OUT = INT(EST.CASE.SIDE.CL.CUT.OUT / 100)
   CLOTH.WIDTH = EST.CASE.SIDE.CL.CUT.SIZE<1,COMP,1> / 10000
   CLOTH.LENGTH = EST.CASE.SIDE.CL.CUT.SIZE<1,COMP,2> / 10000
   NO.OUT = INT(EST.CASE.SIDE.CL.CUT.OUT<1,COMP> / 100)
*T27924 ^
*
*---- MAIN PROCESSING
*
   BEGIN CASE
*T27924 v
*     CASE NUM(EST.CASE.SPOIL<1,3>)
*        SPOIL = INT(COMPQTY * (EST.CASE.SPOIL<1,3> / 100) + 0.99)
      CASE NUM(EST.CASE.SPOIL<1,COMP,3>)
         SPOIL = INT(COMPQTY * (EST.CASE.SPOIL<1,COMP,3> / 100) + 0.99)
*T27924 ^
      CASE 1
*T27924 v
*        MATREAD BST.REC FROM ESTIMATE.BIND.SPOIL, CONO:EST.CASE.SPOIL<1,3> ELSE
         MATREAD BST.REC FROM ESTIMATE.BIND.SPOIL, CONO:EST.CASE.SPOIL<1,COMP,3> ELSE
*T27924 ^
            MAT BST.REC = ""
         END
*T27924 v
         LOCATE COMPQTY IN BST.QTY<1>,1 BY "AR" SETTING BP ELSE NULL
*T27924 ^
         BEGIN CASE
            CASE BP = 1
               BSPCT = BST.PCT<1,BP>
            CASE BP > COUNT(BST.QTY,VM) + 1
               BSPCT = BST.PCT<1,BP-1>
            CASE BST.EXTR = "Y"
               BSPCT = INT(BST.PCT<1,BP>-(BST.QTY<1,BP>-COMPQTY)/(BST.QTY<1,BP>-BST.QTY<1,BP-1>)*(BST.PCT<1,BP>-BST.PCT<1,BP-1>)+0.5) ;*T27924
            CASE 1
               BSPCT = BST.PCT<1,BP>
         END CASE
         SPOIL = INT(COMPQTY * (BSPCT / 10000) + 0.99) ;*T27924
   END CASE
   PROD.QTY = COMPQTY + SPOIL ;*T27924
   BEGIN CASE
*T27924 v
*     CASE EST.BIND.COVER.STYLE # "C"
      CASE EST.BIND.COVER.STYLE<1,COMP> # "C"
*T27924 ^
         TEMP.QTY = 0
      CASE NO.OUT = 0
         TEMP.QTY = 0
*T27924 v
*     CASE EST.CASE.SIDE.CL.SRC = "S" AND EST.CASE.PIECES = 1
      CASE EST.CASE.SIDE.CL.SRC<1,COMP>="S" AND EST.CASE.PIECES<1,COMP>=1
*T27924 ^
         TEMP.QTY = INT(PROD.QTY / NO.OUT + 0.99)
*T27924 v
*     CASE EST.CASE.SIDE.CL.SRC = "S" AND EST.CASE.PIECES = 3
      CASE EST.CASE.SIDE.CL.SRC<1,COMP>="S" AND EST.CASE.PIECES<1,COMP>=3
*T27924 ^
         TEMP.QTY = INT(PROD.QTY * 2 / NO.OUT + 0.99)
*T27924 v
*     CASE EST.CASE.PIECES = 1 AND EST.CASE.SIDE.CL.CUT.DIR = "W"
      CASE EST.CASE.PIECES<1,COMP> = 1 AND EST.CASE.SIDE.CL.CUT.DIR<1,COMP> = "W"
*T27924 ^
         TEMP.QTY = INT(PROD.QTY * CLOTH.LENGTH / 36 / NO.OUT + 0.99)
*T27924 v
*     CASE EST.CASE.PIECES = 1 AND EST.CASE.SIDE.CL.CUT.DIR = "H"
      CASE EST.CASE.PIECES<1,COMP>=1 AND EST.CASE.SIDE.CL.CUT.DIR<1,COMP>="H"
*T27924 ^
         TEMP.QTY = INT(PROD.QTY * CLOTH.WIDTH / 36 / NO.OUT + 0.99)
*T27924 v
*     CASE EST.CASE.PIECES = 3 AND EST.CASE.SIDE.CL.CUT.DIR = "W"
      CASE EST.CASE.PIECES<1,COMP>=3 AND EST.CASE.SIDE.CL.CUT.DIR<1,COMP>="W"
*T27924 ^
         TEMP.QTY = INT(PROD.QTY * 2 * CLOTH.LENGTH / 36 / NO.OUT + 0.99)
*T27924 v
*     CASE EST.CASE.PIECES = 3 AND EST.CASE.SIDE.CL.CUT.DIR = "H"
      CASE EST.CASE.PIECES<1,COMP>=3 AND EST.CASE.SIDE.CL.CUT.DIR<1,COMP>="H"
*T27924 ^
         TEMP.QTY = INT(PROD.QTY * 2 * CLOTH.WIDTH / 36 / NO.OUT + 0.99)
      CASE 1
         TEMP.QTY = 0
   END CASE
*T27924 v
*  IF EST.CASE.SIDE.CL.SRC = "S" THEN
*     EST.CASE.SIDE.CL.QTY<1,1,QPTR> = TEMP.QTY
*     EST.CASE.SIDE.CL.QTY<1,2> = "SHT"
   IF EST.CASE.SIDE.CL.SRC<1,COMP> = "S" THEN
      EST.CASE.SIDE.CL.QTY<1,COMP,QPTR> = TEMP.QTY
      EST.CASE.SIDE.CL.UOM<1,COMP,3> = "SHT"
*T27924 ^
   END ELSE
*T27924 v
*     EST.CASE.SIDE.CL.QTY<1,1,QPTR> = TEMP.QTY
*     EST.CASE.SIDE.CL.QTY<1,2> = "YDS"
      EST.CASE.SIDE.CL.QTY<1,COMP,QPTR> = TEMP.QTY
      EST.CASE.SIDE.CL.UOM<1,COMP,3> = "YDS"
*T27924 ^
   END
   IF TEMP.TYPE[1,1] = "M" THEN
      TEMP.FCTR = 1000
*T27924 v
*     TEMP.STD = EST.CASE.SIDE.CL.PRICE<1,1,QPTR> / 100
*     TEMP.STD.TYPE = "$/":EST.CASE.SIDE.CL.PRICE<1,2>
*     TEMP.UM = EST.CASE.SIDE.CL.PRICE<1,3>
      TEMP.STD = EST.CASE.SIDE.CL.PRICE<1,COMP,QPTR> / 100
      TEMP.STD.TYPE = "$/":EST.CASE.SIDE.CL.UOM<1,COMP,1>
      TEMP.UM = EST.CASE.SIDE.CL.UOM<1,COMP,2>
*T27924 ^
      TEMP.IND.1 = ESTM.FOH.PCT<1,MP>
      TEMP.MARKUP = ESTM.MARKUP<1,MP>
*T27924 v
*     TEMP.DESC = EST.CASE.SIDE.CL<1,2>
      TEMP.DESC = EST.CASE.SIDE.CL<1,COMP,2>
*T27924 ^
   END
   TEMP.VSALE = "Y"
   RETURN
END
