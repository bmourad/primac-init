* SOURCE IS 'JOINED' TO EST.DEPT.MAINT, THIS ITEM EXISTS SOLEY TO FOOL TASK TECH UPDATE.
*T21177 diane 11/21/1996 * REV10B UPG
*-- DISPLAY COST CENTERS
*
41000*
   START.REF.NO=1+INT((XREF.REF.NO-1)/XREF.LINE.COUNT)*XREF.LINE.COUNT
   IF START.REF.NO=XREF.CURR.REF.NO THEN RETURN
   XREF.CURR.REF.NO=START.REF.NO
   IF START.REF.NO=1 THEN
      S$DATA(2)<S$SCR>="Cctr"
      SCREEN DISPLAY;;2
      S$DATA(3)<S$SCR>=DEPT.CCTRS
   END
   IF XREF.DESC<1,START.REF.NO>="" THEN
      FOR N=1 TO XREF.LINE.COUNT
         NN=START.REF.NO+N-1
         READV DESC FROM COST.CNTR,CONO:DEPT.CCTRS<1,NN>,1 ELSE DESC="??????????"
         XREF.DESC<1,NN>=DESC
      NEXT N
      DEPT.CCTRS.DESC=XREF.DESC
   END
   S$DATA(4)<S$SCR>=XREF.DESC
   S$VAL=START.REF.NO
   S$CNT=XREF.CNT
   SCREEN MULTI;;S;3;4
   RETURN
*
*-- DISPLAY OPERATIONS
*
42000*
   START.REF.NO=1+INT((XREF.REF.NO-1)/XREF.LINE.COUNT)*XREF.LINE.COUNT
   IF START.REF.NO=XREF.CURR.REF.NO THEN RETURN
   XREF.CURR.REF.NO=START.REF.NO
   IF START.REF.NO=1 THEN
      S$DATA(2)<S$SCR>="Oper"
      SCREEN DISPLAY;;2
      S$DATA(3)<S$SCR>=CCTR.OPER
   END
   IF XREF.DESC<1,START.REF.NO>="" THEN
      FOR N=1 TO XREF.LINE.COUNT
         NN=START.REF.NO+N-1
         READV DESC FROM OPERATION,CONO:CCTR.OPER<1,NN>,1 ELSE DESC="??????????"
         XREF.DESC<1,NN>=DESC
      NEXT N
   END
   S$DATA(4)<S$SCR>=XREF.DESC
   S$VAL=START.REF.NO
   S$CNT=XREF.CNT
   SCREEN MULTI;;S;3;4
   RETURN
*
*-- DISPLAY MATERIALS
*
43000*
   START.REF.NO=1+INT((XREF.REF.NO-1)/XREF.LINE.COUNT)*XREF.LINE.COUNT
   IF START.REF.NO=XREF.CURR.REF.NO THEN RETURN
   XREF.CURR.REF.NO=START.REF.NO
   IF START.REF.NO=1 THEN
      S$DATA(2)<S$SCR>="Prod"
      SCREEN DISPLAY;;2
   END
   IF XREF.DESC<1,START.REF.NO>="" THEN
      MATREAD ESTM.REC FROM ESTIMATE.MATL,CONO:TEMP.TYPE[2,1] ELSE
         MAT ESTM.REC=""
      END
      S$DATA(3)<S$SCR>=ESTM.PROD
      XREF.DESC=ESTM.FULL.DESC
      S$DATA(4)<S$SCR>=XREF.DESC
   END
   S$VAL=START.REF.NO
   S$CNT=XREF.CNT
   SCREEN MULTI;;S;3;4
   RETURN
*
*-- DISPLAY GROUPS
*
44000*
   START.REF.NO=1+INT((XREF.REF.NO-1)/XREF.LINE.COUNT)*XREF.LINE.COUNT
   IF START.REF.NO=XREF.CURR.REF.NO THEN RETURN
   XREF.CURR.REF.NO=START.REF.NO
   IF START.REF.NO=1 THEN
      S$DATA(2)<S$SCR>="Group"
      SCREEN DISPLAY;;2
   END
   S$DATA(3)<S$SCR>=""
   S$DATA(4)<S$SCR>=""
   FOR N=1 TO XREF.LINE.COUNT
      NN=START.REF.NO+N-1
      READV DESC FROM ESTIMATE.GRP,CONO:DEPT:"!":ESTGX.GRP<1,NN>,1 ELSE DESC="??????????"
      S$DATA(3)<S$SCR,NN>=ESTGX.GRP<1,NN>
      S$DATA(4)<S$SCR,NN>=DESC
   NEXT N
   S$VAL=START.REF.NO
   S$CNT=XREF.CNT
   SCREEN MULTI;;S;3;4
   RETURN
*
*---- CODE SELECTION
*
49000*
   MAT GEN.XREF.REC = ''
   GXR.CO = CONO
   GXR.ID = ""
   GXR.NAME = "GEN.CODE"
   GXR.FILE = XFILE
   GXR.SORT.FILE = XTYPE
   CALL GEN.XREF.SUB(MAT GEN.XREF.REC, PREFIX, XREF.DATA)
   XCODE = GXR.ID
   SCREEN FORMAT
   S$VALUE=XCODE
   S$DATA(FLD)<S$SCR,FREF>=XCODE
   GOSUB 80100
   CURR.REF.NO=""
   GOSUB 50000
   RETURN
*
*-- DISPLAY MULTI-LINE DATA
*
50000*
   START.REF.NO=1+INT((REF.NO-1)/LINE.COUNT)*LINE.COUNT
   IF START.REF.NO=CURR.REF.NO THEN RETURN
   CURR.REF.NO=START.REF.NO
   S$VAL=START.REF.NO
   S$CNT=COUNT(S$DATA(9)<S$SCR>,VM)+(S$DATA(9)<S$SCR>#"")
   SCREEN MULTI;;C;8;9;10;11;12;13;14;15;16;18;19
   RETURN
*
*-- LOAD SCREEN DATA
*
80000*
   S$DATA(9)<S$SCR>=ESTD.TYPE
   S$DATA(10)<S$SCR>=ESTD.CCTR
   S$DATA(11)<S$SCR>=ESTD.OPV
   S$DATA(12)<S$SCR>=ESTD.CODE
   S$DATA(13)<S$SCR>=ESTD.QTY
   S$DATA(14)<S$SCR>=ESTD.FCTR
   S$DATA(15)<S$SCR>=ESTD.STD
   S$DATA(16)<S$SCR>=ESTD.STD.TYPE
   S$DATA(18)<S$SCR>=ESTD.TSALE
   S$DATA(19)<S$SCR>=ESTD.DESC
   FOR NN=1 TO LINE.CNT
      TQ=ESTD.QTY<1,NN>
      IF INT(TQ/100)=TQ/100 THEN
         S$DATA(13)<S$SCR,NN>=INT(TQ/100)
      END ELSE
         S$DATA(13)<S$SCR,NN>=TQ/100
      END
      IF ESTD.TYPE<1,NN>#"G" THEN
         TS=ESTD.STD<1,NN>
         IF INT(TS/100)=TS/100 THEN
            S$DATA(15)<S$SCR,NN>=INT(TS/100)
         END ELSE
            S$DATA(15)<S$SCR,NN>=TS/100
         END
      END
   NEXT NN
80100*
   SCREEN DISPLAY;;ALL
   RETURN
*
*-- ERROR ROUTINE
*
* 90000*
*       PRINT @(0,23):CL:ERRMSG:
*       INPUT REPLY,1:
*       PRINT @(0,23):CL:
*       RETURN
90000 *
91000 *
   ERR.TYPE = 1;CALL SI_SYSCOM(MAT SYSCOM.REC); RETURN
*
99999*
   SCREEN CLEAR;EST.DEPT.MAINT;D
   RETURN
END
