*COPY>CPYLIB>COM1
****************************************************************
*
* REVISION - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
*
* PROGRAM       - EST.INK.LIST
*
* SYSTEM        - JESBP
*
* BY            - RHONDA PERRIN, COMPUTER BUSINESS ASSOCIATES
*
* DATE          - 04/17/86
*
* DESCRIPTION   -
* This program produces an Estimate Ink report.
*
*T25901 cmykleb 03/07/2002 * Change heading to use GET.PROG.HEAD pgm.
*T26493 cmykleb 03/22/2002 * Change report to use rpt # from proc.
*ENDDOC
****************************************************************
*
*---- FILE EQUATES
*
*COPY>CPYLIB>SYSCOM
*COPY>CPYLIB>CHAR
*COPY>CPYLIB>FILE.VARS
*COPY>PMC.CPYLIB>COMPANY
*COPY>JES.CPYLIB>ESTIMATE.MATL
*
*---- SETUP FOR SYSTEM ERROR MESSAGES
*
   SYS.TYPE=1
   CALL SI_SYSCOM(MAT SYSCOM.REC)
*
*---- OPEN FILES
*
   OPEN '','COMPANY' TO COMPANY ELSE ERRMSG='COMPANY FILE MISSING';GOTO 93000
   OPEN '','CONTROL' TO CONTROL ELSE ERRMSG='CONTROL FILE MISSING';GOTO 93000
   OPEN '','ESTIMATE.MATL' TO ESTIMATE.MATL ELSE ERRMSG='ESTIMATE.MATL FILE MISSING';GOTO 93000
*
*---- READ FROM PROC
   PROCREAD BUFFER ELSE
      ERRMSG = "CANNOT READ FROM PROC"
      GOTO 93000
   END
*
*---- GET COMPANY NUMBER
*
   CONO=""
   CALL GET.CONO(CONO,MAT COMP.REC)
   IF CONO='END' THEN GOTO 99999
*
*---- INITIALIZATION
*
   PG.NO=0
   LINE.CNT=0
   ERRMSG=""
   PREV.INK = ""
   RPT.NO="XXXX"
   UNKNOWN=STR("?",30)
   SP2 = "  "
   SP3 = "   "
   SP4 = "    "
   NODATA=1
*T25901 v
*  K = SPACE(INT((50 - LEN(CO.NAME)) / 2))
*  CONAME = K:CO.NAME:K
*  CONAME = CONAME "L#50"
*  HEAD1 = OCONV(DATE(),"D2/"):SPACE(33):CONAME:SPACE(32):"PAGE  "
*  HEAD2 = SPACE(46):"E S T I M A T E   I N K   L I S T I N G"
*T26493 v
*  REPORT.NAME = "ESTIMATE INK LISTING"
*  REPORT.NUMBER = "XXXX"
   REPORT.NUMBER = BUFFER<2>
   REPORT.NAME = ""
   CONO.NAME = ""
*T26493 ^
   HEAD1 = "" ; HEAD2 = ""
   CALL GET.PROG.HEAD(CONO,CONO.NAME,REPORT.NAME,REPORT.NUMBER,"",HEAD1,HEAD2)
*T25901 ^
   HEAD3 = "GROUP : INK"
   HEAD4 = "                                           COATED    UNCOAT    MIN     UNIT                      <-- QTY -->"
   HEAD5 = " INK#             DESCRIPTION               CVRG      CVRG     QTY     COST    FOH%     MKUP%    T  PARAM  O  V"
   HEAD6 = "------   ------------------------------   -------   -------   -----   -----   ------   ------    -  -----  -  -"
   PRINTER ON
*
*---- MAIN PROCESSING
*
10*
   READNEXT ESTM.KEY ELSE 
      IF NODATA THEN GOTO 99999
      GOTO 15
   END
   MATREAD ESTM.REC FROM ESTIMATE.MATL,ESTM.KEY ELSE GOTO 10
   NODATA=0
   INK.NO = ESTM.KEY[4,99]
   IF PREV.INK # INK.NO THEN
      GOSUB 20
      PREV.INK=INK.NO
   END
   PROD.CNT = COUNT(ESTM.PROD,VM) + (ESTM.PROD # "")
   FOR QQ = 1 TO PROD.CNT
      PROD.NO = ESTM.PROD<1,QQ> "L#6"
      DESC = ESTM.DESC<1,QQ> "L#30"
      COST = OCONV(ESTM.COST<1,QQ>,"MD2") "R#5"
      IF NUM(ESTM.FOH.PCT<1,QQ>) THEN
         FOH = OCONV(ESTM.FOH.PCT<1,QQ>,"MD2") "R#6"
      END ELSE
         FOH = ESTM.FOH.PCT<1,QQ> "R#6"
      END
      IF NUM(ESTM.MARKUP<1,QQ>) THEN
         MKUP = OCONV(ESTM.MARKUP<1,QQ>,"MD2") "R#6"
      END ELSE
         MKUP = ESTM.MARKUP<1,QQ> "R#6"
      END
      COVER.C = OCONV(ESTM.COVER.C<1,QQ>,"MD0,")"R#7"
      COVER.U = OCONV(ESTM.COVER.U<1,QQ>,"MD0,")"R#7"
      MINQ = OCONV(ESTM.MIN.QTY<1,QQ>,"MD2") "R#5"
      QCALC = ESTM.QCALC<1,QQ> "L#1"
      QPARAM = ESTM.QPARAM<1,QQ> "L#5"
      QOR = ESTM.QOR<1,QQ> "L#1"
      QVARNISH = ESTM.VARNISH<1,QQ> "L#1"
      GOSUB 30
   NEXT QQ
   GOTO 10
15*
   PRINTER OFF
   GOTO 99999
*
*---- PRINT THE HEADINGS
*
20*
   PRINT CHAR(12)
   PRINT
   PG.NO=PG.NO + 1
   PRINT HEAD1:PG.NO
   PRINT HEAD2
   PRINT HEAD3
   PRINT
   PRINT HEAD4
   PRINT HEAD5
   PRINT HEAD6
   PRINT
   LINE.CNT = 8
   RETURN
*
*---- PRINT THE VALUES
*
30*
   PRINT PROD.NO:SP3:DESC:SP3:COVER.C:SP3:COVER.U:SP3:MINQ:SP3:COST:SP3:FOH:SP3:MKUP:SP4:QCALC:SP2:QPARAM:SP2:QOR:SP2:QVARNISH
   LINE.CNT = LINE.CNT + 1
   IF LINE.CNT >= 55 THEN GOSUB 20
   RETURN
*
*---- CALLS FOR SYSCOM
*
93000*
   PRINTER OFF
   ERR.TYPE=3
   CALL SI_SYSCOM(MAT SYSCOM.REC)
99999*
END
