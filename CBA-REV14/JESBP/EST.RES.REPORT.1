   SUBROUTINE EST.RES.REPORT.1 (CONO,CO.NAME,EST.KEY,PAGE.NO,PRT.QTY,HD1,HD2)
*********************************************************************
*
* REVISION - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
*
* PROGRAM  - EST.RES.REPORT.1
*
* AUTHOR   - NICK AMENDOLA, COMPUTER BUSINESS ASSOCIATES
*
* DATE     - 04/18/86
*
* DESCRIPTION
*
* This program will print the estimate report.
*
* MODIFIED - Graham Jarvis, Pacrim Software Pty Ltd
*            July 1994
*            Changes made to suit new RES Estimating Screens
*
*T21556 doug 02/05/1997 * Corrections to formula Q869
*T22653 gat 03/03/1998 * FIX REPORT FOR PRICING.
*C32160 rik 11/25/1998 * PRINT ONLY 28 CHARS OF PRESS DESC. PUT "/"
*                        BETWEEN BWGT & MMSI.
*T25783 lanny 05/01/2001 * Print only MSI calc for qty's selected for
*                          report.
*T26138 cm 10/11/2001 * Expand qty fields.
*T26090 cmykleb 04/04/2002 * Change rpt to use rpt heading from call pgm.
*T27809 cmykleb 12/02/2003 * When pre-press inclusive flag is set to "N"
*                            the amounts are wrong in the cost summary
*                            section of the report.
*********************************************************************
*
*---- COPY STATEMENTS
*
*COPY>JES.CPYLIB>SCOMMON.ESTIMATE
*COPY>JES.CPYLIB>ESTIMATE
*COPY>JES.CPYLIB>ESTIMATE.RES
*COPY>JES.CPYLIB>ESTIMATE.DEPT
*COPY>JES.CPYLIB>ESTIMATOR
*COPY>JES.CPYLIB>ESTIMATE.MATL
*COPY>JES.CPYLIB>ESTIMATE.RES.CYLINDER
*COPY>JES.CPYLIB>EST.COST.TYPE.SUM
*COPY>PMC.CPYLIB>COMPANY
*COPY>JES.CPYLIB>JES.FILE.VARS
*COPY>PMC.CPYLIB>DIVISION
*COPY>PMC.CPYLIB>SALESMAN
*COPY>PMC.CPYLIB>COST.CNTR
*COPY>JCS.CPYLIB>JOB.CATEGORY
*COPY>CPYLIB>SCREEN.COM
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*
   OPEN '','ESTIMATE.RES.DIE' TO ESTIMATE.RES.DIE ELSE STOP
   OPEN '','ESTIMATE.RES.CYLINDER' TO ESTIMATE.RES.CYLINDER ELSE STOP
   OPEN '','ESTIMATE.QUOTES' TO ESTIMATE.QUOTES ELSE STOP
   DIM PRT.REC(15)
   EQU P.TYPE    TO PRT.REC(1)    ;* (MV1)
   EQU P.CCTR    TO PRT.REC(2)    ;* (MV1)
   EQU P.OPV     TO PRT.REC(3)    ;* (MV1)
   EQU P.DESC    TO PRT.REC(4)    ;* (MV1)
   EQU P.QTY     TO PRT.REC(5)    ;* (MV1,MSV)
   EQU P.HRS     TO PRT.REC(6)    ;* (MV1,MSV)
   EQU P.FCTR    TO PRT.REC(7)    ;* (MV1,MSV)
   EQU P.UM      TO PRT.REC(8)    ;* (MV1)
   EQU P.SELL    TO PRT.REC(9)    ;* (MV1,MSV)
   EQU P.THRS    TO PRT.REC(10)   ;* (MSV)
   EQU P.TCOST   TO PRT.REC(11)   ;* (MSV)
   EQU P.GHRS    TO PRT.REC(12)   ;* (MSV)
   EQU P.GSELL   TO PRT.REC(13)   ;* (MSV)
   MAT PRT.REC=''
   TCOST.LAB=''
   TCOST.STK=''
   TCOST.MAT=''
   TCOST.SHP=''
   TCOST.OSP=''
   TCOST.MSC=''
   TCOST=''
   TSALE=''
*
*---- INITIALIZATION
*
10*
   CALL GET.CONO1 (CONO,MAT COMP.REC,COMPANY,CONTROL)
   READ PC FROM CONTROL,CONO:'PRINTER' ELSE PC=''
   PAGE.NO = 0
   SP1 = " "
   SP2 = SPACE(2)
   SP3 = SPACE(3)
   SP4 = SPACE(4)
   SP5 = SPACE(5)
   SP6 = SPACE(6)
   UNKNOWN = STR("?",45)
   PBOLDON=PC<1,12>
   PBOLDOF=PC<1,13>
   SELFONT=CHAR(27):CHAR(38):CHAR(107):CHAR(50):CHAR(83)
   CDATE = DATE()
   CTIME = TIME()
   IF CTIME < 10 THEN CDATE = DATE()
   CTIME = OCONV(CTIME,"MTS")
   CHR = CTIME[1,2]+0
   CMN = CTIME[4,2]
   BEGIN CASE
      CASE CHR < 12
         PTIME = CHR:":":CMN:" AM"
      CASE CHR = 12
         PTIME = CHR:":":CMN:" PM"
      CASE 1
         PTIME = (CHR-12):":":CMN:" PM"
   END CASE
*T26090 v
*  HD1A = OCONV(CDATE,"D2/"):SP3:PTIME
*  HD1B = SPACE((40-LEN(CO.NAME))/2):CO.NAME
*  HD1 = HD1A"L#46":HD1B"L#40":SPACE(34):"PAGE: "
*  HD2 = SPACE(51):"E S T I M A T E   R E P O R T"
*T26090 ^
*18484 v
   ECNT = DCOUNT(PRT.QTY,SVM) 
   QPTR = ''
   FOR Q = 1 TO ECNT
      LOCATE PRT.QTY<1,1,Q> IN EST.QTY<1>,1 SETTING Q1 THEN
         QPTR<1,Q> = Q1
      END
   NEXT Q
*18484 ^      
   SHC = 'Cost Summary':SPACE(22)
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
      QQ = OCONV(EST.QTY<1,QPTR<1,EPTR>>,"MD0,")
      QQ = QQ:SPACE((9-LEN(QQ))/2)
      SHC = SHC:FILL1:'-':QQ "R#12":'-'
      FILL1 = " : "
   NEXT EPTR 
   UL1 = SPACE(34)
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
      UL1 = UL1:FILL1:"--------------"
      FILL1 = " : "
   NEXT EPTR 
   UL2 = SPACE(34)
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
      UL2 = UL2:FILL1:"=============="
      FILL1 = " : "
   NEXT EPTR 
*
*---- MAIN PROCESSING
*
100*
   BEGIN CASE
      CASE EST.TYPE = "R"
         ETYPE = "REGULAR"
      CASE EST.TYPE = "C"
         ETYPE = "CHANGE ORDER"
      CASE EST.TYPE = "S"
         ETYPE = "SPOILAGE"
      CASE EST.TYPE = "N"
         ETYPE = "NON-CHARGEABLE"
      CASE 1
         ETYPE = ""
   END CASE
   MATREAD DIV.REC FROM DIVISION, CONO:FIELD(EST.DIV,"-",1) ELSE
      MAT DIV.REC = ""
   END
   IF EST.SALESMAN = "" THEN
      MAT SALESMAN.REC = ""
   END ELSE
      MATREAD SALESMAN.REC FROM SALESMAN, CONO:EST.SALESMAN ELSE
         MAT SALESMAN.REC = ""
      END
   END
   IF EST.CATG = "" THEN
      MAT JCATG.REC = ""
   END ELSE
      MATREAD JCATG.REC FROM JOB.CATEGORY, CONO:EST.CATG ELSE
         MAT JCATG.REC = ""
      END
   END
   IF EST.ESTIMATOR = "" THEN
      MAT ESTIMATOR.REC = ""
   END ELSE
      MATREAD ESTIMATOR.REC FROM ESTIMATOR, CONO:EST.ESTIMATOR ELSE
         MAT ESTIMATOR.REC = ""
      END
   END
*
*---- PRINT DEMOGRAPHICS
*
2000*
   PRINTER ON
   GOSUB 10000
   PLINE = PBOLDON:"Customer : ":PBOLDOF:EST.CUST.NAME"L#30"
   PLINE = PLINE:SP6:PBOLDON:"Division : ":PBOLDOF
   PLINE = PLINE:DIV.DESC"L#30"
   PLINE = PLINE:SP5:PBOLDON:"Date Entered   : ":PBOLDOF:OCONV(EST.DATE.ENTERED,"D2/")
   PRINT PLINE
   PRINT "Attention: ":EST.CUST.ATTN "L#30"
   LINE.CNT=LINE.CNT+2
   PLINE = "DETAILS                             Job Description / Remarks                                    Special Instructions"
   PRINT PBOLDON:PLINE:PBOLDOF
   LINE.CNT = LINE.CNT + 1
   LINE.CNT = LINE.CNT + 1
   DC = DCOUNT(EST.COMMENTS,VM)
   CMNT.TYPE = ""
   CMNTS = ""
   DCNT = 0
   FOR DP = 1 TO DC
      IF EST.COMMENT.TYPE<1,DP>="" OR EST.COMMENT.TYPE<1,DP>="I" THEN
         DCNT = DCNT + 1
         CMNT.TYPE<1,DCNT> = EST.COMMENT.TYPE<1,DP>
         CMNTS<1,DCNT> = EST.COMMENTS<1,DP>
      END
   NEXT DP
   GOSUB 5000
   LC = ECNT
   IF DCNT > LC THEN LC = DCNT
   IF SCNT > LC THEN LC = SCNT
   FOR LP = 1 TO LC
      IF LINE.CNT > 55 THEN GOSUB 10000
      IF ECNT < LP THEN
         QVAL = ''
      END ELSE
         QVAL = OCONV(EST.QTY<1,QPTR<1,LP>>,"MD0,")
      END
      PLINE = QVAL"R#11"
      PLINE = PLINE:SP6:CMNT.TYPE<1,LP>"L#2"
      PLINE = PLINE:SP2:CMNTS<1,LP>"L#60"
      PLINE = PLINE:SP4:SREC<LP>"L#45"
      PRINT PLINE
      LINE.CNT = LINE.CNT + 1
   NEXT LP
*
*---- PRINT STOCK AND PRODUCTION INFORMATION
*
3000*
   PRINT
   LINE.CNT = LINE.CNT + 1
*T26138 v
*  PLINE = 'STOCKS           Pg   Product/Inventory Code Stock Description          EstWth  ActWth Caliper BWgt/MMSI   M.S.I   LnFeet   Price'
   PLINE = 'STOCKS           Pg Product/Inventory Code Stock Description          EstWth  ActWth Caliper BWgt/MMSI   M.S.I   LnFeet   Price'
*T26138 ^
   PRINT PBOLDON:PLINE:PBOLDOF
   LINE.CNT = LINE.CNT + 1
   LOOP.CNT = 0
   COMP = DCOUNT(EST.PROD.OS.USAGE,VM)
   FOR C = 1 TO COMP
      WEB = DCOUNT(EST.PROD.OS.USAGE<1,C>,SVM)
      FOR W = 1 TO WEB
         IF LINE.CNT + ECNT > 55 THEN GOSUB 10000
*T25783 v
         QCNT = DCOUNT(EST.RL.PAP.MSI<1,C,W>,"!")
         IF QCNT > ECNT THEN QCNT = ECNT ;*T25783
         FOR Q = 1 TO QCNT
            LOOP.CNT = LOOP.CNT + 1
            IF Q = 1 THEN
               EST.WIDTH=OCONV(EST.PROD.OS.WIDTH<1,C,W>,'MD4')
*T26138 v
*              PLINE=SPACE(17):EST.PROD.OS.USAGE<1,C,W> "L#2":SP3:EST.PROD.OS.PROD<1,C,W> "L#7"
               PLINE=SPACE(17):EST.PROD.OS.USAGE<1,C,W> "L#2":SP1:EST.PROD.OS.PROD<1,C,W> "L#7"
*T26138 ^
               PLINE=PLINE:EST.PROD.INV.ID<1,C,W> "L#16"
               PLINE = PLINE:EST.PROD.OS.DESC<1,C,W> "L#25":EST.WIDTH "R#8":OCONV(EST.RL.ACT.WIDTH<1,C,W>,"MD4") "R#8"
               PLINE = PLINE:OCONV(EST.RL.PAP.CAL<1,C,W>,'MD4') 'R#8'
               PLINE = PLINE:OCONV(EST.RL.PAP.GSM<1,C,W>,'MD4') "R#10"
            END ELSE
*T26138 v
*              PLINE = SPACE(104)
               PLINE = SPACE(102)
*T26138 ^
            END
            PPRICE = FIELD(EST.RL.PAP.PRICE<1,C,W>,"!",QPTR<1,Q>)
            PPRICE = OCONV(PPRICE,"MD4") "R#8"
            SQMTRS = FIELD(EST.RL.PAP.MSI<1,C,W>,'!',QPTR<1,Q>)
            LNMTRS = FIELD(EST.RL.TOTAL.PC<1,C,W>,'!',QPTR<1,Q>)
*T25783 ^
            LNMTRS = INT(LNMTRS/12+.5)
*T26138 v
*           PLINE = PLINE:SQMTRS "R#8":LNMTRS "R#9"
            PLINE = PLINE:SP1:SQMTRS"R#8":SP1:LNMTRS"R#9"
*T26138 ^
            PLINE = PLINE:PPRICE
            PRINT PLINE
            LINE.CNT = LINE.CNT + 1
         NEXT Q
      NEXT W
   NEXT C
   DCNT = DCOUNT(EST.RL.DIE,VM)
*
*--- Print Die
*
   IF DCNT > 5 THEN DCNT = 5
   IF (LINE.CNT + DCNT + 5) > 55 THEN GOSUB 10000
   PRINT
   LINE.CNT = LINE.CNT + 1
   PLINE="DIE              Press Id/Description              Die Id/Description           Type    Repeat Ac  Ar  Die Cyl  PrtGear   PrtAr"
   PRINT PBOLDON:PLINE:PBOLDOF
   LINE.CNT = LINE.CNT + 1
   FOR D = 1 TO DCNT
      DPRESSID=EST.RL.DIE.PRESS.NO<1,1,D>
      READV CCDESC FROM COST.CNTR,CONO:DPRESSID,1 ELSE
         CCDESC='*** Unknown ***'
      END
      DPRESSID=DPRESSID:" ":CCDESC
      PLINE=SPACE(17):DPRESSID "L#34"
      BEGIN CASE
         CASE EST.RL.DIE<1,1,D> = '#'
            DIEDESC='*** New Die ***'
         CASE EST.RL.DIE<1,1,D> = 'B'
            DIEDESC='--- Butt Cut ---'
         CASE 1
            READV DIEDESC FROM ESTIMATE.RES.DIE,CONO:EST.RL.DIE<1,1,D>,1 ELSE
               DIEDESC='--- DIE MISSING ---'
            END
      END CASE
      DIEDESC=EST.RL.DIE<1,1,D>:"   ":DIEDESC
      PLINE=PLINE:DIEDESC "L#28":"  ":EST.RL.DIETYPE<1,1,D>:"  ":SP1:OCONV(EST.RL.DIE.REPEAT<1,1,D>,'MD4')"R#9":SP1:EST.RL.DIE.NO.ACR<1,1,D>"R#2":SP2
      PLINE = PLINE:EST.RL.DIE.NO.ARD<1,1,D> "R#2":SP2:EST.RL.DIE.CYL.ID<1,1,D> "L#7":SP2:EST.RL.PRINTGEARS<1,1,D> "L#8":EST.RL.PRINTAR<1,1,D> "R#5"
      PRINT PLINE
      LINE.CNT = LINE.CNT + 1
   NEXT D
   IF (LINE.CNT + 18) > 55 THEN GOSUB 10000
   PRINT
*
*--- Print Estimate
*
   PLINE="SIZES            Size Across x Around   Set Ratio MGap Size  Job Type   Prev Est   Type Chge   Copy Frt  Copy Bck"
   PRINT PBOLDON:PLINE:PBOLDOF
   PLINE=SPACE(16):OCONV(EST.RL.DIM.AC,'MD4') "R#9":" x ":OCONV(EST.RL.DIM.AR,'MD4') "R#9"
   PLINE=PLINE:SPACE(5):EST.RL.SETS<1,COMP,1> "L#2":" / ":EST.RL.SETS<1,COMP,2> "R#2"
   PLINE=PLINE:OCONV(EST.RL.GAP<1,COMP,1>,'MD4') "R#10"
   PLINE=PLINE:SPACE(5):EST.RL.JOB.TYPE "L#2":SPACE(6):EST.RL.PREV.EST "L#8"
   PLINE=PLINE:SPACE(1):EST.RL.TYPE.CHG "L#13":SPACE(4):EST.RL.CPY.DIR<1,COMP,1>:EST.RL.CPY.DIR<1,COMP,2> "R#10"
   PRINT PLINE
   PRINT
*
*--- Print Job Press
*
   PLINE='PRESS            Press Id/Description        Cols  Cols  Cols  Varn  Foil  Cols  Cols  Embs  Over  NoOf  Plte  Cols  Cols Sprk'
   PRINT PBOLDON:PLINE:PBOLDOF
   PLINE='                                             Frnt  Back  Adhv  ForS  YorN  Sscr  Grav  YorN  Lamn  Kind  Chng  Chng  Mix  Pnch'
   PRINT PBOLDON:PLINE:PBOLDOF
   PCNT = DCOUNT(EST.RL.PRESS.CCTR<1,1>,SM)
   FOR PP=1 TO PCNT
      READV CCDESC FROM COST.CNTR,CONO:EST.RL.PRESS.CCTR<1,1,PP>,1 ELSE
         CCDESC='*** Unknown ***'
      END
      PRESSID=EST.RL.PRESS.CCTR<1,1,PP>:" ":CCDESC
      COLSF=EST.PROD.COLORS.1<1,1,PP>
      PLINE=SPACE(17):PRESSID "L#28"
      PLINE=PLINE:COLSF "L#6"
      PLINE=PLINE:EST.RL.BACKPRINT<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.ADHESIVE<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.FULL.SPOT<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.FOIL<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.SSCREEN<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.GRAVURE<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.EMBOSS<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.OVERLAM<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.KINDS<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.PLATE.CHANGES<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.COLOR.CHANGES<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.COL.MIX<1,1,PP> "L#6"
      PLINE=PLINE:EST.RL.SPROCKET<1,1,PP> 'L#6'
      PRINT PLINE
   NEXT PP
   PRINT
*
*
*--- Print Finishing
*
   PLINE='FINISH           NoOf   Roll   QtyPer   Core   Lbls   Core   Max    Disp   Shts   Qty/   FFld   Qty/   Qty/   Shnk   Pack'
   PRINT PBOLDON:PLINE:PBOLDOF
   PLINE='                 Slit   YorN    Roll    YorN   Acrs   Size   OD     Pack   YorN   Pack   YorN   Pack   Fold   Wrap   Lbls'
   PRINT PBOLDON:PLINE:PBOLDOF
   PLINE=SPACE(18):EST.RL.NO.SLITS "L#2"
   PLINE=PLINE:SPACE(5):EST.RL.ROLLS "L#2":OCONV(EST.RL.NO.PER.ROLL,'MD0,')"R#9"
   PLINE=PLINE:SPACE(5):EST.RL.CORE "L#7":EST.RL.LAB.ACR "L#5"
   PLINE=PLINE:OCONV(EST.RL.CORE.SIZE,'MD4') 'L#7'
   PLINE=PLINE:OCONV(EST.RL.MAX.OD,'MD4') 'L#9'
   PLINE=PLINE:EST.RL.DISP.PACK "L#7"
   PLINE=PLINE:EST.RL.SHEETS "L#7":EST.RL.NO.PER.PKG "L#7"
   PLINE=PLINE:EST.RL.FANFOLD "L#7":EST.RL.NO.PER.BATCH "L#7":EST.RL.NO.PER.FOLD "L#7"
   PLINE=PLINE:EST.RL.SHRK.WRP "L#7":EST.RL.PKG.LABELS "L#7"
   PRINT PLINE
   PLINE='Calculated:':SPACE(16):OCONV(EST.RL.CALC.ROLL.QTY<1,COMP,1>,'MD0,')"R#9":SPACE(24)
   PLINE=PLINE:OCONV(EST.RL.CALC.MAX.OD<1,COMP,1>,'MD4') "L#9"
   PRINT PLINE
   PRINT
*
*--- Print The Cost Summary Using EST.RL.DETAIL.RECAP
*
*     CALL EST.RES.DETAIL.RECAP(CONO,CO.NAME,EST.KEY,EST.COMMENTS<1,1>,PAGE.NO,PRT.QTY)
*
*--- Process Summary For EST.RES.REPORT.1
*
   FOR EPTR=1 TO ECNT
      MAT CSUM.REC=""
      CALL EST.RES.COST.TYPE.SUB(CONO,EST.KEY,"ALL","ALL",EST.QTY<1,QPTR<1,EPTR>>,MAT CSUM.REC)
*T27809 v
*     TCOST.LAB<EPTR>=CSUM.LB.COST
      TCOST.LAB<EPTR>=CSUM.LB.SALE
*T27809 ^
      TCOST.STK<EPTR>=CSUM.MT.COST.DET<1,1>
      FOR MTCNT=2 TO 6
         TCOST.MAT<EPTR>=TCOST.MAT<EPTR>+CSUM.MT.COST.DET<1,MTCNT>
      NEXT MTCNT
      TCOST.OSP<EPTR>=CSUM.OS.COST
      TCOST.SHP<EPTR>=CSUM.SP.COST
      TCOST.MSC<EPTR>=CSUM.MS.COST
*T27809 v
*     TCOST<EPTR> = CSUM.TOT.COST
      TCOST<EPTR> = CSUM.TOT.SALE
*T27809 ^
* T22653
*     TSALE<EPTR> = CSUM.TOT.SALE
      TSALE<EPTR> = EST.FINAL.PRICE<1,QPTR<1,EPTR>>
* T22653
   NEXT EPTR
   PRINT PBOLDON:SHC:PBOLDOF
   PRINT PBOLDON:UL1:PBOLDOF
*
*--- Labor Cost Summary
*
   PLINE=  PBOLDON:'Labor Cost':SPACE(24):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(TCOST.LAB<EPTR>,'MD2,') "R#12"
*     PLINE = PLINE:"  "
      PLINE = PLINE:FILL1:OCONV(TCOST.LAB<EPTR>,'MD2,') "R#14"
*T26138 ^
      FILL1 = " : "
   NEXT EPTR
   PRINT PLINE
*
*--- Stock Cost Summary
*
   PLINE=  PBOLDON:'Stock Cost':SPACE(24):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(TCOST.STK<EPTR>,'MD2,') "R#12"
*     PLINE = PLINE:"  "
      PLINE = PLINE:FILL1:OCONV(TCOST.STK<EPTR>,'MD2,') "R#14"
*T26138 ^
      FILL1 = " : "
   NEXT EPTR
   PRINT PLINE
*
*--- Materials Cost Summary
*
   PLINE=  PBOLDON:'Material Cost':SPACE(21):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(TCOST.MAT<EPTR>,'MD2,') "R#12"
*     PLINE = PLINE:"  "
      PLINE = PLINE:FILL1:OCONV(TCOST.MAT<EPTR>,'MD2,') "R#14"
*T26138 ^
      FILL1 = " : "
   NEXT EPTR
   PRINT PLINE
*
*--- Outside Po Cost Summary
*
   PLINE=  PBOLDON:'Outside Po ':SPACE(23):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(TCOST.OSP<EPTR>,'MD2,') "R#12"
*     PLINE = PLINE:"  "
      PLINE = PLINE:FILL1:OCONV(TCOST.OSP<EPTR>,'MD2,') "R#14"
*T26138 ^
      FILL1 = " : "
   NEXT EPTR
   PRINT PLINE
*
*--- Freight Cost Summary
*
   PLINE=  PBOLDON:'Freight Cost':SPACE(22):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(TCOST.SHP<EPTR>,'MD2,') "R#12"
*     PLINE = PLINE:"  "
      PLINE = PLINE:FILL1:OCONV(TCOST.SHP<EPTR>,'MD2,') "R#14"
*T26138 ^
      FILL1 = " : "
   NEXT EPTR
   PRINT PLINE
*
*--- Misc Cost Summary
*
   PLINE=  PBOLDON:'Misc Cost  ':SPACE(23):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(TCOST.MSC<EPTR>,'MD2,') "R#12"
*     PLINE = PLINE:"  "
      PLINE = PLINE:FILL1:OCONV(TCOST.MSC<EPTR>,'MD2,') "R#14"
*T26138 ^
      FILL1 = " : "
   NEXT EPTR
   PRINT PLINE
   PRINT PBOLDON:UL1:PBOLDOF
*
*--- Print Total Cost
*
   PLINE = PBOLDON:'Total Cost':SPACE(24):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(TCOST<EPTR>,"MD2,") "R#12"
*     PLINE = PLINE:"  "
      PLINE = PLINE:FILL1:OCONV(TCOST<EPTR>,"MD2,") "R#14"
*T26138 ^
      FILL1 = " : "
   NEXT EPTR
   PRINT PLINE
*
*--- Print Profit $
*
   PLINE = PBOLDON:'Profit    ':SPACE(24):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(TSALE<EPTR>-TCOST<EPTR>,'MD2,') "R#12"
*     PLINE = PLINE:"  "
      PLINE = PLINE:FILL1:OCONV(TSALE<EPTR>-TCOST<EPTR>,'MD2,') "R#14"
*T26138 ^
      FILL1 = " : "
   NEXT EPTR
   PRINT PLINE
*
*--- Print Profit %
*
   PLINE = PBOLDON:'Markup %  ':SPACE(24):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
      PROFIT=0
      PROFIT=TSALE<EPTR>-TCOST<EPTR>
      PPCT=0
      IF TCOST<EPTR>+0 # 0 THEN
         PPCT=INT((PROFIT/TCOST<EPTR>)*10000+.5)
      END
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(PPCT,'MD2') "R#12":"%"
*     PLINE = PLINE:" "
*     FILL1 = " : "
      PLINE = PLINE:FILL1:OCONV(PPCT,'MD2') "R#14":"%"
      FILL1 = ": "
*T26138 ^
   NEXT EPTR
   PRINT PLINE
   PRINT PBOLDON:UL2:PBOLDOF
*
*--- Print Selling Price
*
   PLINE = PBOLDON:'Final Price':SPACE(23):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(TSALE<EPTR>,"MD2,") "R#12"
*     PLINE = PLINE:"  "
      PLINE = PLINE:FILL1:OCONV(TSALE<EPTR>,"MD2,") "R#14"
*T26138 ^
      FILL1 = " : "
   NEXT EPTR
   PRINT PBOLDON:PLINE:PBOLDOF
*
*--- Print Price Per 1000
*
   PLINE = PBOLDON:'Price per 1,000':SPACE(19):PBOLDOF
   FILL1 = "  "
   FOR EPTR = 1 TO ECNT
      PPM=""
      PPM=TSALE<EPTR> / (EST.QTY<1,QPTR<1,EPTR>>/1000)
*T26138 v
*     PLINE = PLINE:FILL1:OCONV(PPM,'MD2,') "R#12"
*     PLINE = PLINE:"  "
      PLINE = PLINE:FILL1:OCONV(PPM,'MD2,') "R#14"
*T26138 ^
      FILL1 = " : "
   NEXT EPTR
   PRINT PBOLDON:PLINE:PBOLDOF
*
* - Print Quoted Price in ESTIMATE.QUOTES File
*
   PRINT
   PLINE = "Pre-Press Details                    Qty        Cost      Target      Quoted"
   IF EST.RL.PP.INCLUDE='Y' THEN
* T22653
*     PLINE = PLINE:'   *** Pre-Press Included In Price per 1000 ***'
      PLINE = PLINE:'   ** Pre-Press Incl In Recommended Sell Per 1000 **'
* T22653
   END ELSE
* T22653
*     PLINE = PLINE:'   *** Pre-Press Not Included In Price per 1000 ***'
      PLINE = PLINE:'   ** Pre-Press Not Incl In Recommended Sell Per 1000 **'
* T22653
   END
   PRINT PBOLDON:PLINE:PBOLDOF
   CALL EST.RES.PP.COST.PSUB(CONO,EST.KEY,"ALL","ALL",EST.QTY<1,QPTR<1,1>>)
   PRINT
   DCNT = COUNT(EST.DESC,VM) + (EST.DESC # "")
   IF DCNT <= 10 THEN
      LC = DCNT
   END ELSE
      LC = INT(DCNT/2+0.99)
   END
   PRINT STR("*",55):"  JOB INSTRUCTIONS  ":STR("*",55)
   PRINT
   FOR LP = 1 TO LC
      PLINE=EST.DESC.HEADING<1,LP>"L#12":SPACE(2):EST.DESC<1,LP>"L#50"
      PLINE=PLINE:" | ":EST.DESC.HEADING<1,LP+LC>"L#12":SPACE(2):EST.DESC<1,LP+LC>"L#50"
      PRINT PLINE
   NEXT LP
   GOTO 99999
*
*---- PRINT DEPARTMENT DETAIL FOR SPECIFIED COMPONENT
*
1000 *
   P.CCTR = ""
   P.OPV = ""
   P.DESC = ""
   P.QTY = ""
   P.HRS = ""
   P.THRS = ""
   P.GHRS = ""
   FOR EPTR = 1 TO ECNT
      EQTY = EST.QTY<1,QPTR<1,EPTR>>
      ESTD.ID = DPTR:"!":CPTR:"!":EQTY
      LOCATE ESTD.ID IN EST.DEPT.COMP<1>,1 SETTING DCP ELSE RETURN
      MATREAD ESTD.REC FROM ESTIMATE.DEPT, CONO:EST.KEY:"!":ESTD.ID ELSE RETURN
      LPTR = 0
      TC = COUNT(ESTD.TYPE,VM) + (ESTD.TYPE # "")
      FOR TP = 1 TO TC
         TYPE = ESTD.TYPE<1,TP>
         IF TYPE[1,1] = "G" THEN
            LPTR = LPTR + 1
            P.TYPE<1,LPTR> = "G"
            P.OPV<1,LPTR> = ESTD.OPV<1,TP>
            P.DESC<1,LPTR> = ESTD.DESC<1,TP>
            GOTO 1090
         END
         LPTR = LPTR + 1
         IF EPTR = 1 THEN
            P.TYPE<1,LPTR> = TYPE
            P.CCTR<1,LPTR> = ESTD.CCTR<1,TP>
            P.OPV<1,LPTR> = ESTD.OPV<1,TP>
            P.DESC<1,LPTR> = ESTD.DESC<1,TP>
            P.UM<1,LPTR> = ESTD.STD.TYPE<1,TP>
         END ELSE
            IF ESTD.CCTR<1,TP> # P.CCTR<1,LPTR> THEN
               ERRMSG = "Department detail mismatch"
            END
            IF ESTD.CCTR<1,TP> # P.CCTR<1,LPTR> THEN
               ERRMSG = "Department detail mismatch"
            END
         END
         BEGIN CASE
            CASE TYPE[1,1] = "L"
               P.HRS<1,LPTR,EPTR> = ESTD.HRS<1,TP>
               P.THRS<1,1,EPTR> = P.THRS<1,1,EPTR> + P.HRS<1,LPTR,EPTR>
               P.GHRS<1,1,EPTR> = P.GHRS<1,1,EPTR> + P.HRS<1,LPTR,EPTR>
            CASE 1
               P.QTY<1,LPTR,EPTR> = ESTD.QTY<1,TP>
         END CASE
         P.FCTR<1,LPTR,EPTR> = ESTD.FCTR<1,TP>
         P.TCOST<1,1,EPTR> = P.TCOST<1,1,EPTR> + ESTD.COST<1,TP>
         P.GSELL<1,1,EPTR> = P.GSELL<1,1,EPTR> + ESTD.TSALE<1,TP>
1090  NEXT TP
   NEXT EPTR
   RETURN
*
*---- GET SPECIAL INSTRUCTIONS
*
5000*
   SCNT=0; SREC=""
   OP=0; OLD.DESC = ""
   FOR LP = 1 TO DC
      IF NUM(EST.COMMENT.TYPE<1,LP>) AND EST.COMMENT.TYPE<1,LP> # "" THEN
         OP = OP + 1
         OLD.DESC<1,OP> = EST.COMMENTS<1,LP>
      END
   NEXT LP
   CALL DESC.REFORMAT (OLD.DESC,45,NEW.DESC)
   LP = DCOUNT(NEW.DESC,VM)
   FOR L = 1 TO LP
      SCNT = SCNT + 1
      SREC<SCNT> = NEW.DESC<1,L>
   NEXT L
   RETURN
*
*---- PRINT PAGE HEADINGS
*
10000*
   PRINT CHAR(12)
   PAGE.NO = PAGE.NO + 1
   PRINT HD1 : PAGE.NO
   PRINT HD2
   PLINE= PBOLDON:"Estimate : ":PBOLDOF:EST.KEY "L#30"
   PLINE = PLINE:SP5:' ':PBOLDON:"Salesrep : ":PBOLDOF
   PLINE = PLINE:SALS.NAME"L#30"
   PLINE = PLINE:SP5:PBOLDON:"Estimator      : ":PBOLDOF:ESTMTR.NAME
   PRINT PLINE
   LINE.CNT = 4
   RETURN
*
*---- END OF PROGRAM
*
99999*
   PRINTER OFF
*  PRINTER CLOSE
   RETURN
END
