   SUBROUTINE EST.RES.DEPT.COMP.SUM.RPT(CONO, CO.NAME, EST.KEY,JOB.DESC, PAGE.NO,PRT.QTY,HD1,HD2)
*********************************************************************
* REVISION - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* PROGRAM  - EST.RES.DEPT.COMP.SUM.RPT
* AUTHOR   - RHONDA PERRIN, COMPUTER BUSINESS ASSOCIATES
* DATE     - 03/21/86
* DESCRIPTION
* This subroutine will print estimate data summarized by department and
* component. Data may be summarized for one or all components for the
* specified order quantity.
*T26138 cm 10/11/2001 * Expand qty field from 8 to 9 digits.
*T26090 cmykleb 04/04/2002 * Change rpt to use rpt heading from call pgm.
*********************************************************************
*
*---- COPY STATEMENTS
*
*COPY>JES.CPYLIB>SCOMMON.ESTIMATE
*COPY>JES.CPYLIB>ESTIMATE
*COPY>JES.CPYLIB>EST.DEPT.COMP.SUM
*COPY>JES.CPYLIB>JES.FILE.VARS
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*COPY>CPYLIB>SYSCOM
   MAT SYSCOM.REC =  ""; SYS.TYPE = 2
*
*---- DIMENSIONED VARIABLES
*
   DIM TOT.REC(20)
   DIM DEPT.TTL(20)
   DIM COMP.TTL(20)
   DIM GRND.TTL(20)
*
*---- INITIALIZATION
*
   SP = " "
   QCNT = DCOUNT(PRT.QTY,SVM)
   QPTR = ''
   FOR Q = 1 TO QCNT
      LOCATE PRT.QTY<1,1,Q> IN EST.QTY<1>,1 SETTING Q1 THEN
         QPTR<1,Q> = Q1
      END
   NEXT Q
   IF QCNT > 3 THEN QCNT = 3
*T26138 v
*  QTY1 = OCONV(EST.QTY<1,QPTR<1,1>>,"MD0,") "R#10"
*  QTY2 = OCONV(EST.QTY<1,QPTR<1,2>>,"MD0,") "R#10"
*  QTY3 = OCONV(EST.QTY<1,QPTR<1,3>>,"MD0,") "R#10"
   QTY1 = OCONV(EST.QTY<1,QPTR<1,1>>,"MD0,") "R#11"
   QTY2 = OCONV(EST.QTY<1,QPTR<1,2>>,"MD0,") "R#11"
   QTY3 = OCONV(EST.QTY<1,QPTR<1,3>>,"MD0,") "R#11"
*T26138 ^
   BEGIN CASE
      CASE QCNT = 3
*T26138 v
*        HD4A = "<----- QUANTITY #2 ----->  <----- QUANTITY #3 ----->"
*        HD5A = QTY2:SPACE(17):QTY3
*        HD6A = "RECOMMENDED    CUSTOMER    RECOMMENDED    CUSTOMER"
*        HD7A = "SELL         QUOTE         SELL         QUOTE"
*        HD8A = "------------  -----------  ------------  -----------"
         HD4A = "<------ QUANTITY #2 -----> <------ QUANTITY #3 ----->"
         HD5A = QTY2:SPACE(16):QTY3
         HD6A = "RECOMMENDED    CUSTOMER    RECOMMENDED    CUSTOMER"
         HD7A = "SELL         QUOTE         SELL         QUOTE"
         HD8A = "-------------- ----------- -------------- -----------"
*T26138 ^
      CASE QCNT = "2"
*T26138 v
*        HD4A = "<----- QUANTITY #2 ---->"
*        HD5A = QTY2
*        HD6A = "RECOMMENDED    CUSTOMER"
*        HD7A = "SELL         QUOTE"
*        HD8A = "------------  -----------"
         HD4A = "<------ QUANTITY #2 ------>"
         HD5A = QTY2
         HD6A = " RECOMMENDED    CUSTOMER"
         HD7A = " SEL         QUOTE"
         HD8A = "-------------- -----------"
*T26138 ^
      CASE 1
         HD4A = ""
         HD5A = ""
         HD6A = ""
         HD7A = ""
         HD8A = ""
   END CASE
   LINE = STR("_",11)
*T26090 v
*  N = ((50 - LEN(CO.NAME)) / 2)
*  COMPY.NAME = SPACE(N):CO.NAME:SPACE(N)
*  HD1 = OCONV(DATE(),"D2/"):SPACE(33):COMPY.NAME:SPACE(30):"PAGE: "
*  HD2 = SPACE(43):"E S T I M A T E   S U M M A R Y   R E P O R T"
*  HD2A = SPACE(59):"BY DEPARTMENT"
   HD2A = SPACE(57):"ESTIMATE SUMMARY REPORT - BY DEPARTMENT"
*T26090 ^
   HD3 = "ESTIMATE : ":EST.KEY "L#12":"    ":EST.CUST.NAME "L#40":"    ":JOB.DESC "L#60"
*T26138 v
*  HD4 = SPACE(51):"<----- QUANTITY #1 ----->  ":HD4A
*  HD5 = SPACE(58):QTY1:SPACE(17):HD5A
*  HD6 = SPACE(51):"RECOMMENDED    CUSTOMER    ":HD6A
*  HD7 = "         DEPARTMENT                                    SELL         QUOTE         ":HD7A
*  HD8 = "---------------------------  --------------------  ------------  -----------  ":HD8A
   HD4 = SPACE(49):"<------ QUANTITY #1 -----> ":HD4A
   HD5 = SPACE(58):QTY1:SPACE(15):HD5A
   HD6 = SPACE(51):"RECOMMENDED    CUSTOMER    ":HD6A
   HD7 = "         DEPARTMENT                                    SELL         QUOTE        ":HD7A
   HD8 = "--------------------------- -------------------- -------------- ----------- ":HD8A
*T26138 ^
   MAT TOT.REC = ""
   MAT DEPT.TTL = ""
   MAT COMP.TTL = ""
   MAT GRND.TTL = ""
   DSEL = "ALL"
   CSEL = "ALL"
   PRINTER ON
*
*---- MAIN PROCESSING
*
   GOSUB 200
100 *
   FOR R = 1 TO QCNT
      QTY.CNT = R
      QSEL = EST.QTY<1,R>
      MAT DSUM.REC2 = ""
      CALL EST.RES.DEPT.COMP.SUB(CONO,EST.KEY,DSEL,CSEL,QSEL,MAT DSUM.REC2)
      GOSUB 300
   NEXT R
   GOSUB 400
   PRINTER OFF
   GOTO 99999
*
*---- PRINT HEADING
*
200 *
   PRINT CHAR(12)
   PAGE.NO = PAGE.NO + 1
   PRINT HD1:PAGE.NO
   PRINT HD2
   PRINT
   PRINT HD3
   PRINT
   PRINT HD4
   PRINT HD5
   PRINT HD6
   PRINT HD7
   PRINT HD8
   PRINT
   LINE.CNT = 12
   RETURN
*
*---- CREATE TABLE
*
300 *
   DCNT = COUNT(DSUM.DEPT,VM) + (DSUM.DEPT # "")
   FOR DD = 1 TO DCNT
      LOCATE DSUM.DEPT<1,DD> IN TOT.REC(1)<1>,1 SETTING YY ELSE
         YY = COUNT(TOT.REC(1),VM) + (TOT.REC(1) # "") + 1
         IF QTY.CNT = 1 THEN
            TOT.REC(1)<1,YY> = DSUM.DEPT<1,DD>
            TOT.REC(2)<1,YY> = DSUM.DEPT.DESC<1,DD>
         END
      END
      CCNT = COUNT(DSUM.COMP<1,DD>,SVM) + (DSUM.COMP<1,DD> # "")
      FOR CC = 1 TO CCNT
         IF QTY.CNT = 1 THEN
            TOT.REC(3)<1,YY,CC> = DSUM.COMP<1,DD,CC>
         END
         B = QTY.CNT + 4
         TOT.REC(B)<1,YY,CC> = TOT.REC(B)<1,YY,CC> + DSUM.COMP.LABOR.SALE<1,DD,CC> + DSUM.COMP.MATL.SALE<1,DD,CC> + DSUM.COMP.OSP.SALE<1,DD,CC> + DSUM.COMP.SHIP.SALE<1,DD,CC> + DSUM.COMP.MISC.SALE<1,DD,CC>
         IF QTY.CNT = 1 THEN
            COMP.TTL(1)<1,CC> = DSUM.COMP.DESC<1,DD,CC>
         END
         G = QTY.CNT + 1
         COMP.TTL(G)<1,CC> = COMP.TTL(G)<1,CC> + TOT.REC(B)<1,YY,CC>
      NEXT CC
      DEPT.TTL(QTY.CNT)<1,YY> = DEPT.TTL(QTY.CNT)<1,YY> + DSUM.DEPT.LABOR.SALE<1,DD> + DSUM.DEPT.MATL.SALE<1,DD> + DSUM.DEPT.OSP.SALE<1,DD> + DSUM.DEPT.SHIP.SALE<1,DD> + DSUM.DEPT.MISC.SALE<1,DD>
   NEXT DD
   RETURN
*
*---- PRINT DETAIL LINES
*
400 *
   TCNT = COUNT(TOT.REC(1),VM) + (TOT.REC(1) # "")
   FOR ZZ = 1 TO TCNT
      PLINE = TOT.REC(1)<1,ZZ> "L#5":SP:TOT.REC(2)<1,ZZ> "L#20":SP
      CP.CNT = COUNT(TOT.REC(3)<1,ZZ>,SVM) + (TOT.REC(3)<1,ZZ> # "")
      FOR CP = 1 TO CP.CNT
*T26138 v
*        PLINE = PLINE:TOT.REC(4)<1,ZZ,CP> "L#20":SP:OCONV(TOT.REC(5)<1,ZZ,CP>,"MD2,")"R#12":SP:LINE:SP
*        IF QCNT > 1 THEN PLINE = PLINE:OCONV(TOT.REC(6)<1,ZZ,CP>,"MD2,")"R#12":SP:LINE:SP
*        IF QCNT = 3 THEN PLINE = PLINE:OCONV(TOT.REC(7)<1,ZZ,CP>,"MD2,")"R#12":SP:LINE
         PLINE = PLINE:TOT.REC(4)<1,ZZ,CP> "L#21":SP:OCONV(TOT.REC(5)<1,ZZ,CP>,"MD2,")"R#14":SP:LINE:SP
         IF QCNT > 1 THEN PLINE = PLINE:OCONV(TOT.REC(6)<1,ZZ,CP>,"MD2,")"R#14":SP:LINE:SP
         IF QCNT = 3 THEN PLINE = PLINE:OCONV(TOT.REC(7)<1,ZZ,CP>,"MD2,")"R#14":SP:LINE
*T26138 ^
         PRINT PLINE
         PLINE = SPACE(29)
         LINE.CNT = LINE.CNT + 1
         IF LINE.CNT >= 53 THEN GOSUB 200
      NEXT CP
*T26138 v
*     DLINE = SPACE(31):"DEPARTMENT TOTALS   ":OCONV(DEPT.TTL(1)<1,ZZ>,"MD2,")"R#12":SP:LINE:SP
*     IF QCNT > 1 THEN DLINE = DLINE:OCONV(DEPT.TTL(2)<1,ZZ>,"MD2,")"R#12":SP:LINE:SP
*     IF QCNT = 3 THEN DLINE = DLINE:OCONV(DEPT.TTL(3)<1,ZZ>,"MD2,")"R#12":SP:LINE
      DLINE = SPACE(29):"DEPARTMENT TOTALS   ":OCONV(DEPT.TTL(1)<1,ZZ>,"MD2,")"R#14":SP:LINE:SP
      IF QCNT > 1 THEN DLINE = DLINE:OCONV(DEPT.TTL(2)<1,ZZ>,"MD2,")"R#14":SP:LINE:SP
      IF QCNT = 3 THEN DLINE = DLINE:OCONV(DEPT.TTL(3)<1,ZZ>,"MD2,")"R#14":SP:LINE
*T26138 ^
      PRINT DLINE
      PRINT
      LINE.CNT = LINE.CNT + 2
      IF LINE.CNT >= 53 THEN GOSUB 200
      PLINE = ""
      DLINE = ""
   NEXT ZZ
   CLINE = SPACE(19):"          COMPONENT TOTALS   "
*T26138 v
*  CLINE = CLINE:SPACE(1):OCONV(COMP.TTL(2)<1,1>,"MD2,")"R#12":SP:LINE
   CLINE = CLINE:SPACE(1):OCONV(COMP.TTL(2)<1,1>,"MD2,")"R#14":SP:LINE
*T26138 ^
   PRINT CLINE
   CLINE = SPACE(29)
   LINE.CNT = LINE.CNT + 1
   IF LINE.CNT >= 53 THEN GOSUB 200
   GRND.TTL(1) = GRND.TTL(1) + COMP.TTL(2)<1,1>
   GRND.TTL(2) = GRND.TTL(2) + COMP.TTL(3)<1,1>
   GRND.TTL(3) = GRND.TTL(3) + COMP.TTL(4)<1,1>
   PRINT
*T26138 v
*  GLINE = SPACE(36):"GRAND TOTALS   ":OCONV(GRND.TTL(1),"MD2,")"R#12":SP:LINE:SP
*  IF QCNT > 1 THEN GLINE = GLINE:OCONV(GRND.TTL(2),"MD2,")"R#12":SP:LINE:SP
*  IF QCNT = 3 THEN GLINE = GLINE:OCONV(GRND.TTL(3),"MD2,")"R#12":SP:LINE
   GLINE = SPACE(34):"GRAND TOTALS   ":OCONV(GRND.TTL(1),"MD2,")"R#14":SP:LINE:SP
   IF QCNT > 1 THEN GLINE = GLINE:OCONV(GRND.TTL(2),"MD2,")"R#14":SP:LINE:SP
   IF QCNT = 3 THEN GLINE = GLINE:OCONV(GRND.TTL(3),"MD2,")"R#14":SP:LINE
*T26138 ^
   PRINT GLINE
   RETURN
*
*---- ERROR ROUTINE
*
90000 ERR.TYPE=1;CALL SI_SYSCOM(MAT SYSCOM.REC);RETURN
*
*---- END OF PROGRAM
*
99999 *
   RETURN
END
