      SUBROUTINE EST.FORMULA.Q002 (CONO, ACTION, EQTY, DEPT, COMP)
***************************************************************************
*
* REVISION - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
*
* PROGRAM  - EST.FORMULA.Q002
*
* AUTHOR   - NICK AMENDOLA, COMPUTER BUSINESS ASSOCIATES
*
* DATE     - 04/27/86
*
* DESCRIPTION
*
* This formula is used to calculate quantity of roll paper required.
*
***************************************************************************
*
*---- COPY STATEMENTS
*
*COPY>JES.CPYLIB>SCOMMON.ESTIMATE
*COPY>JES.CPYLIB>ESTIMATE
*COPY>JES.CPYLIB>ESTIMATE.MATL
*COPY>JES.CPYLIB>ESTIMATE.TEMP
*COPY>JES.CPYLIB>JES.FILE.VARS
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*
*---- INITIALIZATION
*
      IF TEMP.MPTR = "" THEN MPTR = 1 ELSE MPTR = TEMP.MPTR
      IF EST.PROD.OS.PROD<1,COMP,MPTR> = "" THEN
         TEMP.QTY = 0
         RETURN
      END
*
      TEMP.QTY = ""
      LOCATE EQTY IN EST.QTY<1>,1 SETTING QPTR ELSE QPTR = 1
*     MATREAD ESTM.REC FROM ESTIMATE.MATL, CONO:TEMP.TYPE[2,1]:EST.PROD.OS.USAGE<1,COMP,MPTR> ELSE
*        MATREAD ESTM.REC FROM ESTIMATE.MATL, CONO:TEMP.TYPE[2,1] ELSE RETURN
*     END
*
*---- MAIN PROCESSING
*
      TEMP.OPV = EST.PROD.OS.PROD<1,COMP,MPTR>
      LOCATE TEMP.OPV IN ESTM.PROD<1>,1 SETTING MP ELSE RETURN
      TEMP.CODE = EST.PROD.PLINE<1,COMP,MPTR>
      TEMP.QTY = FIELD(EST.PROD.PQTY<1,COMP,MPTR>,"!",QPTR)
      IF TEMP.FCTR = "" THEN
         TEMP.FCTR = 1000
      END
      TEMP.STD = FIELD(EST.PROD.PCST<1,COMP,MPTR>,"!",QPTR) / 100
      TEMP.STD.TYPE = "$/CWT"
      TEMP.UM = 100
      TEMP.IND.1 = ESTM.FOH.PCT<1,MP>
      TEMP.MARKUP = ESTM.MARKUP<1,MP>
      TEMP.DESC = EST.PROD.OS.DESC<1,COMP,MPTR>
********************************************************************
* TASK # 16665, NA 09-24-92
* ELIMINATE M/R IMPRESSIONS FROM ADDITIONAL THOUSAND CALCULATION
*     TEMP.VSALE = "Y"
      M.WEIGHT = EST.PROD.M.WT<1,COMP,MPTR> / 100
      MR.SHT = FIELD(EST.PROD.MR.REQ<1,COMP,MPTR>,"!",QPTR)
      ORD.LBS = FIELD(EST.PROD.PQTY<1,COMP,MPTR>,"!",QPTR)
      ORD.SHT = INT(ORD.LBS * 1000 / M.WEIGHT + 0.5)
      TOT.SHT = ORD.SHT
      TEMP.VSALE = INT((100 - (MR.SHT*100/TOT.SHT)) * 100 + 0.5)
********************************************************************
      RETURN
   END
