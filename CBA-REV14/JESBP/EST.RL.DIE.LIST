*COPY>CPYLIB>SCOMMON1
*********************************************************************
* REVISION    - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - RES.BP
* PROGRAM     - EST.RL.DIE.LIST
* BY          - KERRY WILSON
* DATE        - 01/23/90
* DESCRIPTION - This program lists the Roll Label Die.
* MOD TASK 16863 01/19/93 BP - REMOVE ALL REFERENCES TO DEPARTMENT
* CSF 22040 - 11/17/94 LMR - PRINT SAME FORMAT REGARDLESS OF SORT Y/N.
*********************************************************************
*COPY>JES.CPYLIB>ESTIMATE.RL.DIE
*COPY>PMC.CPYLIB>DEPARTMENT
*COPY>PMC.CPYLIB>COMPANY
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>SYSCOM
*COPY>CPYLIB>CHAR
*
*---- SET SYSCOM
*
      SYS.TYPE=1
      CALL SI_SYSCOM(MAT SYSCOM.REC)
*
*---- OPEN FILES
*
      OPEN 'ESTIMATE.RL.DIE' TO ESTIMATE.RL.DIE ELSE
         ERRMSG = 'CANNOT OPEN ESTIMATE.RL.DIE FILE'
         GOTO 93000
      END
      OPEN 'DEPARTMENT' TO DEPARTMENT ELSE
         ERRMSG = 'CANNOT OPEN DEPARTMENT FILE'
         GOTO 93000
      END
      OPEN 'COMPANY' TO COMPANY ELSE
         ERRMSG = 'CANNOT OPEN COMPANY FILE'
         GOTO 93000
      END
      OPEN 'CONTROL' TO CONTROL ELSE
         ERRMSG = 'CANNOT OPEN CONTROL FILE'
         GOTO 93000
      END
*
*---- PROC READ
*
      PROCREAD ID ELSE
      ERRMSG = "MUST RUN FROM MENU"
      GOSUB 91000
      GOTO 99999
      END
      CONO = ID<1>
      CONO.NAME = ID<2>
      PRT.FLG = ID<3>
      PRS.CNT = 0
*
*---- SET UP HEADINGS
*
      REPORT.NAME = "ROLL DIE REPORT"
      REPORT.NUMBER = "XXXX"
      REPORT.DATE = DATE()
      HD1 = ''
      HD1B = SPACE(INT((100-LEN(CONO.NAME))/2)):CONO.NAME
      HD1B = HD1B "L#100"
      HD1 = HD1:HD1B:'   PAGE '
      HD2 = 'REPORT # : ':REPORT.NUMBER
      HD2 = HD2:SPACE(44):'R O L L   D I E   R E P O R T'
      HD3 = 'DEPARTMENT '
*     IF PRT.FLG = 'Y' THEN
*        HD4 = ' DIE ID   SIZE AC SIZE AR'
*        HD5 = '--------- ------- -------'
*     END ELSE
*          HD4 = ' DIE ID    TH  REPEAT #AC SIZE AC STEP AC #AR SIZE AR  SPC AR'
*          HD5 = '--------- --- ------- --- ------- ------- --- ------- -------'
         HD4 = ' DIE ID    TH  REPEAT #AC SIZE AC SPACE AC #AR SIZE AR  SPC AR LOC PRESS'
         HD5 = '--------- --- ------- --- ------- -------- --- ------- ------- --- -----'
*     END
*
*---- INITIALIZATION
*
      LINE.CNT = 999
      PAGE.CNT = 0
      PRINTER ON
*
*---- MAIN PROCESSING
*
100 *
      READNEXT KEY ELSE GOTO 99999
      DIE = KEY[4,12]
      MATREAD RLDIE.REC FROM ESTIMATE.RL.DIE,KEY ELSE GOTO 100
*     IF PRT.FLG NE 'Y' THEN
         PRS.CNT = DCOUNT(RLDIE.CCTR,VM)
         IF PRS.CNT > 0 THEN
            PRS.CNT.CHK = PRS.CNT - 1
         END ELSE
            PRS.CNT.CHK = PRS.CNT
         END
*     END ELSE
*        PRS.CNT.CHK = 0
*     END
*     PREV.DEPT = RLDIE.DEPT
      GOSUB 10000
      GOSUB 1000
      DATA = 1
      LOOP
         READNEXT KEY ELSE DATA = 0
      WHILE DATA DO
         DIE = KEY[4,12]
         MATREAD RLDIE.REC FROM ESTIMATE.RL.DIE,KEY ELSE GOTO 199
*        IF PRT.FLG NE 'Y' THEN
            PRS.CNT = DCOUNT(RLDIE.CCTR,VM)
            IF PRS.CNT > 0 THEN
               PRS.CNT.CHK = PRS.CNT - 1
            END ELSE
               PRS.CNT.CHK = PRS.CNT
            END
*        END ELSE
*           PRS.CNT.CHK = 0
*        END
         BEGIN CASE
*           CASE PREV.DEPT # RLDIE.DEPT
*              PREV.DEPT = RLDIE.DEPT
*              GOSUB 10000
*              GOSUB 1000
            CASE LINE.CNT + 3 + PRS.CNT.CHK > 54
               GOSUB 10000
               GOSUB 1000
            CASE 1
               GOSUB 1000
         END CASE
199 *
      REPEAT
      GOTO 99999
*
*---- PRINT DETAIL
*
1000 *
*     IF PRT.FLG = 'Y' THEN
*        PLINE = DIE "L#9 "
*        PLINE := OCONV(RLDIE.SZ.ACROSS,"MD4")"R#7 "
*        PLINE := OCONV(RLDIE.SZ.AROUND,"MD4")"R#7 "
*     END ELSE
         PLINE = DIE "L#9 "
         PLINE := RLDIE.TEETH "R#3 "
         PLINE := OCONV(RLDIE.REPEAT,"MD4")"R#7 "
         PLINE := RLDIE.NO.ACROSS "R#3 "
         PLINE := OCONV(RLDIE.SZ.ACROSS,"MD4")"R#7 "
         PLINE := OCONV(RLDIE.STEP.ACROSS,"MD4")"R#8 "
         PLINE := RLDIE.NO.AROUND "R#3 "
         PLINE := OCONV(RLDIE.SZ.AROUND,"MD4")"R#7 "
         PLINE := OCONV(RLDIE.SP.AROUND,"MD4")"R#7 "
         PLINE := RLDIE.LOC "R#3 "
         PLINE := RLDIE.CCTR<1,1> "R#5"
*     END
      PRINT PLINE
      LINE.CNT += 1
*     IF PRT.FLG NE 'Y' THEN
         IF PRS.CNT > 1 THEN
            GOSUB 2000
         END
*     END
      RETURN
*
*---- PRINT ADDITIONAL PRESSES
*
2000 *
      VAL = 1
      LOOP
         VAL += 1
      WHILE VAL LE PRS.CNT DO
         PLINE = SPACE(67):RLDIE.CCTR<1,VAL> 'R#5'
         PRINT PLINE
         LINE.CNT += 1
         IF LINE.CNT + 3 > 54 THEN
            GOSUB 10000
            PLINE = DIE "L#9 ":"   CONTINUED"
            PRINT PLINE
            LINE.CNT += 1
         END
      REPEAT
      RETURN
*
*---- PRINT HEADING
*
10000 *
*     MATREAD DEPT.REC FROM DEPARTMENT,CONO:PREV.DEPT ELSE
*        MAT DEPT.REC = ''
*        DEPT.DESC = 'UNKNOWN'
*     END
      PAGE.CNT = PAGE.CNT + 1
      PRINT CHAR(12)
      PRINT HD1:PAGE.CNT
      PRINT HD2
      PRINT
*     PRINT HD3:PREV.DEPT:' ':DEPT.DESC
*     PRINT
      PRINT HD4
      PRINT HD5
      PRINT
      LINE.CNT = 8
      RETURN
*
*---- SYSCOM MESSAGES
*
91000 *
      ERR.TYPE=1
      CALL SI_SYSCOM(MAT SYSCOM.REC)
      RETURN
92000 *
      ERR.TYPE=2
      CALL SI_SYSCOM(MAT SYSCOM.REC)
      RETURN
93000 *
      ERR.TYPE=3
      CALL SI_SYSCOM(MAT SYSCOM.REC)
99999 *
      PRINTER OFF
   END
