      SUBROUTINE EST.DETAIL.RPT.2 (CONO, CO.NAME, EST.KEY, PAGE.NO)
***************************************************************************
*
* REVISION - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
*
* PROGRAM  - EST.DETAIL.RPT.2
*
* AUTHOR   - NICK AMENDOLA, COMPUTER BUSINESS ASSOCIATES
*
* DATE     - 04/18/86
*
* DESCRIPTION
*
* This program will print the detail estimate report.
*
***************************************************************************
*
*---- COPY STATEMENTS
*
*COPY>JES.CPYLIB>SCOMMON.ESTIMATE
*COPY>JES.CPYLIB>ESTIMATE
*COPY>JES.CPYLIB>ESTIMATE.DEPT
*COPY>JES.CPYLIB>JES.FILE.VARS
*COPY>PMC.CPYLIB>COST.CNTR
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*
*---- DEFINE TABLE
*
      DIM TEMP.TBL(20)
      EQU TEMP.DEPT    TO TEMP.TBL(1)
      EQU TEMP.CCTR    TO TEMP.TBL(2)
      EQU TEMP.TYPE    TO TEMP.TBL(3)
      EQU TEMP.OPV     TO TEMP.TBL(4)
      EQU TEMP.DESC    TO TEMP.TBL(5)
      EQU TEMP.RATE    TO TEMP.TBL(6)
      EQU TEMP.QTY     TO TEMP.TBL(7)
      EQU TEMP.FCTR    TO TEMP.TBL(8)
      EQU TEMP.TSALE    TO TEMP.TBL(9)
*
*---- INITIALIZATION
*
      HD1A = "MM/DD/YY"
      HD1B = "                                              XXXXXXXXXX             PAGE "
      HD1 = HD1A:HD1B
      HD2A = SPACE(45):"E S T I M A T E   D E T A I L   R E P O R T"
      HD2B = SPACE(10):"QUANTITY : "
      HD2 = HD2A:HD2B
*
      SH1A = "                   DESCRIPTION                       RATE "
      SH2A = "-------------------------------------------------  -------"
      SH1B = "    QTY   FACTOR TARGET SELL"
      SH2B = "  ------- ------ -----------"
      SH1 = SH1A:SH1B:SH1B:SH1B
      SH2 = SH2A:SH2B:SH2B:SH2B
      PREV.CCTR = ""
      LINE.CNT = 99
      PRINTER ON
*
*---- MAIN PROCESSING
*
      ECNT = COUNT(EST.QTY,VM) + (EST.QTY # "")
      CCNT = EST.COMPONENT.CNT
      DCNT = COUNT(EST.DEPT,VM) + (EST.DEPT # "")
      FOR CPTR = 1 TO CCNT
         FOR DPTR = 1 TO DCNT
            MAT TEMP.TBL = ""
            FOR EPTR = 1 TO ECNT
               EQTY = EST.QTY<1,EPTR>
               GOSUB 1000
            NEXT EPTR
            GOSUB 2000
         NEXT DPTR
      NEXT CPTR
      GOTO 99999
*
*---- GET DEPARTMENT DATA FOR SPECIFIED QUANTITY
*
1000*
      ESTD.ID = DPTR:"!":CPTR:"!":EQTY
      LOCATE ESTD.ID IN EST.DEPT.COMP<1>,1 SETTING DCP ELSE RETURN
      MATREAD ESTD.REC FROM ESTIMATE.DEPT, CONO:EST.KEY:"!":ESTD.ID ELSE RETURN
      TEMP.DEPT<EPTR> = DPTR
      TEMP.CCTR<EPTR> = ESTD.CCTR
      TEMP.TYPE<EPTR> = ESTD.TYPE
      TEMP.OPV<EPTR> = ESTD.TYPE
      TEMP.DESC<EPTR> = ESTD.DESC
      TEMP.RATE<EPTR> = ESTD.STD
      TEMP.QTY<EPTR> = ESTD.QTY
      TEMP.FCTR<EPTR> = ESTD.FCTR
      TEMP.TSALE<EPTR> = ESTD.TSALE
      RETURN
*
*---- PRINT DEPARTMENT DATA
*
2000*
      PRINT
      LINE.CNT = LINE.CNT + 1
      PLINE = EST.DEPT.DESC<1,TEMP.DEPT<1>>
      PRINT PLINE
      LINE.CNT = LINE.CNT + 1
      CCTR.CNT = COUNT(TEMP.CCTR,VM) + (TEMP.CCTR # "")
      FOR CP = 1 TO CCTR.CNT
         CCTR = TEMP.CCTR<1,CP>
         IF CCTR # PREV.CCTR THEN
            PREV.CCTR = CCTR
            MATREAD CCTR.REC FROM COST.CNTR, CONO:CCTR ELSE
               MAT CCTR.REC = ""
            END
            PLINE = SPACE(2):CCTR.DESC
            PRINT PLINE
            LINE.CNT = LINE.CNT + 1
         END
         PLINE = SPACE(4):TEMP.DESC<1,CP>"L#45"
         PLINE = PLINE:SPACE(2):OCONV(TEMP.RATE<1,CP>,"MD2,")"R#7"
         PLINE = PLINE:SPACE(2):OCONV(TEMP.QTY<1,CP>,"MD2,")"R#7"
         PLINE = PLINE:SPACE(1):OCONV(TEMP.FCTR<1,CP>,"MD3")"R#6"
         PLINE = PLINE:SPACE(1):OCONV(TEMP.TSALE<1,CP>,"MD2,")"R#11"
         PLINE = PLINE:SPACE(2):OCONV(TEMP.QTY<2,CP>,"MD2,")"R#7"
         PLINE = PLINE:SPACE(1):OCONV(TEMP.FCTR<2,CP>,"MD3")"R#6"
         PLINE = PLINE:SPACE(1):OCONV(TEMP.TSALE<2,CP>,"MD2,")"R#11"
         PLINE = PLINE:SPACE(2):OCONV(TEMP.QTY<3,CP>,"MD2,")"R#7"
         PLINE = PLINE:SPACE(1):OCONV(TEMP.FCTR<3,CP>,"MD3")"R#6"
         PLINE = PLINE:SPACE(1):OCONV(TEMP.TSALE<3,CP>,"MD2,")"R#11"
         PRINT PLINE
         LINE.CNT = LINE.CNT + 1
      NEXT CP
      RETURN
*
*---- PRINT HEADINGS
*
10000*
      PRINT CHAR(12)
      PAGE.NO = PAGE.NO + 1
      PRINT HD1:PAGE.NO
      PRINT HD2:OCONV(EQTY,"MD0,")
      PRINT
      PRINT "******************"
      PRINT
      PRINT SH1
      PRINT SH2
      LINE.CNT = 8
      RETURN
*
*---- END OF PROGRAM
*
99999*
      PRINTER OFF
      RETURN
   END
