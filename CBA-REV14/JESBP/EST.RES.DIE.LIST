*COPY>CPYLIB>SCOMMON1
*********************************************************************
* REVISION    - [10.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - PRIMAC
* SOURCE      - RES.BP
* PROGRAM     - EST.RL.DIE.LIST
* BY          - KERRY WILSON
* DATE        - 01/23/90
* DESCRIPTION - This program lists the Roll Label Die.
*T25901 cmykleb 03/07/2002 * Change heading to use GET.PROG.HEAD pgm.
*T26090 ajibaly 03/22/2002 * CONVERT TO R12 / RPT.SCRN
*T26594 cmykleb 05/31/2002 * Location needs to be 4 characters.
*********************************************************************
*COPY>JES.CPYLIB>ESTIMATE.RES.DIE
*COPY>JES.CPYLIB>EQUIPMENT
*COPY>PMC.CPYLIB>DEPARTMENT
*COPY>PMC.CPYLIB>COMPANY
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>SYSCOM
*COPY>CPYLIB>CHAR
*
*---- SET SYSCOM
*
   SYS.TYPE=1
   CALL SI_SYSCOM(MAT SYSCOM.REC)
*
*---- OPEN FILES
*
   OPEN 'ESTIMATE.RES.DIE' TO ESTIMATE.RL.DIE ELSE
      ERRMSG = 'CANNOT OPEN ESTIMATE.RL.DIE FILE'
      GOTO 93000
   END
   OPEN 'ESTIMATE.RES.GEARSET' TO EST.RL.GEARSET ELSE
      ERRMSG = 'CANNOT OPEN EST.RL.GEARSET FILE'
      GOTO 93000
   END
   OPEN 'EQUIPMENT' TO EQUIPMENT ELSE
      ERRMSG = 'CANNOT OPEN EQUIPMENT FILE'
      GOTO 93000
   END
   OPEN 'COMPANY' TO COMPANY ELSE
      ERRMSG = 'CANNOT OPEN COMPANY FILE'
      GOTO 93000
   END
   OPEN 'CONTROL' TO CONTROL ELSE
      ERRMSG = 'CANNOT OPEN CONTROL FILE'
      GOTO 93000
   END
*
*---- PROC READ
*
   PROCREAD ID ELSE
      ERRMSG = "MUST RUN FROM MENU"
      GOSUB 91000
      GOTO 99999
   END
   CONO = ID<1>
*T26090 v
*   CONO.NAME = ID<2>
   CONO.NAME = ''
*T26090 ^
   PRT.FLG = ID<3>
   PRT.FLG = 'N'
*
*---- SET UP HEADINGS
*
*T26090 v
*   REPORT.NAME = "ROLL LABEL ESTIMATING DIE LISTING"
   REPORT.NAME = ''
*T26090 ^
   REPORT.NUMBER = ID<2>
*T25901 v
*  HD1 = ''
*  HD1B = SPACE(INT((100-LEN(CONO.NAME))/2)):CONO.NAME
*  HD1B = HD1B "L#100"
*  HD1 = HD1:HD1B:'   PAGE '
*  HD2 = 'REPORT # : ':REPORT.NUMBER
*  HD2 = HD2:SPACE(43):'ROLL LABEL ESTIMATING DIE LISTING'
   HD1 = "" ; HD2 = ""
   CALL GET.PROG.HEAD(CONO,CONO.NAME,REPORT.NAME,REPORT.NUMBER,"",HD1,HD2)
*T25901 ^
   HD3 = 'Gearset Code: '
   IF PRT.FLG = 'Y' THEN
      HD4 = ' DIE ID   SIZE AC SIZE AR'
      HD5 = '--------- ------- -------'
   END ELSE
*T26594 v
*     HD4 = ' DIE ID   T DESCRIPTION             TH  REPEAT  #AC SIZE AC  STEP AC  #AR SIZE AR   SPC AR  CYLINDER ID SHAPE BLANK CORNERS LOC CCTR'
*     HD5 = '--------- - ---------------------- --- -------- --- -------- -------- --- -------- -------- ----------- ----- ----- ------- --- ----'
      HD4 = ' DIE ID   T DESCRIPTION             TH  REPEAT  AC SIZE AC  STEP AC  AR SIZE AR   SPC AR  CYLINDER ID SHAPE BLANK CORNERS LOC  CCTR'
      HD5 = '--------- - ---------------------- --- -------- -- -------- -------- -- -------- -------- ----------- ----- ----- ------- ---- ----'
   END
*
*---- INITIALIZATION
*
   LINE.CNT = 999
   PAGE.CNT = 0
   IDLIST = ""
   PRINTER ON
*
*---- MAIN PROCESSING
*
100 *
   READNEXT KEY ELSE GOTO 99999
   DIE = KEY[4,12]
   MATREAD RLDIE.REC FROM ESTIMATE.RL.DIE,KEY ELSE GOTO 100
   PREV.DEPT = DIE[1,2]
   GOSUB 3000
*T26594 v
*  PRS.CNT = DCOUNT(CCTR,VM)
*T26594 ^
   BEGIN CASE
      CASE LINE.CNT + PRS.CNT+ 2 > 54
         GOSUB 10000
         GOSUB 1000
      CASE 1
         GOSUB 1000
   END CASE
105 *
   READNEXT KEY ELSE GOTO 99999
   DIE = KEY[4,12]
   MATREAD RLDIE.REC FROM ESTIMATE.RL.DIE,KEY ELSE GOTO 100
*T26594 v
*  PRS.CNT = DCOUNT(CCTR,VM)
*T26594 ^
   BEGIN CASE
      CASE PREV.DEPT # DIE[1,2]
         PREV.DEPT = DIE[1,2]
         GOSUB 3000
         GOSUB 10000
         GOSUB 1000
      CASE LINE.CNT + PRS.CNT + 2 > 54
         GOSUB 10000
         GOSUB 1000
      CASE 1
         GOSUB 1000
   END CASE
   GOTO 105
   GOTO 99999
*
*---- PRINT DETAIL
*
1000 *
   IF PRT.FLG = 'Y' THEN
      PLINE = DIE "L#9 "
      PLINE = PLINE:OCONV(RLDIE.SZ.ACROSS,"MD4")"R#7 "
      PLINE = PLINE:OCONV(RLDIE.SZ.AROUND,"MD4")"R#7 "
   END ELSE
      PLINE = DIE "L#9 "
      PLINE = PLINE:RLDIE.RF "L#2"
      PLINE = PLINE:RLDIE.DESC "L#23"
      PLINE = PLINE:RLDIE.TEETH "R#3 "
      PLINE = PLINE:OCONV(RLDIE.REPEAT,"MD4")"R#8 "
*T26594 v
*     PLINE = PLINE:RLDIE.NO.ACROSS "R#3 "
      PLINE = PLINE:RLDIE.NO.ACROSS "R#2 "
*T26594 ^
      PLINE = PLINE:OCONV(RLDIE.SZ.ACROSS,"MD4")"R#8 "
      PLINE = PLINE:OCONV(RLDIE.STEP.ACROSS,"MD4")"R#8 "
*T26594 v
*     PLINE = PLINE:RLDIE.NO.AROUND "R#3 "
      PLINE = PLINE:RLDIE.NO.AROUND "R#2 "
*T26594 ^
      PLINE = PLINE:OCONV(RLDIE.SZ.AROUND,"MD4")"R#8 "
      PLINE = PLINE:OCONV(RLDIE.SP.AROUND,"MD4")"R#8"
      PLINE = PLINE:" ":RLDIE.CYLINDER "L#11"
      PLINE = PLINE:" ":RLDIE.SHAPE "L#5"
      PLINE = PLINE:" ":OCONV(RLDIE.BLANK,"MD2") "R#5"
      PLINE = PLINE:" ":OCONV(RLDIE.CORNERS,"MD5") "R#7 "
*T26594 v
*     PLINE = PLINE: RLDIE.LOC "R#3 "
      PLINE = PLINE: RLDIE.LOC "R#4 "
*T26494 ^
      PLINE = PLINE: CCTR<1,1>[4,99] "L#4"
   END
   PRINT PLINE
   LINE.CNT = LINE.CNT + 1
   IF PRS.CNT > 1 THEN
      GOSUB 2000
   END
   RETURN
*
*---- PRINT ADDITIONAL PRESSES
*
2000 *
   VAL = 1
   LOOP
      VAL += 1
   WHILE VAL LE PRS.CNT DO
      PLINE = SPACE(128):CCTR<1,VAL>[4,99] 'L#4'
      PRINT PLINE
      LINE.CNT += 1
      IF LINE.CNT + 3 > 54 THEN
         GOSUB 10000
         PLINE = DIE "L#9 ":"   CONTINUED"
         PRINT PLINE
         LINE.CNT += 1
      END
   REPEAT
   RETURN
*
*---- GET COST CENTERS
*
3000*
   CCTR = ""
   SELECTINDEX "GSROTARY", PREV.DEPT FROM EQUIPMENT TO IDLIST
   DATA2 = 1
   LOOP
      READNEXT ID FROM IDLIST ELSE DATA2 = 0
   WHILE DATA2 DO
      IF ID[1,3] = CONO THEN
         LOCATE ID IN CCTR<1>,1 BY "AR" SETTING PTR ELSE
            CCTR = INSERT(CCTR,1,PTR,0,ID)
         END
      END
   REPEAT
   SELECTINDEX "GSFBED", PREV.DEPT FROM EQUIPMENT TO IDLIST
   DATA2 = 1
   LOOP
      READNEXT ID FROM IDLIST ELSE DATA2 = 0
   WHILE DATA2 DO
      IF ID[1,3] = CONO THEN
         LOCATE ID IN CCTR<1>,1 BY "AR" SETTING PTR ELSE
            CCTR = INSERT(CCTR,1,PTR,0,ID)
         END
      END
   REPEAT
   PRS.CNT = DCOUNT(CCTR,VM) ;* T26594
   RETURN
*
*---- PRINT HEADING
*
10000 *
   READV GEARSET.DESC FROM EST.RL.GEARSET,CONO:PREV.DEPT,1 ELSE
      GEARSET.DESC = 'Unknown'
   END
   PAGE.CNT = PAGE.CNT + 1
   PRINT CHAR(12)
   PRINT HD1:PAGE.CNT
   PRINT HD2
   PRINT
   PRINT HD3:PREV.DEPT:' ':GEARSET.DESC
   PRINT
   PRINT HD4
   PRINT HD5
   PRINT
   LINE.CNT = 8
   RETURN
*
*---- SYSCOM MESSAGES
*
91000 *
   ERR.TYPE=1
   CALL SI_SYSCOM(MAT SYSCOM.REC)
   RETURN
92000 *
   ERR.TYPE=2
   CALL SI_SYSCOM(MAT SYSCOM.REC)
   RETURN
93000 *
   ERR.TYPE=3
   CALL SI_SYSCOM(MAT SYSCOM.REC)
99999 *
   PRINTER OFF
   PRINTER CLOSE
END
