   SUBROUTINE EST.COMP.DEPT.SUM.RPT (CONO,CO.NAME,EST.KEY,JOB.DESC, PAGE.NO,PRT.QTY,HD1,HD2)
***************************************************************************
*
* REVISION - [08.0]
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
*
* PROGRAM  - EST.COMP.DEPT.SUM.RPT
*
* AUTHOR   - RHONDA PERRIN, COMPUTER BUSINESS ASSOCIATES
*
* DATE     - 03/25/86
*
* DESCRIPTION
*
* This subroutine will print estimate data summarized by component and
* department. Data may be summarized for one or all departments for the
* specified order quantity.
* MOD TASK 18171 06/14/94 (LMR)
* MOD TASK 18148 DMT 7/6/94 PRINT SELECTED QUANTITIES
*T26138 cm 10/04/2001 Expand qty fields from 8 to 9 digits
*T26090 cmykleb 04/04/2002 * Change rpt to use rpt heading from call pgm.
***************************************************************************
*
*---- COPY STATEMENTS
*
*COPY>JES.CPYLIB>SCOMMON.ESTIMATE
*COPY>JES.CPYLIB>ESTIMATE
*COPY>JES.CPYLIB>EST.COMP.DEPT.SUM
*COPY>JES.CPYLIB>JES.FILE.VARS
*COPY>CPYLIB>FILE.VARS
*COPY>CPYLIB>CHAR
*COPY>CPYLIB>SYSCOM
   MAT SYSCOM.REC =  ""; SYS.TYPE = 2
*
*---- DIMENSIONED VARIABLES
*
   DIM TOT.REC(20)
   DIM DEPT.TTL(20)
   DIM COMP.TTL(20)
   DIM GRND.TTL(20)
*
*---- INITIALIZATION
*
   SP = "  "
   LINE = STR("_",11)
*T26090 v
*  N = ((50 - LEN(CO.NAME)) / 2)
*  COMPY.NAME = SPACE(N):CO.NAME:SPACE(N)
*  HD1 = OCONV(DATE(),"D2/"):SPACE(33):COMPY.NAME:SPACE(30):"PAGE: "
*  HD2 = SPACE(43):"E S T I M A T E   S U M M A R Y   R E P O R T"
*  HD2A = SPACE(60):"BY COMPONENT"
   HD2A = SPACE(56):"ESTIMATE SUMMARY REPORT - BY COMPONENT"
*T26090 ^
   HD3 = "ESTIMATE : ":EST.KEY "L#12":"    ":EST.CUST.NAME "L#40":"    ":JOB.DESC "L#60"
   QCNT = DCOUNT(PRT.QTY,SVM)
   QPTR = ''
   FOR Q = 1 TO QCNT
      LOCATE PRT.QTY<1,1,Q> IN EST.QTY<1>,1 SETTING Q1 THEN
         QPTR<1,Q> = Q1
      END
   NEXT Q
   IF QCNT > 3 THEN QCNT = 3
   HD4="""L#42"
   FOR EP = 1 TO QCNT
      QQ = OCONV(EST.QTY<1,QPTR<1,EP>>,"MD0,")
*T26138 v
*     QQ = QQ:SPACE((10-LEN(QQ))/2)
*     HD4=HD4:SPACE(2):"<------ ":QQ"R#10":" ------>"
      QQ = QQ:SPACE((12-LEN(QQ))/2)
      HD4=HD4:SPACE(2):"<------ ":QQ"R#12":" ------>"
*T26138 ^
   NEXT EP
   HD6="""L#42"
   FOR EP = 1 TO QCNT
*T26138 v
*     HD6=HD6:SPACE(3):" RECOMMENDED":SPACE(2):" CUSTOMER  "
      HD6=HD6:SPACE(3):" RECOMMENDED ":SPACE(2):" CUSTOMER  "
*T26138 ^
   NEXT EP
   HD7="     COMPONENT      ":SPACE(2):"     DEPARTMENT     "
   FOR EP = 1 TO QCNT
*T26138 v
*     HD7=HD7:SPACE(3):"    SELL    ":SPACE(2):"   QUOTE   "
      HD7=HD7:SPACE(3):"     SELL    ":SPACE(2):"   QUOTE   "
*T26138 ^
   NEXT EP
   HD8="--------------------":SPACE(2):"--------------------"
   FOR EP = 1 TO QCNT
*T26138 v
*     HD8=HD8:SPACE(2):"-------------":SPACE(2):"-----------"
      HD8=HD8:SPACE(2):"--------------":SPACE(2):"-----------"
*T26138 ^
   NEXT EP
   MAT TOT.REC = ""
   MAT DEPT.TTL = ""
   MAT COMP.TTL = ""
   MAT GRND.TTL = ""
   DSEL = "ALL"
   CSEL = "ALL"
   PRINTER ON
*
*---- MAIN PROCESSING
*
   GOSUB 200
100*
   FOR R = 1 TO QCNT
      QTY.CNT = R
      QSEL = EST.QTY<1,QPTR<1,R>>
      MAT DSUM.REC = ""
      CALL EST.COMP.DEPT.SUB(CONO,EST.KEY,DSEL,CSEL,QSEL,MAT DSUM.REC)
      GOSUB 300
   NEXT R
   GOSUB 400
   PRINTER OFF
   GOTO 99999
*
*---- PRINT HEADING
*
200*
   PRINT CHAR(12)
   PAGE.NO = PAGE.NO + 1
   PRINT HD1:PAGE.NO
   PRINT HD2
   PRINT
   PRINT HD3
   PRINT
   PRINT
   PRINT HD4
   PRINT HD6
   PRINT HD7
   PRINT HD8
   PRINT
   LINE.CNT = 13
   RETURN
*
*---- CREATE TABLE
*
300*
   DCNT = COUNT(DSUM.COMP,VM) + (DSUM.COMP # "")
   FOR DD = 1 TO DCNT
      LOCATE DSUM.COMP<1,DD> IN TOT.REC(1)<1>,1 SETTING YY ELSE
         YY = COUNT(TOT.REC(1),VM) + (TOT.REC(1) # "") + 1
         IF QTY.CNT = 1 THEN
            TOT.REC(1)<1,YY> = DSUM.COMP<1,DD>
            TOT.REC(2)<1,YY> = DSUM.COMP.DESC<1,DD>
         END
      END
      CCNT = COUNT(DSUM.DEPT<1,DD>,SVM) + (DSUM.DEPT<1,DD> # "")
      FOR CC = 1 TO CCNT
         IF QTY.CNT = 1 THEN
            TOT.REC(3)<1,YY,CC> = DSUM.DEPT<1,DD,CC>
            TOT.REC(4)<1,YY,CC> = DSUM.DEPT.DESC<1,DD,CC>
         END
         B = QTY.CNT + 4
         TOT.REC(B)<1,YY,CC> = TOT.REC(B)<1,YY,CC> + DSUM.DEPT.LABOR.SALE<1,DD,CC> + DSUM.DEPT.MATL.SALE<1,DD,CC> + DSUM.DEPT.OSP.SALE<1,DD,CC> + DSUM.DEPT.SHIP.SALE<1,DD,CC> + DSUM.DEPT.MISC.SALE<1,DD,CC>
         LOCATE DSUM.DEPT<1,DD,CC> IN DEPT.TTL(1)<1>,1 SETTING FND ELSE
            FND = COUNT(DEPT.TTL(1),VM) + (DEPT.TTL(1) # "") + 1
            IF QTY.CNT = 1 THEN
               DEPT.TTL(1)<1,FND> = DSUM.DEPT<1,DD,CC>
               DEPT.TTL(2)<1,FND> = DSUM.DEPT.DESC<1,DD,CC>
            END
         END
         G = QTY.CNT + 2
         DEPT.TTL(G)<1,FND> = DEPT.TTL(G)<1,FND> + TOT.REC(B)<1,YY,CC>
      NEXT CC
      COMP.TTL(QTY.CNT)<1,YY> = COMP.TTL(QTY.CNT)<1,YY> + DSUM.COMP.LABOR.SALE<1,DD> + DSUM.COMP.MATL.SALE<1,DD> + DSUM.COMP.OSP.SALE<1,DD> + DSUM.COMP.SHIP.SALE<1,DD> + DSUM.COMP.MISC.SALE<1,DD>
   NEXT DD
   RETURN
*
*---- PRINT DETAIL LINES
*
400*
   TCNT = COUNT(TOT.REC(1),VM) + (TOT.REC(1) # "")
   FOR ZZ = 1 TO TCNT
      PLINE = TOT.REC(2)<1,ZZ> "L#20"
      CP.CNT = COUNT(TOT.REC(3)<1,ZZ>,SVM) + (TOT.REC(3)<1,ZZ> # "")
      FOR CP = 1 TO CP.CNT
*T26138 v
*        PLINE = PLINE:SP:TOT.REC(4)<1,ZZ,CP> "L#20":SP:OCONV(TOT.REC(5)<1,ZZ,CP>,"MD2,")"R#13":SP:LINE:SP
*        IF QCNT > 1 THEN PLINE = PLINE:OCONV(TOT.REC(6)<1,ZZ,CP>,"MD2,")"R#13":SP:LINE:SP
*        IF QCNT = 3 THEN PLINE = PLINE:OCONV(TOT.REC(7)<1,ZZ,CP>,"MD2,")"R#13":SP:LINE
         PLINE = PLINE:SP:TOT.REC(4)<1,ZZ,CP> "L#20":SP:OCONV(TOT.REC(5)<1,ZZ,CP>,"MD2,")"R#14":SP:LINE:SP
         IF QCNT > 1 THEN PLINE = PLINE:OCONV(TOT.REC(6)<1,ZZ,CP>,"MD2,")"R#14":SP:LINE:SP
         IF QCNT = 3 THEN PLINE = PLINE:OCONV(TOT.REC(7)<1,ZZ,CP>,"MD2,")"R#14":SP:LINE
*T26138 ^
         PRINT PLINE
         PRINT
         LINE.CNT = LINE.CNT + 2
         PLINE = SPACE(20)
         IF LINE.CNT >= 55 THEN GOSUB 200
      NEXT CP
*T26138 v
*     CLINE = SPACE(24):" COMPONENT TOTALS   ":OCONV(COMP.TTL(1)<1,ZZ>,"MD2,")"R#13":SP:LINE:SP
*     IF QCNT > 1 THEN CLINE = CLINE:OCONV(COMP.TTL(2)<1,ZZ>,"MD2,")"R#13":SP:LINE:SP
*     IF QCNT = 3 THEN CLINE = CLINE:OCONV(COMP.TTL(3)<1,ZZ>,"MD2,")"R#13":SP:LINE
      CLINE = SPACE(24):" COMPONENT TOTALS   ":OCONV(COMP.TTL(1)<1,ZZ>,"MD2,")"R#14":SP:LINE:SP
      IF QCNT > 1 THEN CLINE = CLINE:OCONV(COMP.TTL(2)<1,ZZ>,"MD2,")"R#14":SP:LINE:SP
      IF QCNT = 3 THEN CLINE = CLINE:OCONV(COMP.TTL(3)<1,ZZ>,"MD2,")"R#14":SP:LINE
*T26138 ^
      PRINT CLINE
      PRINT
      PRINT
      LINE.CNT = LINE.CNT + 3
      IF LINE.CNT >= 55 THEN GOSUB 200
      PLINE = ""
      CLINE = ""
   NEXT ZZ
   DLINE = SPACE(2):"DEPARTMENT TOTALS "
   COM.CNT = COUNT(DEPT.TTL(1),VM) + (DEPT.TTL(1) # "")
   FOR RR = 1 TO COM.CNT
*T26138 v
*     DLINE = DLINE:SP:DEPT.TTL(2)<1,RR> "L#20":SP:OCONV(DEPT.TTL(3)<1,RR>,"MD2,")"R#13":SP:LINE:SP
*     IF QCNT > 1 THEN DLINE = DLINE:OCONV(DEPT.TTL(4)<1,RR>,"MD2,")"R#13":SP:LINE:SP
*     IF QCNT = 3 THEN DLINE = DLINE:OCONV(DEPT.TTL(5)<1,RR>,"MD2,")"R#13":SP:LINE
      DLINE = DLINE:SP:DEPT.TTL(2)<1,RR> "L#20":SP:OCONV(DEPT.TTL(3)<1,RR>,"MD2,")"R#14":SP:LINE:SP
      IF QCNT > 1 THEN DLINE = DLINE:OCONV(DEPT.TTL(4)<1,RR>,"MD2,")"R#14":SP:LINE:SP
      IF QCNT = 3 THEN DLINE = DLINE:OCONV(DEPT.TTL(5)<1,RR>,"MD2,")"R#14":SP:LINE
*T26138 ^
      PRINT DLINE
      PRINT
      LINE.CNT = LINE.CNT + 2
      DLINE = SPACE(20)
      IF LINE.CNT >= 55 THEN GOSUB 200
      GRND.TTL(1) = GRND.TTL(1) + DEPT.TTL(3)<1,RR>
      GRND.TTL(2) = GRND.TTL(2) + DEPT.TTL(4)<1,RR>
      GRND.TTL(3) = GRND.TTL(3) + DEPT.TTL(5)<1,RR>
   NEXT RR
   PRINT
*T26138 v
*  GLINE = SPACE(29):"GRAND TOTALS   ":OCONV(GRND.TTL(1),"MD2,")"R#13":SP:LINE:SP
*  IF QCNT > 1 THEN GLINE = GLINE:OCONV(GRND.TTL(2),"MD2,")"R#13":SP:LINE:SP
*  IF QCNT = 3 THEN GLINE = GLINE:OCONV(GRND.TTL(3),"MD2,")"R#13":SP:LINE
   GLINE = SPACE(29):"GRAND TOTALS   ":OCONV(GRND.TTL(1),"MD2,")"R#14":SP:LINE:SP
   IF QCNT > 1 THEN GLINE = GLINE:OCONV(GRND.TTL(2),"MD2,")"R#14":SP:LINE:SP
   IF QCNT = 3 THEN GLINE = GLINE:OCONV(GRND.TTL(3),"MD2,")"R#14":SP:LINE
*T26138 ^
   PRINT GLINE
   RETURN
*
*---- ERROR ROUTINE
*
90000 ERR.TYPE=1;CALL SI_SYSCOM(MAT SYSCOM.REC);RETURN
*
*---- END OF PROGRAM
*
99999*
   RETURN
END
