SUBROUTINE ValidPO
********************************************************************************
*   Program name :- ValidPO
*   Created:- 8/4/2003
*   T540 Added by yakub on 08/09/07
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE JCS.CPYLIB JOB.STATS
$INCLUDE POS.CPYLIB OUTSIDE.PO
$INCLUDE CPYLIB CHAR;**T540


ERRMSG = ""
*PO.NUM = ''
*PO.LINE.NO = '' 
*CO.POS = ""
*JSTAT_OPO_NO = ''
*VM = ""
*JSTAT_OPO_NO = ''
STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
CONO = PMCProperty<1,4>

*OPEN FILES

OPEN '','JOB.STATS' TO JOB.STATS ELSE ERRMSG='JOB.STATS FILE IS MISSING';GOTO 91000
OPEN '','OUTSIDE.PO' TO OUTSIDE.PO ELSE ERRMSG='OUTSIDE.PO FILE IS MISSING';GOTO 91000
OPEN '','COMPANY' TO COMPANY ELSE ERRMSG='COMPANY FILE IS MISSING';GOTO 91000


* Insert method code here
STATUS = RBO.getProperty('','ID',ID)
STATUS = RBO.getProperty('','DOS_JOB',DOS_JOB)
STATUS = RBO.getProperty('','DOS_PO',DOS_PO)
*STATUS = RBO.getProperty('','Val_Job',DOS_JOB)
*STATUS = RBO.getProperty('','Val_Po',DOS_PO)


*
* GET OUTSIDE PO FOR THIS TRANS
*

*STATUS = RBO.setProperty('','ServerMessage',CONO:"~":CO.POS:"~") 
*RETURN
*STATUS = RBO.setProperty('','ServerMessage',CONO:"~":DOS_JOB:"~":DOS_PO:"~":CO.POS:"~":JSTAT_OPO_NO:"~")
*RETURN
	MATREAD COMP.REC FROM COMPANY, CONO ELSE 
		ERRMSG = "Invalid Company ID (":CONO:")" ;GOTO 91000
	END
	MATREAD OPO.REC FROM OUTSIDE.PO , CONO:DOS_PO ELSE
               MAT OPO.REC=''
	END
	
IF OPO.JOB.NO = '' THEN DOS.PRD.SEQ = 1

    *IF CO.POS="Y" THEN

      MATREAD JSTAT.REC FROM JOB.STATS,CONO:DOS_JOB ELSE MAT JSTAT.REC = ''

*STATUS = RBO.setProperty('','ServerMessage',CONO:"~":DOS_JOB:"~":DOS_PO:"~":CO.POS:"~":JSTAT_OPO_NO:"~")
*STATUS = RBO.setProperty('','ServerMessage',CONO:"~":DOS_JOB:"~":CO.POS)
*RETURN
      PCNT = DCOUNT(JSTAT.OPO.NO,@VM)
      IF PCNT THEN
         GXR.IDLIST=''
         FOR P = 1 TO PCNT
            LOCATE JSTAT.OPO.NO<1,P> IN GXR.IDLIST<1>,1 SETTING PFND ELSE
               GXR.IDLIST<1,PFND> = JSTAT.OPO.NO<1,P>
            END
         NEXT P
         ID.LIST = GXR.IDLIST
         JOB.NO = DOS_JOB
         DOS.PRD.SEQ = 1
      END ELSE
         ERRMSG="No OUTSIDE PO's exist for this job. "
	 GOSUB 91000

      END

   OPO.FND=0
   IF CO.POS="Y" THEN
      OPO.FND = 1
      MATREAD OPO.REC FROM OUTSIDE.PO , CONO:DOS_PO ELSE
         MAT OPO.REC=''
         OPO.FND = 0

         DOS.PRD.SEQ = 1
      END
   END
   VAL.CAT = ''
   VAL.LINE.NO = ''
   VAL.SEQ = ''
   FND = 0
   NEW.PO = ''


   FOR PTR = 1 TO DCOUNT(OPO.JOB.NO,@VM)
*STATUS = RBO.setProperty('','ServerMessage',CONO:"~":CO.POS:"~":DOS_JOB:"~":OPO.JOB.NO<1,PTR>:"~ TEST") 
*RETURN
	NEW.PO<1,PTR> = OPO.PROD.LINE<1,PTR>
      IF OPO.JOB.NO<1,PTR> = DOS_JOB THEN
         FND += 1 
         VAL.CAT <1,FND> = OPO.PROD.LINE<1,PTR>
         VAL.LINE.NO<1,FND>=PTR
         VAL.SEQ<1,FND>=OPO.PROD.SEQ<1,PTR>
*STATUS = RBO.setProperty('','ServerMessage',CONO:"~":VAL.CAT <1,FND>:"~":VAL.LINE.NO<1,FND>:"~":VAL.SEQ<1,FND>) 
*RETURN
      END
   NEXT PTR
*T540 v
CATG = ""
IF DCOUNT(VAL.CAT,VM) = 1 THEN CATG = VAL.CAT
*T540 ^
IF VAL.SEQ = '' THEN  VAL.SEQ = 1
*STATUS = RBO.setProperty('','DOS_PRD_LINE',VAL.CAT)
STATUS = RBO.setProperty('','Out_Cat',VAL.CAT)
STATUS = RBO.setProperty('','Out_Line_No',VAL.LINE.NO)
STATUS = RBO.setProperty('','Out_Seq',VAL.SEQ)
STATUS = RBO.setProperty('','DOS_OPO_SEQ',OPO.PROD.SEQ<1,PTR>)
STATUS = RBO.setProperty('','DOS_PRD_SEQ',NEW.PO)
STATUS = RBO.setProperty('','OPO_FND',OPO.FND)
STATUS = RBO.setProperty('','PO_JOBNO',OPO.JOB.NO)
STATUS = RBO.setProperty('','CATG',CATG);*T540

*STATUS = RBO.setProperty('','DOS_PRD_SEQ',VAL.CAT <1,FND>)

*STATUS = RBO.setProperty('','UOM',UOM)
RETURN

* End of method code
91000
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN

