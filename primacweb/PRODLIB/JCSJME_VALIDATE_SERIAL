SUBROUTINE JCSJME_VALIDATE_SERIAL
********************************************************************************
*   Program name :- JCSJME_VALIDATE_SERIAL
*   Created:- 9/12/2005
*   By :- S.Suhail Hussain  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB CATEGORY
$INCLUDE ICS.CPYLIB INV.WHSE
$INCLUDE ICS.CPYLIB INV.WHSE.LOC
$INCLUDE ICS.CPYLIB INV_SERIAL

  OPEN "","INVENTORY" TO INVENTORY ELSE ERRMSG = "CANNOT OPEN INVENTORY FILE";GOTO 91000
  OPEN "","CATEGORY" TO CATEGORY ELSE ERRMSG = "CANNOT OPEN CATEGORY FILE";GOTO 91000
  OPEN "","INV.WHSE" TO INV.WHSE ELSE ERRMSG = "CANNOT OPEN INV.WHSE FILE";GOTO 91000
  OPEN "","INV.WHSE.LOC" TO INV.WHSE.LOC ELSE ERRMSG = "CANNOT OPEN INV.WHSE.LOC FILE";GOTO 91000
  OPEN "","INV_SERIAL" TO INV_SERIAL ELSE ERRMSG = "CANNOT OPEN INV_SERIAL FILE";GOTO 91000

  STATUS = RBO.getProperty('','SERIAL_DATA',SERIAL_DATA) 
 
  CONO = SERIAL_DATA<1,1>
  JOBNO = SERIAL_DATA<1,2>
  PROD = SERIAL_DATA<1,3>
  WHSNO = SERIAL_DATA<1,4>
  LOCNO = SERIAL_DATA<1,5>
  SERIAL = SERIAL_DATA<1,6>
  RET.VALUE = ""
  IWH.ID=CONO:PROD:"!":WHSNO
  IWLO.ID=CONO:PROD:"!":WHSNO:"!":LOCNO
  MATREAD INV.REC FROM INVENTORY,CONO:PROD ELSE MAT INV.REC = ""
  MATREAD CATG.REC FROM CATEGORY,CONO:INV.LINE ELSE MAT CATG.REC = ""
  MATREAD IWH.REC FROM INV.WHSE,IWH.ID ELSE MAT IWH.REC = ""
  MATREAD IWLO.REC FROM INV.WHSE.LOC,IWLO.ID ELSE MAT IWLO.REC = ""

  IF CATG.TRK.LVL='S' THEN
    LOCATE SERIAL IN IWLO.SERIAL<1>,1 SETTING RFND THEN
      ISTK.ID=CONO:SERIAL
    END ELSE
      ERRMSG="Cannot Locate Serial (":SERIAL:") For Location - ":LOCNO
      GOTO 91000
    END
    MATREAD ISTK.REC FROM INV_SERIAL,ISTK.ID ELSE MAT ISTK.REC=''
    IF CATG.RSV.SERIAL='Y' THEN
      LOCATE JOBNO IN ISTK.JOB<1> SETTING JUNK ELSE
        RET.VALUE='WARNING, This serial has not been reserved for this job.'
      END
    END
    IF CATG.TRACK.QOH='Y' AND ISTK.CUR.QTY<1 THEN
      ERRMSG="No Quantity Available For Serial - ":IWLO.SERIAL<1,RFND>
      GOTO 91000
    END
  END
  STATUS = RBO.setProperty("","SERIAL_INFO",RET.VALUE)
RETURN
91000*
  STATUS = RBO.setProperty("","ServerStatus",1)
  STATUS = RBO.setProperty("","ServerMessage",ERRMSG)
RETURN

