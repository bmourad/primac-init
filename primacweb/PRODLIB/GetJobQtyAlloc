SUBROUTINE GetJobQtyAlloc
********************************************************************************
*   Program name :- GetJobQtyAlloc
*   Created:- 11/14/2005
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB INV.CNV


ERRMSG = ''
OPEN '','REG.REQ' TO REG.REQ ELSE 
	ERRMSG = 'REG.REQ FILE IS MISSING'; GOTO 93000
END

OPEN '','INVENTORY' TO INVENTORY ELSE 
	ERRMSG = 'INVENTORY FILE IS MISSING'; GOTO 93000
END

STATUS=RBO.getProperty('','CONO',CONO)
STATUS=RBO.getProperty('','ProdNum',ProdNum)
STATUS=RBO.getProperty('','JBOnOrd',JBOnOrd)
STATUS=RBO.getProperty('','QtyOpen',QtyOpen)
VALUE=JBOnOrd
MATREAD INV.REC FROM INVENTORY,CONO:ProdNum THEN
   $INCLUDE ICSBP INV.UM.CNV
   GOSUB 4000
   IF ICR.CNV='MD0' THEN
      VALUE = INT(((VALUE/ICR.MT1)*ICR.DV1)*ICR.DV2 + .5)
      QtyOpen=INT(((QtyOpen/ICR.MT1)*ICR.DV1)*ICR.DV2+.5)
   END ELSE
      VALUE=VALUE*10
      QtyOpen=QtyOpen*10
   END
   IF VALUE > QtyOpen THEN
      ERRMSG="QUANTITY ALLOCATED CAN'T BE MORE THAN QUANTITY ORDERED"
      GOTO 93000
   END
END
RETURN
4000:
 BEGIN CASE
      CASE INV.UNIT<1,2> = "SHT" AND INV.UNIT<1,3> = "LBS"
         ICR.CNV = "MD0"; ICR.DV2 = 1
         ICR.DV1 = INV.M.WT; ICR.MT1 = 1
      CASE INV.UNIT<1,2> = "PC" AND INV.UNIT<1,3> = "MSI"
         ICR.CNV = "MD0"; ICR.DV2 = 1
         ICR.DV1 = INV.PAP.WIDTH/100; ICR.MT1 = 10
      CASE INV.UNIT<1,2> = "FT" AND INV.UNIT<1,3> = "MSI"
         ICR.CNV = "MD0"; ICR.DV2 = 12
         ICR.DV1 = INV.PAP.WIDTH/100; ICR.MT1 = 100
      CASE 1
         ICR.CNV = "MD2"; ICR.DV2 = 1
         ICR.DV1 = 10; ICR.MT1 = 1
   END CASE
 

RETURN

93000:
  STATUS = RBO.setProperty('','ServerStatus',1)        
  STATUS = RBO.setProperty('','ServerMessage',ERRMSG) 
RETURN


