SUBROUTINE SYSONPM_GETDATA
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB OVERNIGHT.REQUESTS
ERRMSG = ""
SCHEDDATE = ""
OPEN "","CONTROL" TO CONTROL ELSE
  ERRMSG = "CANNOT OPEN CONTROL FILE"
  GOTO 91000
END

MATREAD OR.REC FROM CONTROL, "OVERNIGHT.REQUESTS" ELSE
	ERRMSG="Processor not currently available for maintenance."
	GOTO 91000
END

STATUS_R=OR.STATUS

X=DCOUNT(STATUS_R,@VM)
FOR I=1 TO X
	IF STATUS_R<1,I>="A" THEN
	STATUS_R<1,I>=STATUS_R<1,I>:"bt"
	END
	IF STATUS_R<1,I>="C" THEN
	STATUS_R<1,I>=STATUS_R<1,I>:"mp"
	END
	IF STATUS_R<1,I>="D" THEN
	STATUS_R<1,I>=STATUS_R<1,I>:"el"
	END
	IF STATUS_R<1,I>="H" THEN
	STATUS_R<1,I>=STATUS_R<1,I>:"ld"
	END
	IF STATUS_R<1,I>="I" THEN
	STATUS_R<1,I>=STATUS_R<1,I>:"np"
	END	
	IF STATUS_R<1,I>="S" THEN
	STATUS_R<1,I>=STATUS_R<1,I>:"ch"
	END

	
NEXT
SCHEDDATE=OR.SCHED.DATE
XYZ=DCOUNT(OR.SCHED.DATE,@VM)

FOR I = 1 TO XYZ
	IF SCHEDDATE<1,I> # "" THEN
	SCHEDDATE<1,I>=OCONV(SCHEDDATE<1,I>,"D2/")
	END
	ELSE
	SCHEDDATE<1,I>=""
	END
NEXT	

STATUS=RBO.setProperty('','REQUESTEDPROCEDURE',OR.REPORT.NAME)
STATUS=RBO.setProperty('','COMPANYNO',OR.COMPANY.NO)
STATUS=RBO.setProperty('','USERID',OR.USER.ID)
STATUS=RBO.setProperty('','STATUS_R',STATUS_R)
STATUS=RBO.setProperty('','SCHEDDATE',SCHEDDATE)
STATUS=RBO.setProperty('','XYZ',XYZ)

RETURN     
91000 
STATUS=RBO.setProperty('','ServerStatus',1)
STATUS=RBO.setProperty('','ServerMessage',ERRMSG)
RETURN

