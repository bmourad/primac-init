SUBROUTINE CR_COALEVEL(CONO,TVO.DIV.OWNER,TVO.AP.DIV,TVO.AP.DEPT,TVO.AP.CCTR,COA.LEVEL,DISABLEDCNT,DIV.DEPTS,DEPT.CCTRSS)
********************************************************************************
*   Program name :- CR_COALEVEL
*   Created:- 5/25/2004
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB DIVISION
$INCLUDE PMC.CPYLIB DEPARTMENT
* Insert method code here
	OPEN "DIVISION" TO DIVISION ELSE ERRMSG = "UNABLE TO OPEN DIVISION FILE";GOTO 1000
	OPEN "DEPARTMENT" TO DEPARTMENT ELSE ERRMSG = "UNABLE TO OPEN DEPARTMENT FILE";GOTO 1000

GEN.DIV  = "00"
GEN.DEPT = "00"
GEN.CCTR = "000"
IF COA.LEVEL = 0 THEN 
	TVO.AP.DIV   = GEN.DIV
	TVO.AP.DEPT  = GEN.DEPT 
	TVO.AP.CCTR  = GEN.CCTR
	DISABLEDCNT  = "CDV#CDP#CCtr"
END ELSE
	DIV = TVO.AP.DIV 
	IF COA.LEVEL = 1 OR DIV = GEN.DIV THEN
		TVO.AP.DEPT 	  = GEN.DEPT
		TVO.AP.CCTR 	  = GEN.CCTR
		DISABLEDCNT 	  = "CDV#CDP#CCtr"
	END ELSE
		IF TVO.DIV.OWNER # "" AND TVO.DIV.OWNER # GEN.DIV THEN
			MATREAD DIV.REC FROM DIVISION,CONO:TVO.DIV.OWNER ELSE
				ERRMSG = "DIVISION " : TVO.DIV.OWNER:"IS NOT ON FILE" 
				GOTO 1000
			END
			DIV	      = TVO.DIV.OWNER				
			TVO.AP.DIV   = DIV			
			DIV.DEPTS    = LOWER(DIV.DEPT)	
			DISABLEDCNT  = "CDV"
		END ELSE
			DIV	      = TVO.AP.DIV 
			DISABLEDCNT  = ""			
		END				
		DEPT = TVO.AP.DEPT 		
		IF COA.LEVEL = 2 OR DEPT = GEN.DEPT THEN
			TVO.AP.CCTR  = GEN.CCTR
			DISABLEDCNT  = "CDV#CCtr"	
		END ELSE			
			MATREAD DEPT.REC FROM DEPARTMENT, CONO:DEPT ELSE DEPT.DESC = ""          
			CCTR	      = TVO.AP.CCTR 
			DEPT.CCTRSS  = LOWER(DEPT.CCTRS) 						
		END
	END				
END

1000*
   IF ERRMSG # "" THEN
	STATUS = RBO.setProperty('','ServerStatus',1)        
	STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
    END
* End of method code
RETURN

