SUBROUTINE XREF_GET_PRODUCT
********************************************************************************
*   Program name :- XREF_GET_PRODUCT
*   Created:- 8/28/2003
*------------------------------------------------------------------------------*
*
* AUTHOR G.PURUSHOTHAM RAO
* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE ICS.CPYLIB CATEGORY
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB INV.WHSE
$INCLUDE ICS.CPYLIB WAREHOUSE
$INCLUDE CPYLIB GEN.XREF.SUB
$INCLUDE CPYLIB CHAR
$INCLUDE CPYLIB XREF.DATA

   OPEN '','CATEGORY' TO CATEGORY ELSE
      ERRMSG = 'CANNOT LOCATE CATEGORY FILE'
      GOTO 93000
   END
   OPEN '','INVENTORY' TO INVENTORY ELSE
      ERRMSG = 'CANNOT LOCATE INVENTORY FILE'
      GOTO 93000
   END
   OPEN '','INV.WHSE' TO INV.WHSE ELSE
      ERRMSG = 'CANNOT LOCATE INV.WHSE FILE'
      GOTO 93000
   END
   OPEN '','WAREHOUSE' TO WAREHOUSE ELSE
      ERRMSG = 'CANNOT LOCATE WAREHOUSE FILE'
      GOTO 93000
   END

* Insert method code here

STATUS=RBO.getProperty('','XREF_PROD_DESC',PROD.DESC)
STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
CONO = PMCProperty<1,4>
USER.ID = PMCProperty<1,3>
*----------------------------------------------------------------------
  OPEN '','PREFIX' TO PREFIX ELSE
    ERRMSG = 'CANNOT LOCATE PREFIX FILE'
    GOTO 93000
  END

  OPEN '','INVENTORY.XREF' TO INVENTORY.XREF ELSE
    ERRMSG = 'CANNOT LOCATE INVENTORY.XREF FILE'
    GOTO 93000
  END

  OPEN '','XREF.DATA' TO XREF.DATA ELSE
    ERRMSG = 'CANNOT LOCATE XREF.DATA FILE'
    GOTO 93000
  END

XFR.CO = CONO
GXR.XREF = INVENTORY.XREF

GXR.SRCH.ID = PROD.DESC
ALL.NAMES = ""

CALL GET.NAME(GXR.SRCH.ID,ALL.NAMES,PREFIX)

   NAME.CNT = DCOUNT(ALL.NAMES,VM)
   REC.IDS = ""
   REC.TRK = ""	
   IF NAME.CNT THEN
      READ ITEM FROM GXR.XREF, XFR.CO : ALL.NAMES<1,1> ELSE
         GXR.ACTION = "X"; GXR.NAME = "Error # 018"
         GOTO 3999
      END
	*STATUS = RBO.setProperty('','XREF_DIV', ITEM)
	*RETURN
      *REC.IDS = ITEM<XRFS.LOC>
	REC.IDS = ITEM<1>
   END

   LIMIT = NAME.CNT
   FOR MLP = 2 TO LIMIT
      READ ITEM FROM GXR.XREF, XFR.CO : ALL.NAMES<1,MLP> THEN
         CNT = DCOUNT(REC.IDS<1>,VM)
         IF CNT THEN
            FOR SLP = CNT TO 1 STEP - 1
               *LOCATE REC.IDS<1,SLP> IN ITEM<XRFS.LOC>,1 SETTING FND ELSE
		 LOCATE REC.IDS<1,SLP> IN ITEM<1>,1 SETTING FND ELSE
                  REC.IDS = DELETE(REC.IDS,1,SLP,0)
               END
            NEXT SLP
            IF REC.IDS = "" THEN LIMIT = 0
         END ELSE
            LIMIT = 0; REC.IDS = ""
         END
      END ELSE
         LIMIT = 0; REC.IDS = ""
      END
   NEXT MLP

  REC.CNT = DCOUNT(REC.IDS,VM)
  FOR I = 1 TO REC.CNT - 1
	FOR J = I+1 TO REC.CNT
		IF REC.IDS<1,J> < REC.IDS<1,I> THEN
			TEMP = REC.IDS<1,I>
			REC.IDS<1,I> = REC.IDS<1,J>
			REC.IDS<1,J> = TEMP
		END
	NEXT J
  NEXT I
  
   MATREAD XRFS.REC FROM XREF.DATA, "INVENTORY" ELSE
      GXR.ACTION = "X"; GXR.NAME = "Error # 001"
      GOTO 93000
   END

  COL.CNT = DCOUNT(XRFS.HEADING,VM)
  
  DIV.STR = ""

  DIV.STR = DIV.STR : "<TABLE CELLSPACING=1 BORDER=0 CELLPADDING=2 class='readOnlyTable_style'>"

  FOR R = 1 TO REC.CNT
	DIV.STR = DIV.STR : "<TR bgcolor='#cecfce'>"
	
	READV INV.LINE FROM INVENTORY, CONO:REC.IDS<1,R> , 5 ELSE INV.LINE = ''
		READV CATG.TRK.LVL FROM CATEGORY, CONO:INV.LINE , 39 ELSE CATG.TRK.LVL = ''

    FOR I = 1 TO COL.CNT
	*XRFS.LEN<1,I> = XRFS.LEN<1,I> * 10
	IF I = 1 THEN
	  HIDDEN_TEXT = "<INPUT TYPE=HIDDEN NAME=PRODUCT_ID_" : R : " VALUE = '" : REC.IDS<1,R> : "'>"
	  HIDDEN_TEXT_TKL =	"<INPUT TYPE=HIDDEN NAME=CATG_TRK_LVL_" : R : " VALUE = '" : CATG.TRK.LVL : "'>"
		IF HIDDEN_TEXT_TKL = '' THEN
			HIDDEN_TEXT_TKL = 'BHASKAR'
		END	
	  DIV.STR = DIV.STR : "<td align=left><div id=a2" : (R-1) : " onclick=getSerials('" : "DDD" : "'," : R : ") style='text-decoration:underline;color:black;cursor:hand' >" : R : "</div>" : HIDDEN_TEXT  : HIDDEN_TEXT_TKL : " </td>"
	END ELSE	
	  READV ITEM FROM INVENTORY, CONO:REC.IDS<1,R> , XRFS.ATT<1,I> ELSE ITEM = ""
	  IF XRFS.ATT<1,I> = 0 THEN ITEM =  REC.IDS<1,R>
	  IF XRFS.OCONV<1,I> # "" THEN
		ITEM = OCONV(ITEM,XRFS.OCONV)
	  END

**************************************

*	  READV INV.LINE FROM INVENTORY, CONO:REC.IDS<1,R> , 5 ELSE INV.LINE = ''
*	  MATREAD CATG.TRK.LVL FROM CATEGORY, CONO:INV.LINE ELSE CATG.TRK.LVL = ''
*	  IF CATG.TRK.LVL # '' THEN
*		DIV.STR = DIV.STR : "<INPUT TYPE=HIDDEN NAME=CATG_TRK_LVL_" : R : " VALUE = '" : REC.IDS<1,R> : "'>"
*	  END ELSE
*		DIV.STR = DIV.STR : "<INPUT TYPE=HIDDEN NAME=CATG_TRK_LVL_" : R : " VALUE = 'BHASKAR'>"
*	  END

**************************************

	IF I = 2 THEN
	DIV.STR = DIV.STR : "<td align=left><span id=span2[": (I-1) :"][" : (R-1) : "] style='text-decoration:underline;color:black;cursor:hand' onclick=selectProductNumber('" : "DDD" : "'," : R : ") >" : CHANGE(CHANGE(ITEM,'"',''),"'","") : "</span></td>"
	END ELSE
	DIV.STR = DIV.STR : "<td align=left><span id=span2[": (I-1) :"][" : (R-1) : "] >" : CHANGE(CHANGE(ITEM,'"',''),"'","") : "</span></td>"
	END
END
  NEXT I
	DIV.STR = DIV.STR : "</TR>"
  NEXT R
	DIV.STR = DIV.STR : "</table>"
	DIV.STR = DIV.STR : VM : REC.CNT

*	DIV.STR = REC.IDS 	
	STATUS = RBO.setProperty('','XREF_DIV', DIV.STR)
3999*
RETURN

93000*
	STATUS = RBO.setProperty("","ServerMessage",ERRMSG)
RETURN
