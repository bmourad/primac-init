SUBROUTINE RELM_VALIDATE_NEWID
********************************************************************************
*   Program name :- RELM_VALIDATE_NEWID
*   Created:- 9/1/2003 RAZI mohiuddin
*------------------------------------------------------------------------------*
* In Properties:
* --------------
* Out Properties:
* ---------------
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE OPS.CPYLIB ORDER
$INCLUDE OPS.CPYLIB ORDER.RELEASE
$INCLUDE OPS.CPYLIB ORDER.DETAIL
$INCLUDE OPS.CPYLIB PICK.TICKET 

* Insert method code here
OPEN 'ORDER' TO ORDER ELSE
      ERRMSG='CANNOT OPEN ORDER FILE'
      GOTO 1000
END

OPEN 'ORDER.RELEASE' TO ORDER.RELEASE ELSE
      ERRMSG='CANNOT OPEN ORDER.RELEASE FILE'
      GOTO 1000
END

OPEN "","PICK.TICKET" TO PICK.TICKET ELSE
         ERRMSG = "Cannot locate the PICK.TICKET file"
	  GOTO 1000
END


ERRMSG =''
ORDNO = ''

STATUS = RBO.getProperty('','ID',ID)
STATUS = RBO.getProperty('','ORR_ORD',ORR_ORD)


CONO = ID[1,3]
ID = ID[4,99]
ORDNO=ORR_ORD

*STATUS = RBO.setProperty('','ServerMessage','id -- ' : CONO:ORDNO)
*RETURN

MATREAD ORD.REC FROM ORDER, CONO:ORDNO ELSE
    ERRMSG = "Cannot locate order # ":ORDNO
    GOTO 1000
END

******************
PT.NO = 0
PT.CHECK.DONE = 0
  LOOP
    	PT.NO = PT.NO + 1
    	IF LEN(PT.NO) = 1 THEN PT.NO = "0":PT.NO
   	PT.ID = CONO: ORDNO :"-":PT.NO
    	MATREAD PKT.REC FROM PICK.TICKET,PT.ID ELSE
      		MAT PKT.REC = "" ; PT.CHECK.DONE = 1  ; * dont check anymore if null
    	END
    	IF PKT.PRINT.DATE NE "" THEN  ; * check if record really exists
      		IF PKT.REL.NO = "" THEN
        		ERRMSG = "Cannot create release. Delete the picking ticket already printed for this order" : "..."
		       GOTO 1000; PT.CHECK.DONE = 1
      		END 
    	END
  UNTIL PT.CHECK.DONE DO REPEAT
******************
RETURN

1000*
   IF ERRMSG # "" THEN
      STATUS = RBO.setProperty('','ServerStatus', 1)
      STATUS = RBO.setProperty('','ServerMessage', ERRMSG)            
   END

* End of method code
RETURN

