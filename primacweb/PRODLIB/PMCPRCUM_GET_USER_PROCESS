SUBROUTINE PMCPRCUM_GET_USER_PROCESS

$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB PMC_PROCESS
$INCLUDE PMC.CPYLIB SECURITY
$INCLUDE CPYLIB CHAR

ERRMSG = ''
CONO = ''
USER.ID = ''
PMCProperty = ''
PROC.LIST=''
SAVE.PROC.LIST=''

	STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
	STATUS=RBO.getProperty('','UserId',USER.ID)

	CONO = PMCProperty<1,4>
	USER.ID=UPCASE(USER.ID)
	SEC.ID="_":CONO:USER.ID
	
	OPEN "","SECURITY" TO SECURITY ELSE
	  ERRMSG = "CANNOT OPEN SECURITY FILE"
	  GOTO 93000
	END

	 PROCESS.ONFILE = 1
	  OPEN "","PMC_PROCESS" TO PMC_PROCESS ELSE
	    PROCESS.ONFILE = 0
	    ERRMSG = "CANNOT OPEN PMC_PROCESS FILE"
	    GOTO 93000
	  END
	    	
	READU PROC.LIST FROM SECURITY,SEC.ID LOCKED
	      ERRMSG = 'SECURITY record is locked by user - ':GETUSERNAME(STATUS())
	      GOTO 93000
	END THEN
		GOTO READPROCESS
	END ELSE
		RELEASE SECURITY, SEC.ID
	RETURN
	END

*RELEASE SECURITY, SEC.ID
RETURN

READPROCESS:

	arrPPS.DESC=''
	LINES=''
	PPS_ID = ''
	LINES=DCOUNT(PROC.LIST,AM)
	FOR N = 1 TO LINES
		MATREAD PPS.REC FROM PMC_PROCESS,PROC.LIST<N> THEN
			IF N=1 THEN
				PPS_ID=PROC.LIST<N>
				arrPPS.DESC=PPS.DESC
			END ELSE
				PPS_ID=PPS_ID:"ý":PROC.LIST<N>
				arrPPS.DESC=arrPPS.DESC:"ý":PPS.DESC
			END
		END
	NEXT N

	STATUS=RBO.setProperty('','Process',PPS_ID)
	STATUS=RBO.setProperty('','Desc',arrPPS.DESC)
RETURN

93000:
IF ERRMSG # "" THEN
      STATUS = RBO.setProperty('', 'ServerStatus', 1)
      STATUS = RBO.setProperty('', 'ServerMessage', ERRMSG)
END
RETURN
