SUBROUTINE DEFAULT_RELQTY
********************************************************************************
*   Program name :- DEFAULT_RELQTY
*   Created:- 12/26/2005
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE OPS.CPYLIB ORDER.DETAIL
$INCLUDE OPS.CPYLIB ORDER.RELEASE

$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB INV.WHSE
$INCLUDE OPS.CPYLIB ORDER

$INCLUDE ICS.CPYLIB INV.CNV
$INCLUDE CPYLIB CHAR

* Insert method code here

OPEN '','CONTROL' TO CONTROL ELSE
      ERRMSG='CANNOT OPEN CONTROL FILE'
      GOTO 1000
END

OPEN 'ORDER.RELEASE' TO ORDER.RELEASE ELSE
      ERRMSG='CANNOT OPEN ORDER.RELEASE FILE'
      GOTO 1000
END

OPEN '','INVENTORY' TO INVENTORY ELSE
      ERRMSG='CANNOT OPEN INVENTORY FILE'
      GOTO 1000
END

OPEN 'ORDER.DETAIL' TO ORDER.DETAIL ELSE
      ERRMSG='CANNOT OPEN ORDER.DETAIL FILE'
      GOTO 1000
END

ORR_ORD =''
OSD_ITEM =''
REL_QTY=''
LN=''
ORR_SHIP_TO=''
RELNO=''
STATUS = RBO.getProperty('','ORR_ORD',ORR_ORD)		;*ORDER NO
STATUS = RBO.getProperty('','OSD_ITEM',OSD_ITEM)	;*ITEM
STATUS = RBO.getProperty('','ORR_SHIP_TO',ORR_SHIP_TO);*SHIP TO
STATUS = RBO.getProperty('','RELEASE_NO',RELNO)	;*RELEASE NO.
STATUS = RBO.getProperty('','INDEX',LN)

CONO = ORR_ORD[1,3]
ORR_ORD = ORR_ORD[4,99]
*WRITE 'ORR_ORD':ORR_ORD:'OSD_ITEM ':OSD_ITEM:'ORR_SHIP_TO':ORR_SHIP_TO:'RELNO :':RELNO:'REL_QTY :':REL_QTY ON CONTROL,"01YAKUB"
MATREAD INV.REC FROM INVENTORY,CONO:OSD_ITEM ELSE
	ERRMSG='CANNOT READ INVENTORY FILE'
	GOTO 1000
END

$INCLUDE ICSBP INV.UM.CNV

MATREAD ORD.DET.REC FROM ORDER.DETAIL,CONO:ORR_ORD:"!":ORR_SHIP_TO ELSE
 ERRMSG='CANNOT READ ORDER.DETAIL FILE ' 
 GOTO 1000
END 

MATREAD ORR.REC FROM ORDER.RELEASE,CONO:RELNO ELSE
	MAT ORR.REC =''
END

*ADDED BY YAKUB TO GET THE DEFAULT VALUE FOR RELEASE QTY ie REL QTY
	
		MINV = 0; MAXV = OSD.O.QTY<1,LN> - OSD.S.QTY<1,LN>
		IF MAXV < 0 THEN MAXV = 0
                 O.R = "O"
  		*IF REL_QTY<1,LN> # "" THEN
		IF ORR.QTY<1,LN> # "" THEN

    				DEFAULT_RELQTY = OCONV(INT(((ORR.QTY<1,LN> / ICR.DV1) * ICR.MT1) / ICR.DV2 + .5),ICR.CNV)
    	       END ELSE
    				DQTY = OSD.R.QTY<1,LN>
    				DCNT = DCOUNT(OSD.RECP.NO<1,LN>,SM)
   			 FOR DPTR = 1 TO DCNT
     				 IF OSD.REL.NO<1,LN,DPTR> # RELNO THEN
        				DQTY = DQTY - OSD.REL.QTY<1,LN,DPTR>
     				 END
    			NEXT DPTR
			*WRITE 'OSD.R.QTY<1,LN> :':OSD.R.QTY<1,LN>:'DCNT :':DCNT:'DQTY :':DQTY:'OSD.REL.QTY  :':OSD.REL.QTY ON CONTROL,"01YAKUB"

			WRITE DQTY:"~":ICR.DV1:"~":ICR.MT1:"~":ICR.DV2:"~":ICR.CNV ON CONTROL,"11YAKUB"

  		 	DEFAULT_RELQTY = OCONV(INT(((DQTY / ICR.DV1) * ICR.MT1) / ICR.DV2 + .5),ICR.CNV)
 		END

		*ENDED

		 STATUS = RBO.setProperty('','DEFAULT_RELQTY',DEFAULT_RELQTY)

* End of method code
RETURN

1000*
   IF ERRMSG # "" THEN
      STATUS = RBO.setProperty('','ServerStatus', 1)
      STATUS = RBO.setProperty('','ServerMessage', ERRMSG)            
   END
RETURN

