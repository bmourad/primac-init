SUBROUTINE ESTRLM_OPV_LS
********************************************************************************
*   Program name :- ESTRLM_OPV_LS
*   Created:- 7/25/2006
*   Written by   :- Ramakrishna Pusuluri 
*------------------------------------------------------------------------------*
*
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB COST.CNTR
$INCLUDE JCS.CPYLIB OPERATION
$INCLUDE PMC.CPYLIB VEND

OPEN '','COST.CNTR' TO COST.CNTR ELSE
         ERRMSG = 'Cannot open COST.CNTR file!'
	  GOTO 9999
END
OPEN '','OPERATION' TO OPERATION ELSE
         ERRMSG = 'Cannot open OPERATION file!'
	  GOTO 9999
END
OPEN '','VEND' TO VEND ELSE
         ERRMSG = 'Cannot open VEND file!'
	  GOTO 9999
END

* Insert method code here
ESTDEPTINFO 	 = ""
ERRMSG		 = ""
TEMP.TYPE="";TEMP.CCTR="";TEMP.OPV="";TEMP.OPV.TYPE="";TEMP.FCTR="";TEMP.STD=""
TEMP.STD.TYPE="";TEMP.RATE="";TEMP.IND.1="";TEMP.IND.2="";TEMP.IND.3="";TEMP.IND.4=""
TEMP.MARKUP="";TEMP.DESC=""

  	ERR = RBO.getProperty('','DREFCREF',VALUECONTENT)
 	ERR = RBO.getProperty('','PMCProperty',PMCProperty)

     CONO      = PMCProperty<1,4>
     TEMP.TYPE = FIELD(VALUECONTENT,"^",1)
     TEMP.CCTR = FIELD(VALUECONTENT,"^",2)
     TEMP_OPV  = FIELD(VALUECONTENT,"^",3) 


MATREAD CCTR.REC FROM COST.CNTR,CONO:TEMP.CCTR ELSE
     ERRMSG="Invalid Cost Center. Try again! "
END

*LOCATE TEMP.CCTR IN CCTR.OPER<1>,1 SETTING OP.PTR ELSE
LOCATE TEMP_OPV IN CCTR.OPER<1>,1 SETTING OP.PTR ELSE

  ERRMSG="Invalid operation for specified cost center. Try again! "
END

MATREAD OPER.REC FROM OPERATION,CONO:TEMP_OPV ELSE
  ERRMSG="Cannot locate selected operation. Try again! "
END
    TEMP.OPV=TEMP_OPV
    TEMP.OPV.TYPE=CCTR.OPER.TYPE<1,OP.PTR>
    IF CCTR.OPER.STD.IMP<1,OP.PTR>+0=0 THEN TEMP.OPV.TYPE="F"
    TEMP.FCTR=1000
BEGIN CASE
  CASE TEMP.TYPE[1,1]="L"
     IF TEMP.OPV.TYPE="F" THEN
	TEMP.STD=CCTR.OPER.STD.HRS<1,OP.PTR>/100
	TEMP.STD.TYPE="HR/OP"
     END ELSE
	TEMP.STD=CCTR.OPER.STD.IMP<1,OP.PTR>
	TEMP.STD.TYPE="OP/HR"
     END
  CASE 1
     TEMP.STD=CCTR.OPER.HR.RATE<1,OP.PTR>/100
     TEMP.STD.TYPE="$/EA"
END CASE
    IF TEMP.STD+0=0 THEN TEMP.STD=""    
    TEMP.RATE=CCTR.OPER.HR.RATE<1,OP.PTR>
    TEMP.IND.1=CCTR.FOH.TYPE<1,1>:CCTR.FOH.PCT<1,1>
    TEMP.IND.2=CCTR.FOH.TYPE<1,2>:CCTR.FOH.PCT<1,2>
    TEMP.IND.3=CCTR.FOH.TYPE<1,3>:CCTR.FOH.PCT<1,3>
    TEMP.IND.4=CCTR.FOH.TYPE<1,4>:CCTR.FOH.PCT<1,4>
    TEMP.MARKUP=CCTR.OPER.MARKUP<1,OP.PTR>
    TEMP.DESC=OPER.DESC

FOR I=1 TO DCOUNT(CCTR.OPER,@VM)
   IF CCTR.OPER<1,I> = TEMP.OPV THEN
      TEMP.RATE=CCTR.OPER.HR.RATE<1,I>
   END
NEXT I

ESTDEPTINFO = TEMP.TYPE:"^":TEMP.CCTR:"^":TEMP.OPV:"^":TEMP.OPV.TYPE:"^":TEMP.FCTR:"^":TEMP.STD:"^":TEMP.STD.TYPE:"^":TEMP.RATE:"^":TEMP.IND.1:"^":TEMP.IND.2:"^":TEMP.IND.3:"^":TEMP.IND.4:"^":TEMP.MARKUP:"^":TEMP.DESC
STATUS = RBO.setProperty('', 'ESTDEPTINFO', ESTDEPTINFO)
RETURN

9999*	
     IF ERRMSG # "" THEN
       STATUS = RBO.setProperty('', 'ServerMessage', ERRMSG)	   
     END
RETURN
