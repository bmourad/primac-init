SUBROUTINE ARMCRM_GetID
********************************************************************************
*   Program name :- ARMCRM_GetID
*   Created:- 01/08/2003
*------------------------------------------------------------------------------*
*
* In Properties:
* --------------
* Cono,CH_DATE,CH_NUM
*
* Out Properties:
* ---------------
* CONO:DC.KEY
********************************************************************************
$INCLUDE WWINSERT RBO.H

* Insert method code here
$INCLUDE ARS.CPYLIB DAILY.CASH
$INCLUDE CPYLIB CHAR

ERRMSG = ''

* Open files
OPEN '','CONTROL' TO CONTROL ELSE
  ERRMSG='Cannot open CONTROL file!'
  GOTO 93000
END
OPEN '','DAILY.CASH' TO DAILY.CASH ELSE
  ERRMSG='Cannot open DAILY.CASH file!'
  GOTO 93000
END

* Get CONO
STATUS = RBO.getProperty('','Cono',CONO)
STATUS = RBO.getProperty('','CH_DATE',CH_DATE)
REC.DATE = ICONV(CH_DATE,'D2/')
STATUS = RBO.getProperty('','CH_NUM',CH_NUM)

MAT DC.REC = ''
FND=1
LOOP
  READU REF.NUM FROM CONTROL , CONO:"CRREF" ELSE REF.NUM = 800000
  IF REF.NUM > 999999 THEN REF.NUM = 800000
  WRITE REF.NUM+1 ON CONTROL , CONO:"CRREF"
  DC.KEY = "MISC!":REC.DATE:"!":REF.NUM
  MATREAD DC.REC FROM DAILY.CASH , CONO:DC.KEY ELSE
    FND = 0; MAT DC.REC = ''
  END
  IF DC.CASH = '' THEN FND = 0
WHILE FND DO
REPEAT

STATUS = RBO.setProperty('','ID',CONO:DC.KEY)
STATUS = RBO.setProperty('','REF_NUM',REF.NUM)

GOTO 99999

93000
IF ERRMSG THEN
  CALL RBO_ERROR_SUB(ERRMSG)
END

* End of method code
99999
RETURN
