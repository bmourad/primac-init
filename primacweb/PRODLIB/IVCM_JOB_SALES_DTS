SUBROUTINE IVCM_JOB_SALES_DTS
********************************************************************************
*   Program name :- IVCM_JOB_SALES_DTS
*   Created:- 4/29/2004
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE JCS.CPYLIB JOB
$INCLUDE PMC.CPYLIB JOB.SALES.STATS

* Insert method code here
OPEN "","COMPANY" TO COMPANY ELSE ERRMSG="COMPANY FILE IS MISSING"; GOTO 93000
OPEN "","JOB" TO JOB ELSE ERRMSG="JOB FILE IS MISSING"; GOTO 93000
OPEN "","JOB.SALES.STATS" TO JOB.SALES.STATS ELSE ERRMSG="JOB.SALES.STATS FILE IS MISSING";GOTO 93000

STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
CONO = PMCProperty<1,4>
STATUS = RBO.getProperty('','JOB_NO',JOB.NO)

*PREBILL NO THEN IT JOB SCREEN HAS TO APPEAR (IVC.LAST = "y" AND PREBILL = N)


MATREAD COMP.REC FROM COMPANY,CONO ELSE MAT COMP.REC = ""

IF CO.SAS = "Y" AND CO.SAS.INVOICE # "N" THEN
         MATREAD JOB.REC FROM JOB, CONO:JOB.NO ELSE MAT JOB.REC = ""
         *CALL JOB.SALES.MAINT(CONO,JOB.NO,IVC.NO,4,MAT JSS.REC)
	  GOSUB 55555
END
STATUS = RBO.setProperty('','JOB_COST_TOTAL',OCONV(JSS.COST.TOTAL,'MD2'))
RETURN

55555 : 
MATREADU JSS.REC FROM JOB.SALES.STATS,CONO:JOB.NO LOCKED
    ERRMSG = 'JOB SALES STATS record is locked by user - ':GETUSERNAME(STATUS())
    JOB.NO = ''
    GOTO 93000
END ELSE
    MAT JSS.REC = ""
    NEW.JSS = "Y"
END
JSS.COST.TOTAL = JOB.TOT.COST
RETURN

* End of method code
93000
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)

RETURN

