SUBROUTINE RELM_VALIDATE_PROD
********************************************************************************
*   Program name :- RELM_VALIDATE_PROD
*   Created:- 10/4/2003 RAZI
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE OPS.CPYLIB ORDER
$INCLUDE OPS.CPYLIB ORDER.RELEASE
$INCLUDE OPS.CPYLIB ORDER.DETAIL
$INCLUDE OPS.CPYLIB ORDER.DETAIL.INQ
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE PMC.CPYLIB SHIP.TO
$INCLUDE OPS.CPYLIB PICK.TICKET            
$INCLUDE ICS.CPYLIB CATEGORY
$INCLUDE ICS.CPYLIB INV.WHSE
ERRMSG = ''
$INCLUDE ICS.CPYLIB INV.CNV
$INCLUDE CPYLIB CHAR

* Insert method code here
ERRMSG = ''
OPEN 'ORDER' TO ORDER ELSE
      ERRMSG='CANNOT OPEN ORDER FILE'
      GOTO 1000
END

OPEN 'ORDER.RELEASE' TO ORDER.RELEASE ELSE
      ERRMSG='CANNOT OPEN ORDER.RELEASE FILE'
      GOTO 1000
END

OPEN 'ORDER.DETAIL' TO ORDER.DETAIL ELSE
      ERRMSG='CANNOT OPEN ORDER.DETAIL FILE'
      GOTO 1000
END

OPEN 'INVENTORY' TO INVENTORY ELSE
      ERRMSG='CANNOT OPEN INVENTORY FILE'
      GOTO 1000
END

OPEN 'CUSTOMER' TO CUSTOMER ELSE
      ERRMSG='CANNOT OPEN CUSTOMER FILE'
      GOTO 1000
END

OPEN 'SHIP.TO' TO SHIP.TO ELSE
      ERRMSG='CANNOT OPEN SHIP.TO FILE'
      GOTO 1000
END


OPEN 'CATEGORY' TO CATEGORY ELSE
      ERRMSG='CANNOT OPEN CATEGORY FILE'
      GOTO 1000
END

OPEN "","INV.WHSE" TO INV.WHSE ELSE
       ERRMSG = "Cannot locate the INV.WHSE file"
	GOTO 1000
END

ID = ''
CONO=''
STATUS = RBO.getProperty('','ID',ID)
STATUS = RBO.getProperty('','ORR_ORD',ORR_ORD)
STATUS = RBO.getProperty('','ORR_SHIP_TO',ORR_SHIP_TO)
STATUS = RBO.getProperty('','OSD_PROD',OSD_PROD)

CONO = ID[1,3]
ID = ID[4,99]
GEN.SHPNO='000'
PDNO=OSD_PROD
PDNOS=''
MCNT =''
PCNT = 0
VALUE =''
WHNO=''
REFNO=''
INVSUBS=''
BREF = ""
INV_UM =''

WHNOS =''
PPTR = ''
HMSG = ''
PROD.SUBS =''
INV_WHSE_CODE = ''
NCNT =''
J = ''
*************************************************************************
	IF ID # "N" THEN	
		MATREAD ORR.REC FROM ORDER.RELEASE,CONO:ID ELSE
			ERRMSG='CANNOT READ ORDER.RELEASE FILE'
			GOTO 1000
		END
	
		MATREAD ORD.DET.REC FROM ORDER.DETAIL,CONO:ORR.ORD:"!":ORR.SHIP.TO THEN

			WHNOS<1,-1>	  = OSD.WHSE
		END ELSE
			ERRMSG='CANNOT READ ORDER.DETAIL FILE'
			GOTO 1000
		END
	END ELSE 
		MATREAD ORD.DET.REC FROM ORDER.DETAIL,CONO:ORR_ORD:"!":ORR_SHIP_TO THEN
			PDNOS<1,-1> 	  = OSD.PROD
			WHNOS<1,-1>	  = OSD.WHSE
		END ELSE
			ERRMSG='CANNOT READ ORDER.DETAIL FILE'
			GOTO 1000
		END
	END

***************************************************************************
	IF PDNO # "" THEN
	MCNT = DCOUNT(OSD.PROD,VM)
	**P=1
	   FOR P = 1 TO MCNT
		 MATREAD INV.REC FROM INVENTORY,CONO:OSD.PROD<1,P> THEN
      			IF INV.SUBS # "" THEN
       		 	PCNT = PCNT + 1
	      		 	BREF<PCNT> = P
       		 	PROD.SUBS<PCNT> = INV.SUBS
			 	INVSUBS = INV.SUBS
				INV_WHSE_CODE<1,P>	= INV.WHSE.CODE ;* //ADDED BY ZUBAIR TO GET THE WHSE CODE
     			END
    		END
           
 	  NEXT P	



 NCNT = DCOUNT(INVSUBS,@VM)
   FOR J = 1 TO NCNT
		
		MATREAD INV.REC FROM INVENTORY, CONO:INVSUBS<1,J> THEN
    			INV_UM<1,J>=INV.UNIT<1,3>	
		END
   NEXT
DST.SUBS<PPTR> = ""; DST.WHSE<PPTR> = ""
  DST.QTY<PPTR> = ""; ORG.QTY<PPTR> = ""; ORD.QTY<PPTR> = ""
  FOR M = 1 TO MCNT
    LOCATE M IN BREF,1 SETTING X ELSE
      LIMIT = PCNT
      FOR P = 1 TO LIMIT
        LOCATE OSD.PROD<1,M> IN PROD.SUBS<P>,1 SETTING X THEN
          PTR = 1
          LOOP
            LOCATE OSD.PROD<1,M> IN DST.SUBS<PPTR>,PTR SETTING SLOC THEN
              IF OSD.WHSE<1,M> = DST.WHSE<PPTR,SLOC> THEN
                DST.QTY<PPTR,SLOC> = DST.QTY<PPTR,SLOC> + OSD.G.QTY<1,M>
                ORD.QTY<PPTR,SLOC> = ORD.QTY<PPTR,SLOC> + OSD.O.QTY<1,M>
                PTR = 0
              END
            END ELSE
              DST.SUBS<PPTR,SLOC> = OSD.PROD<1,M>
              DST.WHSE<PPTR,SLOC> = OSD.WHSE<1,M>
              DST.QTY<PPTR,SLOC> = OSD.G.QTY<1,M>
              ORD.QTY<PPTR,SLOC> = OSD.O.QTY<1,M>
              PTR = 0
            END
          WHILE PTR DO
            PTR = SLOC + 1
          REPEAT
          LIMIT = 0
        END
      NEXT P
    END
  NEXT M

STATUS = RBO.setProperty('','DST_SUBS',DST.SUBS);*THIS PROPERTY IS SET TO TAKE THE DST_SUBS(MUTIVALUE) AND ITS COMPULSARY


*STATUS = RBO.setProperty('','ServerMessage',"PCNT :":PCNT:"@@@@@":"MCNT :":MCNT:"$$$$":"OSD.PROD :":OSD.PROD)

***************************************************************************************************

   		IF PCNT < 1 THEN
    			ERRMSG = "Cannot locate any base products to distribute for this order"
    			GOTO 1000
   		END

		IF PCNT < 2 AND BREF<PCNT> = PPTR THEN
      			ERRMSG = "There is only one product for this order"
			GOTO 1000
  		END   
		
*Added 
 REFNO = ""; PDNOS = ""; WHNOS = "" 
 FOR M = 1 TO PCNT
    P = BREF<M>
    LOCATE OSD.PROD<1,P> IN PDNOS<1>,1 SETTING PLOC ELSE
      PDNOS<1,PLOC> = OSD.PROD<1,P>
    END
   * LOCATE OSD.WHSE<1,P> IN WHNOS<PLOC>,1 SETTING WLOC ELSE
    *  WHNOS<PLOC,WLOC> = OSD.WHSE<1,P>
    *END
    *REFNO<PLOC,WLOC> = P
  NEXT M
		
		LOCATE PDNO IN PDNOS<1>,1 SETTING PLOC ELSE
    			ERRMSG= "Cannot locate product (":PDNO:") for this order."
   			GOTO 1000
  		END   		
	END







 	STATUS = RBO.setProperty('','TEST', PCNT :" hhh" :MCNT) 
       STATUS = RBO.setProperty('','INV_SUBS', INVSUBS)
	STATUS = RBO.setProperty('','OSD_WHSE', INV_WHSE_CODE)
	STATUS = RBO.setProperty('','INV_UM',INV_UM)


	*STATUS = RBO.setProperty('','DST_SUBS',DST.SUBS)
*************************************************************************
	IF WHNO # "" THEN
		LOCATE WHNO IN WHNOS<PLOC>,1 SETTING WLOC ELSE
   			 ERRMSG = "Warehouse (":WHNO:") is not valid for product (":PDNO:") on this order"
   			 GOTO 1000
  		END
 		MATREAD IWH.REC FROM INV.WHSE, CONO:PDNO:"!":WHNO ELSE
  			 ERRMSG = "Cannot locate warehouse (":WHNO:") for product # ":PDNO
   			 GOTO 1000
 		END
 		PPTR = REFNO<PLOC,WLOC>
  		LOCATE PPTR IN BREF,1 SETTING BPTR ELSE BPTR = 1
	END

*************************************************************************

7010*
 *IF DST.SUBS<PPTR,LN> # "" THEN
 *   DEFAULT = DST.SUBS<PPTR,LN>
 * END
	LOCATE VALUE IN PROD.SUBS<BPTR>,1 SETTING FND ELSE
    		HMSG = "This product is not associated with the base # ":PDNO
   		GOTO 1000
 	END
  	
RETURN
*************************************************************************

1000*
   IF ERRMSG # "" THEN
      STATUS = RBO.setProperty('','ServerStatus', 1)
      STATUS = RBO.setProperty('','ServerMessage', ERRMSG)
      STATUS = RBO.setProperty('','HMSG', HMSG)
	
            
   END

* End of method code
RETURN

