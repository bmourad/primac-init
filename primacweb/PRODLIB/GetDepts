SUBROUTINE GetDepts
********************************************************************************
*   Program name :- GetDepts
*   Created:- 9/23/2001
*------------------------------------------------------------------------------*
*
*  This is a server event which is triggered after the object has been create- *
*  d on the RedBack Server. Note "Server Events" are pre-defined events to wh- *
*  ich application developers can assign BASIC code routines.                                                      - *

* In Properties:
* --------------
*  
*  Updated by Abed Ali
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB DEPARTMENT

* Insert method code here

PROG.ID = 'GetDepts'
   *
   OPEN '','DEPARTMENT' TO DEPARTMENT ELSE
      MESG = 'Cannot open DEPT file!'
      STATUS = RBO.setProperty('', 'ServerStatus', 1)
      STATUS = RBO.setProperty('', 'ServerMessage', MESG)
      RETURN
   END
*
   STATUS = RBO.getProperty('','PMCProperty',Data)
   CONO = Data<1,4>
   DEPTCODES = ''
   DEPTDESCS = ''
   
   CMD = "SSELECT DEPARTMENT WITH CONO='":CONO:"'"
   UDTEXECUTE CMD
   DATA = 1
   LOOP
      READNEXT CODE ELSE DATA = 0
   WHILE DATA DO
	IF CODE[1,3] = CONO THEN
      		MATREAD DEPT.REC FROM DEPARTMENT,CODE ELSE MAT DEPT.REC = ''
		DEPTCODES<1,-1> = CODE[4,99]
		DEPTDESCS<1,-1> = CODE[4,99] : "-" : DEPT.DESC
     	END
   REPEAT
*
   STATUS = RBO.setProperty('', 'DEPT_CODES', DEPTCODES)
   STATUS = RBO.setProperty('', 'DEPT_DESCS', DEPTDESCS)
	

*   STATUS = RBO.setProperty('', 'ServerStatus', 0)
*   STATUS = RBO.setProperty('', 'ServerMessage', '')
*

* End of method code
9999
RETURN

END
