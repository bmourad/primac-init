SUBROUTINE VALIDATE_INV
*********************************************************************
* Copyright 1998 by Primac Systems India
* SYSTEM       - EPRIMAC
* PROGRAM      - VALIDATE_INV
* BY           - KHAJA ZIAUDDIN
* DATE         - 07/29/2003 (mm/dd/yyyy)
* DESCRIPTION  - 
*                
*                
*                
*                
*ENDDOC
*********************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB CATEGORY
$INCLUDE ICS.CPYLIB INV.WHSE
$INCLUDE ICS.CPYLIB INV.CNV

OPEN '','INVENTORY' TO INVENTORY ELSE ERRMSG = 'INVENTORY FILE IS MISSING'; GOTO 93000
OPEN '','CATEGORY' TO CATEGORY ELSE ERRMSG = 'CATEGORY FILE IS MISSING'; GOTO 93000
OPEN '','INV.WHSE' TO INV.WHSE ELSE ERRMSG = 'INV.WHSE FILE IS MISSING'; GOTO 93000

STATUS = RBO.getProperty('','Prod', PROD.ID)
STATUS = RBO.getProperty('','FromWhse',IDM.FROM.WHSE)
STATUS = RBO.getProperty('','PMCProperty', PMCPROPERTY)
CONO = PMCPROPERTY<1,4>

INQUIRY.FLG = 0

   MATREAD INV.REC FROM INVENTORY, CONO:PROD.ID THEN
      MATREAD CATG.REC FROM CATEGORY, CONO:INV.LINE THEN
$INCLUDE ICSBP INV.UM.CNV
         BEGIN CASE           
            CASE CATG.TYPE="L" 
               U.M="LBS"        
            CASE CATG.TYPE="S" 
               U.M="SHT"        
            CASE CATG.TYPE="RL"
               U.M="PC "        
            CASE CATG.TYPE="PC"
               U.M="FT "        
            CASE 1             
               IF INQUIRY.FLG = 0 THEN
                  ERRMSG='PRODUCT ':PROD.ID:' IS NOT A PAPER PRODUCT LINE'
                  GOSUB 91000 ; VALID.PRODUCT = 0 ; RETURN
               END
         END CASE 
         BASWGT = INT(INV.BAS.WT/100)
         BEGIN CASE
            CASE MOD(INV.PAP.WIDTH,10000) = 0
               IWIDTH = OCONV(INT(INV.PAP.WIDTH/10000),"MD0")
            CASE MOD(INV.PAP.WIDTH,1000) = 0
               IWIDTH = OCONV(INT(INV.PAP.WIDTH/1000),"MD1")
            CASE MOD(INV.PAP.WIDTH,100) = 0
               IWIDTH = OCONV(INT(INV.PAP.WIDTH/100),"MD2")
            CASE MOD(INV.PAP.WIDTH,10) = 0
               IWIDTH = OCONV(INT(INV.PAP.WIDTH/10),"MD3")
            CASE 1
               IWIDTH = OCONV(INV.PAP.WIDTH,"MD4")
         END CASE
         MATREAD IWH.REC FROM INV.WHSE, CONO:PROD.ID:'!':IDM.FROM.WHSE THEN
               IF IWH.ON.HAND-IWH.RESV LE 1 THEN
                  ERRMSG = 'PRODUCT ':PROD.ID:' HAS NO QUANTITY AVAILABLE TO TRANSFER'
                  GOSUB 91000 ; VALID.PRODUCT = 0 ; RETURN
               END
               IF CATG.TRK.LVL # 'S' THEN
                  ERRMSG = 'PRODUCT ':PROD.ID:' IS NOT SERIAL TRACKED'
                  GOSUB 91000 ; VALID.PRODUCT = 0 ; RETURN
               END
               LOCATE IDM.FROM.WHSE IN INV.WHSE.CODE<1>,1 SETTING ZPOS ELSE
                  ERRMSG = 'WAREHOUSE #':IDM.FROM.WHSE:' IS NOT SETUP FOR PRODUCT ':PROD.ID
                  GOSUB 91000 ; VALID.PRODUCT = 0 ; RETURN
               END
            *END
         END ELSE
            IF INQUIRY.FLG = 0 THEN
               ERRMSG = 'INV.WHSE #':CONO:PROD.ID:'!':IDM.FROM.WHSE:'IS NOT ON FILE'
               GOSUB 91000 ; VALID.PRODUCT = 0 ; RETURN
            END
         END
      END ELSE
         ERRMSG = 'INVALID PRODUCT LINE ASSOCIATED TO THE PRODUCT ':PROD.ID
         GOSUB 91000 ; VALID.PRODUCT = 0 ; RETURN
      END
   END ELSE
      ERRMSG = 'INVALID PRODUCT ':PROD.ID
      GOSUB 91000 ; VALID.PRODUCT = 0 ; MAT INV.REC = '' ; RETURN
   END
  *
STATUS = RBO.setProperty('','UM',U.M)
RETURN

91000

93000
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage', ERRMSG)
RETURN
