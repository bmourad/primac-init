SUBROUTINE JCSTMEP_PREREAD
********************************************************************************
*   Program name :- JCSJTE_PREREAD
*   Created:- 7/9/2003
*   By :- S.Zahoor Ahmed
*------------------------------------------------------------------------------*
* In Properties:
* --------------
*  CONO
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JCS.CPYLIB OPERATION
$INCLUDE JCS.CPYLIB FACTOR
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB COST.CNTR
$INCLUDE JCS.CPYLIB SF.PROMPT

  OPEN '','CONTROL' TO CONTROL ELSE ERRMSG='CONTROL FILE IS MISSING'; GOTO 93000
  OPEN "","COMPANY" TO COMPANY ELSE ERRMSG="CANNOT OPEN COMPANY FILE";GOSUB 93000;STOP
  OPEN "","OPERATION" TO OPERATION ELSE ERRMSG="CANNOT OPEN OPERATION FILE";GOSUB 93000;STOP
  OPEN '','SF.PROMPT' TO SF.PROMPT ELSE ERRMSG='CANNOT OPEN SF.PROMPT FILE';GOSUB 93000
  OPEN '','COST.CNTR' TO COST.CNTR ELSE ERRMSG='COST.CNTR FILE IS MISSING'; GOTO 93000
  OPEN '','FACTOR' TO FACTOR ELSE ERRMSG='FACTOR FILE IS MISSING'; GOTO 93000
  OPEN '','SPOILAGE.CODES' TO SPOILAGE.CODES ELSE ERRMSG='SPOILAGE.CODES FILE IS MISSING'; GOTO 93000

* Insert method code here
MAT COMP.REC='' ; CONO = ''
MAT CCTR.REC = '';MAT OPER.REC = ''; MAT FCTR.REC = ''

STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
CONO   = PMCProperty<1,4>

********** CONTROL CONO:'DAILY.TIME' VALUES
	READU TIME.ENT.SEQ FROM CONTROL, CONO:"DAILY.TIME" ELSE TIME.ENT.SEQ = 10001

********** COMPANY VALUES
	MATREAD COMP.REC FROM COMPANY, CONO ELSE
		ERRMSG = "COMPANY FILE IS MISSING"
	END 
********** FACTOR CODE VALUES
FACTOR_LIST = ""

CMD = "SSELECT FACTOR WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD

DATA = 1
LOOP
	READNEXT ID THEN
		FACTOR_LIST<1,-1> = ID[4,99]
	END ELSE
		DATA = 0
	END
WHILE DATA DO
REPEAT
*************** SF.PROMPT VALUES

CMD = "SSELECT SF.PROMPT WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD

SFP_LIST = ""
SFP_PROMPT = ""
SFP_RESP_TYPE = ""
SFP_RESP_LEN = ""
SFP_SCALER= ""
SFP_VALDAT = ""

DATA = 1
LOOP
	READNEXT ID THEN
		SFP_LIST<1,-1> = ID[4,99]
	END ELSE
		DATA = 0  
	END

WHILE DATA DO
REPEAT

	SFP_COUNT = DCOUNT(SFP_LIST,@VM)

	FOR X = 1 TO SFP_COUNT

		MATREAD SFP.REC FROM SF.PROMPT, CONO : SFP_LIST<1,X> THEN

	*		SWAP @VM WITH "," IN SFP.PROMPT
			SFP_PROMPT<1,X> = SFP.PROMPT
			SFP_RESP_TYPE<1,X> = SFP.RESP.TYPE
			SFP_RESP_LEN<1,X> = SFP.RESP.LEN	
			SFP_SCALER<1,X> =SFP.RESP.SCALER
			SFP_VALDAT<1,X> = SFP.VALDAT
		END
	NEXT X


**** COST CENTER VALUES
CCTR_LIST = ""
CCTR_TYPE = ""
CCTR_OPER_TYPE = ""
CCTR_DEPT = ""
CCTR_OPER = ""

CMD = "SSELECT COST.CNTR WITH CONO = '" : CONO : "' AND WITH CCTR_TYPE # 'F'"
UDTEXECUTE CMD

DATA = 1
LOOP
	READNEXT ID THEN
		CCTR_LIST<1,-1> = ID[4,99]
	END ELSE
		DATA = 0
	END

WHILE DATA DO
REPEAT
	CCTR_COUNT = DCOUNT(CCTR_LIST,@VM)

	FOR I = 1 TO CCTR_COUNT
		MATREAD CCTR.REC FROM COST.CNTR , CONO:CCTR_LIST<1,I> THEN
			CCTR_TYPE<1,I> = CCTR.TYPE

			SWAP @VM WITH "," IN CCTR.OPER
			CCTR_OPER<1,I> = CCTR.OPER

			SWAP @VM WITH "," IN CCTR.OPER.TYPE
			CCTR_OPER_TYPE<1,I> = CCTR.OPER.TYPE

			CCTR_DEPT<1,I> = CCTR.DEPT
			
		END
	NEXT I

****************OPERATION VALUES
OPER_LIST = ""
OPER_SF_PROMPT = ""
OPER_MATL_REQ = ""
OPER_PLINE = ""
OPER_DESC_LIST = ""
CMD = "SSELECT OPERATION WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD

DATA = 1
LOOP
	READNEXT ID ELSE DATA = 0
WHILE DATA DO
	OPER_LIST<1,-1> = ID[4,99]
REPEAT

	OPER_COUNT = DCOUNT(OPER_LIST,@VM)
		FOR X = 1 TO OPER_COUNT
			MATREAD OPER.REC FROM OPERATION,CONO:OPER_LIST<1,X> THEN
				SWAP @VM WITH "," IN OPER.SF.PROMPT
				OPER_SF_PROMPT<1,X> = OPER.SF.PROMPT
				OPER_MATL_REQ<1,X> = OPER.MATL.REQ	
				OPER_PLINE<1,X> = OPER.PLINE
				OPER_DESC_LIST<1,X> = OPER_LIST<1,X>:"-":OPER.DESC
			*	LIST<1,X> = X
			END

		NEXT X
STATUS = RBO.setProperty('','MAX_SEQ',TIME.ENT.SEQ)
STATUS = RBO.setProperty('','FACTOR_LIST',FACTOR_LIST)

STATUS = RBO.setProperty('','CCTR_TYPE',CCTR_TYPE)
STATUS = RBO.setProperty('','CCTR_LIST',CCTR_LIST)
STATUS = RBO.setProperty('','CCTR_OPER',CCTR_OPER)
STATUS = RBO.setProperty('','CCTR_DEPT',CCTR_DEPT)
STATUS = RBO.setProperty('','CCTR_OPER_TYPE',CCTR_OPER_TYPE)

STATUS = RBO.setProperty('','OPER_LIST',OPER_LIST)
STATUS = RBO.setProperty('','OPER_SF_PROMPT',OPER_SF_PROMPT)
STATUS = RBO.setProperty('','OPER_MATL_REQ',OPER_MATL_REQ)
STATUS = RBO.setProperty('','OPER_PLINE',OPER_PLINE)
STATUS = RBO.setProperty('','OPER_DESC_LIST',OPER_DESC_LIST)

STATUS = RBO.setProperty('','SFP_LIST',SFP_LIST)
STATUS = RBO.setProperty('','SFP_PROMPT',SFP_PROMPT)
STATUS = RBO.setProperty('','SFP_RESP_TYPE',SFP_RESP_TYPE)
STATUS = RBO.setProperty('','SFP_RESP_LEN',SFP_RESP_LEN)
STATUS = RBO.setProperty('','SFP_SCALER',SFP_SCALER)
STATUS = RBO.setProperty('','SFP_VALDAT',SFP_VALDAT)
STATUS = RBO.setProperty('','CO_SPOIL_FLG',CO.SPOIL.FLG)
STATUS = RBO.setProperty('','CO_PSS',CO.PSS)

* End of method code
RETURN

93000*
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)



