SUBROUTINE VALIDATE_ACCTNO
********************************************************************************
*   Program name :- VALIDATE_ACCTNO
*   Created:- 4/10/2007
********************************************************************************
$INCLUDE WWINSERT RBO.H

$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB COA
$INCLUDE PMC.CPYLIB VEND
$INCLUDE PMC.CPYLIB GLTABLE
$INCLUDE APS.CPYLIB CKP
$INCLUDE APS.CPYLIB APCHECK
$INCLUDE CPYLIB CHAR
$INCLUDE PRS.CPYLIB PRSCHECK.STATS
*
*---- PROCREAD
*
ERRMSG=""
    *
   OPEN '',"CONTROL" TO CONTROL ELSE ERRMSG = "CONTROL FILE MISSING";GOTO 93000
   DIM TOT(3),VOID(25),DOL(19),TEN(9),CAP(9)
   DIM CHNO(1)
*
*---- OPEN FILES
*
   OPEN '',"CKP" TO CKP ELSE ERRMSG = "CKP FILE MISSING";GOTO 93000
   OPEN '',"CKR" TO CKR ELSE ERRMSG = "CKR FILE MISSING";GOTO 93000
   OPEN '',"APCHECK" TO APCHECK ELSE ERRMSG = "APCHECK FILE MISSING";GOTO 93000
   OPEN '',"VEND" TO VEND ELSE ERRMSG = "VEND FILE MISSING";GOTO 93000
   OPEN "DICT","CKP" TO  D.CKP ELSE ERRMSG="DICT CKP FILE MISSING";GOTO 93000
   OPEN '',"COMPANY" TO COMPANY ELSE ERRMSG = "COMPANY FILE MISSING";GOTO 93000
   OPEN '',"CONTROL" TO CONTROL ELSE ERRMSG = "CONTROL FILE MISSING";GOTO 93000
   OPEN '',"CHECK.STATS" TO CHECK.STATS ELSE ERRMSG = "CHECK.STATS FILE MISSING";GOTO 93000
   OPEN '',"COA" TO COA ELSE ERRMSG="CHART OF ACCOUNTS FILE MISSING";GOTO 93000
*
*---- INITIALIZATION
*
* PAPS55 v

  STATUS = RBO.getProperty('','BUFF_VAL',ID)

   CONO = FIELD(ID,"!",1)
   DIV.OWNER = FIELD(ID,"!",2)
   CKDT = FIELD(ID,"!",3)
   ACCT.NO = FIELD(ID,"!",4)
   CKNO = FIELD(ID,"!",5)
   CKNO =CKNO"R%6"
*vvv
   USER.ID = FIELD(ID,"!",6)
   STATUS = RBO.setProperty('','Cono',CONO)
   STATUS = RBO.setProperty('','TYPE',"P") 
   STATUS = RBO.setProperty('','DIV_CODE',DIV.OWNER)
   STATUS = RBO.setProperty('','USER_ID',USER.ID)

   CALL APS_CHECK_PRCS_CHK

   STATUS = RBO.getProperty('','ServerMessage',ERRMSG)
   IF ERRMSG # "" THEN
      GOTO 93000 
   END
*^^^

MATREAD COMP.REC FROM COMPANY,CONO ELSE ERRMSG="COMPANY MISSING";GOTO 93000

*
*---- SET G/L ACCT PARAMETERS
*
*9500 *
   Z1=COUNT(CO.ACCT.STRUC,"-")+1
   ACAVAL=0
   FOR I = 1 TO Z1
      ACAVAL=ACAVAL + FIELD(CO.ACCT.STRUC,"-",I)
   NEXT I
   MAXL=ACAVAL
   MINL=FIELD(CO.ACCT.STRUC,"-",1)
   ACJUS="L"
   FOR I = 1 TO Z1
      ACJUS=ACJUS:STR("#",FIELD(CO.ACCT.STRUC,"-",I)):"-"
   NEXT I
   ACJUS=ACJUS[1,LEN(ACJUS)-1]
   ACCSH=GLTB.CASH
   ACDISC=GLTB.PUR.DISC
   ACAP=GLTB.AP
*  RETURN

   IF LEN(ACCT.NO) <MAXL THEN ACCT.NO=ACCT.NO:STR("0",MAXL-LEN(ACCT.NO))
   MATREAD PCS.REC FROM CHECK.STATS, CONO:ACCT.NO:"!":DIV.OWNER ELSE
      MAT PCS.REC = ''
   END
   IF CO.GLS="Y" THEN
      READV DESC FROM COA,CONO:ACCT.NO,1 ELSE 
*         PRINT @(5,16):"INVALID ACCOUNT NUMBER":
	   ERRMSG = "INVALID ACCOUNT NUMBER"
	   GOTO 93000
      END
   END
   IF CO.GLS#"Y" THEN DESC=""
   BANK.NO=ACCT.NO
20 *

   PCS.LST.MV.NO = DCOUNT(PCS.VOID.DATE,VM)
   IF PCS.LST.CHK.NO > 0 AND CKNO <= PCS.LST.CHK.NO THEN
      IF ICONV(CKDT,'D2/') > ICONV(PCS.VOID.DATE<1,PCS.LST.MV.NO>,'D2/') THEN
		ERRMSG = "THIS CHECK ALREADY ON BANK FILE! HIT RET "
	       GOTO 93000
      END
   END
   MATREAD APCK.REC FROM APCHECK,CONO:BANK.NO:CKNO THEN
	   ERRMSG = "THIS CHECK ALREADY ON BANK FILE! HIT RET "
	   GOTO 93000
   END
RETURN
93000 *
	STATUS = RBO.setProperty('','ServerStatus',1)
	STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN

