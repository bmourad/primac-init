SUBROUTINE ORDM_GET_KIT_INFORMATION
********************************************************************************
*   Program name :- ORDM_GET_KIT_INFORMATION
*   Created:- 10/14/2003
*------------------------------------------------------------------------------*
*

* PROGRAMMER SYED ABDUL ALEEM
* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE OPS.CPYLIB ORDER
$INCLUDE OPS.CPYLIB ORDER.DETAIL
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB INV.CNV
$INCLUDE ICS.CPYLIB INV.WHSE
$INCLUDE OPS.CPYLIB ORDER.RELEASE
$INCLUDE ICS.CPYLIB INV.FNGD
$INCLUDE ICS.CPYLIB FNGD.BOM
$INCLUDE CPYLIB CHAR

DEFFUN CALC_STK_QTY(COST.QTY,MAT INV.CNV.REC,ROND,LN)
DEFFUN CALC_COST_QTY(STK.QTY,MAT INV.CNV.REC,ROND,LN)

  TM = CHAR(240)

* Insert method code here  
  OPEN "","ORDER.DETAIL" TO ORDER.DETAIL ELSE
    ERRMSG = "Cannot locate the ORDER.DETAIL file";GOTO 93000
  END

  OPEN "","INVENTORY" TO INVENTORY ELSE
    ERRMSG = "Cannot locate the INVENTORY file";GOTO 93000
  END

  OPEN "","INV.WHSE" TO INV.WHSE ELSE
    ERRMSG = "Cannot locate the INV.WHSE file";GOTO 93000
  END

  OPEN "","INV.FNGD" TO INV.FNGD ELSE
    ERRMSG = "Cannot locate the INV.FNGD file";GOTO 93000
  END

  OPEN "","FNGD.BOM" TO FNGD.BOM ELSE
    ERRMSG = "Cannot locate the FNGD.BOM file";GOTO 93000
  END

  STATUS = RBO.getProperty('', 'PMCProperty', PMCProperty)
  STATUS = RBO.getProperty('', 'ID', ORDER.DETAIL.ID)
  STATUS = RBO.getProperty('', 'OSD_PROD', PDNO)
  STATUS = RBO.getProperty('', 'OSD_WHSE', TEMP.MF2)
  STATUS = RBO.getProperty('', 'OSD_G_QTY', TEMP.MF3)
  STATUS = RBO.getProperty('', 'OSD_R_QTY', TEMP.MF11)
  STATUS = RBO.getProperty('', 'OSD_JOB', TEMP.MF13)
  STATUS = RBO.getProperty('', 'OSD_PRICE', TEMP.MF15)
 

 CONO = PMCProperty<1,4>

 *CALL ORDM_IS_KIT
 *STATUS = RBO.getProperty('', 'ServerMessage', MSG)

* IF MSG # '' THEN
 * RETURN ;* SINCE THE PRODUCT IS NOT KITTED ITEM  
 *END

 KIT.ITEM.CODE = ""
 KIT.ITEM.DESC = ""
 KIT.UOM = ""
 KIT.WHSE = ""
 KIT.ORDER.QTY = ""
 KIT.RESERVE.QTY = ""
 KIT.UNIT.PRICE = ""
 KIT.JOB = ""

 IF INDEX(ORDER.DETAIL.ID,"*NEWORD*!",1) = 0 THEN
	 MATREAD ORD.DET.REC FROM ORDER.DETAIL,ORDER.DETAIL.ID ELSE
		ERRMSG = " INVALID ORDER NUMBER "
		GOTO 93000
	 END
 END ELSE
	OSD.KIT<1,1>         = "K" 
	OSD.PROD<1,1>        = PDNO
	OSD.WHSE<1,1>        = TEMP.MF2	
	OSD.KIT.G.QTY<1,1>   = TEMP.MF3
	OSD.R.QTY<1,1>       = TEMP.MF11
	OSD.JOB<1,1>         = TEMP.MF13
	OSD.KIT.PRICE<1,1>   = TEMP.MF15
	MATREAD IOF.REC FROM INV.FNGD, CONO:PDNO ELSE
    		MAT IOF.REC = ""
	END
	BOM.KEY = CONO:IOF.BOM
	MATREAD BOM.REC FROM FNGD.BOM, CONO:IOF.BOM ELSE
	    MAT BOM.REC = ""
  	END
	FOR KK = 1 TO DCOUNT(BOM.PROD,VM)
	    OSD.PROD<1,KK+1>  = BOM.PROD<1,KK>
	    OSD.WHSE<1,KK+1>  = TEMP.MF2	
	    OSD.R.QTY<1,KK+1> = ""
	    OSD.JOB<1,KK+1>   = ""
	    OSD.KIT<1,KK+1>   = "M"	    
	NEXT	
*	ERRMSG = OSD.PROD ;*: BOM.PROD : " JJJJJJJJJJJJ " : CONO:IOF.BOM:" KKKKKKK" : CONO:PDNO : " LLLLLL"
*	GOTO 93000
 END

   LOCATE PDNO IN OSD.PROD<1>,1 SETTING INDX ELSE
   	GOTO 93000
   END

   NUM.PROD = DCOUNT(OSD.PROD,VM)
   NUM.ON.SCRN = ""

*ERRMSG = NUM.PROD : " NUM.PROD ":INDX: " INDX"
*GOTO 93000

   K = 0
   FOR I = INDX TO NUM.PROD
     IF OSD.KIT<1,I> = "K" THEN
      IF I = INDX THEN
         NUM.PROD = NUM.PROD + 1
         K = K + 1
         NUM.ON.SCRN<1,K> = I
      END ELSE
         I = NUM.PROD + 1
      END
    END
    IF OSD.KIT<1,I> = "M" THEN
      NUM.PROD = NUM.PROD + 1
      K = K + 1
      NUM.ON.SCRN<1,K> = I
    END
  NEXT I	

  KIT.COUNT = DCOUNT(NUM.ON.SCRN,VM)
*ERRMSG = KIT.COUNT : " HHHHH HH H"
*GOTO 93000

  FOR I = 1 TO KIT.COUNT
	INDX = NUM.ON.SCRN<1,I>
	MATREAD INV.REC FROM INVENTORY, CONO:OSD.PROD<1,INDX> ELSE
	   MAT INV.REC = ""; INV.FULL.DESC = "Unknown"
	END
	
	$INCLUDE ICSBP INV.UM.CNV
	
 	KIT.ITEM.CODE<1,I> = OSD.PROD<1,INDX>
	KIT.WHSE<1,I> = OSD.WHSE<1,INDX>
	KIT.UOM<1,I> = INV.UNIT<1,3>

	MATREAD IWH.REC FROM INV.WHSE, CONO:OSD.PROD<1,INDX>:"!":OSD.WHSE<1,INDX> ELSE
	   MAT IWH.REC = ""
	END
	IF OSD.KIT<1,INDX> = "K" THEN
	   PRINT.ORDER = OSD.KIT.G.QTY<1,INDX>
	END ELSE
	   PRINT.ORDER = ""
	END

	KIT.ORDER.QTY<1,I> = OCONV(INT(((PRINT.ORDER / ICR.DV1) * ICR.MT1) / ICR.DV2 + .5),ICR.CNV1)
	KIT.RESERVE.QTY<1,I> = OCONV(INT(((OSD.R.QTY<1,INDX> / ICR.DV1) * ICR.MT1) / ICR.DV2 + .5),ICR.CNV1)

	IF OSD.KIT.PRICE<1,INDX> > 0 THEN
	   KIT.UNIT.PRICE<1,I> = OCONV(OSD.KIT.PRICE<1,INDX>,"MD4")
	END ELSE
	   KIT.UNIT.PRICE<1,I> = SPACE(10)
	END

	KIT.ITEM.DESC<1,I> = INV.FULL.DESC
	IF OSD.JOB<1,INDX,2> # "" THEN
	   KIT.JOB<1,I> = "MULTI"
	END ELSE
	   KIT.JOB<1,I> = OSD.JOB<1,INDX>
	END
  NEXT I

* END

STATUS = RBO.setProperty('', 'KIT_ITEMS', KIT.ITEM.CODE)
STATUS = RBO.setProperty('', 'KIT_ITEMS_DESC', KIT.ITEM.DESC)
STATUS = RBO.setProperty('', 'KIT_WHSE', KIT.WHSE)

STATUS = RBO.setProperty('', 'KIT_UOM', KIT.UOM)
STATUS = RBO.setProperty('', 'KIT_ORDER_QTY', KIT.ORDER.QTY)
STATUS = RBO.setProperty('', 'KIT_RESERVE_QTY', KIT.RESERVE.QTY)

STATUS = RBO.setProperty('', 'KIT_JOB', KIT.JOB)
STATUS = RBO.setProperty('', 'KIT_UNIT_PRICE', KIT.UNIT.PRICE)
STATUS = RBO.setProperty('', 'ServerMessage', '')

* End of method code
RETURN
93000*
   STATUS = RBO.setProperty('', 'ServerStatus', '1')
   STATUS = RBO.setProperty('', 'ServerMessage', ERRMSG)

