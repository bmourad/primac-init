SUBROUTINE GLJEM_Format
********************************************************************************
*   Program name :- GLJEM_Format
*   Created:- 06/01/2003
*   Razi Mohiuddin
*------------------------------------------------------------------------------
* In Properties:
* --------------
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

* Insert method code here
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE GLS.CPYLIB JE
$INCLUDE PMC.CPYLIB COA
$INCLUDE CPYLIB CHAR

* Open files
ERRMSG = ''
OPEN 'COMPANY' TO COMPANY ELSE ERRMSG = 'CANNOT OPEN COMPANY FILE'
OPEN 'COA' TO COA ELSE ERRMSG = 'CANNOT OPEN COA FILE'
IF ERRMSG THEN
  CALL RBO_ERROR_SUB(ERRMSG)
  RETURN
END

* Get properties
STATUS = RBO.getProperty('','ID',ID)
STATUS = RBO.getProperty('','JE_ACCT',JE.ACCT)
STATUS = RBO.getProperty('','JE_DATE',JE.DATE)
STATUS = RBO.getProperty('','JE_DB_AMT',JE.DB.AMT)
STATUS = RBO.getProperty('','JE_CR_AMT',JE.CR.AMT)

* Get CONO
CONO = ID[1,3]
MATREAD COMP.REC FROM COMPANY, CONO ELSE
  ERRMSG = 'Invalid Company ID (':CONO:').'
  CALL RBO_ERROR_SUB(ERRMSG); RETURN
END

* Format data
LineDesc = ''
LineType = ''
LineNorm = ''
LineCat  = ''
LineSub  = ''
LineLevel=''
TotalDebit  = ''
TotalCredit = ''
Balamt = ''
BALType = ''
CrDbFlag = ''
ReferencePeriod = ''
ReferencePeriod = JE.PERIOD[5,2]
JE.DATE = OCONV(JE.DATE,"D2/")
FOR IDX = 1 TO DCOUNT(JE.ACCT,VM)
  MATREAD COA.REC FROM COA, CONO : JE.ACCT<1,IDX> ELSE
    MAT COA.REC = ''
    COA.L.DESC = "Unknown"
  END
  LineDesc<1,IDX> = COA.L.DESC
  LineType<1,IDX> = COA.TYPE
  LineNorm<1,IDX> = COA.NORM
  LineCat<1,IDX>  = COA.CATG
  LineSub<1,IDX>  = COA.SUB.CATG
  LineLevel<1,IDX> = COA.LEVEL

  TotalDebit      = TotalDebit + JE.DB.AMT<1,IDX>
  TotalCredit     = TotalCredit + JE.CR.AMT<1,IDX>
  JE.DB.AMT<1,IDX> = OCONV(JE.DB.AMT<1,IDX>,"MD2Z")
  JE.CR.AMT<1,IDX> = OCONV(JE.CR.AMT<1,IDX>,"MD2Z")
NEXT IDX
	IF TotalDebit > TotalCredit  THEN
		Balamt  = TotalDebit - TotalCredit
		CrDbFlag = 'Debit'
		BALType = 'Out of Balance'
	END ELSE
		Balamt  = TotalCredit - TotalDebit
		CrDbFlag = 'Credit'
		BALType = 'Out of Balance'
	END
	IF Balamt = 0 THEN
		BALType = 'In Balance' 
		CrDbFlag = ''
	END
* Set output properties
STATUS = RBO.setProperty('','JE_DATE',JE.DATE)
STATUS = RBO.setProperty('','ReferencePeriod',ReferencePeriod)
STATUS = RBO.setProperty('','LineDesc',LineDesc)
STATUS = RBO.setProperty('','LineType',LineType)
STATUS = RBO.setProperty('','LineNorm',LineNorm)
STATUS = RBO.setProperty('','LineCat',LineCat)
STATUS = RBO.setProperty('','LineSub',LineSub)
STATUS = RBO.setProperty('','CoaLevel',LineLevel)
STATUS = RBO.setProperty('','TotalCredit',TotalCredit)
STATUS = RBO.setProperty('','TotalDebit',TotalDebit)
STATUS = RBO.setProperty('','BalanceAmt',Balamt)
STATUS = RBO.setProperty('','BalanceType',BALType)
STATUS = RBO.setProperty('','CRDB',CrDbFlag)
STATUS = RBO.setProperty('','JE_DB_AMT',JE_DB_AMT)
STATUS = RBO.setProperty('','JE_CR_AMT',JE_CR_AMT)

* End of method code
RETURN

