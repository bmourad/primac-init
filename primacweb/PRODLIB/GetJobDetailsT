SUBROUTINE GetJobDetailsT
********************************************************************************
*   Program name :- GetJobDetails
*   Created:- 7/24/2003
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE CPYLIB CHAR
$INCLUDE JCS.CPYLIB JOB	
$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE JCS.CPYLIB DAILY.REVERSE
ERRMSG = ''
ERRMSG1 = RBO.getProperty('','PMCProperty',PMCProperty)

* Insert method code here

  OPEN "","JOB" TO JOB ELSE
   ERRMSG = "CANNOT OPEN JOB.REC FILE"
	GOTO 1000
  END

  OPEN "","CUSTOMER" TO CUSTOMER ELSE
   ERRMSG = "CANNOT OPEN CUSTOMER FILE"
	GOTO 1000
  END

  OPEN "","DAILY.REVERSE" TO DAILY.REVERSE ELSE
   ERRMSG = "CANNOT OPEN DAILY.REVERSER FILE"
	GOTO 1000
  END


***
* GRID.ELEMENTS'S LIST ( Dept / Cctr )
***
JOB.LB.GRID.LIST 		= ''
JOB.MT.GRID.LIST 		= ''
JOB.OS.GRID.LIST 		= ''
JOB.SP.GRID.LIST 		= ''
JOB.MS.GRID.LIST 		= ''
JOB.RCLSM.MT.GRID.LIST 	= ''
DAILY.REVERSE.REASON.LIST 	= ''
JOBNO.LIST = ''
JOB.RCLS.MT.GRID.LIST = ''
***
* JOB'S LIST
***
JOBCUST.CODES.LIST = ''
JOBCUST.DESCS.LIST = '-Select-'
***
* CUSTOMER'S LIST
***
CUST.CODES.LIST = ''
CUST.DESCS.LIST = '-Select-'

CONO = PMCProperty<1,4>


* OPENING THE JOB FILE

CMD = "SSELECT JOB WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD

LOOP
	EOF = 1
	READNEXT JOB.ID ELSE EOF = 0
WHILE EOF DO
	MATREAD JOB.REC FROM JOB,JOB.ID THEN 
		
		CNT1 	= DCOUNT(JOB.LB.COST,"ý")
			LBCOST = ""
			FOR J=1 TO CNT1
				LBCOST = LBCOST : OCONV(JOB.LB.COST<1,J>,"MD2") : "ý"
			NEXT J

		CNT1 	= DCOUNT(JOB.OS.COST,"ý")
			OSCOST = ""
			FOR J=1 TO CNT1
				OSCOST = OSCOST : OCONV(JOB.OS.COST<1,J>,"MD2") : "ý"
			NEXT J

		CNT1 	= DCOUNT(JOB.SP.COST,"ý")
			SPCOST = ""
			FOR J=1 TO CNT1
				SPCOST = SPCOST : OCONV(JOB.SP.COST<1,J>,"MD2") : "ý"
			NEXT J

		CNT1 	= DCOUNT(JOB.MS.COST,"ý")
			MSCOST = ""
			FOR J=1 TO CNT1
				MSCOST = MSCOST : OCONV(JOB.MS.COST<1,J>,"MD2") : "ý"
			NEXT J

		CNT1 	= DCOUNT(JOB.MT.COST,"ý")
			MTCOST = ""
			FOR J=1 TO CNT1
				MTCOST = MTCOST : OCONV(JOB.MT.COST<1,J>,"MD2") : "ý"
			NEXT J


			JOBNO.LIST<1,-1> = JOB.ID[4,99]
			JOBCUST.CODES.LIST<1,-1> 		= JOB.ID[4,99] :"~" : JOB.CUST
			JOB.LB.GRID.LIST<1,-1>   		= JOB.ID[4,99] :"~" : LOWER(JOB.LB.DEPT) : "~" :  LOWER(JOB.LB.CCTR) : "~" :  LOWER(LBCOST)
*			JOB.OS.GRID.LIST<1,-1>   		= JOB.ID[4,99] :"~" : LOWER(JOB.OS.DEPT) : "~" :  LOWER(JOB.OS.CCTR) : "~" :  LOWER(JOB.OS.PLINE) : "~" :  LOWER(OSCOST)
			JOB.OS.GRID.LIST<1,-1>   		= JOB.ID[4,99] :"~" : LOWER(JOB.OS.DEPT) : "~" :  LOWER(JOB.OS.CCTR) : "~" :  LOWER(JOB.OS.PLINE) : "~" :  LOWER(OSCOST) : "~" :  CHANGE(JOB.OS.SEQ,"ý","ü")
			JOB.SP.GRID.LIST<1,-1>   		= JOB.ID[4,99] :"~" : LOWER(JOB.SP.DEPT) : "~" :  LOWER(JOB.SP.CCTR) : "~" :  LOWER(SPCOST)
			JOB.MS.GRID.LIST<1,-1>   		= JOB.ID[4,99] :"~" : LOWER(JOB.MS.DEPT) : "~" :  LOWER(JOB.MS.CCTR) : "~" :  LOWER(MSCOST)
*			JOB.MT.GRID.LIST<1,-1>   		= JOB.ID[4,99] :"~" : LOWER(JOB.MT.DEPT) : "~" :  LOWER(JOB.MT.CCTR) : "~" :  LOWER(JOB.MT.PROD) : "~" :  LOWER(JOB.MT.WHSE) : "~" :  LOWER(MTCOST)
			JOB.MT.GRID.LIST<1,-1>   		= JOB.ID[4,99] :"~" : LOWER(JOB.MT.DEPT) : "~" :  LOWER(JOB.MT.CCTR) : "~" :  LOWER(JOB.MT.PROD) : "~" :  LOWER(JOB.MT.WHSE) : "~" :  LOWER(JOB.MT.QTY)
*			JOB.RCLS.MT.GRID.LIST<1,-1>   	= JOB.ID[4,99] :"~" : LOWER(JOB.MT.DEPT) : "~" :  LOWER(JOB.MT.CCTR) : "~" :  LOWER(JOB.MT.PROD) : "~" :  LOWER(JOB.MT.WHSE) : "~" :  LOWER(JOB.MT.QTY)
			JOB.RCLS.MT.GRID.LIST<1,-1> 	= JOB.ID[4,99] :"~" : LOWER(JOB.MT.DEPT) : "~" :  LOWER(JOB.MT.CCTR) : "~" :  LOWER(JOB.MT.PROD) : "~" :  LOWER(JOB.MT.WHSE) : "~" :  LOWER(MTCOST)
		END ELSE 
			ERRMSG = "NO RECORD FOUND"
	END
REPEAT

* OPENING THE CUSTOMER FILE
CMD1 = "SSELECT CUSTOMER WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD1

LOOP
	EOF = 1
	READNEXT CUST.ID ELSE EOF = 0
WHILE EOF DO
	MATREAD CUST.REC FROM CUSTOMER,CUST.ID THEN 
			CUST.CODES.LIST<1,-1> = CUST.ID[4,99]
			CUST.DESCS.LIST<1,-1> = CUST.ID[4,99] :"~" : CUST.NAME
		END ELSE 
			ERRMSG = "NO RECORD FOUND"
	END
REPEAT


LOOP
	EOF = 1
	READNEXT DRV.ID ELSE EOF = 0
WHILE EOF DO
	MATREAD DRV.REC FROM CUSTOMER,CUST.ID THEN 
			DEPTCODES.LIST<1,-1> = DRV.ID[4,99]
			CUSTCODES.LIST<1,-1> = DRV.ID[4,99] :"~" : DRV.DEPT : "~" : DRV.CCTR : "~" : DRV.REASON
		END ELSE 
			ERRMSG = "NO RECORD FOUND"
	END
REPEAT


* OPENING THE DAILY.REVERSE FILE

*		CMD2 = "SSELECT DAILY.REVERSE WITH CONO = '" : CONO : "'"
*		UDTEXECUTE CMD2

*		DRV_REC_ID = ""
*		LOOP
*			EOF = 1
*			READNEXT DRV.REC.ID ELSE EOF = 0
*			DRV_REC_ID<1,-1> = DRV.REC.ID
*		WHILE EOF DO	
*		REPEAT
**
*	FOR N = 1 TO DCOUNT(DRV_REC_ID,VM)
*		MATREAD DRV.REC FROM DAILY.REVERSE,DRV_REC_ID<1,N> THEN 
*		DAILY.REVERSE.REASON.LIST<1,-1> = DRV_REC_ID<1,N> : "~" : LOWER(DRV.REASON)
*		END
*	NEXT N

***************

	STATUS=RBO.setProperty('','JobCustCodes',JOBCUST.CODES.LIST)
	STATUS=RBO.setProperty('','JobCustDescs',CUST.DESCS.LIST)
* ( DEPT / CCTR ) GRID'S DATA	
	STATUS=RBO.setProperty('','JobLBGridList',JOB.LB.GRID.LIST)
	STATUS=RBO.setProperty('','JobOSGridList',JOB.OS.GRID.LIST)
	STATUS=RBO.setProperty('','JobSPGridList',JOB.SP.GRID.LIST)
	STATUS=RBO.setProperty('','JobMSGridList',JOB.MS.GRID.LIST)
	STATUS=RBO.setProperty('','JobMTGridList',JOB.MT.GRID.LIST)
	STATUS=RBO.setProperty('','JobRclsmMTGridList',JOB.RCLS.MT.GRID.LIST)
	
*	STATUS=RBO.setProperty('','JobRevReasonList',DAILY.REVERSE.REASON.LIST)

1000*
  IF ERRMSG # '' THEN
      STATUS = RBO.setProperty('', 'ServerStatus', 1)
      STATUS = RBO.setProperty('', 'ServerMessage', ERRMSG)
  END	
* End of method code
RETURN

