SUBROUTINE NEW_LOAD_SKIP_DATA
********************************************************************************
*   Program name :- NEW_LOAD_SKIP_DATA
*   Created:- 3/7/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB FISCAL


   OPEN '','CONTROL' TO CONTROL ELSE
     ERRMSG = 'CONTROL FILE IS MISSING'
     GOTO 99999
   END
* Insert method code here
*STATUS=RBO.getProperty('','',)
STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
STATUS=RBO.getProperty('','BEG_PER',BEG.PER)
STATUS=RBO.getProperty('','BEG_YR',BEG.YR)
STATUS=RBO.getProperty('','NUM_PERIODS',NUM.PERIODS)
STATUS=RBO.getProperty('','CURR_YR',CURR.YR)
STATUS=RBO.getProperty('','CURR_PER',CURR.PER)
STATUS=RBO.getProperty('','CURR_MON',CURR.MON)

   CONO=PMCProperty<1,4>
   READ TAPE.PERIOD FROM CONTROL, CONO:CURR.YR:"GLS.TAPE" ELSE
      TAPE.PERIOD = ""
   END
   IF TAPE.PERIOD<CURR.PER> = "" THEN
      ERRMSG = 'YOU NEED TO BACKUP THIS PERIOD BEFORE RESTORING'
      GOTO 99999
   END
   READU TAPE.PERIOD FROM CONTROL, CONO:BEG.YR:"GLS.TAPE" ELSE
      TAPE.PERIOD = ""
   END


   READ SALESDATES FROM CONTROL, CONO : "SALESDATES" ELSE
      ERRMSG = 'CANNOT LOCATE CONTROL SALESDATES'
      GOTO 99999
   END
   READ OPENDATES FROM CONTROL, CONO : "OPENDATES" ELSE
      ERRMSG = 'CANNOT LOCATE CONTROL OPENDATES'
      GOTO 99999
   END

   SAVE.PER = ''; SAVE.PTR = '0'
   SAVE.MON = ''; SAVE.DATE = ''
   NO.SAVE.PER = ''; NO.SAVE.PTR = 0
   NO.SAVE.MON = ''; NO.SAVE.DATE = ''
   BEG.MON = SALESDATES<BEG.PER+1,2>
    STATUS = RBO.setProperty('','BEG_MON',BEG.MON)
   NYR.PER = BEG.PER
   LST.PER = BEG.PER - 1
   IF LST.PER < 1 THEN
      LST.PER = (BEG.YR - 1) : NUM.PERIODS
   END ELSE
      LST.PER = STR("0",2-LEN(LST.PER)):LST.PER
      LST.PER = BEG.YR : LST.PER
   END

   IF BEG.YR < CURR.YR THEN
     FOR PER = BEG.PER TO NUM.PERIODS
	 PERIOD = BEG.YR : STR("0",2-LEN(PER)):PER
         IF TAPE.PERIOD<PER> # '' THEN
            SAVE.PTR = SAVE.PTR + 1
            SAVE.PER<SAVE.PTR> = PERIOD
            SAVE.MON<SAVE.PTR> = SALESDATES<PER+1,2>
            SAVE.DATE<SAVE.PTR> = OCONV(OPENDATES<PER>,"D/")
            SAVE.DATE<SAVE.PTR> = SAVE.DATE<SAVE.PTR>[1,6] : SAVE.DATE<SAVE.PTR>[7,4] - 1
            SAVE.DATE<SAVE.PTR> = ICONV(SAVE.DATE<SAVE.PTR>,"D/")
	     SAVE.DATE<SAVE.PTR> = OCONV(SAVE.DATE<SAVE.PTR>, "D2/") "L#8"
            TAPE.PERIOD<PER> = ""
	 END ELSE
	    NO.SAVE.PTR = NO.SAVE.PTR + 1
            NO.SAVE.PER<NO.SAVE.PTR> = PERIOD
            NO.SAVE.MON<NO.SAVE.PTR> = SALESDATES<PER+1,2>
            NO.SAVE.DATE<NO.SAVE.PTR> = OCONV(OPENDATES<PER>,"D/")
            NO.SAVE.DATE<NO.SAVE.PTR> = NO.SAVE.DATE<NO.SAVE.PTR>[1,6] : NO.SAVE.DATE<NO.SAVE.PTR>[7,4] - 1
            NO.SAVE.DATE<NO.SAVE.PTR> = ICONV(NO.SAVE.DATE<NO.SAVE.PTR>,"D/")
	     NO.SAVE.DATE<NO.SAVE.PTR> = OCONV(NO.SAVE.DATE<NO.SAVE.PTR>,"D2/") "L#8"
         END
      NEXT PER
      OTAPE.PERIOD = TAPE.PERIOD
      READU TAPE.PERIOD FROM CONTROL, CONO:CURR.YR:"GLS.TAPE" ELSE
         TAPE.PERIOD = ""
      END
      NYR.PER = "01"
   END
   FOR PER = NYR.PER TO CURR.PER - 1
     PERIOD = CURR.YR : STR("0",2-LEN(PER)):PER
      IF TAPE.PERIOD<PER> # '' THEN
         SAVE.PTR = SAVE.PTR + 1
         SAVE.PER<SAVE.PTR> = PERIOD
         SAVE.MON<SAVE.PTR> = SALESDATES<PER+1,2>
         SAVE.DATE<SAVE.PTR> = OPENDATES<PER>
	  SAVE.DATE<SAVE.PTR> = OCONV(SAVE.DATE<SAVE.PTR>, "D2/") "L#8" 
        TAPE.PERIOD<PER> = ""
      END ELSE
         NO.SAVE.PTR = NO.SAVE.PTR + 1
         NO.SAVE.PER<NO.SAVE.PTR> = PERIOD
         NO.SAVE.MON<NO.SAVE.PTR> = SALESDATES<PER+1,2>
         NO.SAVE.DATE<NO.SAVE.PTR> = OPENDATES<PER>
	  NO.SAVE.DATE<NO.SAVE.PTR> = OCONV(NO.SAVE.DATE<NO.SAVE.PTR>,"D2/") "L#8"

      END
   NEXT PER

   IF SAVE.PTR < 1 THEN
      ERRMSG = "THERE ARE NO PERIODS TO LOAD"
     GOTO 99999
   END

*STATUS=RBO.setProperty('','')
STATUS= RBO.setProperty('','SAVE_PER',LOWER(SAVE.PER))
STATUS = RBO.setProperty('','SAVE_MON',LOWER(SAVE.MON))
STATUS = RBO.setProperty('','SAVE_DATE',LOWER(SAVE.DATE))

STATUS = RBO.setProperty('','NO_SAVE_PER',LOWER(NO.SAVE.PER))
STATUS = RBO.setProperty('','NO_SAVE_MON',LOWER(NO.SAVE.MON))
STATUS = RBO.setProperty('','NO_SAVE_DATE',LOWER(NO.SAVE.DATE))
STATUS = RBO.setProperty('','BEG_MON',BEG.MON)
STATUS = RBO.setProperty('','OTAPE_PERIOD',OTAPE.PERIOD)
STATUS = RBO.setProperty('','TAPE_PERIOD',TAPE.PERIOD)
STATUS = RBO.setProperty('','SAVE_PTR',SAVE.PTR)
STATUS = RBO.setProperty('','SAVE_PTR',SAVE.PTR)
STATUS = RBO.setProperty('','SAVE_PTR',SAVE.PTR)
STATUS = RBO.setProperty('','NO_SAVE_PTR',NO.SAVE.PTR)


* End of method code
RETURN

99999
IF ERRMSG # "" THEN
	VAL = RBO.setProperty('','ServerStatus','E')
	VAL = RBO.setProperty('','ServerMessage',ERRMSG)
END ELSE
	VAL = RBO.setProperty('','ServerStatus','')
END

