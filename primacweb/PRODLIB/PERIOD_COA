SUBROUTINE PERIOD_COA
********************************************************************************
*   Program name :- PERIOD_COA
*   Created:- 2/17/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB FISCAL
* Insert method code here
ERRMSG = ""
   OPEN '','CONTROL' TO CONTROL ELSE
      ERRMSG = 'Cannot open Control file!'
      GOTO 1000
   END

STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
CONO = PMCProperty<1,4>
STATUS = RBO.getProperty('','PRD_FLAG',PRD_FLG)
MAXV=''
PERIOD.MAXV=''
PERIOD.DEFAULT=''
*ENTERED_PERIOD=''
PERIOD.VALUE=''
END.DATE=''
DATE.DEFAULT=''

*WRITE "U R HERE" ON CONTROL ,"01PR"
MATREAD FISCAL.REC FROM CONTROL , CONO:"FISCAL" ELSE
      ERRMSG = "CONTROL FISCAL IS NOT ON FILE";GOTO 1000
END

READ DATES.REC FROM CONTROL , CONO:"OPENDATES" ELSE
      ERRMSG = "CONTROL OPENDATES IS NOT ON FILE";GOTO 1000
END

YEAR = FR.CURR.PER[1,4]
CURR = FR.CURR.PER[5,2]

READ PERIOD.REC FROM CONTROL, CONO : "ACCT.PERIODS" ELSE
      PERIOD.REC = ""
      PERIOD.REC<1> = 12
   END
NUM.PERIODS = PERIOD.REC<1>

BEGIN CASE
      CASE PRD_FLG = "OP"
         PERIOD.VALUE = "01"
         MAXV = "01" 
      CASE PRD_FLG = "CN"
         PERIOD.VALUE = CURR
         MAXV = CURR 
      CASE 1
		BEGIN CASE 
		    CASE PRD_FLG = "LY"
         		PERIOD.MAXV = NUM.PERIODS
         		MAXV = NUM.PERIODS
      		    CASE PRD_FLG = "FR"
         		PERIOD.DEFAULT = CURR
         		PERIOD.MAXV = NUM.PERIODS
         		MAXV = NUM.PERIODS
      		    CASE PRD_FLG = "CP"
         		PERIOD.DEFAULT = CURR
         		PERIOD.MAXV = CURR
         		MAXV = CURR
      		    CASE 1
         		PERIOD.MAXV = CURR
         		MAXV = CURR
		END CASE
END CASE

IF PRD_FLG = "LY" THEN
     PERIOD = (YEAR - 1) : PERIOD.DEFAULT
  END ELSE
     PERIOD = YEAR : PERIOD.MAXV
  END


*--DATE---

IF PRD_FLG = "OP" OR PRD_FLG = "OL" OR PRD_FLG = "LY" THEN
      IF PERIOD[5,2] = NUM.PERIODS THEN
         END.DATE = OCONV(DATES.REC<1> - 1, "D/")
	 END.DATE = END.DATE[1,6] : END.DATE[7,4] + 1
         END.DATE = ICONV(END.DATE, "D/")
	 
      END ELSE
         END.DATE = DATES.REC<PERIOD[5,2] + 1> - 1
	 
      END
      
   END ELSE
      IF END.DATE = "" THEN
         IF PERIOD[5,2] = NUM.PERIODS THEN
            DATE.DEFAULT = OCONV(DATES.REC<1> - 1, "D/")
            DATE.DEFAULT = DATE.DEFAULT[1,6] : DATE.DEFAULT[7,4] + 1
	    DATE.DEFAULT = ICONV(DATE.DEFAULT, "D/")
         END ELSE
            DATE.DEFAULT = DATES.REC<PERIOD[5,2] + 1> - 1
         END
      END
   END

STATUS = RBO.setProperty('','PERIOD_DATE',OCONV(DATE.DEFAULT, "D2/"))
STATUS = RBO.setProperty('','PERIOD_YEAR',YEAR)
STATUS = RBO.setProperty('','PERIOD_MAXV',PERIOD.MAXV)
STATUS = RBO.setProperty('','PERIOD_DEFAULT',PERIOD.DEFAULT)
STATUS = RBO.setProperty('','PERIOD_VALUE',PERIOD)


1000
STATUS = RBO.setProperty('','ServerStatus',1)        
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
99999
RETURN

