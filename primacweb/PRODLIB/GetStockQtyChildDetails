SUBROUTINE GetStockQtyChildDetails
********************************************************************************
*   Program name :- GetStockQtyChildDetails
*   Created:- 9/15/2003
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JES.CPYLIB SCOMMON.ESTIMATE
$DEFINE ESTIMATE
$INCLUDE JES.CPYLIB ESTIMATE

$DEFINE ESTIMATEMATL
$INCLUDE JES.CPYLIB ESTIMATE.MATL
$INCLUDE JES.CPYLIB ESTIMATE.BIND.SPOIL
$INCLUDE JES.CPYLIB ESTIMATE.RES.PRESS.SPOIL
$DEFINE ESTIMATERES
$INCLUDE JES.CPYLIB ESTIMATE.RES
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB INV.WHSE
$DEFINE JESFILEVARS
$INCLUDE JES.CPYLIB JES.FILE.VARS
$DEFINE COMPANY
$INCLUDE PMC.CPYLIB COMPANY
$DEFINE FILEVARS
$INCLUDE CPYLIB FILE.VARS
$INCLUDE CPYLIB CHAR
$INCLUDE PMC.CPYLIB COST.CNTR

ERRMSG = RBO.getProperty('','ID',ID)
*ERRMSG = RBO.getProperty('','Indx',REF.NO)
REF.NO =4
COMP=1

	OPEN "","ESTIMATE" TO ESTIMATE ELSE
		ERRMSG="CAN NOT OPEN ESTIMATE FILE"
	END
	
	OPEN "","ESTIMATE.RES" TO ESTIMATE.RES ELSE
		ERRMSG="CAN NOT OPEN ESTIMATE FILE"
	END

	MATREAD EST.REC FROM ESTIMATE,ID ELSE MAT EST.REC =''


   EQTY = DCOUNT(EST.QTY,VM)

   FOR Y = 1 TO EQTY
 ***********************      
   IF EST.RL.DIE.REPEAT<1,COMP,1> # "" AND EST.RL.DIE.NO.ACR<1,COMP,1> # "" AND EST.RL.DIE.NO.ARD<1,COMP,1> # "" THEN
      VAR1 = EST.QTY<1,Y>*(EST.RL.DIE.REPEAT<1,COMP,1>/10000)
      IF EST.RL.DIE.NO.ARD<1,COMP,1>='' THEN
         VAR3 = 1
      END ELSE
         VAR3 = EST.RL.DIE.NO.ARD<1,COMP,1>
      END
      VAR4 = EST.RL.SETS<1,COMP,2>
      IF VAR4 = '' THEN VAR4 = 1
      VAR2=EST.RL.DIE.NO.ACR<1,COMP,1>
      BASE.LINEAL = INT((VAR1/VAR2)+ .5); * IMPERIAL
      MR.LINEAL=0; PR.SPOIL.LINEAL=0; FIN.SPOIL.LINEAL=0
   ERRMSG = RBO.setProperty('','ProdDefnStr',"BASE.LINEALHFGHF--":BASE.LINEAL:"VAR1-->":VAR1:"VAR2-->":VAR2:"EST.RL.DIE.REPEAT--":EST.RL.DIE.REPEAT:"EST.QTY->":EST.QTY<1,Y>)
      CALL EST_RES_CALC_SPOIL(CONO,ACTION,COMP,EST.QTY<1,Y>,BASE.LINEAL,PR.SPOIL.LINEAL,FIN.SPOIL.LINEAL,MR.LINEAL)

      TOT.LINEAL = BASE.LINEAL+MR.LINEAL+PR.SPOIL.LINEAL+FIN.SPOIL.LINEAL
     END ELSE
      TOT.LINEAL = "0"
   END
MP=1

*************
      TOT.MSI = INT(((EST.PROD.OS.WIDTH<1,COMP,REF.NO>/10000*TOT.LINEAL)/1000)+.9)
      IF UNIT.PR = "" THEN
         PRICE.BRK.COUNT = DCOUNT(ESTM.END.QTY<1,MP>,SVM)
     	 FLG=0
         FOR X = 1 TO PRICE.BRK.COUNT UNTIL FLG=1
            TEST.QTY = ESTM.END.QTY<1,MP,X>
            IF TOT.MSI <= TEST.QTY THEN
               UNIT.PR = ESTM.QCOST<1,MP,X>
               FLG=1
            END
         NEXT X
         IF NOT(FLG) THEN
            UNIT.PR = ESTM.QCOST<1,MP,PRICE.BRK.COUNT>
         END
      END
    *  MACROREPVAL(EST.RL.TOTAL.PC<1,COMP,REF.NO>,"!",Y,INT(TOT.LINEAL))
    *  MACROREPVAL(EST.RL.MR.PC<1,COMP,REF.NO>,"!",Y,INT(MR.LINEAL))
    *  MACROREPVAL(EST.RL.PAP.MSI<1,COMP,REF.NO>,"!",Y,TOT.MSI)
 
   NEXT Y


