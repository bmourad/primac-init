SUBROUTINE DRSJSM_VALIDATE_JOB
********************************************************************************
*   Program name :- DRSJSM_VALIDATE_JOB
*   Created:- 6/7/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE  JCS.CPYLIB JOB
$INCLUDE JCS.CPYLIB DRS.JOB.SPEC
$INCLUDE JCS.CPYLIB CUST.TEMPLATE.LIST
$INCLUDE PMC.CPYLIB CUSTOMER
*
*---- OPEN FILES
*
  OPEN '','DRS.JOB.SPEC' TO DRS.JOB.SPEC ELSE ERRMSG = 'DRS.JOB.SPEC FILE MISSING';GOTO 93000
  OPEN '','JOB' TO JOB ELSE ERRMSG = 'JOB FILE MISSING'; GOTO 93000
  OPEN '','CUSTOMER' TO CUSTOMER ELSE ERRMSG = 'CUSTOMER FILE MISSING'; GOTO 93000
  OPEN '','CUST.TEMPLATE.LIST' TO CUST.TEMPLATE.LIST ELSE ERRMSG = 'CUST.TEMPLATE.LIST FILE MISSING'; GOTO 93000
*
*---- INITIALIZATION
*
JOB_NO = '';JOB_DESC = '';CUST_FLG=''
MAT JOB.REC = ''
CUST.KEY = ''
ERRMSG = ""
UNKNOWN = "???????????????"
NEW = 0

STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
STATUS=RBO.getProperty('','ID',JOB.KEY)
CONO = PMCProperty<1,4>
*
*---- MAIN PROCESSING
*
 MATREAD DJS.REC FROM DRS.JOB.SPEC, CONO:JOB.KEY ELSE
        NEW = 1
        MAT DJS.REC = ''
 END
 MATREAD JOB.REC FROM JOB,CONO:JOB.KEY ELSE
     IF NEW THEN
         ERRMSG = 'JOB record does not exist.'
         GOTO 93000
     END ELSE JOB.DESC = UNKNOWN
END
  IF NOT(NEW) THEN
    CUST.KEY = DJS.CUST
  END ELSE
    IF JOB.CUST # '' THEN
      CUST.KEY = JOB.CUST
    END ELSE
*
10 *     GET CUSTOMER
*	 
         CUST_FLG = 1
         GOTO 93000
    END
  END
  MATREAD CUST.REC FROM CUSTOMER, CONO:CUST.KEY ELSE
    IF NEW THEN
      ERRMSG = 'CUSTOMER record does not exist.'
      CUST_FLG = 1
      GOTO 93000
    END ELSE
      CUST.NAME = UNKNOWN
    END
  END

  READV TEST FROM CUST.TEMPLATE.LIST, CONO:CUST.KEY:"!":JOB.KEY:"!001",1 ELSE
    ERRMSG = 'Note! A Template for this job needs to be created.'
    GOSUB 93000
  END
STATUS = RBO.setProperty('', 'New_Flag',NEW)
STATUS = RBO.setProperty('', 'Job_Name',JOB.DESC)
STATUS = RBO.setProperty('', 'Cust_Number',CUST.KEY)
STATUS = RBO.setProperty('', 'Cust_Name',CUST.NAME)
RETURN
*
*---- ERROR ROUTINE
*
93000*
   IF ERRMSG # "" THEN
	STATUS = RBO.setProperty('', 'ServerStatus',1)
   	STATUS = RBO.setProperty('', 'ServerMessage', ERRMSG)
   END
   IF CUST_FLG = 1 THEN
	STATUS = RBO.setProperty('', 'CUST_FLG',1)
   END
* End of method code
RETURN
