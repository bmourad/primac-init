SUBROUTINE GET_NEW_CREDITID
********************************************************************************
*   Program name :- JOBM_PROCESS_JOBNO
*   Created:- 7/29/2005 
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
* ID 
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

ERRMSG = ''
OPEN '','CONTROL' TO CONTROL ELSE
	ERRMSG = "UNABLE TO OPEN CONTROL FILE"
    	GOTO 99999
END

* Insert method code here

VAL = RBO.getProperty('','ID',ID)
CONO = ID[1,3]
JOBNO = ID[4,99]
IF JOBNO = "N" THEN
 READU  IVC.NO FROM CONTROL, CONO:"NEXT.INVOICE.NO" ELSE IVC.NO=1
            N.IVC.NO=IVC.NO + 1
            IVC.NO=STR("0",6-LEN(IVC.NO)):IVC.NO
            WRITE N.IVC.NO ON CONTROL, CONO:"NEXT.INVOICE.NO"
END

VAL = RBO.setProperty('','ID',IVC.NO)

99999
IF ERRMSG # '' THEN
	STATUS = RBO.setProperty('','ServerStatus','1')
	STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
END ELSE
	STATUS = RBO.setProperty('','ServerStatus','')   
	STATUS = RBO.setProperty('','ServerMessage','')
END
RETURN

