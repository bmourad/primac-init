SUBROUTINE ORDM_PREREQUISITES
********************************************************************************
*   Program name :- ORDM_PREREQUISITES
*   Created:- 2/28/2006
*   Programmer :- Suhail Hussain S  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE CPYLIB COMMON1
$INCLUDE JCS.CPYLIB COM.JCS.LINK  
$INCLUDE ICS.CPYLIB COM.INV.MAIN  
$INCLUDE ICS.CPYLIB COM.INV.SERIAL
$INCLUDE JCS.CPYLIB COM.INV.STATS 
$INCLUDE PMC.CPYLIB COM.CUST 
$INCLUDE OPS.CPYLIB COM.ORDER
$INCLUDE OPS.CPYLIB COM.OPS.LINK

$DEFINE INVENTORY
$DEFINE ORDER
$DEFINE ORDERDETAILINQ
$DEFINE COMPOPS
$DEFINE CUSTOMER
$DEFINE CATEGORY
$DEFINE INVWHSE
$DEFINE FNGDSTATS
$DEFINE FNGDORDERSTATS
$DEFINE JOB
$DEFINE FILEVARS

$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB COMP.OPS
$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE OPS.CPYLIB ORDER
$INCLUDE OPS.CPYLIB ORDER.DETAIL
$INCLUDE OPS.CPYLIB ORDER.DETAIL.INQ
$INCLUDE OPS.CPYLIB ORDER.RELEASE
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB CATEGORY
$INCLUDE ICS.CPYLIB INV.WHSE
$INCLUDE ICS.CPYLIB INV.FNGD
$INCLUDE ICS.CPYLIB INV.CNV
$INCLUDE ICS.CPYLIB FNGD.BOM
$INCLUDE JCS.CPYLIB JOB.CREDIT.STATS
$INCLUDE ICS.CPYLIB FNGD.STATS
$INCLUDE ICS.CPYLIB FNGD.ORDER.STATS
$INCLUDE ICS.CPYLIB FNGD.JOB.STATS
$INCLUDE ICS.CPYLIB PRICE.TABLE
$INCLUDE ICS.CPYLIB WAREHOUSE
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE JCS.CPYLIB JOB
$INCLUDE PMC.CPYLIB SHIP.TO
$INCLUDE CPYLIB FILE.VARS
$INCLUDE CPYLIB CHAR
OPEN "","CONTROL" TO CONTROL ELSE STOP
   OPEN "","COMPANY" TO COMPANY ELSE ERRMSG = "CANNOT OPEN COMPANY FILE";GOTO 91000
   OPEN "","CUSTOMER" TO CUSTOMER ELSE ERRMSG = "CANNOT OPEN CUSTOMER FILE";GOTO 91000
   OPEN "","ORDER" TO ORDER ELSE ERRMSG = "CANNOT OPEN ORDER FILE";GOTO 91000
   OPEN "","ORDER.DETAIL" TO ORDER.DETAIL ELSE ERRMSG = "CANNOT OPEN ORDER.DETAIL FILE";GOTO 91000
   OPEN "","ORDER.RELEASE" TO ORDER.RELEASE ELSE ERRMSG = "CANNOT OPEN ORDER.RELEASE FILE";GOTO 91000
   OPEN "","INVENTORY" TO INVENTORY ELSE ERRMSG = "CANNOT OPEN INVENTORY FILE";GOTO 91000
   OPEN "","CATEGORY" TO CATEGORY ELSE ERRMSG = "CANNOT OPEN CATEGORY FILE";GOTO 91000
   OPEN "","INV.WHSE" TO INV.WHSE ELSE ERRMSG = "CANNOT OPEN INV.WHSE FILE";GOTO 91000
   OPEN "","INV.FNGD" TO INV.FNGD ELSE ERRMSG = "CANNOT OPEN INV.FNGD FILE";GOTO 91000
   OPEN "","FNGD.BOM" TO FNGD.BOM ELSE ERRMSG = "CANNOT OPEN FNGD.BOM FILE";GOTO 91000
   OPEN "","FNGD.STATS" TO FNGD.STATS ELSE ERRMSG = "CANNOT OPEN FNGD.STATS FILE";GOTO 91000
   OPEN "","FNGD.ORDER.STATS" TO FNGD.ORDER.STATS ELSE ERRMSG = "CANNOT OPEN  FILE";GOTO 91000
   OPEN "","FNGD.JOB.STATS" TO FNGD.JOB.STATS ELSE ERRMSG = "CANNOT OPEN FNGD.JOB.STATS FILE";GOTO 91000
   OPEN "","PRICE.TABLE" TO PRICE.TABLE ELSE ERRMSG = "CANNOT OPEN PRICE.TABLE FILE";GOTO 91000
   OPEN "","WAREHOUSE" TO WAREHOUSE ELSE ERRMSG = "CANNOT OPEN WAREHOUSE FILE";GOTO 91000
   OPEN "","ESTIMATE" TO ESTIMATE ELSE ERRMSG = "CANNOT OPEN ESTIMATE FILE";GOTO 91000
   OPEN "","JOB" TO JOB ELSE ERRMSG = "CANNOT OPEN JOB FILE";GOTO 91000
   OPEN "","CONTROL" TO CONTROL ELSE ERRMSG = "CANNOT OPEN CONTROL FILE";GOTO 91000  
   OPEN "","SHIP.TO" TO SHIP.TO ELSE ERRMSG = "CANNOT OPEN SHIP.TO FILE";GOTO 91000
   OPEN "","CREDIT_STATS" TO CREDIT_STATS ELSE ERRMSG = "Cannot locate the CREDIT_STATS file";GOTO 91000
   OPEN "","PICK.TICKET.PRT" TO PICK.TICKET.PRT ELSE ERRMSG = "Cannot locate the PICK.TICKET.PRT file";GOTO 91000

* Insert method code here
  
   STATUS = RBO.getProperty("","PMCProperty",PMCProperty)
   STATUS = RBO.getProperty("","READFLAG",READFLAG)
   CONO = PMCProperty<1,4>
   BEGIN CASE 
      CASE READFLAG = 1
         GOSUB PROCESS_ORD_SHIP_TO
      CASE 1
         MATREAD OPCO.REC FROM CONTROL, CONO:"OPS" ELSE
            ERRMSG = "Cannot locate Order Processing company setup"
            GOTO 91000
         END
         STATUS = RBO.setProperty("","OPCO_SHP_FLW",OPCO.SHP.FLW)
         STATUS = RBO.setProperty("","OPCO_JOB_ACC",OPCO.JOB.ACC)
         STATUS = RBO.setProperty("","OPCO_CNTY",OPCO.CNTY)
         STATUS = RBO.setProperty("","OPCO_KIT_DETAIL",OPCO.KIT.DETAIL)
   END CASE
RETURN

PROCESS_ORD_SHIP_TO:
   STATUS = RBO.getProperty("","INARR",ORDNO)
   MATREAD ORD.REC FROM ORDER, CONO : ORDNO ELSE RETURN
   MAT ORD.DET.SUM = ""
   MAT ORD.DET.INQ = ""
   ORDDETSUM = ""
   STATUS = "L"; SHPNO = "ALL"
   CALL ORDER_LINE_UPD(CONO,ORDNO,SHPNO,STATUS)
   FOR S = 1 TO DCOUNT(ORD.SHIP.TO,VM)
      OSDARR = ""
      FOR P = 1 TO ORD.DET.REC.SIZE
         ORD.DET.REC(P) = ORD.DET.SUM(P,S)
      NEXT P
      MATBUILD OSDARR FROM ORD.DET.REC USING "ð"
      ORDDETSUM := OSDARR : "¥"
   NEXT S
   IF ORDDETSUM # "" THEN 
      ORDDETSUM = ORDDETSUM[1,LEN(ORDDETSUM)-1]
   END
   SWAP VM WITH "#" IN ODQ.PROD
   STATUS = RBO.setProperty("","RETARR",ORDDETSUM)
   STATUS = RBO.setProperty("","GRIDARR",ODQ.PROD)
RETURN
   
* End of method code
91000*
   STATUS = RBO.setProperty("","ServerStatus",1)
   STATUS = RBO.setProperty("","ServerMessage",ERRMSG)
RETURN

