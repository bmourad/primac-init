SUBROUTINE JCSJTE_PREREAD
********************************************************************************
*   Program name :- JCSJTE_PREREAD
*   Created:- 7/9/2003
*------------------------------------------------------------------------------*
*   Program Written by Kauser Jahan

* In Properties:
* --------------
*  CONO
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JCS.CPYLIB OPERATION
$INCLUDE JCS.CPYLIB JOB
$INCLUDE JCS.CPYLIB DAILY.TIME
$INCLUDE JCS.CPYLIB JOB.CUTOFF.NO
$INCLUDE JCS.CPYLIB JOB.STAT.CODE
**$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB CUSTOMER
**$INCLUDE PMC.CPYLIB COST.CNTR

  OPEN '','CONTROL' TO CONTROL ELSE ERRMSG='CONTROL FILE IS MISSING'; GOTO 93000
  OPEN '','JOB' TO JOB ELSE ERRMSG='JOB FILE IS MISSING'; GOTO 93000
  OPEN '','DAILY.TIME' TO DAILY.TIME ELSE ERRMSG='DAILY.TIME FILE IS MISSING'; GOTO 93000
  OPEN '','CUSTOMER' TO CUSTOMER ELSE ERRMSG='CUSTOMER FILE IS MISSING'; GOTO 93000
**  OPEN '','COST.CNTR' TO COST.CNTR ELSE ERRMSG='COST.CNTR FILE IS MISSING'; GOTO 93000
**  OPEN '','COMPANY' TO COMPANY ELSE ERRMSG='COMPANY FILE IS MISSING'; GOTO 93000

* Insert method code here
**MAT COMP.REC=''
CONO = ''

MAT JOB.REC='' 
**  MAT CCTR.REC = ''
MAT OPER.REC = ''

STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
STATUS=RBO.getProperty('','ID',DLB.KEY)
CONO   = PMCProperty<1,4>

**********COMPANY DETAILS**************
**MATREAD COMP.REC FROM COMPANY, CONO ELSE
**	ERRMSG = "COMPANY NOT ON FILE"
**	GOTO 93000
**END


********** CONTROL CONO:'DAILY.TIME' VALUES
	READU TIME.ENT.SEQ FROM CONTROL, CONO:"DAILY.TIME" ELSE TIME.ENT.SEQ = 10001


********** CONTROL CONO:'JOB.CUTOFF.NO' VALUES
  MATREAD JOB.CUTOFF.REC FROM CONTROL, CONO:'JOB.CUTOFF.NO' ELSE
    MAT JOB.CUTOFF.REC=''
    J.CUTOFF.NUM=0
  END

*********** JOB VALUES
CMD = "SSELECT JOB WITH CONO = '" : CONO : "' AND WITH STATUS <= 5"
UDTEXECUTE CMD CAPTURING MSG

JOB_CODES = ""
JOB_DESCS = ""
JOB_TYPE = ""
JOB_CUST = ""
JOB_DIV = ""
JOB_DEPT = ""
JOB_STATUS = ""
JOB_TRACK_DATE = ""
JOB_CODES_LIST = ""
MAT DLB.REC = ""
P_VALUE = ""
DATA =1
LOOP
  READNEXT ID THEN
	JOB_CODES<1,-1> = ID[4,99]
  END ELSE
	DATA = 0
  END

WHILE DATA DO
REPEAT
	JOB_COUNT=DCOUNT(JOB_CODES,@VM)
	
	FOR Y = 1 TO JOB_COUNT
		MID = SUBSTRINGS(JOB_CODES<1,Y>,1,1)
		IF MID # "X" THEN
		    MATREAD JOB.REC FROM JOB,CONO:JOB_CODES<1,Y> THEN
			JOB_CODES_LIST<1,Y> = JOB_CODES<1,Y>
			JOB_DESCS<1,Y> = JOB.DESC<1,1> 
			JOB_CUST<1,Y> = JOB.CUST
			JOB_DIV<1,Y>   = JOB.DIV
                     JOB_DEPT<1,Y>   = JOB.DEPT
			JOB_STATUS<1,Y> = JOB.STATUS<1,1>
			JOB_TRACK_DATE<1,Y> = OCONV(JOB.TRACK.DATE<1,1>,"D2/")
			JOB_TYPE<1,Y> = JOB.TYPE
		   END
              END
	NEXT Y	

*DLB.KEY = EMP.CODE:"*":ENT.DATE:"*":SHIFT.CODE

MATREAD DLB.REC FROM DAILY.TIME , DLB.KEY THEN
END
*-- GET TOTAL TIME AND PRINT IT
  JOB.CNT=COUNT(DLB.JOB,@VM) + (DLB.JOB # '')

  TOTAL.HRS=0
  FOR JT=1 TO JOB.CNT
    IF DLB.CNCR<1,JT> # "Y" THEN
      IF DLB.HRS.EN<1,JT> < DLB.HRS.ST<1,JT> THEN
        DIFF.HRS=(DLB.HRS.EN<1,JT> + 2400) - DLB.HRS.ST<1,JT>
      END ELSE
        DIFF.HRS=DLB.HRS.EN<1,JT> - DLB.HRS.ST<1,JT>
      END
      TOTAL.HRS=TOTAL.HRS + DIFF.HRS
    END
  NEXT JT
  P_VALUE = OCONV(TOTAL.HRS, "MD2")


**** COST CENTER VALUES
**CCTR_DESCS = ""
**CCTR_LIST = ""
**CCTR_TYPE = ""
**CCTR_OPER = ""
**CCTR_OPER_TYPE = ""
**CCTR_OPER_HR_RATE = ""

**CMD = "SSELECT COST.CNTR WITH CONO = '" : CONO : "' AND WITH CCTR_TYPE # 'F'"
**UDTEXECUTE CMD

**DATA = 1
**LOOP
**	READNEXT ID THEN
**		CCTR_LIST<1,-1> = ID[4,99]
**	END ELSE
**		DATA = 0
**	END

**WHILE DATA DO
**REPEAT
**	CCTR_COUNT = DCOUNT(CCTR_LIST,@VM)

**	FOR I = 1 TO CCTR_COUNT
**		MATREAD CCTR.REC FROM COST.CNTR , CONO:CCTR_LIST<1,I> THEN

**			CCTR_DESCS<1,I> = CCTR_LIST<1,I>: "_" :CCTR.DESC;*ADDED 
**			CCTR_TYPE<1,I> = CCTR.TYPE

**			SWAP @VM WITH "," IN CCTR.OPER
**			CCTR_OPER<1,I> = CCTR.OPER

**			SWAP @VM WITH "," IN CCTR.OPER.TYPE
**			CCTR_OPER_TYPE<1,I> = CCTR.OPER.TYPE
			
**			SWAP @VM WITH "," IN CCTR.OPER.HR.RATE
**			CCTR_OPER_HR_RATE<1,I> = CCTR.OPER.HR.RATE
**		END
**	NEXT I


****************CUSTOMER VALUES
CUST_LIST = ""
CUST_NAME = ""

CMD = "SSELECT CUSTOMER WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD

DATA = 1
LOOP
	READNEXT ID ELSE DATA = 0
WHILE DATA DO
	CUST_LIST<1,-1> = ID[4,99]
REPEAT

	CUST_COUNT = DCOUNT(CUST_LIST,@VM)
		FOR X = 1 TO CUST_COUNT
			MATREAD CUST.REC FROM CUSTOMER,CONO:CUST_LIST<1,X> THEN
				CUST_NAME<1,X> = CUST.NAME
			END

		NEXT X


STATUS = RBO.setProperty('','MAX_SEQ',TIME.ENT.SEQ)
STATUS = RBO.setProperty('','J_CUTOFF_NUM',J.CUTOFF.NUM)
STATUS = RBO.setProperty('','J_CUTOFF_PREFIX',J.CUTOFF.PREFIX)
STATUS = RBO.setProperty('','J_CUTOFF_PRE_NO',J.CUTOFF.PRE.NO)
STATUS = RBO.setProperty('','JOB_CODES',JOB_CODES_LIST)
STATUS = RBO.setProperty('','JOB_DESCS',JOB_DESCS)
STATUS = RBO.setProperty('','JOB_CUST',JOB_CUST)
STATUS = RBO.setProperty('','JOB_DIV',JOB_DIV)
STATUS = RBO.setProperty('','JOB_DEPT',JOB_DEPT)
STATUS = RBO.setProperty('','JOB_STATUS',JOB_STATUS)
STATUS = RBO.setProperty('','JOB_TRACK_DATE',JOB_TRACK_DATE)
STATUS = RBO.setProperty('','JOB_TYPE',JOB_TYPE)
STATUS = RBO.setProperty('','CUST_LIST',CUST_LIST)
STATUS = RBO.setProperty('','CUST_NAME',CUST_NAME)
STATUS = RBO.setProperty('','TOTAL_HRS',P_VALUE)

**STATUS = RBO.setProperty('','CCTR_TYPE',CCTR_TYPE)
**STATUS = RBO.setProperty('','CCTR_DESCS',CCTR_DESCS)
**STATUS = RBO.setProperty('','CCTR_LIST',CCTR_LIST)
**STATUS = RBO.setProperty('','CCTR_OPER',CCTR_OPER)
**STATUS = RBO.setProperty('','CCTR_OPER_TYPE',CCTR_OPER_TYPE)
**STATUS = RBO.setProperty('','CCTR_OPER_HR_RATE',CCTR_OPER_HR_RATE)


**STATUS = RBO.setProperty('','CO_JOB_CUST_FLG',CO.JOB.CUST.FLG)

* End of method code
RETURN

93000*
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN

