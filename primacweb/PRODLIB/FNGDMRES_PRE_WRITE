SUBROUTINE FNGDMRES_PRE_WRITE
********************************************************************************
*   Program name :- FNGDMRES_PRE_WRITE
*   Created:- 6/12/2006
*   Programmer :- Syed Suhail Hussain
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE CPYLIB CHAR
OPEN "","INVENTORY" TO INVENTORY ELSE ERRMSG = "CANNOT OPEN INVENTORY FILE";GOTO 91000
OPEN "","CONTROL" TO CONTROL ELSE ERRMSG = "CANNOT OPEN CONTROL FILE";GOTO 91000
* Insert method code here
   STATUS = RBO.getProperty("","PMCProperty",PMCProperty)
   STATUS = RBO.getProperty("","ID",ID)
   STATUS = RBO.getProperty("","INV_BASE_SKU",INV_BASE_SKU)
   STATUS = RBO.getProperty("","INV_CUST",INV_CUST)
   STATUS = RBO.getProperty("","INV_LINE",INV_LINE)
   STATUS = RBO.getProperty("","INV_SBR",INV_SBR)
   STATUS = RBO.getProperty("","INV_BAS_WT",INV_BAS_WT)
   STATUS = RBO.getProperty("","INV_COST_WT",INV_COST_WT)
   STATUS = RBO.getProperty("","INV_M_WT",INV_M_WT)
   STATUS = RBO.getProperty("","BASFLAG",BASFLAG)

   CONO = PMCProperty<1,4>
   PDNO = ID[4,99]
   DIM S.INV.REC(90)

   MATREAD INV.REC FROM INVENTORY,ID THEN
      IF NUM(INV_BAS_WT) THEN
         INV_BAS_WT = ICONV(INV_BAS_WT,"MD2")
      END
      INV_SUBS = INV.SUBS
      IF INV.BASE.SKU # "" AND INV.BASE.SKU # INV_BASE_SKU THEN
         MATREAD INV.REC FROM INVENTORY, CONO:INV.BASE.SKU THEN
            LOCATE PDNO IN INV.SUBS<1>,1 SETTING SLOC THEN
               INV.SUBS = DELETE(INV.SUBS,1,SLOC,0)
               MATWRITE INV.REC ON INVENTORY, CONO:INV.BASE.SKU
            END
         END
      END
      IF INV_BASE_SKU # "" THEN
         MATREAD INV.REC FROM INVENTORY, CONO:INV_BASE_SKU THEN
            LOCATE PDNO IN INV.SUBS<1>,1 SETTING FND ELSE
               INV.SUBS<1,FND> = PDNO
            END
            MATWRITE INV.REC ON INVENTORY, CONO:INV_BASE_SKU
         END
      END
      
      IF INV_SUBS # "" THEN
         S.INV.SUBS = INV_SUBS
         S.CUST = INV_CUST;S.LINE = INV_LINE
         S.SBR = INV_SBR;S.BAS.WT = INV_BAS_WT
         S.COST.WT = INV_COST_WT;S.M.WT = INV_M_WT
         PCNT = DCOUNT(S.INV.SUBS,VM)
         FOR P = 1 TO PCNT
            SUB.SKU = S.INV.SUBS<1,P>
            MATREAD INV.REC FROM INVENTORY, CONO:SUB.SKU THEN
               IF INV.BASE.SKU = PDNO THEN
                  INV.CUST = S.CUST;INV.LINE = S.LINE
                  INV.SBR = S.SBR;INV.BAS.WT = S.BAS.WT
                  INV.COST.WT = S.COST.WT;INV.M.WT = S.M.WT
                  MATWRITE INV.REC ON INVENTORY, CONO:SUB.SKU
               END
            END
         NEXT P
      END
   END ELSE
      IF INV_BASE_SKU # "" THEN
         MATREAD INV.REC FROM INVENTORY, CONO:INV_BASE_SKU THEN
            LOCATE PDNO IN INV.SUBS<1>,1 SETTING FND ELSE
               INV.SUBS<1,FND> = PDNO
            END
            MATWRITE INV.REC ON INVENTORY, CONO:INV_BASE_SKU
         END
      END
   END
RETURN
* End of method code
91000*
   STATUS = RBO.setProperty("","ServerStatus",1)
   STATUS = RBO.setProperty("","ServerMessage",ERRMSG)
RETURN

