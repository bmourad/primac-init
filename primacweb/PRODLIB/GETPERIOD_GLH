SUBROUTINE GETPERIOD_GLH
********************************************************************************
*   Program name :- GETPERIOD_GLH
*   Created:- BY YAKUB ON 2/23/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB FISCAL
* Insert method code here
ERRMSG = ""
   OPEN '','CONTROL' TO CONTROL ELSE
      ERRMSG = 'Cannot open Control file!'
      GOTO 1000
   END
MAXL=''
MAXV=''
PERIOD.MAXV=''
PERIOD.DEFAULT=''
CONO=''
S_PERIOD=''
E_PERIOD=''
START_PERIOD=''
END_PERIOD=''
STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
CONO = PMCProperty<1,4>
STATUS = RBO.getProperty('','STARTING_PERIOD',S_PERIOD)
STATUS = RBO.getProperty('','ENDING_PERIOD',E_PERIOD)


*WRITE "U R HERE" ON CONTROL ,"01PR"
MATREAD FISCAL.REC FROM CONTROL , CONO:"FISCAL" ELSE
      ERRMSG = "CONTROL FISCAL IS NOT ON FILE";GOTO 1000
END
 READ NUM.PERIODS FROM CONTROL,CONO:"ACCT.PERIODS" ELSE
      NUM.PERIODS = 12
   END
*T26619 ^
   READV ALL.DIV FROM CONTROL , CONO:"DIVISIONS" , 1 ELSE ALL.DIV = "01"
   DIV.CNT = DCOUNT(ALL.DIV,@VM)
YEAR = FR.CURR.PER[1,4]
CURR = FR.CURR.PER[5,2]
PERIOD.DEFAULT=FR.CURR.PER


*--- PERIOD
*
IF S_PERIOD # "" THEN
  
   BEGIN CASE
      
      CASE S_PERIOD >= FR.CURR.PER
         ERRMSG = "Cannot use period same or greater than current period"
         GOTO 1000
*T26619 V
*     CASE ECD.RET.VALUE[1,4] < YEAR - 2
      CASE S_PERIOD[1,4] < YEAR - 3
*        ERRMSG = "Cannot go back more than two years."
         ERRMSG = "Cannot go back more than three years."
         GOTO 1000
*     CASE ECD.RET.VALUE[5,2] < 1 OR ECD.RET.VALUE[5,2] > 12
      CASE S_PERIOD[5,2] < 1 OR S_PERIOD[5,2] > NUM.PERIODS
*T26619 ^
         ERRMSG = "Invalid Period !"
         GOTO 1000
      CASE E_PERIOD # "" AND S_PERIOD > E_PERIOD
         ERRMSG = "Starting period must be less than ending period"
         GOTO 1000
   END CASE

	START_PERIOD = S_PERIOD 
 END
     
*
*--- End Period
*
IF E_PERIOD # "" THEN
  
   BEGIN CASE
     
      CASE E_PERIOD >= FR.CURR.PER
         ERRMSG = "Cannot use period same or greater than current period"
          GOTO 1000
*T26619 v
*     CASE ECD.RET.VALUE[1,4] < YEAR - 2
      CASE E_PERIOD[1,4] < YEAR - 3
         ERRMSG = "Cannot go back more than three years."
          GOTO 1000
*     CASE ECD.RET.VALUE[5,2] < 1 OR ECD.RET.VALUE[5,2] > 12
      CASE E_PERIOD[5,2] < 1 OR E_PERIOD[5,2] > NUM.PERIODS
*T26619 ^
         ERRMSG = "Invalid Period !"
          GOTO 1000
      CASE E_PERIOD < START_PERIOD
         ERRMSG = "ending period must be greater than or equal to starting period"
          GOTO 1000
   END CASE
   END_PERIOD = E_PERIOD
END

*STATUS = RBO.setProperty('','START_PERIOD',START_PERIOD)
*STATUS = RBO.setProperty('','END_PERIOD',END_PERIOD)
STATUS = RBO.setProperty('','PERIOD_DEFAULT',PERIOD.DEFAULT)

* End of method code
RETURN

1000
STATUS = RBO.setProperty('','ServerStatus',1)        
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
99999
RETURN



