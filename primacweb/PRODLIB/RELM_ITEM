SUBROUTINE RELM_ITEM
********************************************************************************
*   Program name :- RELM_ITEM
*   Created:- 9/11/2003 RAZI
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE OPS.CPYLIB ORDER
$INCLUDE OPS.CPYLIB ORDER.RELEASE
$INCLUDE OPS.CPYLIB ORDER.DETAIL
$INCLUDE OPS.CPYLIB ORDER.DETAIL.INQ
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE PMC.CPYLIB SHIP.TO
$INCLUDE OPS.CPYLIB PICK.TICKET            
$INCLUDE ICS.CPYLIB CATEGORY
$INCLUDE ICS.CPYLIB INV.WHSE

$INCLUDE ICS.CPYLIB INV.CNV
$INCLUDE CPYLIB CHAR

* Insert method code here
ERRMSG = ''
OPEN 'ORDER' TO ORDER ELSE
      HMSG='CANNOT OPEN ORDER FILE'
      GOTO 1000
END

OPEN 'ORDER.RELEASE' TO ORDER.RELEASE ELSE
      HMSG='CANNOT OPEN ORDER.RELEASE FILE'
      GOTO 1000
END

OPEN 'ORDER.DETAIL' TO ORDER.DETAIL ELSE
      HMSG='CANNOT OPEN ORDER.DETAIL FILE'
      GOTO 1000
END

OPEN 'INVENTORY' TO INVENTORY ELSE
      HMSG='CANNOT OPEN INVENTORY FILE'
      GOTO 1000
END

OPEN 'CUSTOMER' TO CUSTOMER ELSE
      HMSG='CANNOT OPEN CUSTOMER FILE'
      GOTO 1000
END

OPEN "","INV.WHSE" TO INV.WHSE ELSE
       HMSG= "Cannot locate the INV.WHSE file"
	GOTO 1000
END


ID = ''
CONO=''
STATUS = RBO.getProperty('','ID',ID)
STATUS = RBO.getProperty('','ORR_ORD',ORR_ORD)
STATUS = RBO.getProperty('','ORR_SHIP_TO',ORR_SHIP_TO)
STATUS = RBO.getProperty('','OSD_ITEM',OSD_ITEM)
STATUS = RBO.getProperty('','OSD_PROD',OSD_PROD)
STATUS = RBO.getProperty('','DST_WHSE',DST_WHSE)


CONO = ID[1,3]
ID = ID[4,99]
GEN.SHPNO='000'
PDNOS=''
MCNT =''
PCNT = 0
ITEMNO =OSD_ITEM
PDNO=OSD_PROD
ITEM_WHSE=''

IF ID # 'N' THEN
	MATREAD ORR.REC FROM ORDER.RELEASE,CONO:ID ELSE
		ERRMSG='CANNOT READ ORDER.RELEASE FILE'
		GOTO 1000
	END

	MATREAD ORD.DET.REC FROM ORDER.DETAIL,CONO:ORR.ORD:"!":ORR.SHIP.TO THEN
		PDNOS<1,-1> 	  = OSD.PROD
		*WHNOS<1,-1>	  = OSD.WHSE
	END ELSE
		ERRMSG='CANNOT READ ORDER.DETAIL FILE'
		GOTO 1000
	END
END ELSE
	MATREAD ORD.DET.REC FROM ORDER.DETAIL,CONO:ORR_ORD:"!":ORR_SHIP_TO THEN
		PDNOS<1,-1> 	  = OSD.PROD
	END ELSE
		ERRMSG='CANNOT READ ORDER.DETAIL FILE'
		GOTO 1000
	END

END

MCNT = DCOUNT(OSD.PROD,VM)
PCNT = 0; BREF = ""; PROD.SUBS = ""
  FOR P = 1 TO MCNT
    MATREAD INV.REC FROM INVENTORY, CONO:OSD.PROD<1,P> THEN
      IF INV.SUBS # "" THEN
        PCNT = PCNT + 1
        BREF<PCNT> = P
        PROD.SUBS<PCNT> = INV.SUBS
	
      END
   
    END
  NEXT P
  
REFNO = ""; PDNOS = ""; WHNOS = ""
  FOR M = 1 TO PCNT
    P = BREF<M>
    LOCATE OSD.PROD<1,P> IN PDNOS<1>,1 SETTING PLOC ELSE
      PDNOS<1,PLOC> = OSD.PROD<1,P>
    END
    LOCATE OSD.WHSE<1,P> IN WHNOS<PLOC>,1 SETTING WLOC ELSE
      WHNOS<PLOC,WLOC> = OSD.WHSE<1,P>
    END
   *REFNO<PLOC,WLOC> = P
  NEXT M
  
  PPTR = REFNO<PLOC,WLOC>
  LOCATE PPTR IN BREF,1 SETTING BPTR ELSE BPTR = 1

  LOCATE ITEMNO IN PROD.SUBS<BPTR>,1 SETTING FND THEN
		MATREAD INV.REC FROM INVENTORY, CONO:OSD_ITEM THEN
    			ITEM_DESC=INV.FULL.DESC
			ITEM_WHSE =INV.WHSE.CODE ;* ADDED BY ZUBAIR

		END
  END ELSE
    ERRMSG = "This product is not associated with the base # ":PDNO
    GOTO 1000
  END
  
  MATREAD INV.REC FROM INVENTORY, CONO:ITEMNO ELSE
    ERRMSG = "Cannot locate product # ":ITEMNO
    GOTO 1000
  END

*VALIDATE WAREHOUSWE
IF DST_WHSE # "" THEN
   MATREAD IWH.REC FROM INV.WHSE, CONO:ITEMNO:"!":DST_WHSE ELSE
    ERRMSG = "Cannot locate warehouse (":DST_WHSE:") for item # ":ITEMNO
    GOTO 1000
  END
END  

STATUS = RBO.setProperty('','ITEM_DESC', ITEM_DESC)
STATUS = RBO.setProperty('','OSD_WHSE', ITEM_WHSE)

1000*
   IF ERRMSG # "" THEN
      STATUS = RBO.setProperty('','ServerStatus', 1)
      STATUS = RBO.setProperty('','ServerMessage', ERRMSG)
      STATUS = RBO.setProperty('','HMSG', HMSG)            
   END

* End of method code
RETURN

