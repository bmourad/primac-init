SUBROUTINE ORM_DUE_DATE
********************************************************************************
*   Program name :- ORM_DUE_DATE
*   Created:- 1/4/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE ARS.CPYLIB OPEN.RECV
$INCLUDE JCS.CPYLIB INVOICE
$INCLUDE ARS.CPYLIB MANUAL.INVOICE
$INCLUDE PMC.CPYLIB TERMS 
DIM OVC.REC(60)
EQU OVC.TERMS   TO OVC.REC(38)
EQU OVC.DUE.DATE   TO OVC.REC(39)

ERRMSG = ''
  
OPEN '','OPEN.RECV' TO OPEN.RECV ELSE ERRMSG = 'OPEN.RECV FILE IS MISSING';GOTO 93000
OPEN '','MANUAL.INVOICE' TO MANUAL.INVOICE ELSE ERRMSG = 'MANUAL.INVOICE FILE IS MISSING' ; GOTO 93000
OPEN '','INVOICE' TO INVOICE ELSE ERRMSG = 'INVOICE FILE IS MISSING' ; GOTO 93000
OPEN '','TERMS' TO TERMS ELSE ERRMSG = 'TERMS FILE IS MISSING' ; GOTO 93000
OPEN '','ORDER.INVOICE' TO ORDER.INVOICE ELSE ERRMSG = "ORDER.INVOICE FILE IS MISSING" ; GOTO 93000


STATUS = RBO.getProperty('','ID',ID)
CONO=ID[1,3]

STATUS = RBO.getProperty('','OR_INV_DATE',OR.INV.DATE)
OR.INV.DATE = ICONV(OR.INV.DATE,'D2/')
DUEDATE=""
INV.NO = ID[4,8]
INVOICE.TYPE = INV.NO[LEN(INV.NO)-1,2]
IF INVOICE.TYPE # "MI" THEN
      MATREAD IVC.REC FROM INVOICE,CONO:INV.NO THEN
        INVOICE.TYPE = 'I'
	END ELSE  
          MATREAD OVC.REC FROM ORDER.INVOICE,CONO:INV.NO THEN
            INVOICE.TYPE = 'O'
		END	
END
      END ELSE
      		MATREAD MIV.REC FROM MANUAL.INVOICE,CONO:INV.NO ELSE INVOICE.TYPE = ''
    		END
TERMS.CODE = ''

	BEGIN CASE
		CASE INVOICE.TYPE = "MI"
  			TERMS.CODE = MIV.TERMS
    		CASE INVOICE.TYPE = "I"
    			TERMS.CODE = IVC.TERMS
    		CASE INVOICE.TYPE = "O"
     			TERMS.CODE = OVC.TERMS
	END CASE
*IF TERMS.CODE="" THEN
 * TERMS.CODE=0
*END
    IF TERMS.CODE # ""  THEN
      MATREAD TERMS.REC FROM TERMS, CONO : TERMS.CODE ELSE
        MAT TERMS.REC = ""
      END
*STATUS=RBO.setProperty('','TEMPVAL',TERMS.DUE.DAYS)

      DUEDATE = OR.INV.DATE+ TERMS.DUE.DAYS
      
      BEGIN CASE
        CASE INVOICE.TYPE = "MI"
          MIV.DUE.DATE = DUEDATE 
       CASE INVOICE.TYPE = "I"
          IVC.DUE.DATE = DUEDATE
        CASE INVOICE.TYPE = "O"
          OVC.DUE.DATE = DUEDATE 
     END CASE
    END



DUEDATE = OCONV(DUEDATE,'D2/')

STATUS = RBO.setProperty('','OR_DUE_DATE',DUEDATE)

93000
  
      STATUS = RBO.setProperty('','ServerStatus',"1")
      STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
  
RETURN

