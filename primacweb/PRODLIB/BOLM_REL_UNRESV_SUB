SUBROUTINE BOLM_REL_UNRESV_SUB(CONO,MODE,RELNO,PALLET)
********************************************************************************
*   Program name :- BOLM_REL_UNRESV_SUB
*   Created:- 12/31/2002
*   Author:- L. Ross
* REV12 - POST.BOL
* TO release any reserves left on ORDER.RELEASE.
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE OPS.CPYLIB ORDER.DETAIL
$INCLUDE OPS.CPYLIB ORDER.RELEASE
$INCLUDE CPYLIB CHAR
OPEN "","ORDER.DETAIL" TO ORDER.DETAIL ELSE
  ERRMSG = "Cannot locate the ORDER.DETAIL file"; GOTO 93000
END
OPEN "","ORDER.RELEASE" TO ORDER.RELEASE ELSE ERRMSG = "ORDER.RELEASE FILE MISSING"; GOTO 93000
*
MATREADU ORR.REC FROM ORDER.RELEASE, CONO:RELNO THEN
  MATREADU ORD.DET.REC FROM ORDER.DETAIL, CONO:ORR.ORD:"!":ORR.SHIP.TO THEN
    PCNT = DCOUNT(OSD.PROD,VM)
    FOR P = 1 TO PCNT
      IWH.ID = CONO:OSD.PROD<1,P>:"!":OSD.WHSE<1,P>
      RCNT = DCOUNT(OSD.REL.NO,SVM)
      FOR R = 1 TO RCNT
        IF RELNO = OSD.REL.NO<1,P,R> THEN
          OSD.REL.NO<1,P,R> = ""
          OSD.REL.QTY<1,P,R> = ""
        END
      NEXT R
    NEXT P
    MATWRITE ORD.DET.REC ON ORDER.DETAIL, CONO:ORR.ORD:"!":ORR.SHIP.TO
  END ELSE
    RELEASE ORDER.DETAIL, CONO:ORR.ORD:"!":ORR.SHIP.TO
  END
  IF MODE = "C" THEN
    LOCATE RELNO IN ORD.REL.NO<1>,1 SETTING PTR THEN
      ORD.REL.NO = DELETE(ORD.REL.NO,1,PTR,0)
    END
    ORR.STATUS = INSERT(ORR.STATUS,1,1,0,"CANCELLED")
  END ELSE
    ORR.STATUS = INSERT(ORR.STATUS,1,1,0,"COMPLETED")
  END
  ORR.STAT.DATE = INSERT(ORR.STAT.DATE,1,1,0,DATE())
  MATWRITE ORR.REC ON ORDER.RELEASE, CONO:RELNO
END ELSE
  RELEASE ORDER.RELEASE, CONO:RELNO
END
RETURN
93000
STATUS = RBO.setProperty('','ServerStatus',1)        
STATUS = RBO.setProperty('','ServerMessage',ERRMSG) 

RETURN

