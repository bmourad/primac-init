SUBROUTINE JCSRCLSM_VALIDATE_JOB
********************************************************************************
*   Program name :- JCSRCLSM_VALIDATE_JOB
*   Created:- 5/19/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

$INCLUDE JCS.CPYLIB JOB
$INCLUDE JCS.CPYLIB DAILY.RCLS
$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE CPYLIB CHAR
* Insert method code here

OPEN '','JOB' TO JOB ELSE ERRMSG='JOB FILE IS MISSING'; GOTO 93000
OPEN '','CUSTOMER' TO CUSTOMER ELSE ERRMSG='CUSTOMER FILE IS MISSING'; GOTO 93000
OPEN '','DAILY.RCLS' TO DAILY.RCLS ELSE ERRMSG='DAILY.RCLS FILE IS MISSING'; GOTO 93000


CONO = '';JOB_DESC='';MAT JOB.REC = '';MAT CUST.REC = '';DRC.F.CUST = '';DRC.F.DIV = '';DRC.F.DEPT=''
F.CUST.NAME = '';DRC.T.JOB = '';DRC.T.CUST='';T.CUST.NAME = ''
STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
STATUS=RBO.getProperty('','F_JOB',F.JOB)
STATUS=RBO.getProperty('','T_JOB',T.JOB)
STATUS=RBO.getProperty('','JOB_TYP',JOB.TYP)
STATUS = RBO.getProperty('','DRC_SPOIL_RECLASS',DRC.SPOIL.RECLASS)

CONO   = PMCProperty<1,4>
IF F.JOB # "" THEN
      MATREAD JOB.REC FROM JOB, CONO : F.JOB ELSE
        ERRMSG = "CANNOT LOCATE JOB - " : F.JOB
        GOTO 93000
      END
      BEGIN CASE
        CASE JOB.STATUS<1,1>=9
          ERRMSG = "THIS JOB HAS BEEN CANCELLED";GOTO 93000
        CASE JOB.STATUS<1,1>=7
          ERRMSG = "THIS JOB IS READY TO PURGE";GOTO 93000
        CASE JOB.STATUS<1,1>=8
          ERRMSG = "THIS JOB HAS BEEN PURGED";GOTO 93000
      END CASE
*T23278 v
      DIV.CODE = JOB.DIV; USER.ID = PMCProperty<1,3>; ERRMSG = ''
      CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)
      IF ERRMSG # '' THEN
        GOTO 93000
      END
*T23278 ^
      DRC.F.JOB = F.JOB; F.TYPE = JOB.TYPE
      MATREAD CUST.REC FROM CUSTOMER,CONO:JOB.CUST ELSE CUST.NAME = "UNKNOWN"
      DRC.F.CUST = JOB.CUST; DRC.F.DIV = JOB.DIV; DRC.F.DEPT = JOB.DEPT;F.CUST.NAME=CUST.NAME
END
IF T.JOB # "" AND F.JOB # "" AND JOB.TYP="T" THEN
      *IF T.JOB=F.JOB THEN
	IF T.JOB=F.JOB AND DRC.SPOIL.RECLASS # "Y" THEN	
        ERRMSG = "CANNOT RECLASSIFY TO THE SAME JOB"
        GOTO 93000
      END
      MATREAD JOB.REC FROM JOB, CONO : T.JOB ELSE
        ERRMSG = "CANNOT LOCATE JOB - " : T.JOB
        GOTO 93000
      END
      BEGIN CASE
        CASE JOB.STATUS<1,1>=9
          ERRMSG = "THIS JOB HAS BEEN CANCELLED";GOTO 93000
        CASE JOB.STATUS<1,1>=7
          ERRMSG = "THIS JOB IS READY TO PURGE";GOTO 93000
        CASE JOB.STATUS<1,1>=8
          ERRMSG = "THIS JOB HAS BEEN PURGED";GOTO 93000
      END CASE
      IF JOB.DIV # DRC.F.DIV THEN
        ERRMSG = "CANNOT TRANSFER BETWEEN TWO DIFFERENT DIVISIONS"
        GOTO 93000
      END
      IF JOB.DEPT # DRC.F.DEPT[1,LEN(JOB.DEPT)] THEN
        ERRMSG = "CANNOT TRANSFER BETWEEN TWO DIFFERENT DEPARTMENTS"
        GOTO 93000
      END
      IF JOB.TYPE # "R" AND JOB.TYPE # F.TYPE THEN
        ERRMSG = "CANNOT TRANSFER BETWEEN TWO DIFFERENT TYPES"
        GOTO 93000
      END
      IF DRC.F.CUST # JOB.CUST THEN
        MATREAD CUST.REC FROM CUSTOMER,CONO:JOB.CUST ELSE CUST.NAME = "UNKNOWN"
      END
      DRC.T.JOB = T.JOB
      DRC.T.CUST = JOB.CUST
      T.CUST.NAME=CUST.NAME
      MATREAD JOB.REC FROM JOB, CONO : DRC.F.JOB ELSE
        ERRMSG = "CANNOT LOCATE JOB - " : DRC.F.JOB
        GOTO 93000
      END
END
STATUS = RBO.setProperty('','DRC_F_CUST',DRC.F.CUST)
STATUS = RBO.setProperty('','F_CUST_NAME',F.CUST.NAME)
STATUS = RBO.setProperty('','DRC_T_CUST',DRC.T.CUST)
STATUS = RBO.setProperty('','T_CUST_NAME',T.CUST.NAME)
RETURN
93000*
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
* End of method code
RETURN

