SUBROUTINE APCPSCD_WRITE_DATA
********************************************************************************
*   Program name :- APCPSCD_WRITE_DATA
*   Created:- 6/4/2003
*   T260407:- CHANGED AND ADDED BY A. GAFOOR
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  SVEND_NO,SVEND_DS,ID,DIV_CODE
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
DIM SVEND.REC(10)
   EQU SVEND.NO TO SVEND.REC(1)
   EQU SVEND.DS TO SVEND.REC(2)
   EQU SVEND.PT TO SVEND.REC(3)
   MAT SVEND.REC = ''
OPEN '', 'CONTROL' TO CONTROL ELSE
      ERRMSG = 'CONTROL FILE IS MISSING'
      GOTO 99999
END
* Insert method code here
   STATUS = RBO.getProperty('','ID',ID)
   CONO = ID[1,3]
   STATUS = RBO.getProperty('','DIV_CODE',DIV.OWNER)
   STATUS = RBO.getProperty('','PAYMENT_DATE',PAYDATE)
   *PAYDATE = ICONV(PAYDATE,"D2/")  
   VENDOR.CLR.FLG = 'S' ;* THIS IS ACTUALLY COMES FROM PICKBASIC REPORT HERE I AM HARDCODING

   IF 	VENDOR.CLR.FLG = 'S' THEN
	DELETE CONTROL ,CONO:"VENDORS":DIV.OWNER
	MAT SVEND.REC = ''
   END
   
   STATUS = RBO.getProperty('','SVEND_NO',SVEND_NO)
   STATUS = RBO.getProperty('','SVEND_DS',SVEND_DS)
   STATUS = RBO.getProperty('','SVEND_PT',SVEND_PT)
   *vvv T260407
   SUB.TOOLBAR.SAVE.CLICKED = ""
   SVEND_PT1 = FIELD(SVEND_PT,"^",1)
   SUB.TOOLBAR.SAVE.CLICKED = FIELD(SVEND_PT,"^",2)
   *^^^ T260407
   SVEND.NO = SVEND_NO
   SVEND.DS = SVEND_DS
   SVEND.PT = SVEND_PT1

   *vvv T260407 IF CONDITION ADDED
   IF SUB.TOOLBAR.SAVE.CLICKED # '' AND SVEND.PT = 'P' THEN
      MATWRITE SVEND.REC ON CONTROL , ID
   END
   *^^^ T260407

  REC = ""
  *REBUILD 001SCH.PAYDATEALL RECORD IN CONTROL FILE WITH PAYDATE
  READU REC FROM CONTROL, CONO:"SCH.PAYDATE":DIV.OWNER ELSE
    *ERRMSG = "SCH.PAYDATE RECORD IS MISSING"
    *GOTO 99999
  END
  REC<1> = PAYDATE
  WRITE REC ON CONTROL, CONO:"SCH.PAYDATE":DIV.OWNER

  RELEASE CONTROL,CONO:"SCH.PAYDATE":DIV.OWNER 

* End of method code
99999
  IF (TRIM(ERRMSG) # "") THEN
       STATUS = RBO.setProperty('','ServerStatus','E')
       STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
  END ELSE
       STATUS = RBO.setProperty('','ServerStatus','')
       STATUS = RBO.setProperty('','ServerMessage','')
  END 
RETURN

