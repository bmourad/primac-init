SUBROUTINE ICSSRA_READDATA
********************************************************************************
*   Program name :- ICSSRA_READDATA
*   Created:- 6/18/2003
*------------------------------------------------------------------------------*
*
*PROGRAMMER : G.PURUSHOTHAM RAO

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

$INCLUDE CPYLIB COMMON1
$INCLUDE ICS.CPYLIB COM.INV.MAIN 
$INCLUDE ICS.CPYLIB COM.INV.SERIAL
$INCLUDE ICS.CPYLIB COM.INV.LINK
  
$DEFINE INVENTORY
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB WAREHOUSE
$DEFINE INVWHSE
$INCLUDE ICS.CPYLIB INV.WHSE
$INCLUDE ICS.CPYLIB INV.HIST
$DEFINE INVWHSELOC
$INCLUDE ICS.CPYLIB INV.WHSE.LOC
$INCLUDE ICS.CPYLIB INV.STATS
$INCLUDE ICS.CPYLIB INV.CNV
$DEFINE CATEGORY
$INCLUDE ICS.CPYLIB CATEGORY
$INCLUDE ICS.CPYLIB INV.REC.ADJ
$INCLUDE PMC.CPYLIB COMPANY
$DEFINE PO
$INCLUDE PMC.CPYLIB PO
$INCLUDE APS.CPYLIB VEND.STATS
$INCLUDE APS.CPYLIB VEND.PO.STATS
$INCLUDE APS.CPYLIB VEND.PROD.STATS

$INCLUDE CPYLIB CHAR

$INCLUDE POS.CPYLIB ACCRUED.LIAB.HIST
$DEFINE INVSERIAL
$INCLUDE ICS.CPYLIB INV_SERIAL
$DEFINE INVRECEIPTS
$INCLUDE ICS.CPYLIB INV_RECEIPTS
$DEFINE INVRECPWHSE
$INCLUDE ICS.CPYLIB INV_RECP_WHSE
$DEFINE INVAUDITHIST
$INCLUDE ICS.CPYLIB INV_AUDIT_HIST
$DEFINE ICSID
$INCLUDE ICS.CPYLIB ICS.ID 
* Insert method code here

MAT ORG.IWH.REC=''
OPEN.FLAG=1
ERRMSG = ''
OPEN '','INVENTORY' TO INVENTORY ELSE ERRMSG = 'INVENTORY FILE IS MISSING'; GOTO 93000
OPEN '','WAREHOUSE' TO WAREHOUSE ELSE ERRMSG = 'WAREHOUSE FILE IS MISSING'; GOTO 93000
OPEN '','CATEGORY' TO CATEGORY ELSE ERRMSG = 'CATEGORY FILE IS MISSING'; GOTO 93000
OPEN '','INV.WHSE' TO INV.WHSE ELSE ERRMSG = 'INV.WHSE FILE IS MISSING'; GOTO 93000
OPEN '','INV.HIST' TO INV.HIST ELSE ERRMSG = 'INV.HIST FILE IS MISSING'; GOTO 93000
OPEN '','INV.WHSE.LOC' TO INV.WHSE.LOC ELSE ERRMSG = 'INV.WHSE.LOC FILE IS MISSING'; GOTO 93000
OPEN '','INV_SERIAL' TO INV_SERIAL ELSE ERRMSG='INV_SERIAL FILE IS MISSING'; GOTO 93000
OPEN '','INV.STATS' TO INV.STATS ELSE ERRMSG = 'INV.STATS FILE IS MISSING'; GOTO 93000
OPEN '','INV_AUDIT_HIST' TO INV_AUDIT_HIST ELSE ERRMSG = 'INV_AUDIT_HIST FILE IS MISSING'; GOTO 93000
OPEN '','INV.REC.ADJ' TO INV.REC.ADJ ELSE ERRMSG = 'INV.REC.ADJ FILE IS MISSING'; GOTO 93000
OPEN '','PREFIX' TO PREFIX ELSE ERRMSG = 'PREFIX FILE IS MISSING'; GOTO 93000
OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = 'COMPANY FILE IS MISSING'; GOTO 93000
OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE IS MISSING'; GOTO 93000
OPEN '','SECURITY' TO SECURITY ELSE ERRMSG = 'SECURITY FILE IS MISSING'; GOTO 93000
OPEN '','ICS.SCREENS' TO M.SCREENS ELSE ERRMSG = 'ICS.SCREENS FILE IS MISSING'; GOTO 93000
OPEN '','INVENTORY.XREF' TO INVENTORY.XREF ELSE ERRMSG = 'INVENTORY.XREF FILE IS MISSING'; GOTO 93000
OPEN '','ACCRUED.LIAB.HIST' TO ACCRUED.LIAB.HIST ELSE ERRMSG = 'ACCRUED.LIAB.HIST FILE IS MISSING'; GOTO 93000
OPEN '','INV.JOB.STATS' TO INV.JOB.STATS ELSE ERRMSG = 'INV.JOB.STATS FILE IS MISSING'; GOTO 93000

STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
LOGIN.NAME = PMCProperty<1,3>
CONO = PMCProperty<1,4>
STATUS=RBO.getProperty('','ID',PRODUCT.ID)
ERR_NUM = ""
PROD = PRODUCT.ID
WHSE.DESC.LIST= ""
WHSE.ID.LIST = ""
WHSE.SECURITY.LIST = ""

GEN.DIV = "00";GEN.DEPT = "00";GEN.CCTR = "000" 

MATREAD INV.REC FROM INVENTORY, CONO:PRODUCT.ID ELSE
  ERRMSG = 'CANNOT LOCATE PRODUCT - ':PRODUCT.ID 
  ERR_NUM = "1"
  GOTO 93000
END

    IF INV.WHSE.CODE # '' THEN
      CATG.ID = CONO:INV.LINE
      MATREAD CATG.REC FROM CATEGORY,CATG.ID THEN
        IF CATG.MAJ.LINE='FNGD'  THEN
          ERRMSG="USE FINISHED GOOD RECEIPT ADJUSTMENT FOR THIS PRODUCT"
          ERR_NUM =2 ; GOTO 93000
	 END ELSE
          EM=''
          IF CATG.INV = '' THEN EM='INVENTORY A/C'
          IF CATG.ACCRU.LIAB = '' THEN
            IF EM # '' THEN EM=EM:' AND'
            EM=EM:' ACCRUED LIABILITY A/C'
          END
          IF EM # '' THEN
            ERRMSG=EM:' NOT SET UP FOR PRODUCT LINE ':INV.LINE
            ERR_NUM =3 ; GOTO 93000
          END ELSE
            WHSE.CNT=DCOUNT(INV.WHSE.CODE,VM)
            IF INV.COST.WT + 0 = 0 THEN INV.COST.WT = 100
            IF INV.SBR + 0 = 0 THEN INV.SBR = 1
            GOSUB GET.QTY.TYPE
            GOSUB DISPLAY.HEADING
            EOI=1
          END
        END
      END ELSE
        ERRMSG = 'CANNOT LOCATE PRODUCT LINE - ':INV.LINE
	 ERR_NUM = 4 ; GOTO 93000
      END
    END ELSE
      ERRMSG = 'PRODUCT (':PROD:') IS NOT SETUP IN ANY WAREHOUSE'
	 ERR_NUM = 5 ; GOTO 93000
    END

	WHSE.COUNT = DCOUNT(INV.WHSE.CODE,VM)
	XX = 1
   FOR X = 1 TO WHSE.COUNT 
      WHSE.ID=CONO:INV.WHSE.CODE<1,X>
      MATREAD WHSE.REC FROM WAREHOUSE,WHSE.ID THEN
        IF WHS.DIV = "" THEN WHS.DIV = GEN.DIV  
        DIV.CODE = WHS.DIV; USER.ID = UPCASE(LOGIN.NAME); ERRMSG = ''
        DV.DP.CC = WHS.DIV:GEN.DEPT:GEN.CCTR    
        CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)
        IF ERRMSG # '' THEN
          WHSE_SECURITY = "N"
        END ELSE
          WHSE_SECURITY = "Y" 
       END
	WHSE.ID.LIST<1,XX> = INV.WHSE.CODE<1,X>
	WHSE.DESC.LIST<1,XX> = INV.WHSE.CODE<1,X> : "_" : WHS.DESC
	WHSE.SECURITY.LIST<1,XX> = WHSE_SECURITY
	XX = XX + 1
      END ELSE
        *ERRMSG='RECORD FOR WAREHOUSE ':WHSE.NUM:' IS MISSING.'
        *GOSUB 93000
      END
  NEXT

*STATUS=RBO.getProperty('','WHSE_NO',WHSE.NUM)

*IWH.ID=CONO:PROD:'!':WHSE.NUM
*MATREAD IWH.REC FROM INV.WHSE,IWH.ID THEN 
*;* REMOVED MATREADU

*END ;*MATREAD IWH.REC

*INAH.PROD=PROD
*INAH.WHSE=WHSE.NUM
*ACTION=1; * build INV.WHSE fifo buckets 
*TMP.CNT='' ; LAST='' ; TMP.ARR=''
*PERIOD='' ; *include future posted receipts too.
*MAT ORG.IWH.REC=MAT IWH.REC

*Rev 12
*T27990 CALL ICS.IWH.SUB(CONO,PERIOD,TMP.ARR,TMP.CNT,LAST,ACTION,OPEN.FLAG)
*        CALL ICS_IWH_SUB(CONO,PERIOD,TMP.ARR,TMP.CNT,LAST,ACTION,OPEN.FLAG,ERRMSG)
* Rev 12

*IH.ID = CONO : PROD

*MATREAD IH.REC FROM INV.HIST, IH.ID ELSE 
;* REMOVED MATREADU
*  MAT IH.REC = ''
*END

*IF IWH.RECP.NO = '' THEN
  *ERRMSG='NO RECEIPTS LOCATED FOR ':PROD:' IN WAREHOUSE ':WHSE.NUM
  *GOSUB 91000
*END ELSE
*LINES=DCOUNT(IWH.RECP.NO,VM)

*END

    
  STATUS = RBO.setProperty('','WHSE_NUM',WHSE.ID.LIST)        
  STATUS = RBO.setProperty('','WHSE_DESC',WHSE.DESC.LIST)  
  STATUS = RBO.setProperty('','WHSE_SECURITY',WHSE.SECURITY.LIST) 
  STATUS = RBO.setProperty('','GRID_HEADING',GRID.HEADING) 
  STATUS = RBO.setProperty('','DIA_FLAG',DIA.FLAG) 
  STATUS = RBO.setProperty('','ServerStatus',ERR_NUM)        
*STATUS = RBO.setProperty('','ServerMessage',"LINES : " :  LINES : " IWH.ID:  : IWH.RECP.NO :" : IWH.RECP.NO) 

STATUS = RBO.setProperty('','ServerMessage',ERRMSG) 

**************
*FOR CLEARING ANY LOCKS
***
RELEASE 
***
*


* End of method code
RETURN

*
****************
GET.QTY.TYPE: 
****************
*
MAIN.HEAD = CL:'Ln Loc  '
H1 = "Ln"
H2 = "Loc"
H3 = "Serial Number"
H4 = ""
H5 = ""
H6 = ""
H7 = ""
REC.QTY.HEAD = 'Rec Qty ':INV.UNIT<1,2> "L#3"
ADJ.QTY.HEAD = 'New Qty ':INV.UNIT<1,2> "L#3"
DIA.FLAG=0
$INCLUDE ICSBP INV.UM.CNV
BEGIN CASE
  CASE INV.UNIT<1,2> = 'SHT' AND INV.UNIT<1,3> = 'LBS'
    H4 = REC.QTY.HEAD
    H5 = ADJ.QTY.HEAD
  CASE INV.UNIT<1,2> = 'PC' AND INV.UNIT<1,3> = 'MSI'
    H4 = REC.QTY.HEAD
    H5 = ADJ.QTY.HEAD
  CASE INV.UNIT<1,2> = 'FT' AND INV.UNIT<1,3> = 'MSI'
    H4 = REC.QTY.HEAD
    H5 = ADJ.QTY.HEAD
  CASE 1
    BEGIN CASE
      CASE INV.PAP.TYPE="ROLL" OR INV.PAP.TYPE="LROLL" OR INV.PAP.TYPE="PCOAT"
        DIA.FLAG=1
        H4 = REC.QTY.HEAD
        H5 = 'Diameter'
        H6 = ADJ.QTY.HEAD
        H7 = 'Diameter'
      CASE 1
        H4 = REC.QTY.HEAD
        H5 = ADJ.QTY.HEAD
    END CASE
END CASE
RETURN
*
****************
DISPLAY.HEADING: 
****************
*
GRID.HEADING = H1 : VM : H2

IF CATG.TRK.LVL='S' THEN
  GRID.HEADING = GRID.HEADING : VM : H3 : VM : H4 : VM : H5 : VM : H6 : VM : H7 
END ELSE
  GRID.HEADING = GRID.HEADING : VM : H4 : VM : H5 
END

RETURN
*


93000 
  STATUS = RBO.setProperty('','ServerStatus',ERR_NUM)        
  STATUS = RBO.setProperty('','ServerMessage',ERRMSG) 

99999 
RETURN


