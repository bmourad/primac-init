SUBROUTINE MISCREQMN_CHK_OWN_DIV
********************************************************************************
*   Program name :- OUTREQMN_CHK_OWN_DIV
*   Created:- 10/24/2005
*   Programmer :- Suhail Hussain S
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB DIVISION
$INCLUDE POS.CPYLIB APP.REQ

* Insert method code here

   SERVER_STATUS = 0
   SET_FOCUS = 0
   ERRMSG = ""

   OPEN "","APP.REQ" TO APP.REQ ELSE ERRMSG = "APP.REQ FILE IS MISSING";SERVER_STATUS = 1;GOTO 91000
   OPEN "","DIVISION" TO DIVISION ELSE ERRMSG = "DIVISION FILE IS MISSING";SERVER_STATUS = 1;GOTO 91000
   OPEN "","CONTROL" TO CONTROL ELSE ERRMSG = "CONTROL FILE IS MISSING";SERVER_STATUS = 1;GOTO 91000
   STATUS = RBO.getProperty("","PMCProperty",PMCProperty)
   STATUS = RBO.getProperty("","MPO_DIV_OWNER",DIV_ID)
   
   CONO = PMCProperty<1,4>
   USER.ID = PMCProperty<1,3>
   OPO.DIV.OWNER = DIV_ID
   DIV = DIV_ID
   INVALID = 0
 WRITE OPO.DIV.OWNER ON CONTROL,"MM"
   IF OPO.DIV.OWNER # "00" THEN
      MATREAD DIV.REC FROM DIVISION, CONO:OPO.DIV.OWNER ELSE
         INVALID = 1
      END
   END ELSE
      DIV = "ALL"
   END
   IF NOT(INVALID) THEN
      VALID = 1
      MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!ALL" THEN
         IF APP.PO.FLAG<1,2> = "Y" THEN
            IF APP.STATUS = "Y" THEN
               RET_VALUE = APP.NAME<1>
            END ELSE
               IF DIV # "ALL" THEN
                  MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":DIV THEN
                     IF APP.STATUS = "Y" THEN
                        RET_VALUE = APP.NAME<1>
                     END ELSE
                        
                        ERRMSG = "User profile is inactive for division ":DIV
                        GOTO 91000
                     END
                  END ELSE
                     
                     ERRMSG = "You are not allowed to enter requisitions for division ":OPO.DIV.OWNER
                        GOTO 91000
                  END
               END ELSE
                  
                  ERRMSG = "User profile is inactive for division ":DIV
                  GOTO 91000
               END
            END
         END ELSE
            
            ERRMSG = "You are not allowed to enter an Outside Requesition."
            GOTO 91000
         END
      END ELSE
         IF DIV # "ALL" THEN
            MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":DIV THEN
               IF APP.PO.FLAG<1,2> = "Y" THEN
                  IF APP.STATUS = "Y" THEN
                     RET_VALUE = APP.NAME<1>
                  END ELSE
                     
		     ERRMSG = "User profile is inactive for division ":DIV
                     GOTO 91000
                  END
               END ELSE
                 
		  ERRMSG = "You are not allowed to enter an Outside Requesition."
                  GOTO 91000
               END
            END ELSE
                
		ERRMSG = "You are not allowed to enter requisitions for division ":OPO.DIV.OWNER
                GOTO 91000
            END
         END ELSE
            
	    ERRMSG = "You are not allowed to enter requisitions for division ":OPO.DIV.OWNER
            GOTO 91000
         END
      END
   END ELSE
      
      ERRMSG = "Invalid division number used for PO owning division"
      GOTO 91000
   END
   DIV.CODE = OPO.DIV.OWNER; USER.ID = UPCASE(@LOGNAME); ERRMSG = ''
   CALL CK_DIV_SEC_SUB(CONO,DIV.CODE,USER.ID,ERRMSG)
   IF ERRMSG # '' THEN
      
      GOTO 91000
   END
RETURN

* End of method code
91000*
   STATUS = RBO.setProperty("","ServerStatus",1)
   STATUS = RBO.setProperty("","ServerMessage",ERRMSG)
   
RETURN

