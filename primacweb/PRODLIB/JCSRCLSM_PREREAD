SUBROUTINE JCSRCLSM_PREREAD
********************************************************************************
*   Program name :- JCSRCLSM_PREREAD
*   Created:- 8/19/2003
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JCS.CPYLIB JOB
$INCLUDE JCS.CPYLIB DAILY.RCLS
$INCLUDE CPYLIB CHAR
ERRMSG = ''
* Insert method code here

OPEN '','JOB' TO JOB ELSE ERRMSG='JOB FILE IS MISSING'; GOTO 93000
OPEN '','DAILY.RCLS' TO DAILY.RCLS ELSE ERRMSG='DAILY.RCLS FILE IS MISSING'; GOTO 93000


CONO = ''
JOB_DESC='' 
JOB.CODES.LIST = ''
JOB.DESCS.LIST = ''
RCS.JOB.SEQID.LIST = ''

STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
CONO   = PMCProperty<1,4>

CMD = "SSELECT JOB WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD

JOB_REC_ID = ''
LOOP
	EOF = 1
	READNEXT JOB.ID ELSE EOF = 0
	JOB_REC_ID<1,-1> = JOB.ID
WHILE EOF DO	
REPEAT

*-----------------------
FOR N = 1 TO DCOUNT(JOB_REC_ID,@VM)
	MATREAD JOB.REC FROM JOB,JOB_REC_ID<1,N> THEN 
		JOB.CODES.LIST<1,-1> = JOB_REC_ID<1,N>[4,99] : "~" : LOWER(JOB.DESC)	 : "~" :JOB.DIV : "~": JOB.DEPT :  "~" : JOB.TYPE : "~" : JOB.STATUS
		JOB.DESCS.LIST<1,-1> = JOB.DESC
	END
NEXT N
*-----------------------


CMD = "SSELECT DAILY.RCLS WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD

RCS_SEQ_ID = ''
LOOP
	EOF = 1
	READNEXT DRC.ID ELSE EOF = 0
	RCS_SEQ_ID<1,-1> = DRC.ID
WHILE EOF DO	
REPEAT
*-----------------------
FOR N = 1 TO DCOUNT(RCS_SEQ_ID,@VM)
	MATREAD DRC.REC FROM DAILY.RCLS,RCS_SEQ_ID<1,N> THEN 
		RCS.JOB.SEQID.LIST<1,-1> = RCS_SEQ_ID<1,N>[4,99] 
	END
NEXT N
*-----------------------

STATUS = RBO.setProperty('','JOB_CODES',JOB.CODES.LIST)
*STATUS = RBO.setProperty('','JOB_DESCS',JOB.DESCS.LIST)
STATUS = RBO.setProperty('','SEQID_LIST',RCS.JOB.SEQID.LIST)
RETURN
93000*
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
* End of method code
RETURN

