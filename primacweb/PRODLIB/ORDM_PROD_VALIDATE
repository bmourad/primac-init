SUBROUTINE ORDM_PROD_VALIDATE
********************************************************************************
*   Program name :- ORDM_PROD_VALIDATE
*   Created:- 12/15/2003
*------------------------------------------------------------------------------*
*
* PROGRAM : G.PURUSHOTHAM RAO
* REPROGRAMED : SYED ABDUL ALEEM.
* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE CPYLIB CHAR
$INCLUDE OPS.CPYLIB ORDER
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE OPS.CPYLIB ORDER.DETAIL
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB CATEGORY
$INCLUDE ICS.CPYLIB INV.WHSE
$INCLUDE ICS.CPYLIB INV.FNGD
$INCLUDE ICS.CPYLIB INV.CNV
$INCLUDE ICS.CPYLIB FNGD.BOM
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE PMC.CPYLIB COMP.OPS

* Insert method code here

   OPEN "","INV.FNGD" TO INV.FNGD ELSE
      ERRMSG = "Cannot locate the INV.FNGD file";GOTO 93000
   END
   OPEN "","FNGD.BOM" TO FNGD.BOM ELSE
      ERRMSG = "Cannot locate the FNGD.BOM file";GOTO 93000
   END
   OPEN "","INVENTORY" TO INVENTORY ELSE
      ERRMSG = "Cannot locate the INVENTORY file";GOTO 93000
   END
   OPEN "","FOB" TO FOB ELSE
      ERRMSG = "Cannot locate the FOB file";GOTO 93000
   END
   OPEN "","COMPANY" TO COMPANY ELSE
      ERRMSG = "Cannot locate the COMPANY file";GOTO 93000
   END
   OPEN "","ESTIMATE" TO ESTIMATE ELSE
      ERRMSG = "Cannot locate the ESTIMATE file";GOTO 93000
   END
   OPEN "","CONTROL" TO CONTROL ELSE
      ERRMSG = "Cannot locate the CONTROL file";GOTO 93000
   END
   OPEN "","ORDER" TO ORDER ELSE
      ERRMSG = "Cannot locate the ORDER file";GOTO 93000
   END
   OPEN "","CATEGORY" TO CATEGORY ELSE
      ERRMSG = "Cannot locate the CATEGORY file";GOTO 93000
   END

  STATUS = RBO.getProperty('', 'PMCProperty', PMCProperty)
  STATUS = RBO.getProperty('', 'ID', PARAMS)

  CONO = PMCProperty<1,4>
   MATREAD OPCO.REC FROM CONTROL, CONO:"OPS" ELSE
      ERRMSG = "Cannot locate Order Processing company setup"
      GOTO 93000
   END

  GEN.SHPNO = "000"
  ERRMSG = ""
  PDNO = PARAMS<1,1>
  SHPNO = PARAMS<1,2>
  ORDNO = PARAMS<1,3>

  MATREAD ORD.REC FROM ORDER, CONO:ORDNO ELSE
	MAT ORD.REC = ""
	ORD.CUST = PARAMS<1,4>
	ORD.DIV = PARAMS<1,5>
  END

* SET UP FOR KIT EXPLOSION
*
  MATREAD INV.REC FROM INVENTORY, CONO:PDNO ELSE
    ERRMSG = "Cannot locate finished goods # ":PDNO
    GOTO 93000
  END
       $INCLUDE ICSBP INV.UM.CNV

  IF INV.M.LINE # "FNGD" THEN
    ERRMSG = "This is not a Finished Goods Product. Try again !!"
    GOTO 93000
  END
*
*  IF TEMP.MF(18) = "K" THEN
*    IF VALUE # TEMP.MF(1) THEN
*      ERRMSG = "Cannot change a Kitted FNGD item to a Regular FNGD Must Delete Line"
*      GOSUB 91000;GOTO 7010
*    END
*  END
  IF INV.CUST # "" AND INV.CUST # ORD.CUST THEN
    ERRMSG = "A different customer owns this finished goods # ":PDNO
    GOTO 93000
  END
  MATREAD CATG.REC FROM CATEGORY, CONO:INV.LINE ELSE
    ERRMSG = "Cannot locate Product Line # ":INV.LINE
    GOTO 93000
  END
  WCNT = DCOUNT(INV.WHSE.CODE,VM)
  IF WCNT < 1 THEN
    ERRMSG = "Cannot locate any warehouses for finished goods # ":PDNO
    GOTO 93000
  END

  MATREAD IOF.REC FROM INV.FNGD, CONO:PDNO ELSE
    MAT IOF.REC = ""
  END
  BOM.KEY = CONO:IOF.BOM
  MATREAD BOM.REC FROM FNGD.BOM, CONO:IOF.BOM ELSE
    MAT BOM.REC = ""
  END
  IF BOM.TYPE = "K" THEN
    IF SHPNO = GEN.SHPNO THEN
      ERRMSG = "Cannot enter a Kitted FNGD item on a General Ship To"
      GOTO 93000
    END
    NUM.BOM.PROD = DCOUNT(BOM.PROD,VM)
    FOR NBP = 1 TO NUM.BOM.PROD
      PROD.KEY = CONO:BOM.PROD<1,NBP>
      READ REC FROM INVENTORY, PROD.KEY ELSE
        REC = ""
      END
      IF REC<19> # "" AND REC<19> # ORD.CUST THEN
        ERRMSG = "A different customer owns a product in this finished good: # ":PDNO
        GOTO 93000
      END
      IF ORDNO = "N" AND (OPCO.EST.BLD = "A" OR OPCO.EST.BLD = "P") THEN
        READ REC FROM INV.FNGD, PROD.KEY ELSE
          REC = ""
        END
        TEMP.EST = ""
        ECNT = DCOUNT(REC<111>,VM)
        FOR E = 1 TO ECNT WHILE TEMP.EST = ""
          MATREAD EST.REC FROM ESTIMATE, CONO:REC<111,E> THEN
            IF EST.DIV[1,2] = ORD.DIV THEN TEMP.EST = REC<111,E>
          END
        NEXT E
        IF TEMP.EST = "" THEN
          ERRMSG = "Cannot create estimate - No template defined for Div ":ORD.DIV:" / Prod ":BOM.PROD<1,NBP>
          *GOTO 93000
        END
      END
    NEXT NBP
  END ELSE
    IF ORDNO = "N" AND (OPCO.EST.BLD = "A" OR OPCO.EST.BLD = "P") THEN
      TEMP.EST = ""
      ECNT = DCOUNT(IOF.ESTIMATE,VM)
      FOR E = 1 TO ECNT WHILE TEMP.EST = ""
        MATREAD EST.REC FROM ESTIMATE, CONO:IOF.ESTIMATE<1,E> THEN
          IF EST.DIV[1,2] = ORD.DIV THEN TEMP.EST = IOF.ESTIMATE<1,E>
        END
      NEXT E
      IF TEMP.EST = "" THEN
        ERRMSG = "Cannot create estimate - No template defined for Div ":ORD.DIV:" / Prod ":PDNO
        *GOTO 93000
      END
    END
  END

   REMOTE_OUTPUT = INV.FULL.DESC : VM : INV.UNIT<1,3> : VM : INV.WHSE.CODE<1,1> : VM : ICR.DV1 : VM : ICR.DV2 : VM : ICR.MT1 : VM : ICR.MT2 : VM : ICR.CNV1 : VM : ICR.CNV
   STATUS = RBO.setProperty('', 'ServerStatus', '0')
   STATUS = RBO.setProperty('', 'ServerMessage', ERRMSG)
   STATUS = RBO.setProperty('', 'REMOTE_OUTPUT', REMOTE_OUTPUT)

   
* End of method code
RETURN
93000*
   STATUS = RBO.setProperty('', 'ServerStatus', '1')
   STATUS = RBO.setProperty('', 'ServerMessage', ERRMSG)



