SUBROUTINE APVOUM_PoValidate
********************************************************************************
*   Program name :- APVOUM_PoValidate
*   Created:- 8/30/2003
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE CPYLIB CHAR
$INCLUDE PMC.CPYLIB PO
$INCLUDE POS.CPYLIB OUTSIDE.PO
$INCLUDE POS.CPYLIB MISC.PO
$INCLUDE PMC.CPYLIB VEND
$INCLUDE PMC.CPYLIB COMPANY
   DIM SVEND.REC(50)
   EQU SVEND.DESC TO SVEND.REC(1)
   EQU SVEND.ADDR1 TO SVEND.REC(2)
   EQU SVEND.CT.ST TO SVEND.REC(4)
   EQU SVEND.ZIP TO SVEND.REC(5)
   EQU SVEND.TERMS TO SVEND.REC(6)

* Insert method code here
 ERRMSG = ""
    OPEN '','PO' TO PO ELSE ERRMSG = 'PO FILE IS MISSING';GOTO 1000
    OPEN '','MISC.PO' TO MISC.PO ELSE ERRMSG = 'MISC.PO FILE IS MISSING';GOTO 1000
    OPEN '','OUTSIDE.PO' TO OUTSIDE.PO ELSE ERRMSG = 'OUTSIDE.PO FILE IS MISSING';GOTO 1000
    OPEN '','VEND' TO VEND ELSE ERRMSG = 'VEND FILE MISSING';GOTO 1000
    OPEN '','COMPANY' TO COMPANY ELSE ERRMSG = 'COMPANY FILE MISSING';GOTO 1000
    
    STATUS        = RBO.getProperty('','ID',ID)	
    CONO          = ID[1,3]
    TVO.PO 	    = FIELD(ID,'!',1)[4,99]
    TVO.PO.TYPE   = FIELD(ID,'!',2)
    TVO.DIV.OWNER = FIELD(ID,'!',3)
    TVO.PO.DETAIL = "Y"  
    MATREAD COMP.REC FROM COMPANY,CONO ELSE ERRMSG = 'COMPANY NOT ON FILE '; GOTO 1000
   FPO = 0
   BEGIN CASE
*     CASE TVO.PO.TYPE = "R"
      CASE TVO.PO.TYPE = "R" AND CO.POS = "Y"
         MATREAD PO.REC FROM PO,CONO:TVO.PO THEN
            IF PO.DIV.OWNER # TVO.DIV.OWNER AND TVO.DIV.OWNER # "00" THEN
               ERRMSG = "PO and Voucher must have the same Owning Division"
               GOTO 1000
            END ELSE TVO.VEND = PO.VEND.NO
         END ELSE FPO = 1
*     CASE TVO.PO.TYPE = "O"
      CASE TVO.PO.TYPE = "O" AND CO.POS = "Y"
         MATREAD OPO.REC FROM OUTSIDE.PO,CONO:TVO.PO THEN
            IF OPO.DIV.OWNER # TVO.DIV.OWNER AND TVO.DIV.OWNER # "00" THEN
               ERRMSG = "PO and Voucher must have the same Owning Division"
               GOTO 1000
            END ELSE TVO.VEND = OPO.VEND.NO
         END ELSE FPO = 1
*     CASE TVO.PO.TYPE = "M"
      CASE TVO.PO.TYPE = "M" AND CO.POS = "Y"
         MATREAD MPO.REC FROM MISC.PO,CONO:TVO.PO THEN
            IF MPO.DIV.OWNER # TVO.DIV.OWNER AND TVO.DIV.OWNER # "00" THEN
               ERRMSG = "PO and Voucher must have the same Owning Division"
               GOTO 1000
            END ELSE TVO.VEND = MPO.VEND.NO
         END ELSE FPO = 1
      CASE TVO.PO.TYPE = "N"
         TVO.PO.DETAIL = ""
   END CASE
   BEGIN CASE
      CASE TVO.PO.TYPE = "R"
         IF CO.APS.R.INTRF < 1 THEN TVO.PO.DETAIL = ""
      CASE TVO.PO.TYPE = "O"
         IF CO.APS.O.INTRF < 1 THEN TVO.PO.DETAIL = ""
      CASE TVO.PO.TYPE = "M"
         IF CO.APS.M.INTRF < 1 THEN TVO.PO.DETAIL = ""
   END CASE
   IF TVO.PO.DETAIL # "Y" THEN
      TVO.PO.DETAIL = "N"
   END
   STATUS=RBO.setProperty('','TVO_PO_DETAIL',TVO.PO.DETAIL)
   IF FPO THEN
      ERRMSG ='This PO is not setup.  Ok to use?  (OK/CANCEL)'
	GOTO 1000
   END ELSE
      MATREAD VEND.REC FROM VEND,CONO:TVO.VEND THEN
		STATUS=RBO.setProperty('','TVO_VEND',TVO.VEND)
		STATUS=RBO.setProperty('','VEND_DESC',VEND.DESC)
		STATUS=RBO.setProperty('','VEND_ADDR1',VEND.ADDR1)
		STATUS=RBO.setProperty('','VEND_CT_ST',VEND.CT.ST)
		STATUS=RBO.setProperty('','VEND_ZIP',VEND.ZIP)
		STATUS=RBO.setProperty('','TERMS_PER',OCONV(VEND.TERMS<1,1>[1,4],"MD2"))
		STATUS=RBO.setProperty('','TERMS_DAYS',VEND.TERMS<1,1>[5,2])
		STATUS=RBO.setProperty('','TERMS_NET',VEND.TERMS<1,2>)
		STATUS=RBO.setProperty('','VendAutoDist',VEND.AUTO.DIST);* added for VEND_AUTO_DIST

		IF TVO.VEND<1,1>[6,1] = "-" THEN 
			GOTO 1200
		END ELSE
		 	GOTO 1000
		END                  
      END ELSE
         ERRMSG = TVO.VEND:" Is Not On File"
         GOTO 1000
      END
   END

1200*
   MATREAD SVEND.REC FROM VEND , CONO:TVO.VEND<1,1>[1,5] ELSE
      MAT SVEND.REC = ""
      SVEND.DESC = "??????????????"
   END
   STATUS=RBO.setProperty('','SVEND_ID',TVO.VEND<1,1>[1,5])
   STATUS=RBO.setProperty('','SVEND_DESC',SVEND.DESC)
   STATUS=RBO.setProperty('','SVEND_ADDR1',SVEND.ADDR1)
   STATUS=RBO.setProperty('','SVEND_CT_ST_ZIP',SVEND.CT.ST[1,19]:" ":SVEND.ZIP)   
1000*
    
    IF ERRMSG # "" THEN
	STATUS = RBO.setProperty('','ServerStatus',1)        
	STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
    END
* End of method code
RETURN

