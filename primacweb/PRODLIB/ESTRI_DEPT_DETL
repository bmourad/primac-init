SUBROUTINE ESTRI_DEPT_DETL
********************************************************************************
*   Program name :- ESTRI_DEPT_DETL
*   Created:- 05/05/2005 RAZI MOHIUDDIN
*------------------------------------------------------------------------------*
*THIS METHOD FETCHES FOR THE DEPT TAB
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB DIVISION
$INCLUDE PMC.CPYLIB DEPARTMENT
$INCLUDE PMC.CPYLIB COST.CNTR
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE JES.CPYLIB ESTIMATE.RES
$INCLUDE JES.CPYLIB ESTIMATE.DIV
$INCLUDE JES.CPYLIB ESTIMATE.DEPT
$INCLUDE CPYLIB FILE.VARS
$INCLUDE JES.CPYLIB JES.FILE.VARS
$INCLUDE CPYLIB CHAR

STATUS = RBO.getProperty('','ID',ID)
CONO=ID[1,3]
EST.KEY=ID[4,99]

  OPEN "","ESTIMATE" TO ESTIMATE ELSE
      ERRMSG = "CANNOT LOCATE ESTIMATE FILE"
      RETURN
   END

  OPEN "","ESTIMATE.RES" TO ESTIMATE.RES ELSE
      ERRMSG = "CANNOT LOCATE ESTIMATE.RES FILE"
      RETURN
   END

   OPEN "","COST.CNTR" TO COST.CNTR ELSE
      ERRMSG = "CANNOT LOCATE COST.CNTR FILE"
      RETURN
   END

QTY.CNT =""
STRVAL =""
PROD_OS_DESC =""
STR_ACT_WIDTH =""
* Insert method code here
   MATREAD EST.REC FROM ESTIMATE,CONO:EST.KEY THEN
           STRVAL<1,-1> = EST.DIV
	    *STRVAL = STRVAL : "!" : EST.KEY
 	    *STRVAL = STRVAL : "!" : EST.CUST.NAME
	    *STRVAL = STRVAL : "!" : EST.COMMENTS<1,1>  
	    STRVAL = STRVAL : "!" : EST.DEPT
	    STRVAL = STRVAL : "!" : EST.DEPT.DESC
	    STRVAL = STRVAL : "!" : EST.COMP.FLAG
	    PROD_OS_DESC = EST.PROD.OS.DESC
      	    QTY.CNT = DCOUNT(EST.QTY,VM)
  END ELSE
  END

STRVAL = STRVAL : "!"
MATREAD EST.RL.REC FROM ESTIMATE.RES,ID THEN
    FOR X = 1 TO QTY.CNT
    STRVAL<1,-1>=INT(FIELD(EST.RL.TOTAL.PC<1,1,1>,"!",X)/12+.5)
    NEXT X
STRVAL = STRVAL : "!"

*STR_ACT_WIDTH = OCONV(EST.RL.ACT.WIDTH,'MD4')
FOR I = 1 TO DCOUNT(EST.RL.ACT.WIDTH,SVM)
    STR_ACT_WIDTH<1,1,I> = OCONV(EST.RL.ACT.WIDTH<1,1,I>,'MD4')
NEXT


READV CCTR.DESC FROM COST.CNTR,CONO:EST.RL.PRESS.CCTR<1,1,1>,1 ELSE CCTR.DESC = ""
   STRVAL<1,-1> = EST.RL.PRESS.CCTR<1,1,1>
   STRVAL<1,-1> = CCTR.DESC

END ELSE

END

STATUS = RBO.setProperty('','CopyDeptInfo',STRVAL : "!" : PROD_OS_DESC : "!" : STR_ACT_WIDTH)

RETURN
