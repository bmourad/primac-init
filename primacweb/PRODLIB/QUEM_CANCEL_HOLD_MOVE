SUBROUTINE QUEM_CANCEL_HOLD_MOVE
********************************************************************************
*   Program name :- QUEM_CANCEL_HOLD_MOVE
*   Created:- 5/29/2006
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE CPYLIB CHAR
* Insert method code here


NEWQ = ""
ERRMSG = ""

STATUS = RBO.getProperty('', 'ACTION', ACTION)
STATUS = RBO.getProperty('', 'JOBID', QID)
STATUS = RBO.getProperty('', 'ID', CURR.QUEUE)

STATUS = RBO.getProperty('', 'JOB_LIST', JOB.LIST)
STATUS = RBO.getProperty('', 'FILE_LIST', FILE.LIST)
STATUS = RBO.getProperty('', 'OWN_LIST', OWN.LIST)
STATUS = RBO.getProperty('', 'NEWQUEUE', NEWQ)
STATUS = RBO.getProperty('','PMCProperty',PMCProperty)

* QID = ECD.RET.VALUE
  JOBNO = TRIM(JOB.LIST<1,QID>)
  FILNM = TRIM(FILE.LIST<1,QID>)
  OWNR = TRIM(OWN.LIST<1,QID>)
  BEGIN CASE
     CASE ACTION = 'CANCEL'
      GOSUB 15000
     CASE ACTION = 'HOLD'
      GOSUB 16000
     CASE ACTION = 'MOVE'
      GOSUB 17000
     CASE 1
      GOTO 93000
  END CASE

93000
     STATUS = RBO.setProperty('', 'ServerMessage', ERRMSG)
RETURN

15000 *
*  USR = @LOGNAME
  USR = PMCProperty<1,3>
  IF USR # OWNR THEN
    ERRMSG = 'Cannot Cancel, Not Your Job'
    GOTO 93000
  END
  CMD = '!cancel ':JOBNO
  HUSH ON
  UDTEXECUTE CMD CAPTURING JUNK
  HUSH OFF
  DEL JOB.LIST<1,QID>; DEL FILE.LIST<1,QID>; DEL OWN.LIST<1,QID>
  RETURN
*
16000 *
*  USR = @LOGNAME
  USR = PMCProperty<1,3>
  IF USR # OWNR THEN
    ERRMSG = 'Cannot Hold, Not Your Job'
    GOTO 93000
  END
  GOSUB 18000
  CMD = '!cp ':QDIRNAME:' /tmp/':USR:DATE():TIME()
  HUSH ON
  UDTEXECUTE CMD CAPTURING JUNK
  HUSH OFF
  ERRMSG = 'Your Hold File Is /tmp/':USR:DATE():TIME()  
  RETURN
*
17000 *
*  USR = @LOGNAME
  USR = PMCProperty<1,3>
  IF USR # OWNR THEN
    ERRMSG = 'Cannot Move, Not Your Job'
    GOTO 93000
    RETURN
  END
  GOSUB 18000
* GOSUB 19000
* IF NEWQ = 'END' THEN GO 17000
  CMD = '!cp ':QDIRNAME:' /tmp/':USR
  HUSH ON
  UDTEXECUTE CMD CAPTURING JUNK
  CMD = '!lpr -P':NEWQ:' /tmp/':USR
  UDTEXECUTE CMD CAPTURING JUNK
  HUSH OFF
  DEL JOB.LIST<1,QID>; DEL FILE.LIST<1,QID>; DEL OWN.LIST<1,QID>
  RETURN
*
18000 ; * Locate The qdaemon file
  ZZZ=DCOUNT(JOB.LIST,VM)
  JCTR = 0
  FOR YYY = 1 TO ZZZ
    IF TRIM(JOB.LIST<1,YYY>) = JOBNO THEN
      JCTR += 1
      GOTO 18100
    END ELSE
      IF OWNR = TRIM(OWN.LIST<1,YYY>) THEN
        JCTR += 1
      END
    END
  NEXT YYY
18100 *
  SPVAR=('00':JCTR)'R#2'
  QFNAME = '/var/spool/lpd/qdir/':SPVAR:OWNR:':':CURR.QUEUE
  OSREAD UNIXFILE FROM QFNAME ELSE
    ERRMSG = 'Cant Find Unix Queue File'
    GOTO 93000
  END
  QDIRNAME = ''
  FOR MM = 1 TO MM + 1
    UNIXREC=FIELD(UNIXFILE,CHAR(010),MM)
    IF UNIXREC = '' THEN GO 18200
    IF UNIXREC[1,4]='/var' THEN
      QDIRNAME = FIELD(UNIXREC,' ',1)
      GOTO 18200
    END
  NEXT MM
18200 *
  IF QDIRNAME = '' THEN
    ERRMSG = 'Cant Find Unix Queue File'
    GOTO 93000
  END
  RETURN





