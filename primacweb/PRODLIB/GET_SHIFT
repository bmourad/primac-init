SUBROUTINE GET_SHIFT
********************************************************************************
*   Program name :- GET_SHIFT
*   Created:- 2/1/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE OPS.CPYLIB ORDER
$INCLUDE OPS.CPYLIB ORDER.DETAIL
$INCLUDE CPYLIB CHAR
OPEN '',"ORDER" TO ORDER ELSE
	ERRMSG="CAN NOT OPEN ORDER FILE"
	GOTO 91000
END
OPEN '',"ORDER.DETAIL" TO ORDER.DETAIL ELSE
	ERRMSG="CAN NOT OPEN ORDER.DETAIL FILE"
	GOTO 91000
END


* Insert method code here
STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
STATUS=RBO.getProperty('','BOL_SHIP_TO',SHPNO)
STATUS=RBO.getProperty('','BOL_ORDNO',ORDNO)
*STATUS=RBO.getProperty('','',)
CONO=PMCProperty<1,4>

   MATREADU ORD.REC FROM ORDER, CONO:ORDNO ELSE
      RELEASE ORDER, CONO:ORDNO
      ERRMSG = "Cannot locate Order # ":ORDNO
      GOTO 91000
   END

   IF LEN(SHPNO) < 3 THEN
       SHPNO = SHPNO "R%3"
   END
   LOCATE SHPNO IN ORD.SHIP.TO<1>,2 SETTING FND ELSE
       ERRMSG = "Cannot locate Ship To (":SHPNO:") for Order # ":ORDNO
       GOTO 91000
   END

	
   MATREAD ORD.DET.REC FROM ORDER.DETAIL, CONO:ORDNO:"!":SHPNO ELSE
      ERRMSG = "Cannot locate Order / Ship to # ":ORDNO:" / ":SHPNO
      GOTO 91000
   END
   PCNT = DCOUNT(OSD.PROD,VM)
   PDPTR = ""; QTYPTR = ""
   PRODPTR = ""
   FOR PNO = 1 TO PCNT
      RCNT = DCOUNT(OSD.FI.QTY<1,PNO>,SVM)
      FOR RNO = 1 TO RCNT
         IF OSD.KIT<1,PNO> # "N" THEN
            IF OSD.KIT<1,PNO> = "K" THEN
               IF OSD.FI.QTY<1,PNO,RNO> > 0 THEN
                  LOCATE PNO IN PDPTR,1 SETTING PLOC ELSE
                     PDPTR<PLOC> = PNO
                  END
                  QTYPTR<PLOC,-1> = RNO
               END ELSE
                  LOCATE PNO IN PDPTR,1 SETTING PLOC ELSE
                     PDPTR<PLOC> = PNO
                  END
                  QTYPTR<PLOC,-1> = RNO + 1
               END
            END ELSE
               IF OSD.FI.QTY<1,PNO,RNO> > 0 THEN
                  LOCATE PNO IN PDPTR,1 SETTING PLOC ELSE
                     PDPTR<PLOC> = PNO
                  END
                  QTYPTR<PLOC,-1> = RNO
               END
            END
         END ELSE
            IF OSD.FI.QTY<1,PNO,RNO> > 0 THEN
               LOCATE PNO IN PDPTR,1 SETTING PLOC ELSE
                  PDPTR<PLOC> = PNO
               END
               QTYPTR<PLOC,-1> = RNO
            END
         END
      NEXT RNO
   NEXT PNO
   PDCNT = DCOUNT(PDPTR,AM)
   IF PDCNT < 1 THEN
      ERRMSG = "Cannot locate any available quantity for this Order/Ship to ":ORDNO:" / ":SHPNO
	GOTO 91000
   END

* End of method code
RETURN
91000 *
   STATUS = RBO.setProperty('','ServerStatus',1)        
   STATUS = RBO.setProperty('','ServerMessage',ERRMSG) 
RETURN


