SUBROUTINE IVCM_PREREAD
********************************************************************************
*   Program name :- IVCM_PREREAD
*   Created:- 8/27/2003
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE CPYLIB CHAR
$INCLUDE JCS.CPYLIB JOB
*$INCLUDE JCS.CPYLIB INVOICE
$INCLUDE PMC.CPYLIB COMPANY

ERRMSG1 = RBO.getProperty('','PMCProperty',PMCProperty)
CONO = PMCProperty<1,4>

* Insert method code here

  OPEN "","JOB" TO JOB ELSE
   ERRMSG = "CANNOT OPEN JOB.REC FILE"
	GOTO 1000
  END

  OPEN "","COMPANY" TO COMPANY ELSE
   ERRMSG = "CANNOT OPEN COMP.REC FILE"
	GOTO 1000
  END

JOB.LIST = ''

*CMD = "SSELECT JOB WITH CONO = '" : CONO : "'"
CMD = "SSELECT JOB WITH @ID LIKE '" : CONO : "...'"
UDTEXECUTE CMD

JOB_REC_ID = ''
LOOP
	EOF = 1
	READNEXT ID ELSE EOF = 0
WHILE EOF DO	
	JOB_REC_ID<1,-1> = ID
REPEAT

*STATUS = RBO.setProperty('', 'ServerMessage', DCOUNT(JOB_REC_ID,VM))
*RETURN


FOR N = 1 TO DCOUNT(JOB_REC_ID,VM)
	MATREAD JOB.REC FROM JOB,JOB_REC_ID<1,N> THEN 
		JOB.LIST<1,-1> = JOB_REC_ID<1,N>[4,99] : "~" : JOB.STATUS
	END
NEXT N

MATREAD COMP.REC FROM COMPANY, CONO ELSE
    ERRMSG = "Cannot locate Company record - ":CONO
    GOTO 1000
END

	STATUS=RBO.setProperty('','JobDataList',JOB.LIST)
	STATUS=RBO.setProperty('','COMP_SAS_INVOICE',CO.SAS.INVOICE)
	STATUS = RBO.setProperty('','COMP_SAS',CO.SAS)
	STATUS = RBO.setProperty('','INV_REV_ALLOC_FLG',CO.ALLOC.FLG)

RETURN

1000*

      STATUS = RBO.setProperty('', 'ServerStatus', 1)
      STATUS = RBO.setProperty('', 'ServerMessage', ERRMSG)
* End of method code
RETURN

