SUBROUTINE PRODUCTION_JOB_DELETE
********************************************************************************
*   Program name :- PRODUCTION_JOB_DELETE
*   Created:- 3/7/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE JCS.CPYLIB JOB

REF.NO = ""
ERRMSG=''
OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = "CONTROL FILE IS MISSING"; GOTO 93000
OPEN '','JOB' TO JOB ELSE ERRMSG = "JOB FILE IS MISSING"; GOTO 93000

STATUS = RBO.getProperty('','ID',ID)
STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
CONO = PMCProperty<1,4>
USER.ID = UPCASE(PMCProperty<1,3>)
  READ DIV.SEC.REC FROM CONTROL, CONO:"DIV.SECURITY" ELSE
    DIV.SEC.REC='N'
    DIV.SEC.REC<2>='N'
  END
READ JC.REC FROM CONTROL, CONO:"JCFISCAL" ELSE
   JC.REC = ""
END
READ TEMP.REC FROM CONTROL, CONO:"DIVISIONS" ELSE
   TEMP.REC = ""
END
NCTR = 1

NCNT = DCOUNT(ID,@VM)
FOR I = 1 TO NCNT
        IF DIV.SEC.REC<2> = 'Y' THEN
           LOCATE ID<1,I> IN TEMP.REC<1>,1 SETTING POS ELSE POS = 1
         END ELSE POS = 1
         NYR=JC.REC<1,POS>[1,4]+1
         NYR=NYR[3,2]
         XJBKEY = CONO:"X":NYR:"01":ID<1,I>:"1"
         READ JREC FROM JOB, XJBKEY THEN
            ERRMSG<1,NCTR>='XJOBS already created for Div ':ID<1,I>:' - Cannot Delete'
	     NCTR = NCTR + 1
         END
NEXT
IF ERRMSG NE "" THEN GOSUB 93000
RETURN

93000 *
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN

