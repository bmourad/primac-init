SUBROUTINE VALIDATE_PNCN
********************************************************************************
*   Program name :- VALIDATE_PNCN
*   Created:- 5/16/2007
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE ARS.CPYLIB MANUAL.INVOICE
$INCLUDE JCS.CPYLIB DAILY.INVOICE
$INCLUDE CPYLIB CHAR

* Insert method code here
     ERRMSG=""
     OPEN "","CONTROL" TO CONTROL ELSE ERRMSG="ERROR IN OPENING CONTROL FILE" ; GOTO 9300
     OPEN "","DAILY.MANUAL.INVOICE" TO DAILY.MANUAL.INVOICE ELSE
         ERRMSG="DAILY.MANUAL.INVOICE FILE MISSING";GOTO 9300
     END
     OPEN "","DAILY.INVOICE" TO DAILY.INVOICE ELSE
         ERRMSG="INVOICE FILE MISSING"; GOTO 9300
     END
*    STATUS = RBO.getProperty('','ID',MODULE)
     * v
TSTSTR=""
     STATUS = RBO.getProperty('','ID',ID)
TSTSTR<1>="ID ":ID ; WRITE TSTSTR ON CONTROL,"1906"
     MODULE = FIELD(ID,"!",1)
     ANSWER = FIELD(ID,"!",2)
     * ^
     IF MODULE = "ARS" THEN
         GOTO 91
     END ELSE IF MODULE = "JCS" THEN
         GOTO 92
     END ELSE
         GOTO 93
     END
91*
     READ PNCN_REC FROM CONTROL,"ARS.PNCN" ELSE ERRMSG="ERROR IN READING ARS.PNCN RECORD" ; GOTO 9300

     MIV.KEY = PNCN_REC<1>
     PNCN.NUM = PNCN_REC<2>
     MV.DM.PNCN = PNCN_REC<3>
     CONO = MIV.KEY[1,3]	
     IF ANSWER = "Y" THEN
        FOR I=1 TO DCOUNT(MIV.KEY,VM)
            MATREAD MIV.REC FROM DAILY.MANUAL.INVOICE,MIV.KEY<1,I> ELSE ERRMSG ='PROBLEM IN DAILY.INVOICE FILE READING';GOTO 9300
            IF MIV.PRT.FLG<1,1> = "Y" THEN
                 WRITE PNCN.NUM ON CONTROL,CONO:"ARSNEXT.PNCN"
                 MIV.PRT.FLG<1,1> = "N"
                 MIV.PNCN = CHANGE(MV.DM.PNCN<1,I>,SM,VM)
                 MATWRITE MIV.REC ON DAILY.MANUAL.INVOICE,MIV.KEY<1,I> 
            END
        NEXT I 
     END

RETURN
92*
     READ PNCN_REC FROM CONTROL,"JCS.PNCN" ELSE ERRMSG="ERROR IN READING JCS.PNCN RECORD" ; GOTO 9300
TSTSTR<-1>="PNCN_REC ":PNCN_REC ; WRITE TSTSTR ON CONTROL,"1906"

     DI.KEY = PNCN_REC<1>
     PNCN.NUM = PNCN_REC<2>
     MV.DI.PNCN = PNCN_REC<3>
     CONO = DI.KEY[1,3]	
     IF ANSWER = "Y" THEN
        FOR I=1 TO DCOUNT(DI.KEY,VM)
            MATREAD DI.REC FROM DAILY.INVOICE,DI.KEY<1,I> ELSE ERRMSG ='PROBLEM IN DAILY.INVOICE FILE READING';GOTO 9300
            IF DI.PRT.FLG<1,1> = "Y" THEN
                WRITE PNCN.NUM ON CONTROL,CONO:"JCSNEXT.PNCN"
                DI.PRT.FLG<1,1> = "N"
                 DI.PNCN = CHANGE(MV.DI.PNCN<1,I>,SM,VM)
                 MATWRITE DI.REC ON DAILY.INVOICE,DI.KEY<1,I> 
            END
        NEXT I 
     END
RETURN
93*
     READ PNCN_REC FROM CONTROL,"JCSCM.PNCN" ELSE ERRMSG="ERROR IN READING JCSCR.PNCN RECORD" ; GOTO 9300
     DI.KEY = PNCN_REC<1>
     PNCN.NUM = PNCN_REC<2>
     MV.DI.PNCN = PNCN_REC<3>
     CONO = DI.KEY[1,3]	 
     IF ANSWER = "Y" THEN
        FOR I=1 TO DCOUNT(DI.KEY,VM)
            MATREAD DI.REC FROM DAILY.INVOICE,DI.KEY<1,I> ELSE ERRMSG ='PROBLEM IN DAILY.INVOICE FILE READING';GOTO 9300
            IF DI.PRT.FLG<1,1> = "Y" THEN
                 WRITE PNCN.NUM ON CONTROL,CONO:"JCSNEXTCM.PNCN"
                 DI.PRT.FLG<1,1> = "N"
                 DI.PNCN = CHANGE(MV.DI.PNCN<1,I>,SM,VM)
                 MATWRITE DI.REC ON DAILY.INVOICE,DI.KEY<1,I> 
            END
        NEXT I 
     END 
RETURN

9300

RETURN


