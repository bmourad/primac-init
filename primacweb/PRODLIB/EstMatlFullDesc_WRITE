  SUBROUTINE EstMatlFullDesc_WRITE
**************************************************************************
* REVISION    - [12.0]
*
* SYSTEM      - PRIMAC
*
* PROGRAM     - EstMatlFullDesc_WRITE
*
* BY          - ALEJANDRO DELGADO
*
* DATE        - 11/06/2002
*
* DESCRIPTION - This program build ESTIMATE.MATL records, with the correct
*               Full Description.
**************************************************************************
  $INCLUDE WWINSERT RBO.H
  $INCLUDE JES.CPYLIB ESTIMATE.MATL
  $INCLUDE CPYLIB CHAR
*
*---- OPEN FILES
*
  IF FILEINFO(ESTIMATE.MATL,0) = 0 THEN
    OPEN 'ESTIMATE.MATL' TO ESTIMATE.MATL ELSE
      ERRMSG = 'CANNOT OPEN ESTIMATE.MATL FILE'
      GOTO 93000
    END
    OPEN 'CONTROL' TO CONTROL ELSE
      ERRMSG = 'CANNOT OPEN CONTROL FILE'
      GOTO 93000
    END
  END
*
*---- MAIN PROCESS
*
  ERRMSG = RBO.getProperty('','ID',MATL.ID)
  ERRMSG = RBO.getProperty('','PMCProperty',PMCProperty)
  CONO = MATL.ID[1,3]
  MATREADU ESTM.REC FROM ESTIMATE.MATL,MATL.ID LOCKED
    ERRMSG = 'ESTIMATE.MATL record is locked by user - ':GETUSERNAME(STATUS())
    GOTO 93000
  END ELSE
    RETURN
  END
  IF PMCProperty<1,1> = "ESTSPM" OR PMCProperty<1,1> = "ESTCMMM" THEN
    TYPE = "S" 
  END ELSE
    TYPE = "R"
  END
  CNT = DCOUNT(ESTM.PROD<1>, VM)
  FOR X = 1 TO CNT
    CALL EST.MATL.FULL.DESC.SUB(MAT ESTM.REC,CONTROL,X,TYPE)
  NEXT X
  MATWRITE ESTM.REC TO ESTIMATE.MATL, MATL.ID
  RETURN
93000 *
  STATUS = RBO.setProperty('','ServerStatus',1)
  STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
  RETURN
END
