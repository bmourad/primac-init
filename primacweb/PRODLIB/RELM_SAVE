SUBROUTINE RELM_SAVE
********************************************************************************
*   Program name :- RELM_SAVE
*   Created:- 8/3/2004
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  ORDNO,SHPNO
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

$INCLUDE CPYLIB COMMON1
$INCLUDE JCS.CPYLIB COM.JCS.LINK  
$INCLUDE ICS.CPYLIB COM.INV.MAIN  
$INCLUDE ICS.CPYLIB COM.INV.SERIAL
$INCLUDE JCS.CPYLIB COM.INV.STATS 
$INCLUDE PMC.CPYLIB COM.CUST
$INCLUDE OPS.CPYLIB COM.ORDER     
$INCLUDE ICS.CPYLIB COM.INV.CNV   
$INCLUDE OPS.CPYLIB COM.OPS.LINK   

$INCLUDE OPS.CPYLIB ORDER.DETAIL


OPEN "","ORDER.DETAIL" TO ORDER.DETAIL ELSE
     ERRMSG = "Cannot locate the ORDER.DETAIL file";GOTO 93000
END

STATUS = RBO.getProperty('', 'PMCProperty', PMCProperty)
CONO  = PMCProperty<1,4>
STATUS = RBO.getProperty('','REL_ORDNO',ORDNO)
STATUS = RBO.getProperty('','REL_SHPNO',SHPNO)
* POSITION OF THE SHIP TO IN ORDER.SHIP.TO FIELD IN FILE ORDDER ,this can be get from ship to field in asp page
STATUS = RBO.getProperty('','LN_JOB_GRID',SPTR) 

MAT ORD.DET.REC = ''
       *IF RELNO = "N" THEN
       *   RELKEY = ""
       *   RELNO = 0
       *   LOOP
       *     FND = 1
       *     RELNO = RELNO + 1
       *     IF RELNO > 99 THEN RELNO = 1
       *     RELKEY = ORR.ORD:"-":STR('0',2-LEN(RELNO)):RELNO
       *     READU O.RECORD FROM ORDER.RELEASE, CONO:RELKEY ELSE FND = 0
       *   WHILE FND DO
       *     RELEASE ORDER.RELEASE, CONO:RELKEY
       *   REPEAT
       *   RELNO = RELKEY
       *   ERRMSG = "Please Note Assigned Release Number : ":RELNO
       *   GOSUB 91000
       *   FOR PLN = 1 TO LINES
       *     LOOP
       *       LOCATE "N" IN OSD.REL.NO<1,PLN>,1 SETTING RLOC ELSE RLOC = 0
       *     WHILE RLOC DO
       *       OSD.REL.NO<1,PLN,RLOC> = RELNO
       *     REPEAT
       *   NEXT PLN
       * END
       *LOCATE RELNO IN ORD.REL.NO<1>,1 SETTING FND ELSE
       *   ORD.REL.NO<1,FND> = RELNO
       *END
	OSD.ID = CONO:ORDNO:"!":SHPNO
	MATREAD ORD.DET.REC FROM ORDER.DETAIL, OSD.ID ELSE
    		MAT ORD.DET.REC=""
  	END
       FOR P = 1 TO ORD.DET.REC.SIZE
           ORD.DET.SUM(P,SPTR) = ORD.DET.REC(P)
       NEXT P

	 *STATUS = "L"; TEMPSHPNO = "ALL"	 
	 *CALL ORDER.LINE.UPD(CONO,ORDNO,TEMPSHPNO,STATUS)
	 *STATUS = "D"
        *CALL ORDER.LINE.UPD(CONO,ORDNO,SHPNO,STATUS)

        STATUS = "L"
        CALL ORDER_LINE_UPD(CONO,ORDNO,SHPNO,STATUS)
        STATUS = "U"; SHPNO = ""
        CALL ORDER_LINE_UPD(CONO,ORDNO,SHPNO,STATUS)
	 RETURN

        *MATWRITE ORR.REC ON ORDER.RELEASE, CONO:RELNO
        *MATREAD OPCO.REC FROM CONTROL, CONO:"OPS" ELSE
        *  MAT OPCO.REC = ""
        *END


	*ORD. = ORDER
       *IF ORD.PRINT # "N" AND OPCO.SHP.FRM # "O" THEN
       *   SHPWHS = ""
       *   FOR P = 1 TO LINES
       *     R = 1
       *     PICK.QTY = 0
       *     LOOP
       *       LOCATE RELNO IN OSD.REL.NO<1,P>,R SETTING RLOC ELSE RLOC = 0
       *     WHILE RLOC DO
       *       PICK.QTY = PICK.QTY + (OSD.REL.QTY<1,P,RLOC> - OSD.P.QTY<1,P,RLOC>)
       *       R = RLOC + 1
       *     REPEAT
       *     IF PICK.QTY > 0 THEN
       *       SHPWH = ORR.SHIP.TO:"!":OSD.WHSE<1,P>
       *       LOCATE SHPWH IN SHPWHS,1 SETTING FND ELSE
       *         PKT.ID = CONO:ORDNO:"!":SHPWH
       *         READ REC FROM PICK.TICKET.PRT, PKT.ID THEN
       *           LOCATE RELNO IN REC,1 SETTING PTR ELSE SHPWHS<FND> = SHPWH
       *         END ELSE
       *           SHPWHS<FND> = SHPWH
       *         END
       *       END
       *     END
       *   NEXT P
       *   SHPWHSCNT = DCOUNT(SHPWHS,AM)
       *   IF SHPWHSCNT THEN
       *     ECD.NUM = 45
       *     ECD.ACTION = 4; CALL SCRN.EDIT
       *     IF ECD.RET.VALUE = "Y" THEN
       *       FOR T = 1 TO SHPWHSCNT
       *         SHPWH = SHPWHS<T>
       *         PKT.ID = CONO:ORDNO:"!":SHPWH
       *         READU REC FROM PICK.TICKET.PRT, PKT.ID THEN
       *           LOCATE RELNO IN REC,1 SETTING PTR ELSE REC<PTR> = RELNO
       *         END ELSE
       *           REC = RELNO
       *         END
       *         WRITE REC ON PICK.TICKET.PRT, PKT.ID
       *       NEXT T
       *     END
       *   END
       * END

       * IF ORDNUM # "" THEN
       *   FOR P = 1 TO ORD.DET.REC.SIZE
       *     ORD.DET.SUM(P,SPTR) = ORD.DET.REC(P)
       *   NEXT P
       *   STATUS = "L"; SHPNO = "ALL"	
       *   CALL ORDER.LINE.UPD(CONO,ORDNO,SHPNO,STATUS)
       *   MORE = 0
       * END

93000 *
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN
