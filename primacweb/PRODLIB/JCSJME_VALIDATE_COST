SUBROUTINE JCSJME_VALIDATE_COST
********************************************************************************
*   Program name :- JCSJME_VALIDATE_COST
*   Created:- 1/19/2004
*------------------------------------------------------------------------------*
*   Program By : Kauser Jahan	
*********************
* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE ICS.CPYLIB INV.WHSE

DEFFUN DIVISION.POSITION (CONO,CONTROL.FILE,DIV.CODE)
DEFFUN CURRENT.PERIOD(CONO,CONTROL.FILE,DIV.POS,FISCAL.FLAG)
CUR.PERIOD = ''

OPEN "","INV.WHSE" TO INV.WHSE ELSE
  ERRMSG="INV.WHSE FILE IS MISSING";GOTO 93000
END

* Insert method code here

STATUS = RBO.getProperty('','IWH_ID',IWH_ID)
STATUS = RBO.getProperty('','Cono',CONO)

TMPINDX = INDEX(IWH_ID,"!",1)
WHS.DIV = IWH_ID[TMPINDX+1,99]
ERRMSG = ''
DIV.POS=DIVISION.POSITION(CONO,CONTROL,WHS.DIV)
BEGIN CASE                                              
  CASE DIV.POS<1,1>=''                                  
    DIV.POS=DIV.POS<1,2>                                
    CUR.PERIOD=CURRENT.PERIOD(CONO,CONTROL,DIV.POS,"JC")
    IF CUR.PERIOD<1,1>='' THEN                          
      CUR.PERIOD=CUR.PERIOD<1,2>                        
    END ELSE                                            
      IF CUR.PERIOD<1,2>='-2' THEN                      
        ERRMSG=CUR.PERIOD<1,2>                          
        GOSUB 93000                                     
      END                                               
    END                                                 
  CASE DIV.POS<1,1>='-1'                                
    ERRMSG=DIV.POS<1,2>                                 
    GOSUB 93000                                         
  CASE DIV.POS<1,1>='-2'                                
    ERRMSG=DIV.POS<1,2>                                 
    GOSUB 93000                                         
END CASE                                                
  STATUS = RBO.setProperty('','DIV_POS',DIV.POS)
  STATUS = RBO.setProperty('','CUR_PERIOD',CUR.PERIOD)

MATREAD IWH.REC FROM INV.WHSE,IWH_ID ELSE MAT IWH.REC=''
ERR.FLG='';ERRMSG=''
PERIOD='';OPEN.FLAG = 1
CALL BUILD.IWH.FI(IWH.ID,MAT IWH.REC,PERIOD,ERR.FLG,ERRMSG,OPEN.FLAG)
FIFO.COST=0
QCNT=DCOUNT(IWH.QTY.FI,@VM)
FOR Q=1 TO QCNT WHILE FIFO.COST=0
  IF IWH.QTY.FI<1,Q> > 0 AND IWH.COST.FI<1,Q> > 0 THEN
    FIFO.COST=IWH.COST.FI<1,Q>
  END
NEXT Q
LAST.COST=IWH.COST.FI<1,QCNT>
  STATUS = RBO.setProperty('','FIFO_COST',FIFO.COST)
  STATUS = RBO.setProperty('','LAST_COST',LAST.COST)
* End of method code
RETURN

93000*
  ERM = 0
  IF ERRMSG # "" THEN ERM = 1
  STATUS = RBO.setProperty('','ServerStatus',ERM)
  STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN

