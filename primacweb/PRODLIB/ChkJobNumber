SUBROUTINE ChkJobNumber
********************************************************************************
*   Program name :- ChkJobNumber
*   Created:- 3/14/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

$INCLUDE JCS.CPYLIB JOB
$INCLUDE PMC.CPYLIB CUSTOMER


STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
CONO   = PMCProperty<1,4>
STATUS=RBO.getProperty('','JOB_NO',JOB_NO)
STATUS=RBO.getProperty('','CUST_NO',CUST_NO)

OPEN "","JOB" TO JOB ELSE ERRMSG = "CANNOT OPEN JOB FILE";GOSUB 93000
OPEN "","CUSTOMER" TO CUSTOMER ELSE ERRMSG = "CANNOT OPEN CUSTOMER FILE"; GOSUB 93000


      MATREAD JOB.REC FROM JOB, CONO:JOB_NO ELSE 
        ERRMSG="Invalid JOB number <":JOB_NO:">"
        GO 93000
      END

      IF CUST_NO # "" THEN
        IF CUST_NO # JOB.CUST THEN
          ERRMSG="Job does not belong to Customer"
          GOSUB 93000
        END
      END

MATREAD CUST.REC FROM CUSTOMER,CONO:JOB.CUST THEN CUSTNAME=CUST.NAME


STATUS=RBO.setProperty('','CUST_NO',JOB.CUST)
STATUS=RBO.setProperty('','EST_NO',JOB.EST)
STATUS=RBO.setProperty('','CUSTNAME',CUSTNAME)

RETURN

93000
	STATUS=RBO.setProperty('','ServerStatus',1)
	STATUS=RBO.setProperty('','ServerMessage',ERRMSG )
RETURN

