SUBROUTINE GET_LOAD_SKIP_DATA
********************************************************************************
*   Program name :- GET_LOAD_SKIP_DATA
*   Created:- 9/17/2003
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

* Insert method code here
ERRMSG = ''
OPEN '','CONTROL' TO CONTROL ELSE
	ERRMSG = 'CONTROL FILE IS MISSING';GOTO 99999
END

VAL = RBO.getProperty('','PMCProperty',PMCProperty)
VAL = RBO.getProperty('','BEG_PER',BEG.PER)
VAL = RBO.getProperty('','BEG_YR',BEG.YR)
VAL = RBO.getProperty('','NUM_PERIODS',NUM.PERIODS)
VAL = RBO.getProperty('','CURR_YR',CURR.YR)
VAL = RBO.getProperty('','CURR_PER',CURR.PER)
VAL = RBO.getProperty('','CURR_MON',CURR.MON)


CONO = PMCProperty<1,4>
READ SALESDATES FROM CONTROL, CONO : "SALESDATES" ELSE
	ERRMSG = 'CANNOT LOCATE CONTROL SALESDATES'
      	GOTO 99999
END
READ OPENDATES FROM CONTROL, CONO : "OPENDATES" ELSE
      ERRMSG = 'CANNOT LOCATE CONTROL OPENDATES'
      GOTO 99999
END

READ TAPE.PERIOD FROM CONTROL, CONO:CURR.YR:"GLS.TAPE" ELSE
	TAPE.PERIOD = ""
END

IF TAPE.PERIOD<CURR.PER> = "" THEN
	ERRMSG = 'YOU NEED TO BACKUP THIS PERIOD BEFORE RESTORING'
      	GOTO 99999
END

BEG.MON = SALESDATES<BEG.PER+1,2>
NYR.PER = BEG.PER
LST.PER = BEG.PER - 1
IF LST.PER < 1 THEN
	LST.PER = (BEG.YR - 1) : NUM.PERIODS
END ELSE
	LST.PER = STR("0",2-LEN(LST.PER)):LST.PER
      	LST.PER = BEG.YR : LST.PER
END

SAVE.PTR = 0
NO.SAVE.PTR = 0
IF BEG.YR < CURR.YR THEN
	FOR PER = BEG.PER TO NUM.PERIODS
       	PERIOD = BEG.YR : STR("0",2-LEN(PER)):PER
         	IF TAPE.PERIOD<PER> # '' THEN
            		SAVE.PTR = SAVE.PTR + 1
            		SAVE.PER<SAVE.PTR> = PERIOD
            		SAVE.MON<SAVE.PTR> = SALESDATES<PER+1,2>
            		SAVE.DATE<SAVE.PTR> = OCONV(OPENDATES<PER>,"D/")
            		SAVE.DATE<SAVE.PTR> = SAVE.DATE<SAVE.PTR>[1,6] : SAVE.DATE<SAVE.PTR>[7,4] - 1
            		*SAVE.DATE<SAVE.PTR> = ICONV(SAVE.DATE<SAVE.PTR>,"D/")
            		SAVE.DATE<SAVE.PTR> = OCONV(SAVE.DATE<SAVE.PTR>,"D2/")
            		TAPE.PERIOD<PER> = ""
         	END ELSE
            		NO.SAVE.PTR = NO.SAVE.PTR + 1
            		NO.SAVE.PER<NO.SAVE.PTR> = PERIOD
            		NO.SAVE.MON<NO.SAVE.PTR> = SALESDATES<PER+1,2>
            		NO.SAVE.DATE<NO.SAVE.PTR> = OCONV(OPENDATES<PER>,"D/")
            		NO.SAVE.DATE<NO.SAVE.PTR> = NO.SAVE.DATE<NO.SAVE.PTR>[1,6] : NO.SAVE.DATE<NO.SAVE.PTR>[7,4] - 1
            		*NO.SAVE.DATE<NO.SAVE.PTR> = ICONV(NO.SAVE.DATE<NO.SAVE.PTR>,"D/")
            		NO.SAVE.DATE<NO.SAVE.PTR> = OCONV(NO.SAVE.DATE<NO.SAVE.PTR>,"D2/")
            	END
     	NEXT PER
      	OTAPE.PERIOD = TAPE.PERIOD
      	READ TAPE.PERIOD FROM CONTROL, CONO:CURR.YR:"GLS.TAPE" ELSE
       	TAPE.PERIOD = ""
      	END
      	NYR.PER = "01"
END

FOR PER = NYR.PER TO CURR.PER - 1
	PERIOD = CURR.YR : STR("0",2-LEN(PER)):PER
      	IF TAPE.PERIOD<PER> # '' THEN
       	SAVE.PTR = SAVE.PTR + 1
         	SAVE.PER<SAVE.PTR> = PERIOD
         	SAVE.MON<SAVE.PTR> = SALESDATES<PER+1,2>
         	*SAVE.DATE<SAVE.PTR> = OPENDATES<PER>
         	SAVE.DATE<SAVE.PTR> = OCONV(OPENDATES<PER>,'D2/')
        	TAPE.PERIOD<PER> = ""
      	END ELSE
       	NO.SAVE.PTR = NO.SAVE.PTR + 1
         	NO.SAVE.PER<NO.SAVE.PTR> = PERIOD
         	NO.SAVE.MON<NO.SAVE.PTR> = SALESDATES<PER+1,2>
         	*NO.SAVE.DATE<NO.SAVE.PTR> = OPENDATES<PER>
         	NO.SAVE.DATE<NO.SAVE.PTR> = OCONV(OPENDATES<PER>,'D2/')
      	END
NEXT PER

IF SAVE.PTR < 1 THEN
	ERRMSG = "THERE ARE NO PERIODS TO LOAD"; GOTO 99999
END

VAL = RBO.setProperty('','SAVE_PER',LOWER(SAVE.PER))
VAL = RBO.setProperty('','SAVE_MON',LOWER(SAVE.MON))
VAL = RBO.setProperty('','SAVE_DATE',LOWER(SAVE.DATE))

VAL = RBO.setProperty('','NO_SAVE_PER',LOWER(NO.SAVE.PER))
VAL = RBO.setProperty('','NO_SAVE_MON',LOWER(NO.SAVE.MON))
VAL = RBO.setProperty('','NO_SAVE_DATE',LOWER(NO.SAVE.DATE))
VAL = RBO.setProperty('','BEG_MON',BEG.MON)
VAL = RBO.setProperty('','OTAPE_PERIOD',OTAPE.PERIOD)
VAL = RBO.setProperty('','TAPE_PERIOD',TAPE.PERIOD)
VAL = RBO.setProperty('','SAVE_PTR',SAVE.PTR)
VAL = RBO.setProperty('','SAVE_PTR',SAVE.PTR)

99999
IF ERRMSG # "" THEN
	VAL = RBO.setProperty('','ServerStatus','E')
	VAL = RBO.setProperty('','ServerMessage',ERRMSG)
END ELSE
	VAL = RBO.setProperty('','ServerStatus','')
END
* End of method code
RETURN

