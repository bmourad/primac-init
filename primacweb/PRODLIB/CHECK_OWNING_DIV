SUBROUTINE CHECK_OWNING_DIV
********************************************************************************
*   Program name :- CHECK_OWNING_DIV
*   Created:- 5/2/2007-BY ABDUL GAFOOR
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB DIVISION

    OPEN "","CONTROL" TO CONTROL ELSE ERRMSG="CONTROL FILE OPEN PROBLEM" ;GOTO 91000 
    OPEN "","DIVISION" TO DIVISION ELSE ERRMSG="DIVISION FILE OPEN PROBLEM" ;GOTO 91000 
* Insert method code here
      STATUS = RBO.getProperty('','Cono',CONO)
      STATUS = RBO.getProperty('','DIV_CODE',DIV)
      STATUS = RBO.getProperty('','USER_ID',USER.ID)
         IF DIV = "00" AND LEN(DIV) = 2 THEN
            READ SECURITY.REC FROM CONTROL, CONO:"DIV.SECURITY" ELSE
               ERRMSG = "DIV.SECURITY CONTROL RECORD IS MISSING:"
               GOTO 91000
            END
            IF SECURITY.REC<1> = "Y" AND SECURITY.REC<2> = "Y" THEN
               ERRMSG = " 'ALL' OR '00' INVALID WHEN DIVISION-LEVEL POSTING & CLOSING IS SELECTED"
               GOTO 91000
            END
         END ELSE
            MATREAD DIV.REC FROM DIVISION, CONO:DIV ELSE
               ERRMSG = "INVALID DIVISION";GOTO 91000
            END
         END
         DIV.CODE = DIV;USER.ID = UPCASE(@LOGNAME); ERRMSG = ''
        CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG) 
         IF ERRMSG # '' THEN
            GOTO 91000
         END

* End of method code
RETURN

91000 *
   STATUS = RBO.setProperty('','ServerStatus','E')
   STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN

