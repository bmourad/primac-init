SUBROUTINE JCSSHM_GET_VALIDATE
********************************************************************************
*   Program name :- JCSSHM_GET_VALIDATE
*   Created:- 9/12/2005
*------------------------------------------------------------------------------*
*

$INCLUDE WWINSERT RBO.H
$INCLUDE JCS.CPYLIB JOB
$INCLUDE JCS.CPYLIB JOB.CUTOFF.NO
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE PMC.CPYLIB DIVISION
$INCLUDE OPS.CPYLIB JOB.FNGD.STATS
$INCLUDE CPYLIB CHAR

OPEN "","JOB" TO JOB ELSE ERRMSG="FILE JOB IS MISSING";GOTO 91000
OPEN "","COMPANY" TO COMPANY ELSE ERRMSG="FILE COMPANY IS MISSING";GOTO 91000
OPEN "","CUSTOMER" TO CUSTOMER ELSE ERRMSG="FILE CUSTOMER IS MISSING";GOTO 91000
OPEN "","DIVISION" TO DIVISION ELSE ERRMSG="FILE DIVISION IS MISSING";GOTO 91000
OPEN "","JOB.FNGD.STATS" TO JOB.FNGD.STATS ELSE ERRMSG = "Cannot locate the JOB.FNGD.STATS file";GOTO 91000
      
*OPEN "","CONTROL" TO CONTROL ELSE ERRMSG="CONTROL FILE IS MISSING";GOTO 91000

CONO=""
DMS_JOB="" 
JCODES=''
JOB_DIV=''
JOB_STATUS=''
JOB_CUST=''
JOB_TRACK_DATE=''
JOB_QTY=''
STATUS = RBO.getProperty('','CHK_JOB',CHK_JOB)

CONO = CHK_JOB<1,1>
JOB.NO = CHK_JOB<1,2>
UNAME = CHK_JOB<1,3>
JOB.ID = CONO:JOB.NO


*MATREAD COMP.REC FROM COMPANY,CONO ELSE
 *  MAT COMP.REC = ''
*END

*** MAIN PROCESSING 

    POST.OSJ=0
    MATREAD JOB.REC FROM JOB,JOB.ID THEN
        *FOR K = 1 TO DCOUNT(JOB.DESC,@VM)
	 *   JOB_DESC<1,K> = JOB.DESC
	 *NEXT K
	JCODES			= JOB.MASTER	
	JOB_DESC		= JOB.DESC<1,1> 
       JOB_DIV         	= JOB.DIV
       JOB_STATUS     	= JOB.STATUS
       JOB_CUST        	= JOB.CUST			
       JOB_TRACK_DATE  	= JOB.TRACK.DATE	
       FOR J = 1 TO DCOUNT(JOB_TRACK_DATE,@VM)
 	 JOB_TRACK_DATE<1,J> =  OCONV(JOB_TRACK_DATE<1,J>,"D2/")
	NEXT J
      JOB_QTY			= JOB.QTY
    END ELSE
        ERRMSG= JOB.NO:" IS NOT ON FILE. TRY AGAIN !"
        GOTO 91000
    END


  *  DIV.CODE = JOB.DIV; USER.ID = UPCASE(UNAME); ERRMSG = ''
	
  *  CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)
    *IF ERRMSG # '' THEN
     * GOTO 91000
    *END
    BEGIN CASE
      CASE JOB.STATUS<1,1>=9
        ERRMSG="THIS JOB HAS BEEN CANCELLED";GOTO 91000
      CASE JOB.STATUS<1,1>=7
        ERRMSG="THIS JOB IS READY TO BE PURGED";GOTO 91000
      CASE JOB.STATUS<1,1>=8
        ERRMSG="THIS JOB HAS BEEN PURGED";GOTO 91000
    END CASE

	MATREAD JFS.REC FROM JOB.FNGD.STATS, JOB.ID THEN
       	IF JFS.PROD # "" THEN
                  ERRMSG = "Cannot Ship a Finished Goods JOB"
		GOTO 91000
      		END
	END

MATREAD DIV.REC FROM DIVISION, CONO:JOB_DIV THEN
	DIV_DESC  = DIV.DESC
	DIV.CODE = JOB_DIV; USER.ID = UPCASE(@LOGNAME); ERRMSG = ''
         CALL CK.DIV.SEC.SUB(CONO,DIV.CODE,USER.ID,ERRMSG)
         IF ERRMSG # '' THEN
            GOTO 91000
         END
END ELSE
	ERRMSG= JOB_DIV:" IS NOT ON FILE. TRY AGAIN !"
        GOTO 91000
    END


    ****** TO CHK IF  CRDT AUTH. IS RQD
    IF (JOB.STATUS<1,1> > 1 AND JOB.STATUS<1,1> # 5) OR JOB.TRACK.DATE<1,7> # "" OR JOB.TRACK.DATE<1,8> # "" THEN
        ERRMSG="This job is not in process. Enter authorization"
    END
* STATUS = RBO.setProperty('','ServerMessage',JOB_DIV:'```':JOB_STATUS:'~~~':JOB_CUST:'---':JOB_TRACK_DATE:'----':JOB_QTY)
*RETURN		
 CUST.ID=CONO:JOB.CUST
      MATREAD CUST.REC FROM CUSTOMER,CUST.ID THEN
       CUS_NAME	= CUST.NAME
	CUS_ADDR1	= CUST.ADDR1
	CUS_ADDR2	= CUST.ADDR2
	CUS_ADDR3	= CUST.ADDR3
	CUS_ADDR4	= CUST.ADDR4:" ":CUST.ZIP
	*CUS_ZIP	= CUST.ZIP
      END ELSE
	ERRMSG= JOB.CUST: "IS NOT ON FILE. TRY AGAIN !!"
        GOTO 91000
      END
	
      *JOB.DESC<1,1>=CUST.NAME
     
    *IF POST.OSJ=0 THEN
     * DMT.DIV=JOB.DIV
      *DIV.ID=CONO:DMT.DIV
      *MATREAD DIV.REC FROM DIVISION,DIV.ID ELSE DIV.DESC="UNKNOWN"
    *END
STATUS = RBO.setProperty('','JCODES',JCODES)
STATUS = RBO.setProperty('','JOB_DESC',JOB_DESC)
STATUS = RBO.setProperty('','JOB_DIV',JOB_DIV:'-':DIV_DESC)
STATUS = RBO.setProperty('','JOB_STATUS',JOB_STATUS)
STATUS = RBO.setProperty('','JOB_CUST',JOB_CUST)
STATUS = RBO.setProperty('','JOB_TRACK_DATE',JOB_TRACK_DATE)
STATUS = RBO.setProperty('','JOB_QTY',JOB_QTY)
STATUS = RBO.setProperty('','CUS_NAME',CUS_NAME)
STATUS = RBO.setProperty('','CUS_ADDR1',CUS_ADDR1)
STATUS = RBO.setProperty('','CUS_ADDR2',CUS_ADDR2)
STATUS = RBO.setProperty('','CUS_ADDR3',CUS_ADDR3)
STATUS = RBO.setProperty('','CUS_ADDR4',CUS_ADDR4)

RETURN

91000:
       STATUS = RBO.setProperty('','ServerStatus',1)
       STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN
