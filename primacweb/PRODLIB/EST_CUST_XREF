SUBROUTINE EST_CUST_XREF
********************************************************************************
*   Program name :- EST_CUST_XREF
*   Created:- 9/1/2004  RAZI MOHIUDDIN
*------------------------------------------------------------------------------*
* This method will fetch estimate nos based on the customer
* -----------------------------------------------------------------------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JES.CPYLIB ESTIMATE

STATUS = RBO.getProperty('','ESTCUST',ESTCUST)

OPEN '','ESTIMATE' TO ESTIMATE ELSE ERRMSG = 'Cannot open ESTIMATE file!'


ESTIDS=''
ESTDESC=''
ESTDATE=''
ESTSTAT=''

CMD="SSELECT ESTIMATE WITH EST.CUST=":ESTCUST
UDTEXECUTE CMD
DATA = 1
S=1
LOOP
    READNEXT CODE ELSE DATA = 0
WHILE DATA DO
CUSTID<1,-1> = CODE

	MATREAD EST.REC FROM ESTIMATE, CODE THEN 
		ESTIDS<1,S> = CODE[4,99]
		ESTDESC<1,S>=EST.COMMENTS	
		ESTDATE<1,S>=OCONV(EST.STAT.DATE,"D2/")
		ESTSTAT<1,S>=EST.STATUS
       END
       S=S+1
REPEAT


STATUS = RBO.setProperty('','ESTIDS',ESTIDS)
STATUS = RBO.setProperty('','ESTDSC',ESTDESC)
STATUS = RBO.setProperty('','ESTDATE',ESTDATE)
STATUS = RBO.setProperty('','ESTSTATUS',ESTSTAT)


RETURN

90000*
   STATUS = RBO.setProperty('','ServerStatus',1)
   STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN



