SUBROUTINE GetEstDivDescs
*********************************************************************************
*   Program name : GetEstDivDescs							 ****
*   Created      : 10/15/2003							 ****
*   Description  : Getting the Division- descptions from DIVISION TABLE	 ****
*********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB DIVISION
$INCLUDE JES.CPYLIB ESTIMATE.DIV
$INCLUDE JES.CPYLIB ESTIMATE.GRP.XREF
$INCLUDE JES.CPYLIB ESTIMATE.MATL
     ERRMSG = ""
     OPEN '','CONTROL' TO CONTROL ELSE
	  ERRMSG="CANT OPEN CONTROL FILE"
	  RETURN
     END	

     OPEN '','DIVISION' TO DIVISION ELSE
         ERRMSG = 'Cannot open DIVISION file!'
         RETURN
     END

     OPEN '','ESTIMATE.DIV' TO ESTIMATE.DIV ELSE
         ERRMSG = 'Cannot open ESTIMATE.DIV file!'
         RETURN
     END
     OPEN '','ESTIMATE.GRP.XREF' TO ESTIMATE.GRP.XREF ELSE
         ERRMSG = 'Cannot open ESTIMATE.GRP.XREF file!'
         RETURN
     END
     OPEN '','ESTIMATE.MATL' TO ESTIMATE.MATL ELSE
         ERRMSG = 'Cannot open ESTIMATE.MATL file!'
         RETURN
     END

****** INITIALIZATION  ********
TYPE=""
EST.DEPT = ''
EST.DEPT.DESC = ''
STATUS =RBO.getProperty('','PMCProperty',PMCProperty)
STATUS =RBO.getProperty('','DivDsc',DivCode)

*vvv Added this functionality to get "No groups defined for this department." on 07/10/07 A. Gafoor
newDivCode = FIELD(DivCode,"!",1)
Module = FIELD(DivCode,"!",2)
IF Module = "DEPT" THEN
   CONO=newDivCode[1,3]
   DEPT = newDivCode[4,99]
   READV ESTGX.GRP FROM ESTIMATE.GRP.XREF,CONO:DEPT,1 ELSE ESTGX.GRP=""
   IF ESTGX.GRP="" THEN
      ERRMSG="No groups defined for this department. Try again! "
      GOTO 93000
   END
   RETURN
END
IF Module = "MAT" THEN
   CONO=newDivCode[1,3]
   TYPE = newDivCode[4,99]
WRITE "CONO ":CONO:" TYPE ":TYPE :" AND ":CONO:TYPE[2,1] ON CONTROL,"8AUG"
   MATREAD ESTM.REC FROM ESTIMATE.MATL,CONO:TYPE[2,1] ELSE
      ERRMSG="No materials defined for this type. Try again! " 
      GOTO 93000
   END
   RETURN
END
DivCode = newDivCode
*^^^
CONO=DivCode[1,3]
ID=""
ESTDEPTDESC=''
DIV_ID = DivCode[1,5]


*STATUS = RBO.setProperty('','ServerMessage','DIV DSC next- ': DivCode)
*RETURN

*MATREAD DIV.REC FROM DIVISION,DivCode THEN 

*	MATREAD DIV.REC FROM DIVISION,DIV_ID THEN
*		ESTDEPTID =DivCode 
*		ESTDEPTDESC=DIV.DESC	
*	END ELSE
*	GOTO 93000
*	ERRMSG = "Departments not defined for specifed entry. Try again!"
*	END

MATREAD ESTV.REC FROM ESTIMATE.DIV, DIV_ID THEN
	 MATREAD DIV.REC FROM DIVISION,DIV_ID THEN
		ESTDEPTID   = DivCode 
		ESTDEPTDESC = DIV.DESC
 	END
END ELSE 
	ERRMSG = "Departments not defined for specifed entry. Try again!"
	GOTO 93000
END

	
*	 MATREAD DIV.REC FROM DIVISION,DIV_ID THEN
*		ESTDEPTID   = DivCode 
*		ESTDEPTDESC = DIV.DESC
*	 END ELSE
*	     ERRMSG = "Departments not defined for specifed entry. Try again!"
*	     GOTO 93000
*	 END


ESTDEPTID   = DivCode 
ESTDEPTDESC = DIV.DESC	

STATUS = RBO.setProperty('','AllEstDivCodes',ESTDEPTID[4,99])
STATUS = RBO.setProperty('','AllEstDivDescs',ESTDEPTDESC)

93000 *
   IF ERRMSG # "" THEN
      STATUS = RBO.setProperty('','ServerStatus',1)
      STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
   END
RETURN

