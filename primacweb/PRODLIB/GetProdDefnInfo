SUBROUTINE GetProdDefnInfo
*********************************************************************************
*   Program name :- GetProdDefnInfo
*   Created:- 10/7/2003
*   AUTHOR  : B.KRISHNA
********************* DESCRIPTION************************************************
* This program is used to capture component definition data for the
* QUIK-PLAN estimating system.
*********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JES.CPYLIB SCOMMON.ESTIMATE.QP
$DEFINE ESTIMATE
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE JES.CPYLIB ESTIMATE.QP
$DEFINE EQUIPMENT
$INCLUDE JES.CPYLIB EQUIPMENT
$DEFINE ESTIMATEPAPERGROUP
$INCLUDE JES.CPYLIB ESTIMATE.PAPER.GROUP
$DEFINE ESTIMATEMATL
$INCLUDE JES.CPYLIB ESTIMATE.MATL
$DEFINE ESTIMATEPRESSSPOIL
$INCLUDE JES.CPYLIB ESTIMATE.PRESS.SPOIL
$DEFINE JESFILEVARS
$INCLUDE JES.CPYLIB JES.FILE.VARS
$INCLUDE PMC.CPYLIB COST.CNTR
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE JES.CPYLIB QPL.SCRIPT
$INCLUDE JES.CPYLIB QPL.SCREEN
$DEFINE FILEVARS
$INCLUDE CPYLIB FILE.VARS
$INCLUDE CPYLIB CHAR

COMP=1
*
*---- OPEN ALL FILES
*
   OPEN "","QPL.PROMPT" TO QPL.PROMPT ELSE
      ERRMSG = "CANNOT OPEN QPL.PROMPT FILE"
      
   END
   OPEN "","QPL.SCREEN" TO QPL.SCREEN ELSE
      ERRMSG = "CANNOT OPEN QPL.SCREEN FILE"
      
   END
   OPEN "","QPL.SCRIPT" TO QPL.SCRIPT ELSE
      ERRMSG = "CANNOT OPEN QPL.SCRIPT FILE"
      
   END
   OPEN "","QPL.SCREENS" TO QPL.SCREENS ELSE
      ERRMSG = "CANNOT OPEN QPL.SCREENS FILE"
      
   END

   OPEN "","ESTIMATE" TO ESTIMATE ELSE
      ERRMSG = "CANNOT OPEN ESTIMATE FILE"
      
   END
EST_PROD_TS_WIDTH="";EST_PROD_TS_LENGTH="";EST_PROD_OS_TYPE="";EST_PROD_OS_PROD="";EST_PROD_OS_WIDTH="";EST_PROD_OS_LENGTH="";EST_PROD_PRESS_ID="";EST_PROD_NO_UP="";EST_PROD_SCRIPT="";PQTYSTR="";EST_PROD_PCST="";FINALSTR=""

ERRMSG = RBO.getProperty('','ID',ID)

MATREAD EST.REC FROM ESTIMATE,ID ELSE MAT EST.REC=""


* Insert method code here

   CCNT = DCOUNT(EST.PROD.DESC, VM)
   FOR REF = 1 TO CCNT
      EST_PROD_TS_WIDTH<1,REF> = OCONV(INT(EST.PROD.TS.WIDTH<1,REF,1>+0.5),"MD4")
      EST_PROD_TS_LENGTH<1,REF> = OCONV(INT(EST.PROD.TS.LENGTH<1,REF,1>+0.5),"MD4")
      EST_PROD_OS_TYPE<1,REF> = EST.PROD.OS.TYPE<1,REF> : EST.PROD.OS.USAGE<1,REF,1>
      EST_PROD_OS_PROD<1,REF> = EST.PROD.OS.PROD<1,REF,1>
      EST_PROD_OS_WIDTH<1,REF> = OCONV(INT(EST.PROD.OS.WIDTH<1,REF,1>/100+0.5),"MD2")
      EST_PROD_OS_LENGTH<1,REF> = OCONV(INT(EST.PROD.OS.LENGTH<1,REF,1>/100+0.5),"MD2")
      IF EST.PROD.DC.CODE<1,REF> = "" THEN
         EST_PROD_PRESS_ID<1,REF> = EST.PROD.PRESS.ID<1,REF>
      END ELSE
         EST_PROD_PRESS_ID<1,REF> = EST.PROD.PRESS.ID<1,REF> : "-" : EST.PROD.DC.CODE<1,REF>
      END
      EST_PROD_NO_UP<1,REF> = EST.PROD.NO.UP<1,REF,1>
      EST_PROD_SCRIPT<1,REF> = EST.PROD.SCRIPT<1,REF>
      IF EST.PROD.OS.TYPE<1,COMP> = "S" THEN
         WEB.CNT = 1 
      END ELSE
         WEB.CNT = EST.PROD.WEB.CNT<1,REF>+0
      END
      IF WEB.CNT = 0 THEN WEB.CNT = 1
      PQTY = 0
      FOR MPTR = 1 TO WEB.CNT
         PQTY = PQTY + FIELD(EST.PROD.PQTY<1,REF,MPTR>,"!",1)
      NEXT MPTR
      PQTYSTR<1,REF> = PQTY
      EST_PROD_PCST<1,REF> = OCONV(FIELD(EST.PROD.PCST<1,REF,1>, "!", 1),"MD2")
   NEXT REF

FINALSTR = EST_PROD_TS_WIDTH : "^" : EST_PROD_TS_LENGTH : "^" : EST_PROD_OS_TYPE : "^" : EST_PROD_OS_PROD :"^" : EST_PROD_OS_WIDTH : "^" :EST_PROD_OS_LENGTH : "^" :  EST_PROD_PRESS_ID : "^" : EST_PROD_NO_UP : "^" : EST_PROD_SCRIPT:"^":PQTYSTR : "^" : EST_PROD_PCST

ERRMSG = RBO.setProperty('','ProdDefnStr',FINALSTR)


* End of method code
RETURN

