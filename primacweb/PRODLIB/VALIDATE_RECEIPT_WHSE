SUBROUTINE VALIDATE_RECEIPT_WHSE
********************************************************************************
*   Program name :- VALIDATE_RECEIPT_WHSE
*   Created:- 8/5/2005
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

$INCLUDE CPYLIB COMMON1
$INCLUDE ICS.CPYLIB COM.INV.MAIN 
$INCLUDE ICS.CPYLIB COM.INV.SERIAL
$INCLUDE ICS.CPYLIB COM.INV.LINK
* Insert method code here
$DEFINE INVRECPWHSE
$INCLUDE ICS.CPYLIB INV_RECP_WHSE
$DEFINE INVRECEIPTS
$INCLUDE ICS.CPYLIB INV_RECEIPTS
$INCLUDE PMC.CPYLIB FISCAL
$INCLUDE ICS.CPYLIB WAREHOUSE

DEFFUN DIVISION_POSITION(COMP.NO,CONTROL.FILE,DIV.NO)
DEFFUN CURRENT_PERIOD(COMP.NO,CONTROL.FILE,DIV.POS,FISCAL.FLAG)
ERRMSG = ''
GEN.DIV = "00";GEN.DEPT = "00";GEN.CCTR = "000" 
CUR.PERIOD = ''
OPEN '','INV_RECEIPTS' TO INV_RECEIPTS ELSE ERRMSG = 'INV_RECEIPTS FILE IS MISSING'; GOTO 93000
OPEN '','WAREHOUSE' TO WAREHOUSE ELSE ERRMSG = 'WAREHOUSE FILE IS MISSING'; GOTO 93000
OPEN '','INV_RECP_WHSE' TO INV_RECP_WHSE ELSE ERRMSG = 'INV_RECP_WHSE FILE IS MISSING'; GOTO 93000
OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE IS MISSING'; GOTO 93000

*********************************************
STATUS  = RBO.getProperty('','RECEIPTNO',RECP.NO) ;*// THESE PROPERTIES NEED TO BE ADDED
STATUS  = RBO.getProperty('','WAREHOUSENO',WHSE.NUM)
DIV.POS = ""
CONO = RECP.NO[1,3]
 MATREAD WHSE.REC FROM WAREHOUSE,CONO : WHSE.NUM THEN
   IF WHS.DIV = "" THEN WHS.DIV = GEN.DIV  
    **GET PERIOD FOR THE DIVISION
     DIV.POS=DIVISION_POSITION(CONO,CONTROL,WHS.DIV)
  MATREAD FISCAL.REC FROM CONTROL, CONO:"ICFISCAL" ELSE
    ERR.FLG = 2
    ERR = "ICS Control Fiscal record is missing"
    *GOTO 99999
  END
	DIVISION_PERIOD = FR.CURR.PER<1,DIV.POS>
 END

      INVR.ID=RECP.NO
      MATREADU INVR.REC FROM INV_RECEIPTS,INVR.ID ELSE
        ERRMSG='INV_RECEIPTS ':INVR.ID:' IS MISSING.'
        GOTO 93000
      END
      IRW.ID=RECP.NO:"!":WHSE.NUM
      MATREADU IRW.REC FROM INV_RECP_WHSE,IRW.ID ELSE
        ERRMSG='INV_RECP_WHSE ':IRW.ID:' IS MISSING.'
        GOTO 93000
      END

      IF INVR.ORG.WHSE # WHSE.NUM THEN
        ERRMSG='Cannot adjust - product moved after receipt!'
        GOTO 91000
      END
      GOSUB ENT.ADJ.PERIOD
      IF NOT(ERR) THEN
*        GOSUB DETAIL.SUB
      END
GOTO 93000
RETURN
*********************************************
*****************
ENT.ADJ.PERIOD: 
*****************
*
CUR.PERIOD=CURRENT_PERIOD(CONO,CONTROL,DIV.POS,"IC")
BEGIN CASE
  CASE CUR.PERIOD<1,1>=''
    CUR.PERIOD=CUR.PERIOD<1,2>
  CASE CUR.PERIOD<1,1>='-2'
    ERRMSG=CUR.PERIOD<1,2>
    GOTO 93000
END CASE
RETURN

*EOI=0
*LOOP
*  PERIOD=''
*  ECD.NUM=58 ; ECD.SUB.NUM=LN ; ECD.ACTION=4
*  IF SAJ.PERIOD<LN> # "" THEN
*    DEFAULT=SAJ.PERIOD<LN>;O.R="O"
*  END ELSE
*    IF CUR.PERIOD < IWH.RECP.PERIOD<1,LN> THEN
*      DEFAULT=IWH.RECP.PERIOD<1,LN>
*    END ELSE
*      IF IWH.RECP.PERIOD<1,LN><CUR.PERIOD THEN
*        DEFAULT=CUR.PERIOD;O.R="O"
*      END ELSE
*        DEFAULT=IWH.RECP.PERIOD<1,LN>;O.R='O'
*      END
*    END
*  END

*  ECD.MINV=DEFAULT ; ECD.MAXV=999999
*  ECD.DEFAULT=DEFAULT


*  BEGIN CASE
*    CASE ECD.RET.VALUE='END' OR ECD.RET.VALUE='E'
*      EOI=1;ERR=1
*      SCV.REC(58)=SAJ.PERIOD<LN>
*      ECD.NUM=58;ECD.SUB.NUM=LN;ECD.ACTION=5
*      CALL SCRN.EDIT
*    CASE 1
*      ERR.FLG="";ERRMSG="" 


*      CALL CHECK.PERIOD.DATE(CONO,"",ECD.RET.VALUE,DIV.CODE,ERR.FLG,ERRMSG,COMPANY,CONTROL)

*      BEGIN CASE 
*        CASE ERRMSG="" 
*          SAJ.PERIOD<LN>=ECD.RET.VALUE
*          EOI=1
*        CASE ERR.FLG=0 
*          SAJ.PERIOD<LN>=ECD.RET.VALUE
*          GOSUB 91000
*          EOI=1
*        CASE ERR.FLG=1 
*          GOSUB 91000
*        CASE ERR.FLG=2 
*          GOSUB 91000 ; EOI=1 ; ERR=1
*      END CASE 
*  END CASE
*UNTIL (EOI) DO REPEAT
*

93000 *
STATUS  = RBO.setProperty('','ServerStatus',1)
STATUS  = RBO.setProperty('','ServerMessage',ERRMSG:"~~~")
* End of method code
RETURN
91000*
RETURN
