SUBROUTINE EST_DEFAULT_MRCNT
********************************************************************************
*   Program name :- EST_DEFAULT_MRCNT
*   Created:- 8/13/2004  RAZI MOHIUDDIN
*------------------------------------------------------------------------------*
* In Properties:
* --------------
* Out Properties:
* ---------------
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JES.CPYLIB EQUIPMENT
$INCLUDE JES.CPYLIB ESTIMATE.PRESS.SPOIL
$INCLUDE CPYLIB CHAR

OPEN "EQUIPMENT" TO EQUIPMENT ELSE ERRMSG="CANNOT OPEN EQUIPMENT FILE";GOTO 90000
OPEN "ESTIMATE.PRESS.SPOIL" TO ESTIMATE.PRESS.SPOIL ELSE ERRMSG="CANNOT OPEN ESTIMATE.PRESS.SPOIL FILE";GOTO 90000

ERRMSG=''
STATUS = RBO.getProperty('', 'ID', ID)
STATUS = RBO.getProperty('', 'EST_PROD_PRESS_ID',EST_PROD_PRESS_ID)
STATUS = RBO.getProperty('', 'EST_PRT_MODE', EST_PRT_MODE)
STATUS = RBO.getProperty('', 'EST_PROD_CLRSIDE1', EST_PROD_CLRSIDE1)
STATUS = RBO.getProperty('', 'EST_PROD_CLRSIDE2',EST_PROD_CLRSIDE2)
STATUS = RBO.getProperty('', 'EST_PROD_FORMS', EST_PROD_FORMS)
STATUS = RBO.getProperty('', 'EST_PRESS_SPOIL', EST_PRESS_SPOIL)
STATUS = RBO.getProperty('', 'EST_MR_CNT',EST_MR_CNT)


CONO=ID[1,3]
EST.PROD.MODE = EST_PRT_MODE
EST.PROD.COLORS.1 = EST_PROD_CLRSIDE1
EST.PROD.COLORS.2 = EST_PROD_CLRSIDE2

MATREAD EQUIPMENT.REC FROM EQUIPMENT,CONO:EST_PROD_PRESS_ID ELSE
         MAT EQUIPMENT.REC=""
END 
MATREAD PST.REC FROM ESTIMATE.PRESS.SPOIL,CONO:EST_PRESS_SPOIL ELSE
         ERRMSG="Invalid press spoilage table. Try again! "
         GOTO 90000
END
   PMODE=EST.PROD.MODE
   C1=EST.PROD.COLORS.1+0
   C2=EST.PROD.COLORS.2+0
   CC=EQP.PRESS.CLR.CNT
   
   BEGIN CASE
      CASE EQP.PRESS.TYPE="W"
         PP=1
      CASE PMODE="SS"
         PP=INT(C1/CC+0.99)
      CASE PMODE="WT" OR PMODE="WR"
         PP=INT(C1/CC+0.99)*2
      CASE PMODE="SW"
         PP=INT(C1/CC+0.99)+INT(C2/CC+0.99)
      CASE 1
         IF C1 > C2 THEN
            PP=INT(C1/CC+0.99)
         END ELSE
            PP=INT(C2/CC+0.99)
         END
   END CASE
   IF PP < 1 THEN PP = 1
   EST.PROD.PASSES=PP

   DEFAULTMRCNT=EST.PROD.PASSES*EST_PROD_FORMS-EST_MR_CNT 
   IF DEFAULTMRCNT < 0 THEN DEFAULTMRCNT=0
   EST_SUBS_MR_CNT=DEFAULTMRCNT 


STATUS = RBO.setProperty('','EST_SUBS_MR_CNT',EST_SUBS_MR_CNT)
STATUS = RBO.setProperty('', 'EST_MR_IMPR',PST.INIT.QTY)
STATUS = RBO.setProperty('', 'EST_SUBS_MR_IMPR',PST.SUB.QTY)

RETURN

90000*
   STATUS = RBO.setProperty('','ServerStatus',1)
   STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN


