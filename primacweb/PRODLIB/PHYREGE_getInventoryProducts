SUBROUTINE PHYREGE_getInventoryProducts
********************************************************************************
*   Program name :- PHYREGE_getInventoryProducts
*   Created:- 7/25/2003
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  VERCOM , USA
*	
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB PHYSICAL.INV
$INCLUDE ICS.CPYLIB CATEGORY
$INCLUDE ICS.CPYLIB INV.WHSE
$INCLUDE ICS.CPYLIB INV.WHSE.LOC
* Insert method code here
CONO = ''
ID = ''
ERRMSG = ''
PROD.LINE = ''
WHSE.CODE = ''
VALUE = ''
INV.WHSE.KEY = ''
PHS.INV.KEY = ''
PROD.NUM = ''
LOC.CODE = ''
PHS.INV.PROD = ''
PHS.INV.DESC = ''
PHS.CUR.QTY = ''
ERR = 0

  ERRMSG = RBO.getProperty('','ID',ID)
  CONO = ID[1,3]
  PHS.INV.KEY = ID[4,99]
  ERRMSG = RBO.getProperty('','PHS_TEMP_VAL',VALUE)

  PROD.LINE = FIELD(ID,"!",2)
  WHSE.CODE = FIELD(ID,"!",3)
  LOC.CODE  = FIELD(ID,"!",4)

OPEN '','INVENTORY' TO INVENTORY ELSE ERRMSG='INVENTORY FILE IS MISSING' ; GOTO 90000
OPEN '','CATEGORY' TO CATEGORY ELSE ERRMSG='CATEGORY FILE IS MISSING' ; GOTO 90000
OPEN '','INV.WHSE' TO INV.WHSE ELSE ERRMSG='INV.WHSE FILE IS MISSING' ; GOTO 90000
OPEN '','INV.WHSE.LOC' TO INV.WHSE.LOC ELSE ERRMSG='INV.WHSE.LOC FILE IS MISSING' ; GOTO 90000
OPEN '','PHYSICAL.INV' TO PHYSICAL.INV ELSE ERRMSG='PHYSICAL.INV FILE IS MISSING' ; GOTO 90000

MATREAD PHS.INV.REC FROM PHYSICAL.INV , PHS.INV.KEY ELSE
  ERRMSG = 'PHYSICAL INVENTORY record is locked by user - ':GETUSERNAME(STATUS())
  *GOSUB 90000
END

IF PHS.INV.PROD<1,1> # VALUE THEN
   LOCATE VALUE IN PHS.INV.PROD<1>,1 SETTING FND ELSE FND=0
   IF FND THEN
     ERRMSG='INVENTORY (':VALUE:') ALREADY ALLOCATED'
     GOSUB 90000; ERR=1
   END
END

IF NOT(ERR) THEN
  PROD.NUM=VALUE
  MATREAD INV.REC FROM INVENTORY, CONO:VALUE THEN
	 IF PROD.LINE # INV.LINE THEN
          ERRMSG='THIS PRODUCT DOES NOT BELONG TO PRODUCT LINE ':PROD.LINE
          GOSUB 90000
	 END ELSE
	   MATREAD CATG.REC FROM CATEGORY,CONO:INV.LINE THEN
		IF CATG.TRK.LVL='S' THEN
	              ERRMSG='THIS IS A SERIALY TRACKED PRODUCT.'
       	       GOSUB 90000
		END ELSE
			LOCATE WHSE.CODE IN INV.WHSE.CODE<1>,1 SETTING WFND THEN
				INV.WHSE.KEY=CONO:PROD.NUM:'!':WHSE.CODE
				MATREAD IWH.REC FROM INV.WHSE , INV.WHSE.KEY THEN
					LOCATE LOC.CODE IN IWH.LOC<1>,1 SETTING LFND ELSE
			                    LFND=DCOUNT(IWH.LOC,@VM) + 1
	       		             IWH.LOC<1,LFND>=LOC.CODE
			                    ERRMSG='THIS PRODUCT IS NOT SETUP FOR LOCATION - ':LOC.CODE
	              		      GOSUB 90000
					END
		                  MATREAD IWLO.REC FROM INV.WHSE.LOC , INV.WHSE.KEY:'!':IWH.LOC<1,LFND> ELSE
		                    MAT IWLO.REC = ""
		                    IWLO.LOC.ON.HAND = 0
		                  END
		                  PHS.INV.PROD<1,1>=PROD.NUM       ;*C35846
		                  PHS.INV.DESC<1,1>=INV.DESC
				    *GET THE CUR.QTY HERE
				    PHS.CUR.QTY<1,1>=OCONV(INT(IWLO.LOC.ON.HAND/10),"MD2")
		  	       END ELSE
		                  ERRMSG='INV.WHSE RECORD NOT ON FILE'
              		    GOSUB 90000
				END
	              END ELSE
       	         ERRMSG='PRODUCT IS NOT SETUP FOR WAREHOUSE # ':WHSE.CODE
              	  GOSUB 90000	
			END		
		END
          END ELSE
            ERRMSG='PRODUCT LINE RECORD ':INV.LINE:' IS MISSING'
            GOSUB 90000
	   END
	 END
  END ELSE
      ERRMSG='INVENTORY (':VALUE:') IS NOT ON FILE.'
      GOSUB 90000
  END
END
* End of method code
*  STATUS = RBO.setProperty('','PlineCodes',PHS.INV.PROD)
*  STATUS = RBO.setProperty('','PlineDescs',PHS.INV.DESC)
  STATUS = RBO.setProperty('','PHS_TEMP_CUR_QTY',PHS.CUR.QTY)
  STATUS = RBO.setProperty('','PHS_TEMP_PROD_DESC',PHS.INV.DESC)
RETURN

90000 *
  STATUS = RBO.setProperty('','ServerStatus',1)
  STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
  RETURN
END
