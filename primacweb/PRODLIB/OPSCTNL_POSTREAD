SUBROUTINE OPSCTNL_POSTREAD
********************************************************************************
*   Program name :- OPSCTNL_POSTREAD
*   BY           :- JAWEED,S.A
*   Created:- 8/17/2003
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE OPS.CPYLIB BOL
$INCLUDE OPS.CPYLIB CARTON
$INCLUDE OPS.CPYLIB ORDER
$INCLUDE PMC.CPYLIB SHIP.TO
$INCLUDE CPYLIB CHAR

OPEN '', 'BOL' TO BOL ELSE
  ERRMSG='BOL'
  GOTO 93000
END
OPEN '', 'CARTON' TO CARTON ELSE
  ERRMSG='CARTON'
  GOTO 93000
END
OPEN '', 'CUSTOMER' TO CUSTOMER ELSE 
  ERRMSG='CUSTOMER'
  GOTO 93000
END
OPEN '', 'ORDER' TO ORDER ELSE 
  ERRMSG='ORDER'
  GOTO 93000
END
OPEN '', 'SHIP.TO' TO SHIP.TO ELSE 
  ERRMSG='SHIP.TO'
  GOTO 93000
END
ERRMSG = ""
STATUS=RBO.getProperty('','ID',ID)
CONO=ID[1,3]

MATREAD ORD.REC FROM ORDER, ID ELSE
    ERRMSG = 'Order number does not exist - Try again'
    GOTO 93000
END
  IF ORD.STATUS<1,1> = "CLOSED" THEN
    ERRMSG = 'Order number is closed - Try again'
    GOTO 93000
  END
  IF ORD.STATUS<1,1> = "CANCEL" THEN
    ERRMSG = 'Order number is cancelled - Try again'
    GOTO 93000
  END
  IF ORD.STATUS<1,1> = "COMPLETE" THEN
    ERRMSG = 'Order number is completed - Try again'
    GOTO 93000 
  END
  GOSUB 7000


7000 *
  REF.CNT = DCOUNT(ORD.BOL,VM)
  ORD_BOL = ORD.BOL
  CARTON.NEEDED = ""
  BOL_SHIP_TO = ""
  SPT_NAME = ""
  CARTON_NEEDED = ""
  NUM.ON.SCREEN = 1
  FOR REF = 1 TO REF.CNT
    MATREAD BOL.REC FROM BOL,CONO:ORD.BOL<1,REF> ELSE MAT BOL.REC = ""
    IF BOL.STATUS # "CANCEL" THEN
      MATREAD SPT.REC FROM SHIP.TO,CONO:ORD.CUST:"!":BOL.SHIP.TO ELSE
        MAT SPT.REC = ""
      END
      MATREAD CARTON.REC FROM CARTON,CONO:"!":ID[4,99]:"!":ORD.BOL<1,REF> THEN
        CARTON.NEEDED<1,NUM.ON.SCREEN> = CARTON.NEED
      END ELSE
       	MAT CARTON.REC = ""
      END
      BOL_SHIP_TO<1,-1> = BOL.SHIP.TO
      SPT_NAME<1,-1> = SPT.NAME
*      CARTON_NEEDED<1,NUM.ON.SCREEN> = CARTON.NEEDED<1,NUM.ON.SCREEN>
      NUM.ON.SCREEN = NUM.ON.SCREEN + 1
    END
  NEXT REF

STATUS=RBO.setProperty('','ORD_BOL',ORD.BOL)
STATUS=RBO.setProperty('','BOL_SHIP_TO',BOL_SHIP_TO)
STATUS=RBO.setProperty('','SPT_NAME',SPT_NAME)
STATUS=RBO.setProperty('','CARTON_NEEDED',CARTON.NEEDED)

93000
STATUS = RBO.setProperty('','ServerStatus',"E")
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN
