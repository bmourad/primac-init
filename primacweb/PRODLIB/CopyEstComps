SUBROUTINE CopyEstComps
********************************************************************************
*   Program name :- CopyEstComps

*   Created:- 6/28/2003

*   Author Irfan M Saleem
*   Modified by   :- Ramakrishna Pusuluri
*
*
*---- COPY COMPONENT FROM ANOTHER ESTIMATE

********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JES.CPYLIB JES.FILE.VARS
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE JES.CPYLIB ESTIMATE.MATL
$INCLUDE JES.CPYLIB ESTIMATE.PAPER.GROUP
$INCLUDE JCS.CPYLIB JOB.CATEGORY
$INCLUDE CPYLIB FILE.VARS
$INCLUDE CPYLIB CHAR
*
*---- OPEN ALL FILES
*
   IN_PARAM = "" ; OUT_PARAM = ""
   ESTDIV = ''
   DESCRIPTION = ''
   ERRMSG = "CALL openEstimateFiles PROBLEM"
   CALL openEstimateFiles(ERRMSG,IN_PARAM,OUT_PARAM,MAT FILE.VARS,MAT JES.FILE.VARS)
   IF ERRMSG # "" THEN GOTO 93000
*
*---- INITIALIZATION
*
FINALCOMPS = ''
COMPS=''
 ERRMSG = RBO.getProperty('','ID',EST.ID)
 ERRMSG = RBO.getProperty('','ESTCOMP',COMPNO)
 TYPE=NUM(COMPNO)
BEGIN CASE
      CASE TYPE=1

	 	MATREAD EST.REC FROM ESTIMATE, EST.ID THEN
		FOR S=1 TO DCOUNT(EST.COMP.FLAG,VM)
			FINALCOMPS=FINALCOMPS :EST.COMP.FLAG<1,S,COMPNO> :VM
		NEXT
	 	END ELSE
        	FINALCOMPS= '' 
       	END

	CASE TYPE=0
		MATREAD EST.REC FROM ESTIMATE, EST.ID THEN
			ESTDIV =EST.DIV
			CMPNO =EST.COMMENT.TYPE
*			FINALCOMPS<1,-1>=CMPNO : "~" :EST.COMMENTS
			FINALCOMPS<1,-1>=CMPNO : "~" :EST.PROD.DESC;*added
			DESCRIPTION = EST.COMMENTS
			ERRMSG = ''
		END ELSE
			ESTDIV = ''
			CMPNO=''
	         	FINALCOMPS= '' 			
			DESCRIPTION = ''
			ERRMSG = "Cannot locate estimate. Try again! "
       	END
END CASE
STATUS = RBO.setProperty('','ESTCOMP',FINALCOMPS)
STATUS = RBO.setProperty('','EST_DIV',ESTDIV)
STATUS = RBO.setProperty('','DREFCREF',DESCRIPTION)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN
 
93000 *
   STATUS = RBO.setProperty('','ServerStatus',1)
   STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
   RETURN

