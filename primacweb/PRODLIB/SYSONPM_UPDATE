SUBROUTINE SYSONPM_UPDATE
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB OVERNIGHT.REQUESTS
STATUS=RBO.getProperty('','FIELDS',FIELDS)
*FIELDS CONTAINS OR.START.TIME
OPEN "","CONTROL" TO CONTROL ELSE ERRMSG = "CANNOT OPEN CONTROL FILE"; GOSUB 91000
MATREAD OR.REC FROM CONTROL,"OVERNIGHT.REQUESTS" ELSE MAT OR.REC = ""
OR.START.TIME = FIELD(FIELDS,"!",1)
OR.END.TIME = FIELD(FIELDS,"!",1)
OR.START.DATE = ICONV(FIELD(FIELDS,"!",2),"D2/")
OR.END.DATE = ICONV(FIELD(FIELDS,"!",2),"D2/")
*WRITE OR.START.DATE:"~":OR.END.DATE ON CONTROL, "001SUMIT"
OR.STATUS = "A"
IF OR.START.TIME # "" THEN
	MATWRITE OR.REC ON CONTROL,"OVERNIGHT.REQUESTS"
	EXECUTE "SLEEP ":OR.START.TIME
       MATREADU OR.REC FROM CONTROL,"OVERNIGHT.REQUESTS" ELSE
         RELEASE CONTROL,"OVERNIGHT.REQUESTS"
       END

    OR.START.TIME = ICONV(FIELD(FIELDS,"!",1),"MTS")
    OR.END.TIME = ICONV(FIELD(FIELDS,"!",1),"MTS")
    OR.PROCESS.DATE = DATE()
    OR.PROCESS.TIME = TIME()
    IF OR.PROCESS.TIME < 30 THEN OR.PROCESS.DATE = DATE()
    MATWRITE OR.REC ON CONTROL,"OVERNIGHT.REQUESTS"
END
STATUS=RBO.setProperty('','ServerMessage','DONE')
RETURN

91000 
	STATUS=RBO.setProperty('','ServerStatus',1)
	STATUS=RBO.setProperty('','ServerMessage',ERRMSG)
RETURN
*     

