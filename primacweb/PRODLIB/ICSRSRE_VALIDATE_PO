SUBROUTINE ICSRSRE_VALIDATE_PO
********************************************************************************
*   Program name :- P.V.B.V.S.RAMAKRISHNA
*   Created:- 3/24/2005
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB PO
$INCLUDE ICS.CPYLIB PO.RSKI.XREF 
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB CATEGORY
$INCLUDE CPYLIB CHAR
$INCLUDE PMC.CPYLIB VEND

ERRMSG = ""
OPEN '','PO' TO PO ELSE
   ERRMSG = 'PO FILE IS MISSING'
   GOTO 91000
END
OPEN '','INVENTORY' TO INVENTORY ELSE
   ERRMSG = 'INVENTORY FILE IS MISSING'
   GOTO 91000
END

OPEN '','CATEGORY' TO CATEGORY ELSE
   ERRMSG = 'CATEGORY FILE IS MISSING'
   GOTO 91000
END

OPEN '','PO.RSKI.XREF' TO PO.RSKI.XREF ELSE
   ERRMSG = 'PO.RSKI.XREF FILE IS MISSING'
   GOTO 91000
END
OPEN '','VEND' TO VEND ELSE
   ERRMSG = 'VEND FILE IS MISSING'
   GOTO 91000
END

STATUS=RBO.getProperty('','CONO',CONO)
STATUS = RBO.getProperty('','ID',PONUM)
MANUAL.ENTRY = 0
PO.PRESENT = 1


*   MATREADU RSXRF.REC FROM PO.RSKI.XREF, CONO: PO.NO LOCKED 
   MATREADU RSXRF.REC FROM PO.RSKI.XREF,CONO:PONUM LOCKED 
      ERRMSG = 'P/O record is locked by user - ':GETUSERNAME(STATUS())
      GOTO 91000
   END ELSE
      MAT RSXRF.REC = ""
      IF PONUM = "*BAD*" THEN
         ERRMSG ="No errors present!"
         GOTO 91000
      END ELSE
         
         MANUAL.ENTRY = 1
      END
   END

MATREAD PO.REC FROM PO,CONO:PONUM THEN
VendNo = PO.VEND.NO
 
END ELSE
ERRMSG = "P/O Not on file"
*MANUAL.ENTRY = 1
*ERRMSG = "P/O Not on file - Do you wish to use? (Y/N)"
GOTO 91000
END

IF PONUM = "*BAD*" THEN
      PO.PRESENT = 0
END ELSE
      MATREADU PO.REC FROM PO, PONUM LOCKED
*	 ERRMSG = 'P/O record CANNOT BE FOUND '
	 ERRMSG = 'P/O record is locked by user - ':GETUSERNAME(STATUS())
        GOTO 91000 
      END ELSE
	 IF DCOUNT(RSXRF.RS.NO,@VM) > 0 THEN MANUAL.ENTRY = 1 ;*T27306
         IF NOT(MANUAL.ENTRY) THEN
            ERRMSG = "P/O record cannot be found"
            GOTO 91000
         END ELSE
		VendNo = PO.VEND.NO	 
*		ERRMSG = "PO NUMBER IS CORRECT ":PO.VEND.NO:" OK"
*	    IF S$VALUE='Y' THEN
*               MAT PO.REC = ''
*               PO.DIV.OWNER = '00'
*            END ELSE GOTO 100
         END
         *PO.PRESENT=0;*T27306
      END
END
IF PO.PRESENT THEN MANUAL.ENTRY = 0
IF NOT(MANUAL.ENTRY) THEN
  PO.LINE.CNT = DCOUNT(PO.PROD.NUM,VM)
         BCFLAG=0
         FOR PO.LINE.PTR=1 TO PO.LINE.CNT WHILE BCFLAG=0
            MATREAD INV.REC FROM INVENTORY, CONO:PO.PROD.NUM<1,PO.LINE.PTR> ELSE MAT INV.REC = ""
            MATREAD CATG.REC FROM CATEGORY,CONO:INV.LINE ELSE MAT CATG.REC=''
            IF CATG.TRK.LVL='S' THEN
               BCFLAG=1
            END
         NEXT PO.LINE.PTR
         IF BCFLAG=0 THEN
            ERRMSG = "Invalid P/O for this function"
            GOSUB 91000
            
         END
END

	STATUS = RBO.setProperty('','VendNo',VendNo)
	STATUS = RBO.setProperty('','ManualEntry',MANUAL.ENTRY)
RETURN 

91000:
	STATUS = RBO.setProperty('','ServerStatus',1)
	STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN

