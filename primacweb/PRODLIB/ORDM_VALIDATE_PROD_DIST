SUBROUTINE ORDM_VALIDATE_PROD_DIST
********************************************************************************
*   Program name :- ORDM_VALIDATE_PROD_DIST
*   Created:- 2/15/2006
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB INV.WHSE
$INCLUDE CPYLIB CHAR

OPEN "","INVENTORY" TO INVENTORY ELSE ERRMSG = "CANNOT OPEN INVENTORY FILE";GOTO 91000
OPEN "","INV.WHSE" TO INV.WHSE ELSE ERRMSG = "CANNOT OPEN INV.WHSE FILE";GOTO 91000

  STATUS = RBO.getProperty("","PMCProperty",PMCProperty)
  STATUS = RBO.getProperty("","INARR",INARR)
  STATUS = RBO.getProperty("","DISPARR",DISP_ARR)

  CONO = PMCProperty<1,4>
  BASE_PROD = INARR<1,1>
  PD_PROD   = INARR<1,2>
  PD_WHSE   = INARR<1,3>
  LN        = INARR<1,4>
  PMPT_NUM  = INARR<1,5>
  SET_FOCUS = 0
  RET_VAL   = ""

  PROD_ARR  = DISP_ARR<1,1>
  WHSE_ARR  = DISP_ARR<1,2>

  SWAP "ð" WITH VM IN PROD_ARR
  SWAP "ð" WITH VM IN WHSE_ARR

  PDNO = BASE_PROD
  VALUE = PD_PROD
  MATREAD INV.REC FROM INVENTORY, CONO:PDNO THEN
     PROD.SUBS = INV.SUBS
  END ELSE
     ERRMSG = "CANNOT READ INVENTORY ID : " : INARR;GOTO 91000
  END
  
  LOCATE VALUE IN PROD.SUBS<1>,1 SETTING FND ELSE
    ERRMSG = "This product is not associated with the base # ":PDNO
    SET_FOCUS = 1
    GOTO 91000
  END
  MATREAD INV.REC FROM INVENTORY, CONO:VALUE ELSE
    ERRMSG = "Cannot locate product # ":VALUE
    SET_FOCUS = 1
    GOTO 91000
  END
  RET_VAL<1,1> = INV.FULL.DESC
  WCNT = DCOUNT(INV.WHSE.CODE,VM)
*
*---- Warehouse
7020*
  IF WCNT = 1 THEN
    VALUE = INV.WHSE.CODE<1,1>
    GOTO 7021
  END
  IF PMPT_NUM = 1 THEN
     SET_FOCUS = 2
     GOTO 93000
  END ELSE
     VALUE = PD_WHSE
  END
7021*
  MATREAD IWH.REC FROM INV.WHSE, CONO:PD_PROD:"!":VALUE ELSE
    ERRMSG = "Cannot locate warehouse (":VALUE:") for item # ":PD_PROD
    IF WCNT = 1 THEN SET_FOCUS = 1 ELSE SET_FOCUS = 2
    GOTO 91000
  END
  LOCATE PD_PROD IN PROD_ARR<1>,1 SETTING L ELSE L = LN
  IF LN # L AND WHSE_ARR<1,L> = VALUE THEN
    ERRMSG = "Item and warehouse already exist on line # ":L
    SET_FOCUS = 1
    GOTO 91000
  END
  RET_VAL<1,2> = VALUE

93000*
  STATUS = RBO.setProperty("","SET_FOCUS",SET_FOCUS)
  STATUS = RBO.setProperty("","RETARR",RET_VAL)
RETURN

91000*
  STATUS = RBO.setProperty("","ServerStatus",1)
  STATUS = RBO.setProperty("","ServerMessage",ERRMSG)
  STATUS = RBO.setProperty("","SET_FOCUS",SET_FOCUS)
RETURN
