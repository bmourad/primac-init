SUBROUTINE PRODUCTION_JOB_SETUP(CONO,PRODUCTION.REC,CPROD.REC, NPROD.REC)


$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB SALESMAN
$INCLUDE PMC.CPYLIB CUSTOMER

*
*--- INITIALIZE
*

GXR.CO = CONO
REF.CNT = 0
REF.NO = ""
CURR.REF.NO = ""
LINE.COUNT = 10
*USER.ID = UPCASE(@LOGNAME)  ;*T23278
STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
CONO = PMCProperty<1,4>
USER.ID = UPCASE(PMCProperty<1,3>)  ;*T23278
OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = "CONTROL FILE IS MISSING"; GOTO 93000
OPEN '','SALESMAN' TO SALESMAN ELSE ERRMSG = "SALESMAN FILE IS MISSING"; GOTO 93000
OPEN '','JOB.CATEGORY' TO JOB.CATEGORY ELSE ERRMSG = "JOB.CATEGORY FILE IS MISSING"; GOTO 93000
OPEN '','CUSTOMER' TO CUSTOMER ELSE ERRMSG = "CUSTOMER FILE IS MISSING"; GOTO 93000

MATREAD CUST.REC FROM CUSTOMER, CONO:PRODUCTION.REC<3> ELSE
   MAT CUST.REC = ""
END
MATREAD SALESMAN.REC FROM SALESMAN, CONO:PRODUCTION.REC<4> ELSE
   MAT SALESMAN.REC = ""
END
READ REC FROM JOB.CATEGORY, CONO:PRODUCTION.REC<5> ELSE
   REC = ""
END
STATUS = RBO.setProperty('','Job_CustomerNo',PRODUCTION.REC<3>)
STATUS = RBO.setProperty('','Job_CustomerName',CUST.NAME)
STATUS = RBO.setProperty('','Job_SalesPersonNo',PRODUCTION.REC<4>)
STATUS = RBO.setProperty('','Job_SalesPersonName',SALS.NAME)
STATUS = RBO.setProperty('','Job_CategoryNo',PRODUCTION.REC<5>)
STATUS = RBO.setProperty('','Job_CategoryName',REC)
STATUS = RBO.setProperty('','Job_Colors',PRODUCTION.REC<6>)
STATUS = RBO.setProperty('','Job_Division',PRODUCTION.REC<7>)
STATUS = RBO.setProperty('','Job_DateCreated',PRODUCTION.REC<8>)
REF.CNT = DCOUNT(PRODUCTION.REC<7>,@VM)
RETURN


93000*
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN
