SUBROUTINE OUTREQMN_PREWRITE
********************************************************************************
*   Program name :- OUTREQMN_PREWRITE
*   Created:- 11/7/2005
*   Programmer :- Suhail Hussain S
*------------------------------------------------------------------------------*
*
*  Server event triggered after the database image has been updated, but prio- *
*  r to the physical update occurring. Any changes to the database image at t- *
*  his point must be made via the API functions RBO.setDBVals() and RBO.getDB- *
*  Vals().
*  
*       - *

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB SHIP.VIA
* Insert method code here

OPEN "","SHIP.VIA" TO SHIP.VIA ELSE ERRMSG = "CANNOT OPEN SHIP.VIA FILE";GOTO 91000;*ADDED BY LAKSHMI

   STATUS = RBO.getProperty("","OPO_U_PRICE",OPO_U_PRICE)
   STATUS = RBO.getProperty("","TERMS_PER",TERMS_PER)
   STATUS = RBO.getProperty("","OPO_DISCOUNT",OPO_DISCOUNT)

   STATUS = RBO.getProperty("","OPO_UOM",OPO_UOM)
   STATUS = RBO.getProperty("","OPO_CANCEL_QTY",OPO_CANCEL_QTY)
   STATUS = RBO.getProperty("","OPO_QTY",OPO_QTY)
   STATUS = RBO.getProperty("","OPO_CANCEL_DATE",OPO_CANCEL_DATE)
   STATUS = RBO.getProperty("","OPO_SHIP_VIA",OPO_SHIP_VIA);*ADDED BY ZAHOOR
   STATUS = RBO.getProperty("","PMCProperty",PMCProperty);*ADDED BY ZAHOOR
*ADDED BY ZAHOOR v
   CONO = PMCProperty<1,4>
   MATREAD SHIP.VIA.REC FROM SHIP.VIA,CONO:OPO_SHIP_VIA THEN
      OPO_VIA_DESC = SHPV.DESC
   END ELSE
      OPO_VIA_DESC = ""
   END
;*ADDED BY ZAHOOR ^

  CANCEL.AMT = ""
  ONORD.AMT = ""
  DESC.PRICE = ""
  OPO_CANCEL_COST = ""
  OPO_EST_COST = ""

   CNT = DCOUNT(OPO_U_PRICE,@VM);TMP = 0
   FOR AA = 1 TO CNT
     OPO_U_PRICE<1,AA> = ICONV(OPO_U_PRICE<1,AA>,"MD4")
     OPO_DISCOUNT<1,AA> = ICONV(OPO_DISCOUNT<1,AA>,"MD2")
     OPO_CANCEL_QTY<1,AA> = ICONV(OPO_CANCEL_QTY<1,AA>,"MD2")
     OPO_QTY<1,AA> = ICONV(OPO_QTY<1,AA>,"MD2")

     DESC.PRICE = INT(OPO_U_PRICE<1,AA>*((OPO_DISCOUNT<1,AA>/10000)))
     DESC.PRICE = INT(OPO_U_PRICE<1,AA> - DESC.PRICE)
     BEGIN CASE
       CASE OPO_UOM<1,AA> = "M" 
          CANCEL.AMT = INT(((DESC.PRICE/100)*(OPO_CANCEL_QTY<1,AA>/100000)+.5))
          ONORD.AMT = INT((DESC.PRICE/100)*(OPO_QTY<1,AA>/100000)+.5)
       CASE OPO_UOM<1,AA> = "C" 
          CANCEL.AMT = INT(((DESC.PRICE/100)*(OPO_CANCEL_QTY<1,AA>/10000)+.5))
          ONORD.AMT = INT((DESC.PRICE/100)*(OPO_QTY<1,AA>/10000)+.5)
       CASE 1
          CANCEL.AMT = INT((DESC.PRICE/100) * (OPO_CANCEL_QTY<1,AA>/100)+.5)
          IF DESC.PRICE LT 0 THEN
             ONORD.AMT = INT((DESC.PRICE/100) * (OPO_QTY<1,AA>/100) - .5)
          END ELSE
             ONORD.AMT = INT((DESC.PRICE/100) * (OPO_QTY<1,AA>/100) + .5)
          END
     END CASE
     OPO_CANCEL_COST<1,AA> = CANCEL.AMT/100
     OPO_EST_COST<1,AA> = ONORD.AMT/100
     OPO_CANCEL_DATE<1,AA> = ICONV(OPO_CANCEL_DATE<1,AA>,"D2/")
   NEXT AA

*   STATUS = RBO.setProperty("","OPO_U_PRICE",OPO_U_PRICE)
*   STATUS = RBO.setProperty("","TERMS_PER",ICONV(TERMS_PER,"MD2"))
*   STATUS = RBO.setProperty("","OPO_DISCOUNT",OPO_DISCOUNT)
   STATUS = RBO.setProperty("","OPO_CANCEL_COST",OPO_CANCEL_COST)
   STATUS = RBO.setProperty("","OPO_EST_COST",OPO_EST_COST)
   STATUS = RBO.setProperty("","OPO_CANCEL_DATE",OPO_CANCEL_DATE)
   STATUS = RBO.setProperty("","OPO_VIA_DESC",OPO_VIA_DESC) ;*ADDED BY ZAHOOR
RETURN

* End of method code
91000:
   STATUS = RBO.setProperty("","ServerStatus",1)
   STATUS = RBO.setProperty("","ServerMessage",ERRMSG)
RETURN

