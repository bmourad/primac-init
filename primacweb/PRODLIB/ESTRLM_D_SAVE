SUBROUTINE ESTRLM_D_SAVE
********************************************************************************
*   Program name :- ESTRLM_D_SAVE
*   Created:- 8/1/2006
*------------------------------------------------------------------------------*
*
$INCLUDE WWINSERT RBO.H
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE JES.CPYLIB ESTIMATE.RES
$INCLUDE JES.CPYLIB ESTIMATE.DEPT
$INCLUDE CPYLIB CHAR
* Insert method code here
  OPEN "","ESTIMATE" TO ESTIMATE ELSE
    ERRMSG="CAN NOT OPEN ESTIMATE"
  END
  OPEN "","ESTIMATE.RES" TO ESTIMATE.RES ELSE
    ERRMSG="CAN NOT OPEN ESTIMATE.RES"
  END
  
  OPEN "","CONTROL" TO CONTROL ELSE STOP
  
  OPEN "","ESTIMATE.DEPT" TO ESTIMATE.DEPT ELSE
	ERRMSG="CAN NOT OPEN ESTIMATE.DEPT"
  END


  CONO='';OLDID='';NEWID='';OPTION='';MSG='';COMP='';CMD=''  
  JUNK='';DATA='';DATAIDS='';ESTD.ID='';ESTD.ID=''
  STATUS = RBO.getProperty('','ID',ID)
  STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
  NEWID=FIELD(ID,'!',1)
  OLDID=FIELD(ID,'!',2)
  OPTION=FIELD(ID,'!',3)
   
  CONO=PMCProperty<1,4>
  COMP=1
   MATREAD EST.REC FROM ESTIMATE, CONO:OLDID ELSE
     		 ERRMSG = 'Estimate not on file. Try again!'
   MAT EST.REC=''
   END
   MATREAD EST.RL.REC FROM ESTIMATE.RES,CONO:OLDID ELSE MAT EST.RL.REC = ''

EST.PROD.OS.USAGE	= EST.REC(71)
EST.PROD.OS.PROD	= EST.REC(72)
EST.PROD.OS.DESC	= EST.REC(73)
EST.PROD.OS.WIDTH	= EST.REC(74)
EST.PROD.INV.ID	= EST.REC(87)

MATWRITE EST.REC ON ESTIMATE, CONO:NEWID

EST.RL.JOB.TYPE 	= EST.RL.REC(1)
EST.RL.PREV.EST	= EST.RL.REC(2)
EST.RL.TYPE.CHG	= EST.RL.REC(3)
EST.RL.DIM.AC		= EST.RL.REC(5)
EST.RL.DIM.AR		= EST.RL.REC(6)
*EST.RL.SETS		= DATA<1,7>
EST.RL.SETS		= EST.RL.REC(96)
*EST.RL.CPY.DIR	= DATA<1,9>
EST.RL.CPY.DIR	= EST.RL.REC(4)
EST.RL.GAP		= EST.RL.REC(98)
EST.RL.DIE.SHAPE	= EST.RL.REC(49)
EST.RL.GAP.CALC	= EST.RL.REC(50)
***
*CCTR
***
     
EST.RL.PRESS.CCTR	       = EST.RL.REC(7)

EST.RL.BACKPRINT		= EST.RL.REC(14)
EST.RL.ADHESIVE		= EST.RL.REC(19)
EST.RL.FULL.SPOT		= EST.RL.REC(16)
EST.RL.FOIL			= EST.RL.REC(68)
EST.RL.FOIL.SPEED		= EST.RL.REC(51)
EST.RL.OVERLAM		= EST.RL.REC(82)
EST.RL.KINDS			= EST.RL.REC(20)
EST.RL.PLATE.CHANGES		= EST.RL.REC(21)
EST.RL.COPY.CHANGES		= EST.RL.REC(21)
EST.RL.COLOR.CHANGES		= EST.RL.REC(22)
EST.RL.SPROCKET		= EST.RL.REC(85)
EST.RL.COL.MIX		= EST.RL.REC(69)
EST.RL.SSCREEN		= EST.RL.REC(76)
EST.RL.GRAVURE		= EST.RL.REC(77)
EST.RL.EMBOSS			= EST.RL.REC(78)
***
*DIE
***
EST.RL.DIE		= EST.RL.REC(8)
EST.RL.DIE.REPEAT	= EST.RL.REC(9)
EST.RL.DIETYPE	= EST.RL.REC(15)
EST.RL.DIE.NO.ACR	= EST.RL.REC(10)
EST.RL.DIE.NO.ARD	= EST.RL.REC(11)
EST.RL.DIE.CYL.ID	= EST.RL.REC(12)
EST.RL.PRINTGEARS	= EST.RL.REC(86)
EST.RL.PRINTAR	= EST.RL.REC(87)
EST.RL.DIE.PRESS.NO	= EST.RL.REC(83)
***
*S=CK
***
EST.RL.ACT.WIDTH	= EST.RL.REC(95)
EST.RL.PAP.CAL	= EST.RL.REC(47)
EST.RL.PAP.GSM	= EST.RL.REC(48)
EST.RL.PAP.MSI	= EST.RL.REC(45)
EST.RL.PAP.PRICE	= EST.RL.REC(46)
***
* Pre-Press Include
***
EST.RL.PP.INCLUDE = EST.RL.REC(100)
	
MATWRITE EST.RL.REC ON ESTIMATE.RES,CONO:NEWID

CMD = "SSELECT ESTIMATE.DEPT WITH @ID LIKE '":CONO:OLDID:"...'" 
MSG= CMD 
	UDTEXECUTE CMD CAPTURING JUNK
	DATA = 1
	LOOP
	   READNEXT MCD.ID ELSE DATA = 0
	WHILE DATA DO
	   *COPY FOR EACH OLD ESTIMATE.DEPT RECORD
  	   MATREAD ESTD.REC FROM ESTIMATE.DEPT,MCD.ID ELSE MAT ESTD.REC = '' 
 	          
	      	   ESTD.DEPT         = ESTD.REC(1);* Department ID
		   ESTD.DEPT.TYPE    = ESTD.REC(2);* Department type
		   ESTD.GRP.SEQ      = ESTD.REC(3);* Group s ence number
		   ESTD.TYPE         = ESTD.REC(6);* (MV1) TYPE (L,Mx,P,S,O)
		   ESTD.CCTR         = ESTD.REC(7);* (MV1) Cost center ID
		   ESTD.CCTR.TYPE    = ESTD.REC(8);* (MV1) Cost center type
		   ESTD.OPV          = ESTD.REC(9);* (MV1) Operation, Product or Vendor
		   ESTD.OPV.TYPE     = ESTD.REC(10);* (MV1) Operation type
		   ESTD.VEND         = ESTD.REC(11);* (MV1) Vendor ID for O/P
		   ESTD.INV.ID       = ESTD.REC(11);* (MV1) Inven=ry ID
		   ESTD.CODE         = ESTD.REC(12);* (MV1) O/P Catg,Carrier or Prod Ln
		   ESTD.QTY          = ESTD.REC(13);* (MV1) Estimated quantity
		   ESTD.FCTR         = ESTD.REC(14);* (MV1) Standard multiplier
		   ESTD.STD          = ESTD.REC(15);* (MV1) Standard cost
		   ESTD.STD.TYPE     = ESTD.REC(16);* (MV1) Standard cost type
		   ESTD.UM           = ESTD.REC(17);* (MV1) Costing unit of measure
		   ESTD.HRS          = ESTD.REC(18);* (MV1) R ired hours
		   ESTD.RATE         = ESTD.REC(19);* (MV1) Cctr/Oper hourly rate
		   ESTD.DCOST        = ESTD.REC(20);* (MV1) Calculated direct cost
		   ESTD.IND.1        = ESTD.REC(21);* (MV1) $amount, %amount or table ID
		   ESTD.IND.2        = ESTD.REC(22);* (MV1) $amount, %amount or table ID
		   ESTD.IND.3        = ESTD.REC(23);* (MV1) $amount, %amount or table ID
		   ESTD.IND.4        = ESTD.REC(24);* (MV1) $amount, %amount or table ID
		   ESTD.COST         = ESTD.REC(25);* (MV1) =tal =tal cost
		   ESTD.MARKUP       = ESTD.REC(26);* (MV1) Mark-up % or table ID
		   ESTD.SALE         = ESTD.REC(27);* (MV1) Calculated sale
		   ESTD.TSALE        = ESTD.REC(28);* (MV1) =tal sale
		   ESTD.DESC         = ESTD.REC(29);* (MV1) Description
		   ESTD.FVAR1        = ESTD.REC(30);* (MV1) Formula variable #1
		   ESTD.FVAR2        = ESTD.REC(31);* (MV1) Formula variable #2
		   ESTD.FVAR3        = ESTD.REC(32);* (MV1) Formula variable #3
		   ESTD.GRP.ID       = ESTD.REC(34);* (MV1) Group ID : "*" : Seq
		   ESTD.GRP.QTY      = ESTD.REC(35);* (MV1) Group quantity
		   ESTD.GRP.FCTR     = ESTD.REC(36);* (MV1) Group fac=r
		   ESTD.GRP.CCTR     = ESTD.REC(37);* (MV1) Group cost center type
		   ESTD.GRP.QCALC    = ESTD.REC(38);* (MV1) Group qty calculation type
		   ESTD.GRP.QPARAM   = ESTD.REC(39);* (MV1) Group qty calculation code
		   ESTD.GRP.QOR      = ESTD.REC(40);* (MV1) Group qty override flag
		   ESTD.GRP.FCALC    = ESTD.REC(41);* (MV1) Group fac=r calc type
		   ESTD.GRP.FPARAM   = ESTD.REC(42);* (MV1) Group fac=r calc code
		   ESTD.GRP.FOR      = ESTD.REC(43);* (MV1) Group fac=r override flag
		   ESTD.MPTR         = ESTD.REC(44);* (MV1) Pointer = cutting, folding or multi-web specs
		   ESTD.FPTR         = ESTD.REC(45);* Reserved
		   ESTD.VSALE        = ESTD.REC(46);* (MV1) Variable cost flag
		   ESTD.QPL.QPARAM   = ESTD.REC(47);* (MV1) QP qty parameter (T-MMM)
		   ESTD.QPL.FPARAM   = ESTD.REC(48);* (MV1) QP fac=r parameter (T-MMM)
		   ESTD.QTY.CWT      = ESTD.REC(49);* CCV 100 weight
		   ESTD.CONTRIB      = ESTD.REC(49);* (MV1) (TREND) Labor contribution
		   ESTD.SAF          = ESTD.REC(49);* (MV1) (VANIER) Labor S&A
		   ESTD.OVR.FLG      = ESTD.REC(49);* (MV1) (NAHAN)
		   ESTD.NET          = ESTD.REC(50);* (MV1) (VANIER) Net Sales
		   ESTD.QTY.OVR.FLG  = ESTD.REC(50);* (MV1) (NAHAN)
		   ESTD.BRK.OUT      = ESTD.REC(50);* (MV1) (Creative) Die line flag
		   ESTD.SHIP.WT.PERC = ESTD.REC(51);* T22812 INSTANT 05/26/98
		   ESTD.SHIP.WT.AMT  = ESTD.REC(52);* T22812 INSTANT 05/26/98	
	  	
		   ESTD.ID = CONO:NEWID:"!":FIELD(MCD.ID,'!',2):"!":FIELD(MCD.ID,'!',3):"!":FIELD(MCD.ID,'!',4)
		   MATWRITE ESTD.REC ON ESTIMATE.DEPT,ESTD.ID 
	REPEAT
* End of method code
RETURN


