SUBROUTINE OUTREQMN_DEPT_CCTR
********************************************************************************
*   Program name :- OUTREQMN_DEPT_CCTR
*   Created:- 11/10/2005
*   Programmer :- Suhail Hussain S
*T571 by yakub ali khan on 08/31/2007
********************************************************************************
$INCLUDE WWINSERT RBO.H
   
$INCLUDE JCS.CPYLIB JOB
$INCLUDE PMC.CPYLIB DIVISION
$INCLUDE PMC.CPYLIB DEPARTMENT
$INCLUDE PMC.CPYLIB COST.CNTR

   OPEN "","JOB" TO JOB ELSE ERRMSG = "CANNOT OPEN JOB FILE";GOTO 93000
   OPEN "","DIVISION" TO DIVISION ELSE ERRMSG = "CANNOT OPEN DIVISION FILE"; GOTO 93000
   OPEN "","DEPARTMENT" TO DEPARTMENT ELSE ERRMSG = "CANNOT OPEN DEPARTMENT FILE"; GOTO 93000
   OPEN "","COST.CNTR" TO COST.CNTR ELSE ERRMSG = "CANNOT OPEN COST.CNTR FILE"; GOTO 93000
   OPEN "","CONTROL" TO CONTROL ELSE ERRMSG = "CANNOT OPEN CONTROL FILE"; GOTO 93000


   STATUS = RBO.getProperty("","PMCProperty",PMCProperty)
   STATUS = RBO.getProperty("","JOB_CCTR",DEPT_CCTR_VALS)
   
   CONO = PMCProperty<1,4> 
   CCTR.ID = DEPT_CCTR_VALS<1,2>
   JOB.ID = DEPT_CCTR_VALS<1,1>

   MATREAD JOB.REC FROM JOB, CONO:JOB.ID ELSE  JOB.DIV = ''
   OPO.DVDPCC = JOB.DIV

   MATREAD CCTR.REC FROM COST.CNTR,CONO:CCTR.ID ELSE
      ERRMSG = "COST CENTER NOT ON FILE"
      GOTO 93000
   END
*T571 v
    IF CCTR.TYPE='F' THEN
            ERRMSG='COST CENTER # ':CCTR.ID:' IS FROZEN'
           GOTO 93000
    END
*T571 ^
   MATREAD DEPT.REC FROM DEPARTMENT, CONO:CCTR.DEPT ELSE
      MAT DEPT.REC=""
      ERRMSG="COST CNTR DEPARTMENT (":CCTR.DEPT:") IS MISSING"
      GOTO 93000
   END
   FDDV = 0
   LOCATE OPO.DVDPCC IN DEPT.DIV<1>,1 SETTING FDDV ELSE FDDV = 0
   IF FDDV = 0 THEN
      ERRMSG='DEPT-COST CNTR MISMATCH FOR SELECTED DIVISION'
      GOTO 93000
   END
   RET.VALUE = CCTR.DEPT
   *CCTR_OPER = CCTR.OPER
   *SWAP @VM WITH "#" IN CCTR_OPER
   *RET.VALUE<1,2> = CCTR_OPER
   STATUS = RBO.setProperty("","RET_VALUE",RET.VALUE)
RETURN

93000:
   STATUS = RBO.setProperty("","ServerStatus",1)
   STATUS = RBO.setProperty("","ServerMessage",ERRMSG)
* End of method code
RETURN

