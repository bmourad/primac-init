SUBROUTINE AVOUM_NEWID
********************************************************************************
*   Program name :- AVOUM_NEWID
*   Created:- 7/1/2003 RAZI MOHIUDDIN
*------------------------------------------------------------------------------*
* In Properties:
* --------------
*  
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

ERRMSG = ""
  OPEN '','CONTROL' TO CONTROL ELSE
      ERRMSG = 'Cannot open Control file!'
      GOTO 1000
  END
  OPEN '','AUTO.VOUCHERS' TO AUTO.VOUCHERS ELSE 
	ERRMSG = 'AUTO.VOUCHERS FILE IS MISSING'
	GOTO 1000
  END
STATUS = RBO.getProperty('','ID',ID)
CONO = ID[1,3]
AUNO = ""
FND = ""
NEXT.NO = ""
     IF ID = CONO:"N" THEN
	
          READU NEXT.NO FROM CONTROL, CONO:"AUTOVOUCHER" ELSE NEXT.NO = 1
          FND = 1
          LOOP
          WHILE FND DO
            	AUNO = NEXT.NO
		NEXT.NO = AUNO + 1
            	IF NEXT.NO > 99999999 THEN NEXT.NO = 1
           		READU REC FROM AUTO.VOUCHERS, CONO:AUNO ELSE
              	REC = ""; FND = 0
           	END
              IF FND THEN RELEASE AUTO.VOUCHERS, CONO:AUNO
          REPEAT
	   STATUS = RBO.setProperty('','NID',AUNO)  
	   WRITE NEXT.NO ON CONTROL, CONO:"AUTOVOUCHER"
          ERRMSG = "Note the Reference Number"; GOTO 1000
      END


1000
STATUS = RBO.setProperty('','ServerStatus',1)        
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)

* End of method code
RETURN

