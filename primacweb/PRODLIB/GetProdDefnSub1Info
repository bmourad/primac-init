SUBROUTINE GetProdDefnSub1Info
********************************************************************************
*   Program name :- GetProdDefnSub1Info
*   Created:- 7/22/2003
*   Created by : B.Krishna
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JES.CPYLIB JES.FILE.VARS
$INCLUDE CPYLIB FILE.VARS
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE JES.CPYLIB ESTIMATE.DEPT
$INCLUDE CPYLIB CHAR
$INCLUDE JES.CPYLIB ESTIMATE.RES
$INCLUDE JES.CPYLIB EQUIPMENT
$INCLUDE JES.CPYLIB ESTIMATE.MATL
$INCLUDE JES.CPYLIB ESTIMATE.RES.PRESS.SPOIL
$INCLUDE JES.CPYLIB ESTIMATE.PAPER.GROUP
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB DEPARTMENT
$INCLUDE PMC.CPYLIB COST.CNTR
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB INV.WHSE
*$INCLUDE CPYLIB GEN.XREF.SUB
$INCLUDE JES.CPYLIB ESTIMATE.RES.DIE
$INCLUDE JES.CPYLIB ESTIMATE.RES.CYLINDER
$INCLUDE JES.CPYLIB ESTIMATE.RES.GEARSET

*   DIE DETAILS
   RLDIESTR  =  "";DIEREPEATSTR=  "";DIETYPESTR=  "";DIENOACRSTR=  "" ;DIENOARDSTR=  "" ;DIECYLIDSTR=  "" 
   PRINTGEARSSTR=  "" ;PRINTARSTR=  "" ;DIEPRESSNOSTR=  "" 
*  STOCK DETAILS

   OSUSAGESTR = "";OSPRODSTR= "" ;ACTWIDTHSTR= "" ;OSDESCSTR= "" ;OSWIDTHSTR= "";PAPCALSTR= "" ;PAPGSMSTR= "" ;INVIDSTR= ""

* MAKEREADY DETAILS

   MAKE.READY.VALUES ="";EST_RL_MR_DIE ="";EST_RL_MR_FDIE ="";EST_RL_MR_FOIL ="";EST_RL_MR_PLATE="";EST_RL_MR_COL_MIX="";EST_RL_MR_LIN_SLITS="";EST_RL_MR_COLORS="";EST_RL_MR_COL_CHANGE="";EST_RL_MR_SPROCKET="";EST_RL_MR_SSCREEN="";EST_RL_MR_GRAVURE =""
   EST_RL_MR_EMBOSS ="";EST_RL_MR_OVERLAM ="";EST_RL_MR_CSETDOWN ="";EST_RL_MR_DSETDOWN="";EST_RL_MR_FSETDOWN ="";EST_RL_MR_SSETDOWN="";EST_RL_MR_GSETDOWN="";EST_RL_MR_ESETDOWN="";EST_RL_MR_OSETDOWN="";EST_RL_PRESS_CCTR	 = ""
   

   PAPERSTR = "";PRESSCCTR = "";PRESSCCTRDESC = "";PRODCOLOR = "";BACKPRINT = "";ADHESIVE = "";FULLSPOT = ""
   RLFOIL = "";FOILSPEED = "";OVERLAM = "" ;RLKINDS = "";PLATECHANGE = "";COLORCHANGES = "";SPROCKET  = ""
   COLMIX = "";RLSSCREEN = "";GRAVURE = "";EMBOSS = ""

*
*---- OPEN ALL FILES
*
   IN_PARAM = "" ; OUT_PARAM = ""
   ERRMSG = "CALL openEstimateFiles PROBLEM"
   *CALL openEstimateFiles(ERRMSG,IN_PARAM,OUT_PARAM,MAT FILE.VARS,MAT JES.FILE.VARS)
   
   ERRMSG = RBO.getProperty('','ID',ID)
   CONO = ID[1,3]
   COMP =1
   CCTRSTR=""

   OPEN "","ESTIMATE.RES" TO ESTIMATE.RES ELSE
	ERRMSG =" CAN NOT OPEN ESTIMATE.RES FILE"
   END

   OPEN "","ESTIMATE" TO ESTIMATE ELSE
	ERRMSG =" CAN NOT OPEN ESTIMATE FILE"
   END
    
   OPEN "","ESTIMATE.RES.DIE" TO  ESTIMATE.RES.DIE ELSE
   ERRMSG="CAN NOT OPEN EQUIPMENT FILE"
   END

   OPEN "","EQUIPMENT" TO EQUIPMENT ELSE
   ERRMSG="CAN NOT OPEN EQUIPMENT FILE"
   END
   
   OPEN "","COST.CNTR" TO COST.CNTR ELSE
   ERRMSG="CAN NOT OPEN COST.CNTR FILE"
   END
   

   OPEN "","ESTIMATE.RES.SHAPE" TO ESTIMATE.RES.SHAPE ELSE
	ERRMSG="CAN NOT OPEN ESTIMATE.RES.SHAPE FILE"
   END
   OPEN "","CONTROL" TO CONTROL ELSE
   ERRMSG="CAN NOT OPEN CONTROL FILE"
   END


   MATREAD EST.RL.REC FROM ESTIMATE.RES,ID ELSE
      ERRMSG = 'ESTIMATE.RES not on file. Try again!'
      MAT EST.RL.REC = ''
   END

   MATREAD EST.REC FROM ESTIMATE,ID ELSE
	ERRMSG="CAN NOT OPEN ESTIMATE FILE"
	MAT EST.REC = ''
   END

*  INITIALIZE VARIABLES 
 

   PAPERSTR<1,-1> = EST.RL.JOB.TYPE<1,COMP,1>
   PAPERSTR<1,-1> = EST.RL.PREV.EST<1,COMP,1>
   PAPERSTR<1,-1> = EST.RL.TYPE.CHG<1,COMP,1>
   PAPERSTR<1,-1> = OCONV(EST.RL.DIM.AC<1,COMP,1>,"MD4")
   PAPERSTR<1,-1> = OCONV(EST.RL.DIM.AR<1,COMP,1>,"MD4")
   PAPERSTR<1,-1> = EST.RL.SETS<1,COMP,1>
   PAPERSTR<1,-1> = EST.RL.SETS<1,COMP,2>
   PAPERSTR<1,-1> = EST.RL.CPY.DIR<1,COMP,1>
   PAPERSTR<1,-1> = EST.RL.CPY.DIR<1,COMP,2>  ;*T21704
   PAPERSTR<1,-1> = OCONV(EST.RL.GAP<1,COMP,1>,"MD4")
   PAPERSTR<1,-1> = EST.RL.DIE.SHAPE<1,COMP,1>
   PAPERSTR<1,-1> = OCONV(EST.RL.GAP.CALC<1,COMP,1>,"MD4")
   READ DESC FROM ESTIMATE.RES.SHAPE, CONO:EST.RL.DIE.SHAPE ELSE
     DESC = ""
   END
   PAPERSTR<1,-1>=DESC

*
  CCTR.CNT=DCOUNT(EST.RL.PRESS.CCTR<1,COMP>,SVM)
   FOR I=1 TO CCTR.CNT
      PRESSCCTR<1,-1> = EST.RL.PRESS.CCTR<1,COMP,I>
      MATREAD CCTR.REC FROM COST.CNTR,CONO:EST.RL.PRESS.CCTR<1,COMP,I> ELSE
        * CCTR.DESC = "*** Unknown Cost Center ***"
	 MAT CCTR.REC = ''	
      END
      PRESSCCTRDESC<1,-1> = CCTR.DESC
      READV RF.TYPE FROM EQUIPMENT,CONO:EST.RL.PRESS.CCTR<1,COMP,I>,14 ELSE RF.TYPE='F'
      *CCTRSTR<1,-1> = RF.TYPE
      PRODCOLOR<1,-1> = EST.PROD.COLORS.1<1,COMP,I>
      BACKPRINT<1,-1> = EST.RL.BACKPRINT<1,COMP,I>
      ADHESIVE<1,-1> = EST.RL.ADHESIVE<1,COMP,I>
      FULLSPOT<1,-1> = EST.RL.FULL.SPOT<1,COMP,I>
      RLFOIL<1,-1> = EST.RL.FOIL<1,COMP,I>
      FOILSPEED<1,-1> = EST.RL.FOIL.SPEED<1,COMP,I>
      OVERLAM<1,-1> = EST.RL.OVERLAM<1,COMP,I>
      RLKINDS<1,-1> = EST.RL.KINDS<1,COMP,I>
      PLATECHANGE<1,-1> = EST.RL.PLATE.CHANGES<1,COMP,I>
      COLORCHANGES<1,-1> = EST.RL.COLOR.CHANGES<1,COMP,I>
      SPROCKET<1,-1> = EST.RL.SPROCKET<1,COMP,I>
      COLMIX<1,-1> = EST.RL.COL.MIX<1,COMP,I>
      RLSSCREEN<1,-1> = EST.RL.SSCREEN<1,COMP,I>
      GRAVURE<1,-1> = EST.RL.GRAVURE<1,COMP,I>
      EMBOSS<1,-1> = EST.RL.EMBOSS<1,COMP,I>

      EST_RL_PRESS_CCTR<1,I> = EST.RL.PRESS.CCTR<1,1,I>

      EST_RL_MR_DIE<1,I>=OCONV(EST.RL.MR.DIE<1,1,I>,"MD2")
      EST_RL_MR_FDIE<1,I>=OCONV(EST.RL.MR.FDIE<1,1,I>,"MD2")
      EST_RL_MR_FOIL<1,I>=OCONV(EST.RL.MR.FOIL<1,1,I>,"MD2")
      EST_RL_MR_PLATE<1,I>=OCONV(EST.RL.MR.PLATE<1,1,I>,"MD2")
      EST_RL_MR_COL_MIX<1,I>=OCONV(EST.RL.MR.COL.MIX<1,1,I>,"MD2")
      EST_RL_MR_LIN_SLITS<1,I>=OCONV(EST.RL.MR.LIN.SLITS<1,1,I>,"MD2")
      EST_RL_MR_COLORS<1,I>=OCONV(EST.RL.MR.COLORS<1,1,I>,"MD2")
      EST_RL_MR_COL_CHANGE<1,I>=OCONV(EST.RL.MR.COL.CHANGE<1,1,I>,"MD2")
      EST_RL_MR_SPROCKET<1,I>=OCONV(EST.RL.MR.SPROCKET<1,1,I>,"MD2")
      EST_RL_MR_SSCREEN<1,I>=OCONV(EST.RL.MR.SSCREEN<1,1,I>,"MD2")
      EST_RL_MR_GRAVURE<1,I>=OCONV(EST.RL.MR.GRAVURE<1,1,I>,"MD2")
      EST_RL_MR_EMBOSS<1,I>=OCONV(EST.RL.MR.EMBOSS<1,1,I>,"MD2")
      EST_RL_MR_OVERLAM<1,I>=OCONV(EST.RL.MR.OVERLAM<1,1,I>,"MD2")
      EST_RL_MR_CSETDOWN<1,I>=OCONV(EST.RL.MR.CSETDOWN<1,1,I>,"MD2")
      EST_RL_MR_DSETDOWN<1,I>=OCONV(EST.RL.MR.DSETDOWN<1,1,I>,"MD2")
      EST_RL_MR_FSETDOWN<1,I>=OCONV(EST.RL.MR.FSETDOWN<1,1,I>,"MD2")
      EST_RL_MR_SSETDOWN<1,I>=OCONV(EST.RL.MR.SSETDOWN<1,1,I>,"MD2")
      EST_RL_MR_GSETDOWN<1,I>=OCONV(EST.RL.MR.GSETDOWN<1,1,I>,"MD2")
      EST_RL_MR_ESETDOWN<1,I>=OCONV(EST.RL.MR.ESETDOWN<1,1,I>,"MD2")
      EST_RL_MR_OSETDOWN<1,I>=OCONV(EST.RL.MR.OSETDOWN<1,1,I>,"MD2")
	     
   NEXT I

   CCTRSTR = PRESSCCTR :"#": PRESSCCTRDESC :"#": PRODCOLOR :"#": BACKPRINT :"#": ADHESIVE :"#": FULLSPOT  :"#"   
   CCTRSTR = CCTRSTR : RLFOIL :"#": FOILSPEED  :"#": OVERLAM  :"#": RLKINDS  :"#": PLATECHANGE  :"#": COLORCHANGES  :"#": SPROCKET :"#"   
   CCTRSTR = CCTRSTR : COLMIX :"#": RLSSCREEN  :"#": GRAVURE  :"#": EMBOSS 
	
   MAKE.READY.VALUES = EST_RL_MR_DIE : "^" : EST_RL_MR_FDIE : "^" : EST_RL_MR_FOIL : "^" : EST_RL_MR_PLATE : "^" : EST_RL_MR_COL_MIX : "^" : EST_RL_MR_LIN_SLITS : "^" : EST_RL_MR_COLORS : "^" : EST_RL_MR_COL_CHANGE : "^" : EST_RL_MR_SPROCKET : "^" : EST_RL_MR_SSCREEN : "^" : EST_RL_MR_GRAVURE 
   MAKE.READY.VALUES = MAKE.READY.VALUES : "^" : EST_RL_MR_EMBOSS : "^" : EST_RL_MR_OVERLAM : "^" : EST_RL_MR_CSETDOWN : "^" : EST_RL_MR_DSETDOWN : "^" : EST_RL_MR_FSETDOWN : "^" : EST_RL_MR_SSETDOWN : "^" : EST_RL_MR_GSETDOWN : "^" : EST_RL_MR_ESETDOWN : "^" : EST_RL_MR_OSETDOWN : "^" : EST_RL_PRESS_CCTR
*
*--- Display Die Details
*
DIESTR=""
DIE_DESC=""
   DIE.CNT = DCOUNT(EST.RL.DIE<1,COMP>,SVM)
   FOR I = 1 TO DIE.CNT
      RLDIESTR<1,-1> = EST.RL.DIE<1,COMP,I>
      DIEREPEATSTR<1,-1> = OCONV(EST.RL.DIE.REPEAT<1,COMP,I>,'MD4')
      DIETYPESTR<1,-1> = EST.RL.DIETYPE<1,COMP,I>
      DIENOACRSTR<1,-1> = EST.RL.DIE.NO.ACR<1,COMP,I>
      DIENOARDSTR<1,-1> = EST.RL.DIE.NO.ARD<1,COMP,I>
      DIECYLIDSTR<1,-1> = EST.RL.DIE.CYL.ID<1,COMP,I>
      PRINTGEARSSTR<1,-1> = EST.RL.PRINTGEARS<1,COMP,I>
      PRINTARSTR<1,-1> = EST.RL.PRINTAR<1,COMP,I>
      DIEPRESSNOSTR<1,-1> = EST.RL.DIE.PRESS.NO<1,COMP,I>
      
      IF EST.RL.DIE<1,COMP,I> # '#' THEN
        READV RLDIE.DESC FROM ESTIMATE.RES.DIE,CONO:EST.RL.DIE<1,COMP,I>,1 THEN 
		DIE_DESC<1,-1> = RLDIE.DESC
	  END ELSE
	           DIE_DESC<1,-1>='*** Missing Die ***'
         END
     END ELSE
        IF EST.RL.BUTT<1,COMP,I>='Y' THEN
             DIE_DESC<1,-1>='** Butt Cut **'
        END ELSE
            DIE_DESC<1,-1> = 'New Die Required'
        END
     END
    NEXT I

	DIESTR = DIEPRESSNOSTR : "!" : RLDIESTR : "!" : DIE_DESC : "!" : DIETYPESTR : "!" : DIENOACRSTR : "!" : DIENOARDSTR : "!" : DIEREPEATSTR : "!" : DIECYLIDSTR : "!" 
       DIESTR = DIESTR : PRINTGEARSSTR : "!" : PRINTARSTR  


*
*--- Display Stock Details
*

   STOCKSTR=""

   PROD.CNT = DCOUNT(EST.PROD.OS.USAGE<1,COMP>,SVM)
   IF PROD.CNT = 0 THEN PCNT = 1 ELSE PCNT = PROD.CNT
   FOR I = 1 TO PCNT
      OSUSAGESTR<1,-1> = EST.PROD.OS.USAGE<1,COMP,I>
      OSPRODSTR<1,-1> = EST.PROD.OS.PROD<1,COMP,I>
      ACTWIDTHSTR<1,-1> = OCONV(EST.RL.ACT.WIDTH<1,COMP,I>,'MD4')
      OSDESCSTR<1,-1> = EST.PROD.OS.DESC<1,COMP,I>
      OSWIDTHSTR<1,-1> = OCONV(EST.PROD.OS.WIDTH<1,COMP,I>,'MD4')
      PAPCALSTR<1,-1> = OCONV(EST.RL.PAP.CAL<1,COMP,I>,'MD4')
      PAPGSMSTR<1,-1> = OCONV(EST.RL.PAP.GSM<1,COMP,I>,'MD4')
      INVIDSTR<1,-1> = EST.PROD.INV.ID<1,COMP,I>
   NEXT I

STOCKSTR = OSUSAGESTR : "!" : OSPRODSTR : "!": OSDESCSTR : "!" : OSWIDTHSTR : "!" : ACTWIDTHSTR : "!" : PAPCALSTR : "!" : PAPGSMSTR : "!" : INVIDSTR
*	    CB,CB001,10.0000,GLOSS BOOK,0.0038,0.0070,0.0000,
*
*---- Scroll Paper MSI and Price
*

PROD.REF.NO = 1
MSIPRICESTR = ""
TOTMSISTR =""
UNITPRICESTR =""
PAPERCOSTSTR=""
CNT=""

  EST.RL.PAP.MSI=CHANGE(EST.RL.PAP.MSI,SM,VM)
  EST.RL.PAP.PRICE=CHANGE(EST.RL.PAP.PRICE,SM,VM)


 *  CNT = DCOUNT(EST.RL.PAP.MSI,SM)

 *  MSI.CNT = DCOUNT(EST.RL.PAP.MSI<1,COMP,PROD.REF.NO>,"!")
 *  IF MSI.CNT = 0 THEN MCNT = 1 ELSE MCNT = MSI.CNT
   
 * FOR J=1 TO CNT
 *  FOR I = 1 TO MCNT
 *     TOT.MSI = FIELD(EST.RL.PAP.MSI<1,COMP,J>,"!",I)
 *     UNIT.PR = FIELD(EST.RL.PAP.PRICE<1,COMP,J>,"!",I)
 *     TOTMSISTR<1,-1> = TOT.MSI
 *     UNITPRICESTR<1,-1> = OCONV(UNIT.PR,"MD4")
 *     PAPERCOSTSTR<1,-1> = OCONV(INT((TOT.MSI * (UNIT.PR/100))+.5),"MD2")
 *  NEXT I
 *  TOTMSISTR = TOTMSISTR : "^"
 *  UNITPRICESTR = UNITPRICESTR : "^"
 *  PAPERCOSTSTR = PAPERCOSTSTR : "^"	
  * PAPERSTR = PAPERSTR : "^"
 * NEXT J

FINALSTR = ""
*FINALSTR = PAPERSTR :"$$": CCTRSTR :"$$": DIESTR :"$$": STOCKSTR :"$$": TOTMSISTR :"$$":  UNITPRICESTR :"$$":  PAPERCOSTSTR :"$$": MAKE.READY.VALUES
FINALSTR = PAPERSTR :"$$": CCTRSTR :"$$": DIESTR :"$$": STOCKSTR :"$$": EST.RL.PAP.MSI :"$$":  EST.RL.PAP.PRICE :"$$":  PAPERCOSTSTR :"$$": MAKE.READY.VALUES


ERRMSG = RBO.setProperty('','ProdDefnSub1Info',FINALSTR)
ERRMSG = RBO.setProperty('','EST_RL_PP_INCLUDE_str',EST.RL.PP.INCLUDE)

RETURN

