SUBROUTINE IVCPR_GET_DIV_FISCAL_MONTH
********************************************************************************
*   Author:-Sk. Zahoor Ahmed
*   Program name :- IVCPR_GET_DIV_FISCAL_MONTH
*   Created:- 5/17/2005
*------------------------------------------------------------------------------*
*
* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB PMC_REPORTS
OPEN '','COMPANY' TO COMPANY ELSE ERRMSG="COMPANY FILE IS MISSING"; GOTO 93000
OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE MISSING'; GOTO 93000
OPEN '','PMC_REPORTS' TO PMC_REPORTS ELSE ERRMSG = 'CONTROL FILE MISSING'; GOTO 93000

STATUS = RBO.getProperty('','ID',PPSD_ID)
STATUS = RBO.getProperty('','PPDField01',DIV_CODE)
STATUS = RBO.getProperty('','PPDField02',STARTING_INVOICE)
STATUS = RBO.getProperty('','PPDField03',ENDING_INVOICE)

  PRPT_ID = FIELD(PPSD_ID, "!", 4) ;* PMC_REPORTS ID
  REPORT_ID = FIELD(PRPT_ID,",",1)
   UserID = FIELD(PPSD_ID, "!", 1) ;* User ID
   PPSID = FIELD(PPSD_ID, "!", 2) ;* PMC_PROCESS ID
   SessionID = FIELD(PPSD_ID, "!", 3) ;* IE Session ID
   CONO = FIELD(PPSD_ID, "!", 5)

   IF FIELD(PPSD_ID, "!", 6) = "Email" THEN
      Email_Flag = "M"
   END ELSE
      Email_Flag = "V"
   END

 
  MATREAD PRPT.REC FROM PMC_REPORTS, REPORT_ID ELSE
     MESG = 'Cannot READ PMC_REPORTS record!'
     STATUS = RBO.setProperty('', 'ServerStatus', 1)
     STATUS = RBO.setProperty('', 'ServerMessage', MESG)
     RETURN
  END
   PPDREC = ""
   LAST_LINE = DCOUNT(PRPT.PROMPTS<1>,@VM)
   FOR II = 1 TO LAST_LINE ;* These are the prompt values submitted from ASP
      DUMMY = ""
      TEST = 'PPDField': II "R%2"
      STATUS = RBO.getProperty('', TEST, DUMMY)
      PPDREC<II> = DUMMY
   NEXT II

GOSUB FIRST_PART
IF CHK_FLAG = 1 THEN 
   MATREAD COMP.REC FROM COMPANY, CONO ELSE GOTO 999999
	STATUS = RBO.setProperty('','Cono',CONO)
	STATUS = RBO.setProperty('','TEMP',"JCFISCAL")
	STATUS = RBO.setProperty('', 'DIV_CODE',DIV_CODE)
	CALL GET_DIV_FISCAL_MONTH
END ELSE
	STATUS = RBO.setProperty('', 'ServerStatus', 1)
END
RETURN

FIRST_PART:
**************
IF PPSID = "IVCPR" THEN
	CMD = "SSELECT DAILY.INVOICE WITH PRT.DATE AND WITH DI_LIST_DATE AND WITH TRANS.FLG # 'CM' AND WITH TRANS.FLG # 'DM' AND WITH CONO = ":CONO
	IF PPDREC<2> # "ALL" THEN
		CMD := " AND WITH TRANS >= ":PPDREC<2>
		CMD := " AND WITH TRANS <= ":PPDREC<3>
	END
	IF PPDREC<1> # "ALL" THEN
		CMD := " AND WITH DI.DIV = ":PPDREC<1>
	END
END
IF PPSID = "IVCCMPR" THEN
	CMD = "SSELECT DAILY.INVOICE WITH PRT.DATE AND WITH TRANS.FLG = 'CM' AND WITH CONO = ":CONO:" AND WITH DI_LIST_DATE" 
	IF PPDREC<2> # "ALL" THEN
		CMD := " AND WITH TRANS >=":PPDREC<2>
		CMD := " AND WITH TRANS <=":PPDREC<3>
	END
	IF PPDREC<1> # "ALL" THEN
		CMD := " AND WITH DI.DIV = ":PPDREC<1>
	END
END
IF PPSID = "IVCDMPR" THEN
	CMD = "SSELECT DAILY.INVOICE WITH PRT.DATE AND WITH TRANS.FLG = 'DM' AND WITH CONO = ":CONO:" AND WITH DI_LIST_DATE"
	IF PPDREC<2> # "ALL" THEN
		CMD := " AND WITH TRANS >=":PPDREC<2>
		CMD := " AND WITH TRANS <=":PPDREC<3>
	END
	IF PPDREC<1> # "ALL" THEN
		CMD := " AND WITH DI.DIV = ":PPDREC<1>	
	END
END
IF PPSID = "JCSSHP" THEN
	CMD = "SSELECT DAILY.SHIP WITH PRINT.DATE # '' AND WITH CONO = ":CONO
	CMD := " AND WITH DATE >= '":PPDREC<1>	
	CMD := "' AND WITH DATE <= '":PPDREC<2>:"'"
	IF PPDREC<3> # "ALL" THEN
		CMD := " AND WITH DIV = ":PPDREC<3>
	END
END
IF PPSID = "JCSPTM" THEN
	STATUS = RBO.getProperty('','PPDField04',SHIFT)
	CMD = "SSELECT DAILY.TIME.MATL WITH PRINT.DATE # '' AND WITH CONO = ":CONO
	CMD := " AND WITH DATE >= '":PPDREC<1>:"' AND WITH DATE <= '":PPDREC<2>:"'"
	IF PPDREC<3> # "ALL" THEN
		CMD := " AND WITH DTM.DIV = ":PPDREC<3>
	END
	IF PPDREC<4> # "ALL" THEN
		CMD := " AND WITH SHIFT = ":PPDREC<4>
	END
END
IF PPSID = "JCSPOP" THEN
	CMD = "SSELECT DAILY.OSP WITH PRINT.DATE AND WITH CONO = ":CONO:" AND WITH IN.DATE >= '":PPDREC<1>:"' AND WITH IN.DATE <= '":PPDREC<2>:"'"
	IF PPDREC<3> # "ALL" THEN
		CMD := " AND WITH DIV = ":PPDREC<3>
	END
END
IF PPSID = "JCSPMSE" THEN
	CMD = "SSELECT DAILY.MISC WITH PRINT.DATE # '' AND WITH CONO = ":CONO:" AND WITH DATE >= '":PPDREC<1>:"' AND WITH DATE <= '":PPDREC<2>:"'"
	IF PPDREC<3> # "ALL" THEN
		CMD := " AND WITH DIV = ":PPDREC<3>
	END
END

IF PPSID = "JCSPTE" THEN
	CMD = "SSELECT DAILY.TIME WITH PRINT.DATE # '' AND WITH CONO = ":CONO:" AND WITH DLB.DATE >= '":PPDREC<1>:"' AND WITH DLB.DATE <= '":PPDREC<2>:"'"
	IF PPDREC<3> # "ALL" THEN
		CMD := " AND WITH DLB.DIV =":PPDREC<3>
	END
	IF PPDREC<4> # "ALL" THEN
		CMD := " AND WITH SHIFT =":PPDREC<4>
	END
END

IF PPSID = "JCSPRCLS" THEN
	CMD = "SSELECT DAILY.RCLS WITH PRINT.DATE # '' AND WITH CONO = ":CONO:" AND WITH DRC.DATE >= '":PPDREC<1>:"' AND WITH DRC.DATE <= '":PPDREC<2>:"'"
	IF PPDREC<3> # "ALL" THEN
		CMD := " AND WITH DRC.DIV = ":PPDREC<3>
	END
	IF PPDREC<4> # "ALL" THEN
		CMD := " AND WITH DRC.F.TYPE = ":PPDREC<4>
	END
END 
IF PPSID = "JCSPREV" THEN
	CMD = "SSELECT DAILY.REVERSE WITH PRINT.DATE # '' AND WITH CONO = ":CONO:" AND WITH DATE >= '":PPDREC<1>:"' AND WITH DATE <= '":PPDREC<2>:"'"
	IF PPDREC<3> # "ALL" THEN
		CMD := " AND WITH DIV = ":PPDREC<3>
	END
	IF PPDREC<4> # "ALL" THEN
		CMD := " AND WITH TYPE = ":PPDREC<4>
	END
END
IF PPSID = "JCSPME" THEN
	CMD = "SSELECT DAILY.MATL BY DMT.PROD BY DMT.WHSE BY DMT.LOC BY DMT.R.S.ID BY USAGE.SEQ  WITH CONO = ":CONO
	IF PPDREC<1> = "R" THEN
	 CMD := " AND WITH PROD.TYPE # 'SHEET' AND WITH PROD.TYPE # 'ROLL'"
	 CMD := " AND WITH PROD.TYPE # 'LROLL' AND WITH PROD.TYPE # 'PCOAT'"
	END ELSE 
	  IF PPDREC<1> = "P" THEN
	    CMD := " AND WITH PROD.TYPE = 'SHEET'"
	  END
	END
	 CMD := " AND WITH DMT.DATE <= ":'"': PPDREC<2> :'"'
	IF PPDREC<3> # "ALL" THEN
	 CMD := " AND WITH DMT.DIV = ":PPDREC<3>
	END
	 CMD := " AND WITH PRINT.DATE"
    IF PPDREC<1> = "P" THEN
	CMD :=" OR WITH PROD.TYPE = 'ROLL' AND WITH CONO = ":CONO
	CMD :=" AND WITH DMT.DATE <= ":'"': PPDREC<2> :'"'
	IF PPDREC<3> # "ALL" THEN
	CMD :=" AND WITH DMT.DIV = ":PPDREC<3>
	END
	CMD :=" AND WITH PRINT.DATE"

	CMD :=" OR WITH PROD.TYPE = 'LROLL' AND WITH CONO = ":CONO
	CMD :=" AND WITH DMT.DATE <= ":'"': PPDREC<2> :'"'

	IF PPDREC<3> # "ALL" THEN
	CMD :=" AND WITH DMT.DIV = ":PPDREC<3>
	END
	CMD :=" AND WITH PRINT.DATE"

	CMD :=" OR WITH PROD.TYPE = 'PCOAT' AND WITH CONO = ":CONO
	CMD :=" AND WITH DMT.DATE <= ":'"': PPDREC<2> :'"'

	IF PPDREC<3> # "ALL" THEN
	CMD :=" AND WITH DMT.DIV =":PPDREC<3>
	END
	CMD :=" AND WITH PRINT.DATE"
    END
END

UDTEXECUTE CMD CAPTURING MESG
RECORD_IDS = ""
CHK_FLAG = 0

  DATA=1
 LOOP

  READNEXT STR_ID ELSE DATA=0
  WHILE DATA DO
   CHK_FLAG = 1	
 REPEAT
RETURN
93000
RETURN
999999
RETURN
