SUBROUTINE CHECK_PO
********************************************************************************
*   Program name :- CHECK_PO
*   Created:- 5/15/2003
*------------------------------------------------------------------------------*
*
* PROGRAMMER : G.PURUSHOTHAM RAO
* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB PO
$INCLUDE POS.CPYLIB APP.REQ
* Insert method code here
   OPEN '','OUTSIDE.PO' TO OUTSIDE.PO ELSE
      ERRMSG = 'OUTSIDE.PO FILE IS MISSING'
      GOTO 93000
   END

   OPEN '','MISC.PO' TO MISC.PO ELSE
      ERRMSG = 'MISC.PO FILE IS MISSING'
      GOTO 93000
   END

   OPEN '','PO' TO PO ELSE 
      ERRMSG = 'PO FILE IS MISSING'
      GOTO 93000
   END

 OPEN '','REG.REQ' TO REG.REQ ELSE ERRMSG = 'REG.REQ FILE IS MISSING'; GOTO 93000

OPEN '','APP.REQ' TO APP.REQ ELSE
   ERRMSG = 'APP.REQ FILE IS MISSING'; GOTO 93000
END


STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
STATUS = RBO.getProperty('','ID',ID)
STATUS = RBO.getProperty('','Req_Type',REQ_TYPE)


USER.ID = PMCProperty<1,3>
CONO = PMCProperty<1,4>
BEGIN CASE
	CASE REQ_TYPE = "R"

               READ REC FROM PO, ID THEN
                  ERRMSG = "Regular PO #" :  ID[4,99] : " already exists on file"
                  GOTO 93000
               END

	CASE REQ_TYPE = "O"

               READ REC FROM OUTSIDE.PO, ID THEN
                  ERRMSG = "Outside PO #" :  ID[4,99] : "  already exists on file"
                  GOTO 93000
               END

	CASE REQ_TYPE = "M"

               READ REC FROM MISC.PO, ID THEN
                  ERRMSG = "Miscellaneous PO #" :  ID[4,99] : "  already exists on file"
                  GOTO 93000
               END
END CASE

  STATUS = RBO.setProperty('','ServerStatus',0)        
  STATUS = RBO.setProperty('','ServerMessage',"") 
RET.FLAG=1
MATREAD PO.REC FROM REG.REQ,ID THEN
  DIV.OWNER=PO.DIV.OWNER
  *IF DIV=00 THEN
   * DIV="ALL"
  *END
  

IF DIV.OWNER = "00" THEN 
      APP.REQ.ID = CONO:USER.ID:"!ALL"
      MATREAD APP.REQ.REC FROM APP.REQ,APP.REQ.ID THEN
         IF APP.STATUS = "N" THEN
            RET.FLAG = 0
         END
      END ELSE
         RET.FLAG = 0
      END
   END ELSE
      APP.REQ.ID = CONO:USER.ID:"!ALL"
      MATREAD APP.REQ.REC FROM APP.REQ,APP.REQ.ID THEN
         IF APP.STATUS = "N" THEN
            MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":DIV.OWNER THEN
               IF APP.STATUS = "N" THEN
                  RET.FLAG = 0
               END
            END ELSE
               RET.FLAG = 0
            END
         END
      END ELSE
         APP.REQ.ID = CONO:USER.ID:"!":DIV.OWNER
         MATREAD APP.REQ.REC FROM APP.REQ,APP.REQ.ID THEN
            IF APP.STATUS = "N" THEN
               RET.FLAG = 0
            END
         END ELSE
            RET.FLAG = 0
         END
      END
   END


     *     MATREAD APP.REQ.REC FROM APP.REQ,CONO:USER.ID:"!":DIV THEN
      *      IF APP.STATUS = "N" THEN
*	       RET.FLAG=0
*	     END 
 *         END ELSE
*	      RET.FLAG=0
 *         END 
IF NOT(RET.FLAG) THEN
  ERRMSG="Profile for user ":USER.ID:" is either missing or is inactive"
  GOTO 93000
END     

END
* End of method code
RETURN

93000 
  STATUS = RBO.setProperty('','ServerStatus',1)        
  STATUS = RBO.setProperty('','ServerMessage',ERRMSG) 
  RETURN

99999 
RETURN

