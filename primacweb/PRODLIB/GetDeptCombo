SUBROUTINE GetDeptCombo
********************************************************************************
*   Program name :- 
*   Created:- 5/23/2006
*------------------------------------------------------------------------------*
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB DIVISION
$INCLUDE PMC.CPYLIB DEPARTMENT
$INCLUDE PMC.CPYLIB COST.CNTR
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE JES.CPYLIB ESTIMATE.RES
$INCLUDE JES.CPYLIB ESTIMATE.DIV
$INCLUDE JES.CPYLIB ESTIMATE.DEPT
$INCLUDE CPYLIB SCREEN.COM
$INCLUDE CPYLIB FILE.VARS
$INCLUDE JES.CPYLIB JES.FILE.VARS
$INCLUDE CPYLIB CHAR
$INCLUDE CPYLIB SYSCOM

* Insert method code here
ERRMSG=""
   OPEN "","ESTIMATE.DEPT" TO FESTIMATE.DEPT ELSE
      ERRMSG = "CANNOT LOCATE ESTIMATE.DEPT FILE"
      GOTO 90000
   END
   OPEN "","ESTIMATE.WORK" TO ESTIMATE.WORK ELSE
      ERRMSG = "CANNOT LOCATE ESTIMATE.WORK FILE"
      GOTO 90000
   END
   OPEN "","ESTIMATE.DIV" TO ESTIMATE.DIV ELSE
      ERRMSG = "CANNOT LOCATE ESTIMATE.DIV FILE"
      GOTO 90000
   END
   OPEN "","DIVISION" TO DIVISION ELSE
      ERRMSG = "CANNOT LOCATE DIVISION FILE"
      GOTO 90000
   END
   OPEN "","DEPARTMENT" TO DEPARTMENT ELSE
      ERRMSG = "CANNOT LOCATE DEPARTMENT FILE"
      GOTO 90000
   END
   	
EST.DIV=""; DivisionInfo=""; EST.DEPT=""; EST.DEPT.TYPE=""; EST.DEPT.DESC=""; DIV=""
CONO=""
STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
STATUS=RBO.getProperty('','Division',DIV)
*STATUS=RBO.getProperty('','',)

CONO=PMCProperty<1,4>
EST.DIV=DIV
   IF EST.DEPT = "" THEN
      NEW.REC = 1
      FND = 1
      MATREAD ESTV.REC FROM ESTIMATE.DIV, CONO:EST.DIV ELSE FND = 0
      IF FND THEN
	  EST.DEPT = ESTV.DEPT
         EST.DEPT.TYPE = ESTV.DEPT.TYPE
         EST.DEPT.DESC = ESTV.DEPT.DESC
      END ELSE
	  MATREAD DIV.REC FROM DIVISION, CONO:FIELD(EST.DIV,"-",1) ELSE MAT DIV.REC = ""
         EST.DEPT = DIV.DEPT
         DEPT.CNT = COUNT(EST.DEPT,VM) + (EST.DEPT # "")
         FOR D = 1 TO DEPT.CNT
            READ DDATA FROM DEPARTMENT, CONO:EST.DEPT<1,D> ELSE DDATA = "??????????"
            EST.DEPT.TYPE<1,D> = DDATA<7>
            EST.DEPT.DESC<1,D> = DDATA<2>
         NEXT D
      END
    END
   DivisionInfo = EST.DEPT :"$$": EST.DEPT.TYPE :"$$": EST.DEPT.DESC
  STATUS=RBO.setProperty('','DivisionInfo',DivisionInfo)
RETURN

90000 *
IF ERRMSG # "" THEN
	STATUS=RBO.setProperty('','ServerStatus',1)
	STATUS=RBO.setProperty('','ServerMessage',ERRMSG)
END
RETURN

