SUBROUTINE OPSCME_PURGE
********************************************************************************
*   Program name :- OPSCME_PURGE
*   Created:- 9/30/2003
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB VOID.INVOICES
$INCLUDE OPS.CPYLIB ORDER
$INCLUDE OPS.CPYLIB BOL
$INCLUDE OPS.CPYLIB ORDER.INVOICE
$INCLUDE CPYLIB CHAR
* Insert method code here
ERRMSG = ""
OPEN "","VOID.INVOICES" TO VOID.INVOICES ELSE
	ERRMSG = "Cannot locate the VOID.INVOICES file"
	GOTO 99999
END
OPEN "","ORDER" TO ORDER ELSE
	ERRMSG = "Cannot locate the ORDER file"
	GOTO 99999
END
OPEN "","BOL" TO BOL ELSE
	ERRMSG = "Cannot locate the BOL file"
	GOTO 99999
END
OPEN "","DAILY.ORDER.INVOICE" TO DAILY.ORDER.INVOICE ELSE
	ERRMSG = "Cannot locate the DAILY.ORDER.INVOICE file"
	GOTO 99999
END
OPEN "","ORDER.INVOICE" TO ORDER.INVOICE ELSE
	ERRMSG = "Cannot locate the ORDER.INVOICE file"
	GOTO 99999
END

*val = RBO.getProperty('','ID',ID) ;* INVOICE NUMBER
*CONO = ID[1,3]
*IVC.NO = ID[4,99]

val = RBO.getProperty('','IVC_NO',ID) ;* ID
IVC.NO = ID
STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
CONO = PMCProperty<1,4>


val = RBO.getProperty('','IVC_CHG_CODE',IVC.CHG.ORDER)

val = RBO.getProperty('','IVC_ADDR1',IVC.ADDR1)
val = RBO.getProperty('','IVC_ADDR2',IVC.ADDR2)
val = RBO.getProperty('','IVC_ADDR3',IVC.ADDR3)
val = RBO.getProperty('','IVC_ADDR4',IVC.ADDR4)
val = RBO.getProperty('','IVC_BOL_NO',IVC.BOL.NO)
val = RBO.getProperty('','IVC_DATE',IVC.DATE) ;* CR.MEMO DATE
val = RBO.getProperty('','IVC_CUST_NO',IVC.CUST.NO)
val = RBO.getProperty('','IVC_CUST_NAME',IVC.CUST.NAME)
val = RBO.getProperty('','IVC_ORDER_NO',IVC.ORDER.NO)
val = RBO.getProperty('','IVC_PO_NO',IVC.PO.NO)

*STATUS = RBO.setProperty('','ServerMessage','Input -' :)
*RETURN

21000 *
O.NOS="";O.JURS="";O.SHIP=""
OCNT=DCOUNT(IVC.CHG.ORDER,VM)
FOR OPTR=1 TO OCNT
	ORD=IVC.CHG.ORDER<1,OPTR>
      	IF ORD # "" THEN
       	LOCATE ORD IN O.NOS,1 SETTING P ELSE O.NOS<P>=ORD
      	END
NEXT OPTR

JCNT=DCOUNT(O.NOS,AM)
FOR J=1 TO JCNT
	MATREADU ORD.REC FROM ORDER, CONO:O.NOS<J> ELSE
       	RELEASE ORDER, CONO:O.NOS<J>
             	*ERRMSG="CANNOT LOCATE ORDER RECORD - ":O.NOS<J>
             	*GOSUB 90000;GOTO 504
	END
       LOCATE IVC.NO IN ORD.INV.NO<1>,1 SETTING FND ELSE FND=0
       IF FND=0 THEN
       	RELEASE ORDER, CONO:O.NOS<J>
       END ELSE
       	IF ORD.INV.DATE<1,FND>="" THEN
       		ORD.INV.NO=DELETE(ORD.INV.NO,1,FND,0)
              	ORD.INV.DATE=DELETE(ORD.INV.DATE,1,FND,0)
              	ORD.INV.CAT=DELETE(ORD.INV.CAT,1,FND,0)
              	ORD.INV.AMT=DELETE(ORD.INV.AMT,1,FND,0)
              	ORD.INV.BAL=DELETE(ORD.INV.BAL,1,FND,0)
              END
              MATWRITE ORD.REC ON ORDER, CONO:O.NOS<J>
	END
504
NEXT J
MAT VOI.REC=""
VOI.DATE=IVC.DATE
VOI.ORDNO=IVC.ORDER.NO
VOI.CUST.NO=IVC.CUST.NO
VOI.CUST.NAME=IVC.CUST.NAME
VOI.ADDR1=IVC.ADDR1
VOI.ADDR2=IVC.ADDR2
VOI.ADDR3=IVC.ADDR3
VOI.ADDR4=IVC.ADDR4
VOI.PO=IVC.PO.NO
VOI.DEL.DATE=DATE()
MATREAD ORD.REC FROM ORDER, CONO:IVC.ORDER.NO ELSE MAT ORD.REC=""
VOI.SLSMAN=ORD.SLSMN
VOI.DIV = ORD.DIV ;* T23278
MATWRITE VOI.REC ON VOID.INVOICES, CONO:IVC.NO
*T22472 v
MATREADU BOL.REC FROM BOL, CONO:IVC.BOL.NO THEN
	BOL.INVOICE = ''
       BOL.INV.DATE = ''
       BOL.INV.AMT = ''
       MATWRITE BOL.REC ON BOL,CONO:IVC.BOL.NO
END ELSE RELEASE BOL,CONO:IVC.BOL.NO
*T22472 ^
DELETE DAILY.ORDER.INVOICE, CONO:IVC.NO

99999
CLOSE ORDER
CLOSE BOL
CLOSE ORDER.INVOICE
CLOSE DAILY.ORDER.INVOICE
CLOSE VOID.INVOICES
IF ERRMSG # "" THEN
	VAL = RBO.setProperty('','ServerStatus','E')
	VAL = RBO.setProperty('','ServerMessage',ERRMSG)
END ELSE
	VAL = RBO.setProperty('','ServerStatus','')
END
* End of method code
RETURN
