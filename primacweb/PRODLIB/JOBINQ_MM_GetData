SUBROUTINE JOBINQ_MM_GetData
********************************************************************************
*   Program name :- JOBINQ_MM_GetData
*   Created:- 12/10/2002
*   Author:- L. Ross
*   Gets info for Job Inquiry 'MM' option.
*------------------------------------------------------------------------------*
*
*  SKJDHFD

* In Properties:
* --------------
*  
IN_PARAM=''
*
* Out Properties:
* ---------------
*  
OUT_PARAM=''
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JCS.CPYLIB JOB
$INCLUDE PMC.CPYLIB CSR.MEMO.TRACK
$INCLUDE PMC.CPYLIB PO
$INCLUDE POS.CPYLIB OUTSIDE.PO
$INCLUDE PMC.CPYLIB SECURITY
$INCLUDE PMC.CPYLIB CUSTOMER
$INCLUDE CPYLIB CHAR

;* open files

ERRMSG=''
IF FILEINFO(JOB,0)=0 THEN
   OPEN '','JOB' TO JOB ELSE
      ERRMSG<1,-1>='JOB FILE IS MISSING'
   END
END
IF FILEINFO(CSR.MEMO.TRACK,0)=0 THEN
   OPEN '','CSR.MEMO.TRACK' TO CSR.MEMO.TRACK ELSE
      ERRMSG<1,-1>='CSR.MEMO.TRACK FILE IS MISSING'
   END
END
IF FILEINFO(SECURITY,0)=0 THEN
   OPEN '','SECURITY' TO SECURITY ELSE
      ERRMSG<1,-1>='SECURITY FILE IS MISSING'
   END
END
IF FILEINFO(CUSTOMER,0)=0 THEN
   OPEN '','CUSTOMER' TO CUSTOMER ELSE
      ERRMSG<1,-1>='CUSTOMER FILE IS MISSING'
   END
END
IF FILEINFO(PO,0)=0 THEN
   OPEN '','PO' TO PO ELSE
      ERRMSG<1,-1>='PO FILE IS MISSING'
   END
END
IF FILEINFO(OUTSIDE.PO,0)=0 THEN
   OPEN '','OUTSIDE.PO' TO OUTSIDE.PO ELSE
      ERRMSG<1,-1>='OUTSIDE.PO FILE IS MISSING'
   END
END
IF ERRMSG#'' THEN GOTO 93000

;* initialize


;* get ID

STATUS=RBO.getProperty('','ID',ID)
CONO=ID[1,3]
STATUS=RBO.getProperty('','MemoKey',CSR.MEMO.TRACK.ID)

;* get database values

CSTATUS=''
CSTATDESC=''
SECCODE=''
SECNAME=''
CUSTNUM=''
CUSTNAME=''
SALESORD=''
POTYPE=''
PONUM=''
JOBNUM=''
INVNUM=''
ESTNUM=''
INVOICENUM=''
FUDATE=''
MEMOS=''
MEMODATES=''
MEMOCODES=''
RESPS=''
UNKNOWN = STR('?',30)
MATREAD CSR.MEMO.TRACK.REC FROM CSR.MEMO.TRACK, CONO:CSR.MEMO.TRACK.ID ELSE
  ERRMSG='Cannot read record ':CONO:CSR.MEMO.TRACK.ID:' from CSR.MEMO.TRACK file'
  GOTO 93000
END
CSTATUS = CSR.STATUS
IF CSR.STATUS = 'P' THEN
  CSTATDESC = 'PURGE'
END ELSE
  CSTATDESC = '     '
END
SECCODE = CSR.SEC.CODE
MATREAD SEC.REC FROM SECURITY, CONO:CSR.SEC.CODE THEN
  USERNAME = SEC.NAME
END ELSE
  USERNAME = 'UNKNOWN'
END
SECNAME = USERNAME
CUSTNUM = CSR.CUST.NUM
MATREAD CUST.REC FROM CUSTOMER, CONO:CSR.CUST.NUM THEN
  CUSTNAME = CUST.NAME 'L#30'
END ELSE
  CUSTNAME = UNKNOWN
END
SALESORD = CSR.SALES.ORD.NUM
IF CSR.PO.NUM # '' AND CSR.PO.TYPE = '' THEN
  READ REC FROM PO, CONO:CSR.PO.NUM THEN
    CSR.PO.TYPE = 'R'
  END ELSE
    READ REC FROM OUTSIDE.PO, CONO:CSR.PO.NUM THEN
      CSR.PO.TYPE = 'O'
    END
  END
END
POTYPE = CSR.PO.TYPE
PONUM = CSR.PO.NUM
JOBNUM = CSR.JOB.NUM
INVNUM = CSR.INVENTORY.NUM
ESTNUM = CSR.EST.NUM
INVOICENUM = CSR.INVOICE.NUM
FUDATE = OCONV(CSR.FU.DATE,'D2/')
MEMOS = CSR.MEMO
FOR I = DCOUNT(CSR.MEMO.DATE,VM) TO 1 STEP -1
  CSR.MEMO.DATE<1,I> = OCONV(CSR.MEMO.DATE<1,I>,'D2/')
NEXT I
MEMODATES = CSR.MEMO.DATE
MEMOCODES = CSR.MEMO.CODE
RESPS = CSR.RESP

STATUS=RBO.setProperty('','CSRStatus',CSTATUS)
STATUS=RBO.setProperty('','CSRStatusDesc',CSTATDESC)
STATUS=RBO.setProperty('','SecCode',SECCODE)
STATUS=RBO.setProperty('','SecName',SECNAME)
STATUS=RBO.setProperty('','CustCode',CUSTNUM)
STATUS=RBO.setProperty('','CustName',CUSTNAME)
STATUS=RBO.setProperty('','SalesOrder',SALESORD)
STATUS=RBO.setProperty('','POType',POTYPE)
STATUS=RBO.setProperty('','PONumber',PONUM)
STATUS=RBO.setProperty('','JobNumber',JOBNUM)
STATUS=RBO.setProperty('','InventoryNo',INVNUM)
STATUS=RBO.setProperty('','EstNumber',ESTNUM)
STATUS=RBO.setProperty('','InvoiceNo',INVOICENUM)
STATUS=RBO.setProperty('','FollowDate',FUDATE)
STATUS=RBO.setProperty('','Memo',MEMOS)
STATUS=RBO.setProperty('','MemoCode',MEMOCODES)
STATUS=RBO.setProperty('','MemoDate',MEMODATES)
STATUS=RBO.setProperty('','Response',RESPS)
GOTO 99999

93000 
STATUS = RBO.setProperty('','ServerStatus',1)        
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)  

99999 
RETURN

