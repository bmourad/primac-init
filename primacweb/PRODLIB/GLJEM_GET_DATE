SUBROUTINE GLJEM_GET_DATE
********************************************************************************
*   Program name :- GLJEM_GET_DATE
*   Created:- 2/10/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

* Insert method code here
   STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
   STATUS = RBO.getProperty('','DEFDATE',DEFDATE)
   STATUS = RBO.getProperty('','DEFPERIOD',DEFPERIOD)
   CONO=PMCProperty<1,4>

   OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE IS MISSING'; GOSUB 91000 

  READ REC FROM CONTROL, CONO:"FISCAL" ELSE
      ERRMSG = "CONTROL FISCAL IS MISSING"; GOSUB 91000
   END
   READ PERIOD.REC FROM CONTROL, CONO:"ACCT.PERIODS" ELSE
      PERIOD.REC = ""
      PERIOD.REC<1> = 12
   END
   NUM.PERIODS = PERIOD.REC<1>
   YEAR = REC<1>[1,4]
   CURR = REC<1>[5,2]
   IF CURR < 1 OR CURR > NUM.PERIODS THEN
      ERRMSG = "INVALID CURRENT PERIOD IN CONTROL FISCAL"; GOSUB 91000
   END
   READ OPENDATES FROM CONTROL, CONO : "OPENDATES" ELSE
      ERRMSG = 'NEED TO SETUP GLS OPEN DATES'
      GOSUB 91000
   END
   	
   IF DEFPERIOD < 1 OR DEFPERIOD > NUM.PERIODS OR NOT(NUM(DEFPERIOD)) THEN GOTO 91000
   IF CURR > (NUM.PERIODS-2) AND DEFPERIOD < 3 THEN JE.PERIOD = YEAR + 1 ELSE JE.PERIOD = YEAR
   JE.PERIOD = JE.PERIOD:DEFPERIOD	


  IF DEFDATE = "" THEN
      XYR = JE.PERIOD[1,4]; XPR = JE.PERIOD[5,2]
      BEGIN CASE
         CASE XYR = YEAR AND XPR < NUM.PERIODS
            JE.DATE = OPENDATES<XPR+1> - 1
         CASE XYR = YEAR
            ECD.DEFAULT = OCONV(OPENDATES<1>,"D/")
            ECD.DEFAULT = ECD.DEFAULT[1,6] : ECD.DEFAULT[7,4] + 1
            JE.DATE = ICONV(ECD.DEFAULT,"D/") - 1
         CASE XPR < NUM.PERIODS
            ECD.DEFAULT = OCONV(OPENDATES<XPR+1>,"D/")
            ECD.DEFAULT = ECD.DEFAULT[1,6] : ECD.DEFAULT[7,4] + 1
            JE.DATE = ICONV(ECD.DEFAULT,"D/") - 1
      END CASE
   END ELSE
      JE.DATE=DEFDATE
   END
   JE.DATE1=OCONV(JE.DATE,"D2/")
   STATUS = RBO.setProperty('','DEFDATE',JE.DATE1)

* End of method code
RETURN

91000
	STATUS = RBO.setProperty('','ServerStatus','1')
       STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN
