SUBROUTINE GetDepartmentInfo
********************************************************************************
*   Program name :- GetDepartmentInfo
*   Created:- 7/16/2003
*   Created By : B.Krishna
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB DIVISION
$INCLUDE PMC.CPYLIB DEPARTMENT
$INCLUDE PMC.CPYLIB COST.CNTR
$INCLUDE JES.CPYLIB ESTIMATE
$INCLUDE JES.CPYLIB ESTIMATE.RES
$INCLUDE JES.CPYLIB ESTIMATE.DIV
$INCLUDE JES.CPYLIB ESTIMATE.DEPT
$INCLUDE CPYLIB FILE.VARS
$INCLUDE JES.CPYLIB JES.FILE.VARS
$INCLUDE CPYLIB CHAR

STATUS = RBO.getProperty('','ID',ID)
CONO=ID[1,3]
EST.KEY=ID[4,99]

  OPEN "","ESTIMATE" TO ESTIMATE ELSE
      ERRMSG = "CANNOT LOCATE ESTIMATE FILE"
      RETURN
   END

  OPEN "","ESTIMATE.RES" TO ESTIMATE.RES ELSE
      ERRMSG = "CANNOT LOCATE ESTIMATE.RES FILE"
      RETURN
   END

   OPEN "","COST.CNTR" TO COST.CNTR ELSE
      ERRMSG = "CANNOT LOCATE COST.CNTR FILE"
      RETURN
   END

QTY.CNT =""
STRVAL =""

* Insert method code here
   MATREAD EST.REC FROM ESTIMATE,CONO:EST.KEY THEN
           STRVAL = STRVAL : "!" : EST.KEY
 	    STRVAL = STRVAL : "!" : EST.CUST.NAME
	    STRVAL = STRVAL : "!" : EST.COMMENTS<1,1>
	    STRVAL = STRVAL : "!" : EST.DEPT
	    STRVAL = STRVAL : "!" : EST.DEPT.DESC
*added v
	    FLAGCNT = DCOUNT(EST.COMP.FLAG,VM)
	    STRINGFLAG = ""
           FOR J=1 TO FLAGCNT	
		IF STRINGFLAG # "" THEN
		   STRINGFLAG	= STRINGFLAG:VM:EST.COMP.FLAG<1,J,1>
		END ELSE
		   STRINGFLAG = EST.COMP.FLAG<1,J,1>:" "
		END	
	    NEXT J		 
	    STRVAL = STRVAL : "!" : STRINGFLAG
*added ^
	   *STRVAL = STRVAL : "!" : EST.COMP.FLAG
      	    QTY.CNT = DCOUNT(EST.QTY,VM)
   END ELSE
   END
STRVAL = STRVAL : "!"
MATREAD EST.RL.REC FROM ESTIMATE.RES,ID THEN 
    FOR X = 1 TO QTY.CNT
    STRVAL<1,-1>=INT(FIELD(EST.RL.TOTAL.PC<1,1,1>,"!",X)/12+.5)
    NEXT X
STRVAL = STRVAL : "!"

READV CCTR.DESC FROM COST.CNTR,CONO:EST.RL.PRESS.CCTR<1,1,1>,1 ELSE CCTR.DESC = ""
   STRVAL<1,-1> = EST.RL.PRESS.CCTR<1,1,1>
   STRVAL<1,-1> = CCTR.DESC
END ELSE

END

STRVAL<1,-1> =STRVAL : "!" :  EST.DIV : "!" : EST.PROD.OS.DESC : "!" : OCONV(EST.PROD.OS.WIDTH,"MD4")

STATUS = RBO.setProperty('','DepartmentInfo',STRVAL)
* End of method code
RETURN

