SUBROUTINE APVOUM_POTYPE_JOB_PERIOD
********************************************************************************
*   Program name :- APVOUM_POTYPE_JOB_PERIOD
*   Created:- 2/8/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE CPYLIB CHAR
$INCLUDE PMC.CPYLIB FISCAL
$INCLUDE PMC.CPYLIB GLTABLE

* Insert method code here

STATUS = RBO.getProperty('','FiscalPeriod',MON)
STATUS = RBO.getProperty('','Cono',CONO)
ERRMSG = ""

OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE IS MISSING';GOTO 93000


MATREAD GLTABLE.REC FROM CONTROL ,CONO:"GLTABLE" ELSE
       ERRMSG = "GLTABLE IS MISSING FROM CONTROL FILE";GOTO 93000
END
READ PERIOD.REC FROM CONTROL, CONO:"ACCT.PERIODS" ELSE
       PERIOD.REC = ""
       PERIOD.REC<1> = 12
END
NUM.PERIODS = PERIOD.REC<1>


MATREAD FISCAL.REC FROM CONTROL, CONO:"APVFISCAL" ELSE
       ERRMSG = "CONTROL RECORD APVFISCAL IS MISSING";GOTO 93000
END
*T28331 v
READ JCFDATA FROM CONTROL, CONO:"JCFISCAL" ELSE
       ERRMSG = "CONTROL RECORD JCFISCAL IS MISSING";GOTO 93000
END
*T28331 ^

YEAR = FR.CURR.PER<1,1>[1,4]
MONTH = FR.CURR.PER<1,1>[5,2]

IF MONTH < 1 OR MONTH > NUM.PERIODS THEN
       ERRMSG = "ERROR IN CONTROL RECORD APVFISCAL"; GOTO 93000
END      

PERIODS = STR("0",2-LEN(MONTH)):MONTH
IF MONTH < (NUM.PERIODS -1) THEN
         PERIODS = PERIODS:VM:STR("0",2-LEN(MONTH+1)):MONTH+1
         PERIODS = PERIODS:VM:STR("0",2-LEN(MONTH+2)):MONTH+2
END ELSE
         IF MONTH = (NUM.PERIODS -1) THEN PERIODS = (NUM.PERIODS -1):VM:NUM.PERIODS:VM:"01"
         IF MONTH = NUM.PERIODS THEN PERIODS = NUM.PERIODS:VM:"01":VM:"02"
END   
     
IF MONTH > (NUM.PERIODS - 2) AND MON < 3 THEN
        TVO.MON = YEAR + 1
END ELSE
        TVO.MON = YEAR
END
TVO.MON = TVO.MON : STR("0",2-LEN(MON)) : MON

JCS.PERIOD = JCFDATA<1,1>

APFISCAL = TVO.MON; JCFISCAL = JCS.PERIOD

BEGIN CASE
      CASE APFISCAL[1,4] = JCFISCAL[1,4]
      CASE APFISCAL[1,4] > JCFISCAL[1,4]
           XX=APFISCAL[5,2] + NUM.PERIODS
           APFISCAL = APFISCAL[1,4]:XX
END CASE

*        IF TVO.MON[5,2] GT JCS.PERIOD[5,2] THEN
 IF APFISCAL[5,2] > JCFISCAL[5,2] THEN
*           DIFF = TVO.MON[5,2] - JCS.PERIOD[5,2]
    DIFF = APFISCAL[5,2] - JCFISCAL[5,2]
*T28292 ^
    IF DIFF GE 3 THEN
       ERRMSG = "Period cannot be more than 2 periods ahead of the JCS period when JOB is used."
    END
 END
*T28292 v
*        IF TVO.MON[5,2] LT JCS.PERIOD[5,2] THEN
 IF TVO.MON LT JCS.PERIOD THEN
*           ERRMSG = "Period cannot be less than the current JCS period of ":JCS.PERIOD[5,2]:", when JOB is used."
    ERRMSG = "Period cannot be less than the JCS period of ":JCS.PERIOD:", when JOB is used."
*T28292 ^
 END
93000*
      STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN




