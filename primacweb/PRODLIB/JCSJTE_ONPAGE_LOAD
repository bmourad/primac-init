SUBROUTINE JCSJTE_ONPAGE_LOAD
********************************************************************************
*   Program name :- JCSJTE_ONPAGE_LOAD
*   Created:- 3/1/2004
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE JCS.CPYLIB DAILY.TIME
$INCLUDE PMC.CPYLIB EMPLOYEE
$INCLUDE JCS.CPYLIB FACTOR
$INCLUDE PMC.CPYLIB DIVISION

  OPEN '','DAILY.TIME' TO DAILY.TIME ELSE ERRMSG='DAILY.TIME FILE IS MISSING'; GOTO 93000
  OPEN '','EMPLOYEE' TO EMPLOYEE ELSE ERRMSG='EMPLOYEE FILE IS MISSING'; GOTO 93000
  OPEN '','CONTROL' TO CONTROL ELSE ERRMSG='CONTROL FILE IS MISSING'; GOTO 93000
  OPEN '','FACTOR' TO FACTOR ELSE ERRMSG='FACTOR FILE IS MISSING'; GOTO 93000
  OPEN '','DIVISION' TO DIVISION ELSE ERRMSG='DIVISION FILE IS MISSING'; GOTO 93000

STATUS=RBO.getProperty('','PMCProperty',PMCProperty)
CONO   = PMCProperty<1,4>

 MAT FCTR.REC = ''
  MAT DLB.REC = '';MAT EMP.REC = ''
********** CONTROL CONO:'DAILY.TIME' VALUES
	READU TIME.ENT.SEQ FROM CONTROL, CONO:"DAILY.TIME" ELSE TIME.ENT.SEQ = 10001

************ EMPLOYEE VALUES	
CMD = "SSELECT EMPLOYEE WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD CAPTURING MESG

EMP_CODES_LIST = ""
EMP_DESCS_LIST = ""
EMP_TERM_DATE_LIST = ""
EMP_REHR_DATE_LIST = ""

DATA = 1
LOOP
	READNEXT ID THEN
		EMP_CODES_LIST<1,-1> = ID[4,99]
	END ELSE
		DATA = 0  
	END
WHILE DATA DO
REPEAT

	EMP_COUNT = DCOUNT(EMP_CODES_LIST,@VM)

	FOR X = 1 TO EMP_COUNT

		MATREAD EMP.REC FROM EMPLOYEE, CONO : EMP_CODES_LIST<1,X> THEN

			EMP_DESCS_LIST<1,X> = EMP_CODES_LIST<1,X> : "_" : EMP.LAST.NAME : "_" : EMP.FRST.NAME
			EMP_TERM_DATE_LIST<1,X> = OCONV(EMP.TERM.DATE,"D4/")
			EMP_REHR_DATE_LIST<1,X> = EMP.REHR.DATE
		END
	NEXT X

**********DAILY.TIME VALUE
DAILY_LIST = ""
D_EMP = ""
D_DATE = ""
D_SHIFT = ""

CMD = "SSELECT DAILY.TIME WITH CONO='" : CONO : "'"
UDTEXECUTE CMD

DATA = 1
LOOP
	READNEXT ID THEN
		DAILY_LIST<1,-1> = ID[4,99]
	END ELSE
		DATA = 0
	END
WHILE DATA DO

	DAILY_CNT = DCOUNT(DAILY_LIST,@VM)
	FOR X = 1 TO DAILY_CNT
		D_EMP<1,X> = FIELD(DAILY_LIST<1,X>,"*",1)
		D_DATE<1,X> = OCONV(FIELD(DAILY_LIST<1,X>,"*",2),"D2/")
		D_SHIFT<1,X> = FIELD(DAILY_LIST<1,X>,"*",3)
	NEXT X
REPEAT

********** FACTOR CODE VALUES

FACTOR_LIST = ""

CMD = "SSELECT FACTOR WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD

DATA = 1
LOOP
	READNEXT ID THEN
		FACTOR_LIST<1,-1> = ID[4,99]
	END ELSE
		DATA = 0
	END
WHILE DATA DO
REPEAT

********** DIVISION CODES*************
CMD = "SSELECT DIVISION WITH CONO = '" : CONO : "'"
UDTEXECUTE CMD

DIV_CODES = ""
DATA =1
LOOP
  READNEXT ID THEN
	DIV_CODES<1,-1> = ID[4,99]
  END ELSE
	DATA = 0
  END

WHILE DATA DO
REPEAT



STATUS = RBO.setProperty('','EMP_CODES_LIST',EMP_CODES_LIST)
STATUS = RBO.setProperty('','EMP_DESCS_LIST',EMP_DESCS_LIST)
STATUS = RBO.setProperty('','EMP_TERM_DATE_LIST',EMP_TERM_DATE_LIST)
STATUS = RBO.setProperty('','EMP_REHR_DATE_LIST',EMP_REHR_DATE_LIST)
STATUS = RBO.setProperty('','MAX_SEQ',TIME.ENT.SEQ)
STATUS = RBO.setProperty('','DAILY_LIST',DAILY_LIST)
STATUS = RBO.setProperty('','D_EMP',D_EMP)
STATUS = RBO.setProperty('','D_DATE',D_DATE)
STATUS = RBO.setProperty('','D_SHIFT',D_SHIFT)
STATUS = RBO.setProperty('','FACTOR_LIST',FACTOR_LIST)
STATUS = RBO.setProperty('','DIV_CODES',DIV_CODES)
* End of method code
RETURN

93000*
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)


