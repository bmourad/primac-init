SUBROUTINE GETDEFAULTROLLS
********************************************************************************
*   Program name :- GETDEFAULTROLLS
*   Created:- 11/21/2005
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE ICS.CPYLIB INVENTORY
$INCLUDE ICS.CPYLIB INV.CNV
$INCLUDE PMC.CPYLIB PO

* Insert method code here
OPEN '','INVENTORY' TO INVENTORY ELSE ERRMSG = 'INVENTORY FILE IS MISSING'; GOTO 91000
OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = 'CONTROL FILE IS MISSING'; GOTO 91000
OPEN '','REG.REQ' TO REG.REQ ELSE 	ERRMSG = 'REG.REQ FILE IS MISSING'; GOTO 91000

STATUS = RBO.getProperty('','ProdNum',PROD_NUM) 
STATUS = RBO.getProperty('','ID',ID)
CONO = ID[1,3]

STATUS = RBO.getProperty('','TotOnOrd',PO.TOT.ONORD)
LN=1
DEFFUN UOM.CONVERSION.CALC(QTY,FROM.UOM,TO.UOM,WGT,WIDTH,ROND,LN)  
MATREAD INV.REC FROM INVENTORY, CONO:PROD_NUM THEN
*STATUS=RBO.setProperty('','TEMPVAL',"TYPE:":INV.PAP.TYPE)
PO.UNIT.FLG<1,LN>=INV.UNIT<1,1>
PO.TOT.ONORD<1,LN>=PO.TOT.ONORD
VALUE=PO.TOT.ONORD

GOSUB 4000

IF DIFF.UM<LN> = "Y" THEN
			FROM.UOM = INV.UNIT<1,1>
			TO.UOM = INV.UNIT<1,2>
			STK.QTY = UOM.CONVERSION.CALC(PO.TOT.ONORD<1,LN>,FROM.UOM,TO.UOM,INV.M.WT,INV.PAP.WIDTH,'','')
			VALUE = UOM.CONVERSION.CALC(STK.QTY,TO.UOM,FROM.UOM,INV.M.WT,INV.PAP.WIDTH,'','')
			IF ICR.CNV<LN,2> = "MD0" THEN
				VALUE = ICONV(((VALUE/ICR.MT1<LN,2>)*ICR.DV1<LN,2>)*ICR.DV2<LN,2>,'MD0')
			END
			IF ICR.CNV<LN,1> = "MD0" THEN
				IF ICR.CNV<LN,2> # "MD0" THEN
					VALUE = VALUE * 10
				END
				P_VALUE = INT(((VALUE/ICR.DV1<LN,1>)*ICR.MT1<LN,1>)/ICR.DV2<LN,1> + .5)
				P_VALUE = ICONV(((VALUE/ICR.DV1<LN,1>)*ICR.MT1<LN,1>)/ICR.DV2<LN,1>,'MD0')
			END ELSE
				VALUE = VALUE * ICR.MT1<LN,1> * 10
				P_VALUE = OCONV(INT(VALUE/10) , "MD2")
			END
			IF ICR.CNV<LN,2> = "MD0" THEN
				P_VALUE = INT(((VALUE/ICR.DV1<LN,2>)*ICR.MT1<LN,2>)/ICR.DV2<LN,2> + .5)
				P_VALUE = ICONV(((VALUE/ICR.DV1<LN,2>)*ICR.MT1<LN,2>)/ICR.DV2<LN,2>,'MD0')
			END ELSE
				IF ICR.CNV<LN,1> = "MD0" THEN
					P_VALUE = OCONV(INT(VALUE/10), "MD2")
				END ELSE
					VALUE = OCONV(INT((VALUE/10)/ICR.MT1<LN,1>), "MD2")
				END
			END
END ELSE
			IF ICR.CNV<LN,1> = "MD0" THEN
				VALUE = ICONV(((VALUE/ICR.MT1<LN,1>)*ICR.DV1<LN,1>)*ICR.DV2<LN,1>,'MD0')
			END ELSE
				VALUE = VALUE * 10
			END
END
PO.TOT.ONORD<1,LN>=VALUE	
 
   BEGIN CASE
	CASE INV.PAP.TYPE = "ROLL" OR INV.PAP.TYPE = "LROLL" OR INV.PAP.TYPE = "PCOAT"
		RETURN_VALUE = "# Rolls"
	*CASE INV.PAP.TYPE = "SHEET" OR INV.PAP.TYPE = "REGULAR"
	CASE INV.PAP.TYPE = "SHEET"
		RETURN_VALUE = "# Skids"
	CASE 1	
		RETURN_VALUE = ""
   END CASE
*STATUS=RBO.setProperty('','TEMPVAL',"TYPE:":INV.PAP.TYPE)
BEGIN CASE

    CASE INV.PAP.TYPE = "ROLL"
   
      IF INV.AVG.DIA = "" OR INV.CORE.DIA = "" OR INV.PAP.WIDTH = "" OR INV.FACTOR = "" THEN
        ERRMSG ="Roll/skids calculations information missing"
        GOTO 91000
      END ELSE
      
          READ ROLL.VARIANCE FROM CONTROL, CONO: 'ROLL.VARIANCE' ELSE ROLL.VARIANCE = 5
          MIN.DIA = INV.AVG.DIA * ((100 - ROLL.VARIANCE)/100)
          MIN.ROLL.SZ=(((MIN.DIA/100)*(MIN.DIA/100))-((INV.CORE.DIA/100)*(INV.CORE.DIA/100)))*(INV.PAP.WIDTH/10000)*(INV.FACTOR/10000)/10
          O.R = "O"


          IF MIN.ROLL.SZ > 0 THEN
            DEFAULT = INT((PO.TOT.ONORD<1,LN>/1000/MIN.ROLL.SZ)+1)
          END ELSE
            DEFAULT = 0
          END
      END
     
    CASE INV.PAP.TYPE = "LROLL" OR INV.PAP.TYPE = "PCOAT"
 
 
	        

      IF INV.AVG.DIA = "" OR INV.CORE.DIA = "" OR INV.PAP.WIDTH = "" OR INV.FACTOR = "" THEN
        ERRMSG ="Roll/skids calculations information missing"
        GOTO 91000
      
      END ELSE
       
          READ ROLL.VARIANCE FROM CONTROL, CONO: 'ROLL.VARIANCE' ELSE ROLL.VARIANCE = 5
          MIN.DIA = INV.AVG.DIA * ((100 - ROLL.VARIANCE)/100)
          BEGIN CASE
            CASE INV.UNIT<1,3> = "FT"
              X = (MIN.DIA * MIN.DIA) - (INV.CORE.DIA * INV.CORE.DIA)
              MIN.ROLL.SZ = INT((X/10000)*3.1416/4*(100000/INV.FACTOR)/12+0.5)
              O.R = "O"
              IF MIN.ROLL.SZ > 0 THEN
                DEFAULT = INT((PO.TOT.ONORD<1,LN>/MIN.ROLL.SZ)+1)
              END ELSE
                DEFAULT = 0
              END
            CASE INV.UNIT<1,3> = "PC"
              X = (MIN.DIA * MIN.DIA) - (INV.CORE.DIA * INV.CORE.DIA)
              MIN.ROLL.SZ = INT((X/10000)*3.1416/4*(100000/INV.FACTOR)/10+0.5)
              O.R = "O"
              IF MIN.ROLL.SZ > 0 THEN
                DEFAULT = INT((PO.TOT.ONORD<1,LN>/MIN.ROLL.SZ)+1)
              END ELSE
                DEFAULT = 0
              END
            CASE INV.UNIT<1,3> = "MSI"
              X = (MIN.DIA * MIN.DIA) - (INV.CORE.DIA * INV.CORE.DIA)
              MIN.ROLL.SZ = INT((X/10000)*3.1416/4*(100000/INV.FACTOR)*(INV.PAP.WIDTH/10000)/1000+0.5)
              O.R = "O"
              IF MIN.ROLL.SZ > 0 THEN
                DEFAULT = INT((PO.TOT.ONORD<1,LN>/1000/MIN.ROLL.SZ)+1)
              END ELSE
                DEFAULT = 0
              END
          END CASE
        END
   
    CASE 1
        DEFAULT=""
  END CASE

STATUS=RBO.setProperty('','DEFAULT_ROLLS',DEFAULT)
END


RETURN
4000:
BEGIN CASE
   CASE INV.UNIT<1,2> = "SHT" AND INV.UNIT<1,3> = "LBS"
     ICR.CNV<LN,1> = "MD0"; ICR.DV2<LN,1> = 1
     ICR.DV1<LN,1> = INV.M.WT; ICR.MT1<LN,1> = 1
    CASE INV.UNIT<1,2> = "PC" AND INV.UNIT<1,3> = "MSI"
      ICR.CNV<LN,1> = "MD0"; ICR.DV2<LN,1> = 1
      ICR.DV1<LN,1> = INV.PAP.WIDTH/100; ICR.MT1<LN,1> = 10
    CASE INV.UNIT<1,2> = "FT" AND INV.UNIT<1,3> = "MSI"
      ICR.CNV<LN,1> = "MD0"; ICR.DV2<LN,1> = 12
      ICR.DV1<LN,1> = INV.PAP.WIDTH/100; ICR.MT1<LN,1> = 100
    CASE 1
      ICR.CNV<LN,1> = "MD2"; ICR.DV2<LN,1> = 1
      ICR.DV1<LN,1> = 10; ICR.MT1<LN,1> = INV.SBR
  END CASE
  BEGIN CASE
    CASE PO.UNIT.FLG<1,LN> = "SHT" AND INV.UNIT<1,3> = "LBS"
      ICR.CNV<LN,2> = "MD0"; ICR.DV2<LN,2> = 1
      ICR.DV1<LN,2> = INV.M.WT; ICR.MT1<LN,2> = 1
    CASE PO.UNIT.FLG<1,LN> = "PC" AND INV.UNIT<1,3> = "MSI"
      ICR.CNV<LN,2> = "MD0"; ICR.DV2<LN,2> = 1
      ICR.DV1<LN,2> = INV.PAP.WIDTH/100; ICR.MT1<LN,2> = 10
    CASE PO.UNIT.FLG<1,LN> = "FT" AND INV.UNIT<1,3> = "MSI"
      ICR.CNV<LN,2> = "MD0"; ICR.DV2<LN,2> = 12
      ICR.DV1<LN,2> = INV.PAP.WIDTH/100; ICR.MT1<LN,2> = 100
    CASE 1
      ICR.CNV<LN,2> = "MD2"; ICR.DV2<LN,2> = 1
      ICR.DV1<LN,2> = 10; ICR.MT1<LN,2> = 1
  END CASE
  IF PO.UNIT.FLG<1,LN> # INV.UNIT<1,2> THEN DIFF.UM<LN> = "Y" ELSE DIFF.UM<LN> = "N"

RETURN
91000:
STATUS = RBO.setProperty('','ServerStatus',1)        
STATUS = RBO.setProperty('','ServerMessage',ERRMSG) 
RETURN
