SUBROUTINE Validate_ReferenceNum
********************************************************************************
*   Program name :- Validate_ReferenceNum
*   Created:- 11/7/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H
$INCLUDE GLS.CPYLIB POSTED.JE
* Insert method code here
ERRMSG = ""
PJE.ID = ""
JE.DB.AMT = ""
JE.CR.AMT = ""
JE.REV.NO =""
LCNT = ""
  OPEN '','CONTROL' TO CONTROL ELSE
     ERRMSG = "CONTROL FILE IS MISSING"
     GOTO 99999
  END
  OPEN '','POSTED.JE' TO POSTED.JE ELSE
     ERRMSG = "POSTED.JE FILE IS MISSING"
     GOTO 99999
  END
OPEN '','DIVISION' TO DIVISION ELSE
     ERRMSG = "DIVISION FILE IS MISSING"
     GOTO 99999
  END


STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
STATUS = RBO.getProperty('','RevJE_Num',RJE.NO)
STATUS = RBO.getProperty('','RevJE_Period',RJE.PERIOD)
CONO = PMCProperty<1,4>
RJE.NO=RJE.NO'R%8'
PJE.ID = CONO:RJE.NO:'!':RJE.PERIOD
	       
               MATREAD PJE.REC FROM POSTED.JE, PJE.ID ELSE
                  ERRMSG = 'Posted JE record is not on file.'
                  GOTO 99999 
               END
               IF PJE.REV.DATE # "" THEN
                  ERRMSG = 'This journal has already been reversed on ':OCONV(PJE.REV.DATE,'D2/')
                  GOTO 99999
               END
		JE.REV.NO = RJE.NO:'!':RJE.PERIOD
               LCNT = DCOUNT(PJE.ACCT,@VM)
               FOR L = 1 TO LCNT
                  JE.DB.AMT<1,L> = OCONV(PJE.CR.AMT<1,L>,'MD2')
	           JE.CR.AMT<1,L> = OCONV(PJE.DB.AMT<1,L>,'MD2')
               NEXT L
            	 READ DIV.DESC FROM DIVISION, CONO:PJE.HEAD.DIV ELSE DIV.DESC = ""
		            
		STATUS = RBO.setProperty('','JE_HEAD_DIV',PJE.HEAD.DIV:"!":DIV.DESC)
		STATUS = RBO.setProperty('','REF_DESC',PJE.DESC)
		STATUS = RBO.setProperty('','PJE_ACCT',PJE.ACCT)
		STATUS = RBO.setProperty('','JE_DIV',PJE.DIV)
		STATUS = RBO.setProperty('','JE_DEPT',PJE.DEPT)
		STATUS = RBO.setProperty('','JE_CCTR',PJE.CCTR)
		STATUS = RBO.setProperty('','JE_DB_AMT',JE.DB.AMT)
		STATUS = RBO.setProperty('','JE_CR_AMT',JE.CR.AMT)
		STATUS = RBO.setProperty('','JE_CMT',PJE.CMT)
		STATUS = RBO.setProperty('','JE_REV_NO',RJE.NO)
		*STATUS = RBO.setProperty('','JE_DATE',OCONV(PJE.PDATE,'D2/'))
* End of method code
RETURN
99999 
  IF (TRIM(ERRMSG) # "") THEN
       STATUS = RBO.setProperty('','ServerStatus',1)
       STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
  END
* End of method code
RETURN


