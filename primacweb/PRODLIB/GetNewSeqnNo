SUBROUTINE GetNewSeqnNo
********************************************************************
* Copyright 1982 by Computer Business Associates (Vercom Software, Inc.)
* SYSTEM      - EPRIMAC
* PROGRAM     - GetNewSeqnNo
* BY          - MOHAMMED ABDUL MALIK
* DATE        - 07/21/2003  (mm/dd/yyyy)
* DESCRIPTION   This program gets the next available sequence No from Control Record
*		   
*ENDDOC
*************************************************************
$INCLUDE WWINSERT RBO.H

OPEN '','CONTROL' TO CONTROL ELSE
	ERRMSG = "CONTROL FILE IS MISSING"
	GOTO 93000
END

OPEN '','SLIT.TRANS' TO SLIT.TRANS ELSE
	ERRMSG = "SLIT.TRANS FILE IS MISSING"
	GOTO 93000
END
  OPEN '','PO' TO PO ELSE
    ERRMSG = 'PO FILE IS MISSING'; GOTO 93000
  END

STATUS = RBO.getProperty('','PMCProperty',PMCPROPERTY)
CONO = PMCPROPERTY<1,4>

         STATUS = RBO.getProperty('','ID',ID)
            IF ID = "N" THEN
              FND = 1
              READU SLIT.SEQ FROM CONTROL, CONO:"SLITCODE" ELSE SLIT.SEQ = "1"
              LOOP
              WHILE FND DO
                ID = STR("0",6-LEN(SLIT.SEQ)):SLIT.SEQ
                SLIT.SEQ = ID + 1
                IF SLIT.SEQ > 999999 THEN SLIT.SEQ = 1
                READU REC FROM SLIT.TRANS, CONO:ID:"S" ELSE
                  READU REC FROM PO, CONO:ID:"S" ELSE FND = 0
                END
                REC = "";RELEASE PO
                IF FND THEN RELEASE SLIT.TRANS, CONO:ID:"S"
              REPEAT
              WRITE SLIT.SEQ ON CONTROL, CONO:"SLITCODE"
              ID = CONO:ID:"S"
              STATUS = RBO.setProperty('','ID',ID)
              MSG = 'Note new Slit Transaction number'
              STATUS = RBO.setProperty('','NewMessage',MSG)
*              GOSUB 93000
            END

RETURN
93000
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
*STATUS = RBO.setError(ERRMSG)
RETURN
