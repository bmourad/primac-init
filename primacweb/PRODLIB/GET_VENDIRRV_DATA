SUBROUTINE GET_VENDIRRV_DATA
*THIS IS VEND.VOU.ACT
$INCLUDE WWINSERT RBO.H
$INCLUDE PMC.CPYLIB VEND
$INCLUDE APS.CPYLIB VEND.VOUCH.STATS
$INCLUDE APS.CPYLIB VEND.STATS
$INCLUDE APS.CPYLIB TEMP.VOUCHERS
$INCLUDE ICS.CPYLIB INV.CNV
$INCLUDE CPYLIB SYSCOM
$INCLUDE CPYLIB CHAR

TEMP_INPUT = ''
PMCProperty = ''
STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
STATUS = RBO.getProperty('','TEMP_INPUT',TEMP_INPUT)
LN.NO = TEMP_INPUT<1,1>
VEND.NUM = TEMP_INPUT<1,2>
OPTION = TEMP_INPUT<1,3> ;*HERE IT IS 'R'
CONO = PMCProperty<1,4>

  BEGIN.PAGE = 8
  PAGE.SIZE = 12
  LINE.SPACE = 1
  LINES = 0
  OLD.START.LINE=0
  VOUCH.NOS = ""
  MAT INV.CNV.REC = ""
  MAT TVO.REC = ""

OPEN "","VEND.STATS" TO VEND.STATS ELSE
	ERRMSG = "CANNOT OPEN VEND.STATS FILE"
	GOTO 91000
END
OPEN "","VEND" TO VEND ELSE
	ERRMSG = 'VENDOR FILE IS MISSING'
	GOTO 91000
END
OPEN "","VEND.VOUCH.STATS" TO VEND.VOUCH.STATS ELSE
	ERRMSG = "CANNOT OPEN VEND.VOUCH.STATS FILE"
	GOTO 91000
END


MATREAD VSTAT.REC FROM VEND.STATS, VEND.NUM:"!":OPTION ELSE
	MAT VSTAT.REC = ""
END

VOUCHER_NUMBERS = ''
VOUCHER_DATES = ''
INVOICE_NUMBERS = ''
INVOICE_DATES = ''
TOTAL_COST = ''
PERIOD = ''

*
**** SETUP FOR SYSTEM ERRMSGS
*
  SYS.TYPE = 1
  CALL SYSCOM(MAT SYSCOM.REC)
  IF LN.NO = "ALL" THEN
    PO.VOU = COUNT(VSTAT.VOUCH.NOS,VM) + (VSTAT.VOUCH.NOS # "")
    FOR X = 1 TO PO.VOU
      VOU.CNT = COUNT(VSTAT.VOUCH.NOS<1,X>,SVM) + (VSTAT.VOUCH.NOS<1,X> # "")
      FOR XX = 1 TO VOU.CNT
        LOCATE VSTAT.VOUCH.NOS<1,X,XX> IN VOUCH.NOS<1>,1 SETTING FND ELSE
          VOUCH.NOS<1,X> = VSTAT.VOUCH.NOS<1,X,XX>
        END
      NEXT XX
    NEXT X
  END ELSE
    VOU.CNT = COUNT(VSTAT.VOUCH.NOS<1,LN.NO>,SVM) + (VSTAT.VOUCH.NOS<1,LN.NO> # "")
    FOR XX = 1 TO VOU.CNT
      LOCATE VSTAT.VOUCH.NOS<1,LN.NO,XX> IN VOUCH.NOS<1>,1 SETTING FND ELSE
        VOUCH.NOS<1,XX> = VSTAT.VOUCH.NOS<1,LN.NO,XX>
      END
    NEXT XX
  END

  LINES = COUNT(VOUCH.NOS,VM) + (VOUCH.NOS # "")
  FOR LN = 1 TO LINES
        *MATREAD VVOS.REC FROM VEND.VOUCH.STATS, CONO:TVO.VEND<1,1>:"!":VOUCH.NOS<1,LN> ELSE
	 MATREAD VVOS.REC FROM VEND.VOUCH.STATS, VEND.NUM:"!":VOUCH.NOS<1,LN> ELSE
          MAT VVOS.REC = ""
        END
        IF VVOS.PROD = "" AND VVOS.SEQ.NO = "" THEN
          ERRMSG = "No Product associated with this voucher." ; GOSUB 91000
        END
	VOUCHER_NUMBERS<1,-1> = VOUCH.NOS<1,LN>
	VOUCHER_DATES<1,-1> = OCONV(VVOS.VOU.DATE, "D2/")
	INVOICE_NUMBERS<1,-1> = VVOS.INV.NO
	INVOICE_DATES<1,-1> = OCONV(VVOS.INV.DATE, "D2/")
	TOTAL_COST<1,-1> = OCONV(VVOS.TOT.COST, "MD2")
	PERIOD<1,-1> = VVOS.VOU.PERIOD
  NEXT
  STATUS = RBO.setProperty('','VVOS_VOU_NO',VOUCHER_NUMBERS)
  STATUS = RBO.setProperty('','VVOS_INV_NO',INVOICE_NUMBERS)
  STATUS = RBO.setProperty('','VVOS_VOU_DATE',VOUCHER_DATES)
  STATUS = RBO.setProperty('','VVOS_INV_DATE',INVOICE_DATES)
  STATUS = RBO.setProperty('','VVOS_TOT_COST',TOTAL_COST)
  STATUS = RBO.setProperty('','VVOS_VOU_PERIOD',PERIOD)
  GOTO 99999
RETURN

91000:
	STATUS = RBO.setProperty('','ServerStatus',1)
	STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN

99999:
RETURN
