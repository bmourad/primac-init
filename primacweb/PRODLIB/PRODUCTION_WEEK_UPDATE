SUBROUTINE PRODUCTION_WEEK_UPDATE
********************************************************************************
*   Program name :- PRODUCTION_WEEK_UPDATE
*   Created:- 3/6/2006
*------------------------------------------------------------------------------*
*

* In Properties:
* --------------
*  
*
* Out Properties:
* ---------------
*  
********************************************************************************
$INCLUDE WWINSERT RBO.H

$INCLUDE PMC.CPYLIB COMPANY
$INCLUDE PMC.CPYLIB FISCAL

OPEN '','CONTROL' TO CONTROL ELSE ERRMSG = "CONTROL FILE IS MISSING"; GOTO 93000

NPROD.REC=""
VM="ý"
STATUS = RBO.getProperty('','PMCProperty',PMCProperty)
STATUS = RBO.getProperty('','PRODUCTION_REC',PRODUCTION.REC)
STATUS = RBO.getProperty('','FiscalYear',FiscalYear)
YEAR=FiscalYear
NXTYR=YEAR+1
CONO = PMCProperty<1,4>
USER.ID = UPCASE(PMCProperty<1,3>)

PRODUCTION.REC = CHANGE(PRODUCTION.REC, "`", @AM)
NCNT2 = DCOUNT(PRODUCTION.REC<1>,@VM)
FOR I = 1 TO NCNT2
	PRODUCTION.REC<1,I> = ICONV(PRODUCTION.REC<1,I>, "D2/")
NEXT I
NCNT2 = DCOUNT(PRODUCTION.REC<8>,@VM)
FOR I = 1 TO NCNT2
	PRODUCTION.REC<8,I> = ICONV(PRODUCTION.REC<8,I>, "D2/")
NEXT I

IF PRODUCTION.REC = "" THEN
    NUM.PRODUCTION.WEEKS = 53
END

NUM.PRODUCTION.WEEKS = DCOUNT(PRODUCTION.REC<1>,VM)
READ NPROD.REC FROM CONTROL, CONO:NXTYR:"PRODUCTION.WEEKS" ELSE NPROD.REC = ''
CPROD.REC = PRODUCTION.REC
 FOR II = 1 TO 2
        IF II = 1 THEN PRODUCTION.REC = CPROD.REC ELSE PRODUCTION.REC = NPROD.REC
        NUM.PRODUCTION.WEEKS = DCOUNT(PRODUCTION.REC<1>,VM)
        FOR I = 1 TO NUM.PRODUCTION.WEEKS-1
          IF PRODUCTION.REC<1,I> > PRODUCTION.REC<1,I+1> THEN
            ERRMSG = "Dates not in Ascending Date Sequence for year "
            IF II = 1 THEN
              ERRMSG := YEAR
            END ELSE
              ERRMSG := NXTYR
            END
            GOSUB 93000; PRODUCTION.REC = CPROD.REC
          END
        NEXT I
 NEXT II
      ERRMSG=''
      IF CPROD.REC<1,1> # "" AND DCOUNT(CPROD.REC<1>,VM) < 52 THEN ERRMSG = YEAR
      IF NPROD.REC<1,1> # "" AND DCOUNT(NPROD.REC<1>,VM) < 52 THEN ERRMSG = NXTYR
      IF ERRMSG # "" THEN
        ERRMSG = "Less than 52 weeks setup for year ":ERRMSG
        GOSUB 93000; PRODUCTION.REC = CPROD.REC
      END


*STATUS = RBO.setProperty('','Period',CPROD.REC)
*STATUS = RBO.setProperty('','Division',NPROD.REC)
  IF CPROD.REC<1,1> # "" THEN WRITE CPROD.REC ON CONTROL, CONO:YEAR:"PRODUCTION.WEEKS"
  IF NPROD.REC<1,1> # "" THEN WRITE NPROD.REC ON CONTROL, CONO:NXTYR:"PRODUCTION.WEEKS"

* End of method code
RETURN

93000 *
STATUS = RBO.setProperty('','ServerStatus',1)
STATUS = RBO.setProperty('','ServerMessage',ERRMSG)
RETURN
