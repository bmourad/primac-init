*   PROCESSES THE FOLLOWING FILES:
*     privilege
*     SQLTables
*     SQLColumns
*     SQLStatistics
*  UPDATES privilege WITH CORRECT ADMINISTRATIVE USERID AND USER# ALSO
*  CREATES PUB LIC ENTRY FOR THOSE THAT HAVE NONE AND UPDATES USERID IN
*  THE PUBLIC ENTRY ATTRIBUTE 4
*  UPDATE THE TABLE OWNER (ATTRI #2 ) IN THE FILES:
*     SQLTables
*     SQLColumns
*     SQLStatistics
*COPY>CPYLIB>CHAR
PROMPT''
OPEN '','privilege' TO PRIV.FILE ELSE
   ERRMSG = "CANNOT OPEN privilege FILE"
   GOSUB 900
   GOTO 999
END
OPEN '','SQLTables' TO SQLT.FILE ELSE
   ERRMSG = "CANNOT OPEN SQLTables FILE"
   GOSUB 900
   GOTO 999
END
OPEN '','SQLColumns' TO SQLC.FILE ELSE
   ERRMSG = "CANNOT OPEN SQLColumns FILE"
   GOSUB 900
   GOTO 999
END
OPEN '','SQLStatistics' TO SQLS.FILE ELSE
   ERRMSG = "CANNOT OPEN SQLStatistics FILE"
   GOSUB 900
   GOTO 999
END
10*
    CRT @(-1)
    CRT @(0,5):"ENTER OLD USER ID: ":
    INPUT OLDID:
    CRT @(0,7):"ENTER OLD USER #: ":
    INPUT OLDNUM:
    CRT @(0,9):"ENTER NEW USER ID: ":
    INPUT NEWID:
    CRT @(0,11):"ENTER NEW USER #: ":
    INPUT NEWNUM:
    CRT @(0,13):"ARE THE ABOVE ENTRIES CORRECT (Y/N) :":
    INPUT RESP:
    IF RESP # "Y" THEN GOTO 10
20*    SET VARIABLES FOR THE FILE ATTRIBUTES FOR privilege FILE
      PUB.ATTR1 = "SELECT":VM:"INSERT":VM:"DELETE":VM:"UPDATE"
      PUB.ATTR2 = VM:VM:VM:"ALL"
      PUB.ATTR3 = 0:VM:0:VM:0:VM:0
      PUB.ATTR4 = NEWID:VM:NEWID:VM:NEWID:VM:NEWID
      OWN.ATTR1 = "OWNER"
      OWN.ATTR5 = "PUBLIC"
100*   Process the 'privilege' file
   SELECT PRIV.FILE
   CNT = 0
110*
   READNEXT ID ELSE GOTO 199
   IF FIELD(ID,'*',1) # OLDNUM THEN GOTO 110
   READ REC FROM PRIV.FILE,ID ELSE
      ERRMSG =  "CANNOT READ ":ID:" FROM PRIV.FILE"
      GOSUB 900
      GOTO 110
   END
   FILENAM = FIELD(ID,"*",2)
   NEWRECID = NEWNUM:"*":FILENAM
   REC<1> = OWN.ATTR1
   REC<5> = OWN.ATTR5
   CRT @(0,23): REC 
   PUBREC = ''
   PUBRECID = "PUBLIC*":FILENAM
   PUBREC<1> = PUB.ATTR1
   PUBREC<2> = PUB.ATTR2
   PUBREC<3> = PUB.ATTR3
   PUBREC<4> = PUB.ATTR4
   WRITE PUBREC ON PRIV.FILE,PUBRECID
   CRT @(0,23): PUBREC
   DELETE PRIV.FILE,ID
   WRITE REC ON PRIV.FILE,NEWRECID
   CNT = CNT + 1
   GOTO 110
199 *
   ERRMSG = "PROCESSED ":CNT:"  privilege RECORDS"
   GOSUB 900
200*  process the records in 'SQLTables' file
   SELECT SQLT.FILE
   CNT = 0
210*
   READNEXT ID ELSE GOTO 299
   READ SQLT.REC FROM SQLT.FILE, ID ELSE
      ERRMSG = "Cannot read ":ID:" from SQLTables file"
      GOSUB 900
      GOTO 210
   END
   SQLT.REC<2> = NEWID
   WRITE SQLT.REC ON SQLT.FILE, ID
   CRT @(0,23): SQLT.REC
   CNT = CNT + 1
   GOTO 210
299*
   ERRMSG = "PROCESSED ":CNT:"  SQLTables RECORDS"
   GOSUB 900
300*  process the records in 'SQLColumns' file
   SELECT SQLC.FILE
   CNT = 0
310*
   READNEXT ID ELSE GOTO 399
   READ SQLC.REC FROM SQLC.FILE, ID ELSE
      ERRMSG = "Cannot read ":ID:" from SQLColumns file"
      GOSUB 900
      GOTO 310
   END
   SQLC.REC<2> = NEWID
   WRITE SQLC.REC ON SQLC.FILE, ID
   CRT @(0,23): SQLC.REC
   CNT = CNT + 1
   GOTO 310
399*
   ERRMSG = "PROCESSED ":CNT:"  SQLColumns RECORDS"
   GOSUB 900
400*  process the records in 'SQLStatistics' file
   SELECT SQLS.FILE
   CNT = 0
410*
   READNEXT ID ELSE GOTO 499
   READ SQLS.REC FROM SQLS.FILE, ID ELSE
      ERRMSG = "Cannot read ":ID:" from SQLStatistics file"
      GOSUB 900
      GOTO 410
   END
   SQLS.REC<2> = NEWID
   WRITE SQLS.REC ON SQLS.FILE, ID
   CRT @(0,23): SQLS.REC
   CNT = CNT + 1
   GOTO 410
499*
   ERRMSG = "PROCESSED ":CNT:"  SQLColumns RECORDS"
   GOSUB 900
   GOTO 999
900*  PROCESS MESSAGES
    CRT @(0,23):CL:ERRMSG:
    INPUT XX:
    CRT @(0,23):CL:
    RETURN
999 *
    ERRMSG = "PROCESSING IS TERMINATED"
    GOSUB 900
    STOP
    END
