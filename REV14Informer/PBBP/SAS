*********************************************************************
*
*---- COPY STATEMENTS
*
*COPY>PMC.CPYLIB>INVOICE.SALES.STATS
*COPY>PMC.CPYLIB>SALES.ANAL.SUM
*COPY>JCS.CPYLIB>JOB
*COPY>OPS.CPYLIB>ORDER
*COPY>CPYLIB>CHAR
*
*---- OPEN ALL FILES
*
OPEN "","INVOICE.SALES.STATS" TO INVOICE.SALES.STATS ELSE STOP
*OPEN "","SALES.CUSTOMER" TO SALES.CUSTOMER ELSE STOP
*OPEN "","SALES.SALESREP" TO SALES.SALESREP ELSE STOP
*OPEN "","SALES.SALESCODE" TO SALES.SALESCODE ELSE STOP
*OPEN "","SALES.CATEGORY" TO SALES.CATEGORY ELSE STOP
*OPEN "","SALES.STATE" TO SALES.STATE ELSE STOP
OPEN "","SALES_FNGD" TO SALES.FNGD ELSE STOP
OPEN "","JOB" TO JOB ELSE STOP
OPEN "","ORDER" TO ORDER ELSE STOP
*
*---- MAIN PROCESSING
*
*CLEARFILE SALES.CUSTOMER
*CLEARFILE SALES.SALESREP
*CLEARFILE SALES.SALESCODE
*CLEARFILE SALES.CATEGORY
*CLEARFILE SALES.STATE
CLEARFILE SALES.FNGD
SELECT INVOICE.SALES.STATS
DATA = 1
LOOP
  READNEXT ID ELSE DATA = 0
WHILE DATA DO
  PRINT "*":
  MATREAD ISS.REC FROM INVOICE.SALES.STATS, ID THEN
    CONO = ID[1,3]
    TYPE = FIELD(ID,"_",2)
    JOBNO = FIELD(ID,"_",3)
    DIV = ISS.DIV
    IF TYPE = "J" THEN
      MATREAD JOB.REC FROM JOB, CONO:JOBNO ELSE MAT JOB.REC=""
      IF DIV = "" THEN DIV = JOB.DIV
    END ELSE
      MATREAD ORD.REC FROM ORDER, CONO:JOBNO ELSE MAT ORD.REC=""
      IF DIV = "" THEN DIV = ORD.DIV
    END
    CUST = ISS.CUST.ID
    SLSM = ISS.SLSM.ID
    SCODE = ISS.SALES.CODE
    JCATG = ISS.JOB.CAT
    STATE = TRIM(ISS.STATE)
    MON = ISS.POSTING.MONTH[5,2]
    YEAR = ISS.POSTING.MONTH[1,4]
**
** CUSTOMER
**
*    SAS.ID = CONO:"*":DIV:"*":CUST:"*":MON:"*":YEAR
*    MATREAD SAS.REC FROM SALES.CUSTOMER, SAS.ID ELSE MAT SAS.REC = ""
*    SAS.TOT.SALES = SAS.TOT.SALES + ISS.INVOICE.TOTAL + ISS.INVOICE.TAX 
*    SAS.NET.SALES = SAS.NET.SALES + ISS.INVOICE.TOTAL - ISS.COMMISSION<1,1>
*    SAS.VAL.ADDED = SAS.VAL.ADDED + ISS.VALUE.ADDED
*    SAS.TOT.COST = SAS.TOT.COST + ISS.COST.TOTAL - ISS.SHIP.COST
*    SAS.PROFIT.MARGIN = SAS.NET.SALES - SAS.TOT.COST
**    MATWRITE SAS.REC ON SALES.CUSTOMER, SAS.ID
**
** SALESREP
**
*    SAS.ID = CONO:"*":DIV:"*":SLSM:"*":MON:"*":YEAR
*    MATREAD SAS.REC FROM SALES.SALESREP, SAS.ID ELSE MAT SAS.REC = ""
*    SAS.TOT.SALES = SAS.TOT.SALES + ISS.INVOICE.TOTAL + ISS.INVOICE.TAX 
*    SAS.NET.SALES = SAS.NET.SALES + ISS.INVOICE.TOTAL - ISS.COMMISSION<1,1>
*    SAS.VAL.ADDED = SAS.VAL.ADDED + ISS.VALUE.ADDED
*    SAS.TOT.COST = SAS.TOT.COST + ISS.COST.TOTAL - ISS.SHIP.COST
*    SAS.PROFIT.MARGIN = SAS.NET.SALES - SAS.TOT.COST
**    MATWRITE SAS.REC ON SALES.SALESREP, SAS.ID
**
** SALESCODE
**
*    SAS.ID = CONO:"*":DIV:"*":SCODE:"*":MON:"*":YEAR
*    MATREAD SAS.REC FROM SALES.SALESCODE, SAS.ID ELSE MAT SAS.REC = ""
*    SAS.TOT.SALES = SAS.TOT.SALES + ISS.INVOICE.TOTAL + ISS.INVOICE.TAX 
*    SAS.NET.SALES = SAS.NET.SALES + ISS.INVOICE.TOTAL - ISS.COMMISSION<1,1>
*    SAS.VAL.ADDED = SAS.VAL.ADDED + ISS.VALUE.ADDED
*    SAS.TOT.COST = SAS.TOT.COST + ISS.COST.TOTAL - ISS.SHIP.COST
*    SAS.PROFIT.MARGIN = SAS.NET.SALES - SAS.TOT.COST
**    MATWRITE SAS.REC ON SALES.SALESCODE, SAS.ID
**
** JOB CATEGORY
**
*    SAS.ID = CONO:"*":DIV:"*":JCATG:"*":MON:"*":YEAR
*    MATREAD SAS.REC FROM SALES.CATEGORY, SAS.ID ELSE MAT SAS.REC = ""
*    SAS.TOT.SALES = SAS.TOT.SALES + ISS.INVOICE.TOTAL + ISS.INVOICE.TAX 
*    SAS.NET.SALES = SAS.NET.SALES + ISS.INVOICE.TOTAL - ISS.COMMISSION<1,1>
*    SAS.VAL.ADDED = SAS.VAL.ADDED + ISS.VALUE.ADDED
*    SAS.TOT.COST = SAS.TOT.COST + ISS.COST.TOTAL - ISS.SHIP.COST
*    SAS.PROFIT.MARGIN = SAS.NET.SALES - SAS.TOT.COST
**    MATWRITE SAS.REC ON SALES.CATEGORY, SAS.ID
**
** STATE
**
*    SAS.ID = CONO:"*":DIV:"*":STATE:"*":MON:"*":YEAR
*    MATREAD SAS.REC FROM SALES.STATE, SAS.ID ELSE MAT SAS.REC = ""
*    SAS.TOT.SALES = SAS.TOT.SALES + ISS.INVOICE.TOTAL + ISS.INVOICE.TAX 
*    SAS.NET.SALES = SAS.NET.SALES + ISS.INVOICE.TOTAL - ISS.COMMISSION<1,1>
*    SAS.VAL.ADDED = SAS.VAL.ADDED + ISS.VALUE.ADDED
*    SAS.TOT.COST = SAS.TOT.COST + ISS.COST.TOTAL - ISS.SHIP.COST
*    SAS.PROFIT.MARGIN = SAS.NET.SALES - SAS.TOT.COST
*    MATWRITE SAS.REC ON SALES.STATE, SAS.ID
*
* FNGD
*
    IF TYPE = "O" THEN
      SAS.ID = CONO:"*":DIV:"*":ISS.PROD.LINE:"*":MON:"*":YEAR
      MATREAD SAS.REC FROM SALES.FNGD, SAS.ID ELSE MAT SAS.REC = ""
      SAS.TOT.SALES = SAS.TOT.SALES + ISS.INVOICE.TOTAL + ISS.INVOICE.TAX 
      SAS.NET.SALES = SAS.NET.SALES + ISS.INVOICE.TOTAL - ISS.COMMISSION<1,1>
      SAS.VAL.ADDED = SAS.VAL.ADDED + ISS.VALUE.ADDED
      SAS.TOT.COST = SAS.TOT.COST + ISS.COST.TOTAL - ISS.SHIP.COST
      SAS.PROFIT.MARGIN = SAS.NET.SALES - SAS.TOT.COST
      MATWRITE SAS.REC ON SALES.FNGD, SAS.ID
    END
  END
REPEAT
END
